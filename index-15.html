<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Studies in Deep Learning." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Neurotic Networking (old posts, page 15) | Neurotic Networking</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/index-15.html" rel="canonical">
<link href="index-16.html" rel="prev" type="text/html">
<link href="index-14.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<link href="apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="site.webmanifest" rel="manifest">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="."><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/word-embeddings-data-preparation/">Word Embeddings: Data Preparation</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/word-embeddings-data-preparation/" rel="bookmark"><time class="published dt-published" datetime="2020-12-08T18:29:17-08:00" itemprop="datePublished" title="2020-12-08 18:29">2020-12-08 18:29</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/word-embeddings-data-preparation/#orgba959f9">Beginning</a></li>
<li><a href="posts/nlp/word-embeddings-data-preparation/#org636b201">Middle</a>
<ul>
<li><a href="posts/nlp/word-embeddings-data-preparation/#org018b88f">Cleaning and tokenization</a></li>
<li><a href="posts/nlp/word-embeddings-data-preparation/#orge0dc776">Tokenize</a></li>
<li><a href="posts/nlp/word-embeddings-data-preparation/#orge0becbc">More Processing</a></li>
<li><a href="posts/nlp/word-embeddings-data-preparation/#org139625d">Make It a Function</a></li>
<li><a href="posts/nlp/word-embeddings-data-preparation/#org009a23a">Sliding Window of Words</a></li>
<li><a href="posts/nlp/word-embeddings-data-preparation/#org2a35af6">Transforming words into vectors for the training set</a>
<ul>
<li><a href="posts/nlp/word-embeddings-data-preparation/#org87decdf">Mapping words to indices and indices to words</a></li>
<li><a href="posts/nlp/word-embeddings-data-preparation/#org9bc1428">Getting one-hot word vectors</a></li>
<li><a href="posts/nlp/word-embeddings-data-preparation/#orgc8eefbc">Getting context word vectors</a></li>
</ul>
</li>
<li><a href="posts/nlp/word-embeddings-data-preparation/#org27893f3">Building the training set</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgba959f9">
<h2 id="orgba959f9">Beginning</h2>
<div class="outline-text-2" id="text-orgba959f9">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">emoji</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org636b201">
<h2 id="org636b201">Middle</h2>
<div class="outline-text-2" id="text-org636b201"></div>
<div class="outline-3" id="outline-container-org018b88f">
<h3 id="org018b88f">Cleaning and tokenization</h3>
<div class="outline-text-3" id="text-org018b88f">
<p>To demonstrate the cleaning and tokenization process, consider a corpus that contains emojis and various punctuation signs. Let's define a corpus:</p>
<div class="highlight">
<pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="s1">'Who ❤️ "word embeddings" in 2020? I do!!!'</span>
</pre></div>
<p>First, replace all interrupting punctuation signs — such as commas and exclamation marks — with periods.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Corpus:  </span><span class="si">{</span><span class="n">corpus</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="c1"># Do the substitution</span>
<span class="n">ONE_OR_MORE</span> <span class="o">=</span> <span class="s2">"+"</span>
<span class="n">PERIOD</span> <span class="o">=</span> <span class="s2">"."</span>
<span class="n">PUNCTUATION</span> <span class="o">=</span> <span class="s2">",!?;-"</span>
<span class="n">CHARACTERS</span> <span class="o">=</span> <span class="s2">"[</span><span class="si">{}</span><span class="s2">]"</span>
<span class="n">EXPRESSION</span> <span class="o">=</span> <span class="n">CHARACTERS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PUNCTUATION</span><span class="p">)</span> <span class="o">+</span> <span class="n">ONE_OR_MORE</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">EXPRESSION</span><span class="p">,</span> <span class="n">PERIOD</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span>
<span class="c1"># Print cleaned corpus</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"After cleaning punctuation:  '</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Corpus:  Who ❤️ "word embeddings" in 2020? I do!!!
After cleaning punctuation:  'Who ❤️ "word embeddings" in 2020. I do.'
</pre></div>
</div>
<div class="outline-3" id="outline-container-orge0dc776">
<h3 id="orge0dc776">Tokenize</h3>
<div class="outline-text-3" id="text-orge0dc776">
<p>Next, use NLTK's tokenization engine to split the corpus into individual tokens.</p>
<div class="highlight">
<pre><span></span><span class="c1"># Print cleaned corpus</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Initial string:  </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="c1"># Tokenize the cleaned corpus</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Print the tokenized version of the corpus</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'After tokenization:  </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
<pre class="example">
Initial string:  Who ❤️ "word embeddings" in 2020. I do.
After tokenization:  ['Who', '❤️', '``', 'word', 'embeddings', "''", 'in', '2020', '.', 'I', 'do', '.']
</pre></div>
</div>
<div class="outline-3" id="outline-container-orge0becbc">
<h3 id="orge0becbc">More Processing</h3>
<div class="outline-text-3" id="text-orge0becbc">
<p>Finally, as you saw in the lecture, get rid of numbers and punctuation other than periods, and convert all the remaining tokens to lowercase.</p>
<div class="highlight">
<pre><span></span><span class="c1"># Print the tokenized version of the corpus</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Initial list of tokens:  </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="c1"># Filter tokenized corpus using list comprehension</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span> <span class="n">character</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">data</span>
         <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">character</span><span class="o">.</span><span class="n">isalpha</span><span class="p">(),</span>
                 <span class="n">character</span><span class="o">==</span> <span class="s1">'.'</span><span class="p">,</span>
                 <span class="n">emoji</span><span class="o">.</span><span class="n">get_emoji_regexp</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">character</span><span class="p">)))</span>
       <span class="p">]</span>

<span class="c1"># Print the tokenized and filtered version of the corpus</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"After cleaning:  '</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Initial list of tokens:  ['Who', '❤️', '``', 'word', 'embeddings', "''", 'in', '2020', '.', 'I', 'do', '.']
After cleaning:  '['who', '❤️', 'word', 'embeddings', 'in', '.', 'i', 'do', '.']'
</pre>
<p>Note that the heart emoji is considered a token just like any normal word.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org139625d">
<h3 id="org139625d">Make It a Function</h3>
<div class="outline-text-3" id="text-org139625d">
<p>Now let's streamline the cleaning and tokenization process by wrapping the previous steps in a function.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="n">corpus</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""clean and tokenize the corpus</span>

<span class="sd">    Args:</span>
<span class="sd">     corpus: original source text</span>

<span class="sd">    Returns:</span>
<span class="sd">     list of cleaned tokens from the corpus</span>
<span class="sd">    """</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">EXPRESSION</span><span class="p">,</span> <span class="n">PERIOD</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span> <span class="n">character</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">data</span>
             <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">character</span><span class="o">.</span><span class="n">isalpha</span><span class="p">(),</span>
                     <span class="n">character</span><span class="o">==</span> <span class="s1">'.'</span><span class="p">,</span>
                     <span class="n">emoji</span><span class="o">.</span><span class="n">get_emoji_regexp</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">character</span><span class="p">)))</span>
       <span class="p">]</span>    
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
<p>Apply this function to the corpus that you'll be working on in the rest of this notebook: "I am happy because I am learning"</p>
<div class="highlight">
<pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="s1">'I am happy because I am learning'</span>

<span class="c1"># Print new corpus</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Corpus:  </span><span class="si">{</span><span class="n">corpus</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="c1"># Save tokenized version of corpus into 'words' variable</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>

<span class="c1"># Print the tokenized version of the corpus</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Words (tokens):  </span><span class="si">{</span><span class="n">words</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
<pre class="example">
Corpus:  I am happy because I am learning
Words (tokens):  ['i', 'am', 'happy', 'because', 'i', 'am', 'learning']
</pre>
<p>An alternative sentence.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tokenize</span><span class="p">(</span><span class="s2">"I'm tired of being a token! Where's all the other cheese-sniffing Gnomish at? I bet theres' at least 2 of us out there, or maybe more..."</span><span class="p">))</span>
</pre></div>
<pre class="example">
['i', 'tired', 'of', 'being', 'a', 'token', '.', 'where', 'all', 'the', 'other', 'gnomish', 'at', '.', 'i', 'bet', 'theres', 'at', 'least', 'of', 'us', 'out', 'there', '.', 'or', 'maybe', 'more']
</pre></div>
</div>
<div class="outline-3" id="outline-container-org009a23a">
<h3 id="org009a23a">Sliding Window of Words</h3>
<div class="outline-text-3" id="text-org009a23a">
<p>Now that you have transformed the corpus into a list of clean tokens, you can slide a window of words across this list. For each window you can extract a center word and the context words.</p>
<p>The <code>get_windows</code> function in the next cell was introduced in the lecture.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">get_windows</span><span class="p">(</span><span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">half_window</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">"""Generates windows of words</span>

<span class="sd">    Args:</span>
<span class="sd">     words: cleaned tokens</span>
<span class="sd">     half_window: number of words in the half-window</span>

<span class="sd">    Yields:</span>
<span class="sd">     the next window</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">center_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">half_window</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">-</span> <span class="n">half_window</span><span class="p">):</span>
        <span class="n">center_word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">center_index</span><span class="p">]</span>
        <span class="n">context_words</span> <span class="o">=</span> <span class="p">(</span><span class="n">words</span><span class="p">[(</span><span class="n">center_index</span> <span class="o">-</span> <span class="n">half_window</span><span class="p">)</span> <span class="p">:</span> <span class="n">center_index</span><span class="p">]</span>
                         <span class="o">+</span> <span class="n">words</span><span class="p">[(</span><span class="n">center_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):(</span><span class="n">center_index</span> <span class="o">+</span> <span class="n">half_window</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">yield</span> <span class="n">context_words</span><span class="p">,</span> <span class="n">center_word</span>
    <span class="k">return</span>
</pre></div>
<p>The first argument of this function is a list of words (or tokens). The second argument, <code>C</code>, is the context half-size. Recall that for a given center word, the context words are made of <code>C</code> words to the left and <code>C</code> words to the right of the center word.</p>
<p>Here is how you can use this function to extract context words and center words from a list of tokens. These context and center words will make up the training set that you will use to train the CBOW model.</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">get_windows</span><span class="p">([</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
<pre class="example">
['i', 'am', 'because', 'i']     happy
['am', 'happy', 'i', 'am']      because
['happy', 'because', 'am', 'learning']  i
</pre>
<p>The first example of the training set is made of:</p>
<ul class="org-ul">
<li>the context words "i", "am", "because", "i",</li>
<li>and the center word to be predicted: "happy".</li>
</ul>
<p><b>Now try it out yourself. In the next cell, you can change both the sentence and the context half-size.</b></p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">get_windows</span><span class="p">(</span><span class="n">tokenize</span><span class="p">(</span><span class="s2">"My baloney has a first name, it's Gerald."</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
<pre class="example">
['my', 'baloney', 'a', 'first'] has
['baloney', 'has', 'first', 'name']     a
['has', 'a', 'name', '.']       first
['a', 'first', '.', 'it']       name
['first', 'name', 'it', 'gerald']       .
['name', '.', 'gerald', '.']    it
</pre></div>
</div>
<div class="outline-3" id="outline-container-org2a35af6">
<h3 id="org2a35af6">Transforming words into vectors for the training set</h3>
<div class="outline-text-3" id="text-org2a35af6">
<p>To finish preparing the training set, you need to transform the context words and center words into vectors.</p>
</div>
<div class="outline-4" id="outline-container-org87decdf">
<h4 id="org87decdf">Mapping words to indices and indices to words</h4>
<div class="outline-text-4" id="text-org87decdf">
<p>The center words will be represented as one-hot vectors, and the vectors that represent context words are also based on one-hot vectors.</p>
<p>To create one-hot word vectors, you can start by mapping each unique word to a unique integer (or index). We have provided a helper function, <code>get_dict</code>, that creates a Python dictionary that maps words to integers and back.</p>
<p>Get 'word2Ind' and 'Ind2word' dictionaries for the tokenized corpus.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">get_dict</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""Creates index to word mappings</span>

<span class="sd">    The index is based on sorted unique tokens in the data</span>

<span class="sd">    Args:</span>
<span class="sd">       data: the data you want to pull from</span>

<span class="sd">    Returns:</span>
<span class="sd">       word2Ind: returns dictionary mapping the word to its index</span>
<span class="sd">       Ind2Word: returns dictionary mapping the index to its word</span>
<span class="sd">    """</span>
    <span class="n">words</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

    <span class="n">word_to_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">word</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">)}</span>
    <span class="n">index_to_word</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="n">word</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">word_to_index</span><span class="p">,</span> <span class="n">index_to_word</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">word2Ind</span><span class="p">,</span> <span class="n">Ind2word</span> <span class="o">=</span> <span class="n">get_dict</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">word2Ind</span><span class="p">)</span>
</pre></div>
<pre class="example">
{'am': 0, 'because': 1, 'happy': 2, 'i': 3, 'learning': 4}
</pre>
<p>You can use this dictionary to get the index of a word.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Index of the word 'i':  </span><span class="si">{</span><span class="n">word2Ind</span><span class="p">[</span><span class="s1">'i'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Index of the word 'i':  3
</pre>
<p>And conversely, here's the dictionary that maps indices to words.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Ind2word</span><span class="p">)</span>
</pre></div>
<pre class="example">
{0: 'am', 1: 'because', 2: 'happy', 3: 'i', 4: 'learning'}
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Word which has index 2:  '</span><span class="si">{</span><span class="n">Ind2word</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Word which has index 2:  'happy'
</pre>
<p>Finally, get the length of either of these dictionaries to get the size of the vocabulary of your corpus, in other words the number of different words making up the corpus.</p>
<div class="highlight">
<pre><span></span><span class="n">vocabulary_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word2Ind</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Size of vocabulary: </span><span class="si">{</span><span class="n">vocabulary_size</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Size of vocabulary: 5
</pre></div>
</div>
<div class="outline-4" id="outline-container-org9bc1428">
<h4 id="org9bc1428">Getting one-hot word vectors</h4>
<div class="outline-text-4" id="text-org9bc1428">
<p>Recall from the lecture that you can easily convert an integer, <i>n</i>, into a one-hot vector.</p>
<p>Consider the word "happy". First, retrieve its numeric index.</p>
<div class="highlight">
<pre><span></span><span class="n">happy_index</span> <span class="o">=</span> <span class="n">word2Ind</span><span class="p">[</span><span class="s1">'happy'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">happy_index</span><span class="p">)</span>
</pre></div>
<pre class="example">
2
</pre>
<p>Now create a vector with the size of the vocabulary, and fill it with zeros. Create vector with the same length as the vocabulary, filled with zeros</p>
<div class="highlight">
<pre><span></span><span class="n">center_word_vector</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">vocabulary_size</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">center_word_vector</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">center_word_vector</span><span class="p">)</span> <span class="o">==</span> <span class="n">vocabulary_size</span>
</pre></div>
<pre class="example">
[0. 0. 0. 0. 0.]
</pre>
<p>Next, replace the 0 of the $n$-th element with a 1.</p>
<p>Replace element number 'n' with a 1</p>
<div class="highlight">
<pre><span></span><span class="n">center_word_vector</span><span class="p">[</span><span class="n">happy_index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
<p>And you have your one-hot word vector.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">center_word_vector</span><span class="p">)</span>
</pre></div>
<pre class="example">
[0. 0. 1. 0. 0.]
</pre>
<p><b>You can now group all of these steps in a convenient function, which takes as parameters: a word to be encoded, a dictionary that maps words to indices, and the size of the vocabulary.</b></p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">word_to_one_hot_vector</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">word_to_index</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                           <span class="n">vocabulary_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Create a one-hot-vector with a 1 where the word is</span>


<span class="sd">    Args:</span>
<span class="sd">     word: known token to add to the vector</span>
<span class="sd">     word_to_index: dict mapping word: index</span>
<span class="sd">     vocabulary_size: how long to make the vector</span>

<span class="sd">    Returns:</span>
<span class="sd">     vector with zeros everywhere except where the word is</span>
<span class="sd">    """</span>
    <span class="n">one_hot_vector</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">vocabulary_size</span><span class="p">)</span>
    <span class="n">one_hot_vector</span><span class="p">[</span><span class="n">word_to_index</span><span class="p">[</span><span class="n">word</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">one_hot_vector</span>
</pre></div>
<p>Check that it works as intended.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">word_to_one_hot_vector</span><span class="p">(</span><span class="s1">'happy'</span><span class="p">,</span> <span class="n">word2Ind</span><span class="p">,</span> <span class="n">vocabulary_size</span><span class="p">))</span>
</pre></div>
<pre class="example">
[0. 0. 1. 0. 0.]
</pre>
<p><b>What is the word vector for "learning"?</b></p>
<div class="highlight">
<pre><span></span><span class="n">actual</span> <span class="o">=</span> <span class="n">word_to_one_hot_vector</span><span class="p">(</span><span class="s1">'learning'</span><span class="p">,</span> <span class="n">word2Ind</span><span class="p">,</span> <span class="n">vocabulary_size</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">)</span>
</pre></div>
<pre class="example">
[0. 0. 0. 0. 1.]
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgc8eefbc">
<h4 id="orgc8eefbc">Getting context word vectors</h4>
<div class="outline-text-4" id="text-orgc8eefbc">
<p>To create the vectors that represent context words, you will calculate the average of the one-hot vectors representing the individual words.</p>
<p>Let's start with a list of context words.</p>
<div class="highlight">
<pre><span></span><span class="n">context_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">]</span>
</pre></div>
<p>Using Python's list comprehension construct and the <code>word_to_one_hot_vector</code> function that you created in the previous section, you can create a list of one-hot vectors representing each of the context words.</p>
<p>Create one-hot vectors for each context word using list comprehension</p>
<div class="highlight">
<pre><span></span><span class="n">context_words_vectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">word_to_one_hot_vector</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">word2Ind</span><span class="p">,</span> <span class="n">vocabulary_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">context_words</span><span class="p">]</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">context_words_vectors</span><span class="p">)</span>
</pre></div>
<pre class="example">
[array([0., 0., 0., 1., 0.]),
 array([1., 0., 0., 0., 0.]),
 array([0., 1., 0., 0., 0.]),
 array([0., 0., 0., 1., 0.])]
</pre>
<p>And you can now simply get the average of these vectors using numpy's <code>mean</code> function, to get the vector representation of the context words.</p>
<div class="highlight">
<pre><span></span><span class="n">ROWS</span><span class="p">,</span> <span class="n">COLUMNS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">context_words_vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ROWS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
</pre></div>
<pre class="example">
[0.25 0.25 0.   0.5  0.  ]
</pre>
<p><b>Now create the <code>context_words_to_vector</code> function that takes in a list of context words, a word-to-index dictionary, and a vocabulary size, and outputs the vector representation of the context words.</b></p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">context_words_to_vector</span><span class="p">(</span><span class="n">context_words</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                            <span class="n">word_to_index</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Create vector with the mean of the one-hot-vectors</span>

<span class="sd">    Args:</span>
<span class="sd">     context_words: words to covert to one-hot vectors</span>
<span class="sd">     word_to_index: dict mapping word to index</span>
<span class="sd">    """</span>
    <span class="n">vocabulary_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_to_index</span><span class="p">)</span>
    <span class="n">context_words_vectors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">word_to_one_hot_vector</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">word_to_index</span><span class="p">,</span> <span class="n">vocabulary_size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">context_words</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">context_words_vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ROWS</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">words_to_vector</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">context_words_to_vector</span><span class="p">,</span> <span class="n">word_to_index</span><span class="o">=</span><span class="n">word2Ind</span><span class="p">)</span>
<span class="n">second</span> <span class="o">=</span> <span class="n">words_to_vector</span><span class="p">([</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">first</span><span class="o">==</span><span class="n">second</span><span class="p">)</span>
</pre></div>
<pre class="example">
[0.25 0.25 0.   0.5  0.  ]
</pre>
<p><b>What is the vector representation of the context words "am happy i am"?</b></p>
<div class="highlight">
<pre><span></span><span class="n">actual</span> <span class="o">=</span> <span class="n">words_to_vector</span><span class="p">([</span><span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">])</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span> <span class="p">,</span> <span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.</span>  <span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">)</span>
</pre></div>
<pre class="example">
[0.5  0.   0.25 0.25 0.  ]
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org27893f3">
<h3 id="org27893f3">Building the training set</h3>
<div class="outline-text-3" id="text-org27893f3">
<p>You can now combine the functions that you created in the previous sections, to build a training set for the CBOW model, starting from the following tokenized corpus.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</pre></div>
<pre class="example">
['i', 'am', 'happy', 'because', 'i', 'am', 'learning']
</pre>
<p>To do this you need to use the sliding window function (<code>get_windows</code>) to extract the context words and center words, and you then convert these sets of words into a basic vector representation using <code>word_to_one_hot_vector</code> and <code>context_words_to_vector</code>.</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">context_words</span><span class="p">,</span> <span class="n">center_word</span> <span class="ow">in</span> <span class="n">get_windows</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">half_window</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Context words:  </span><span class="si">{</span><span class="n">context_words</span><span class="si">}</span><span class="s1"> -&gt; </span><span class="si">{</span><span class="n">words_to_vector</span><span class="p">(</span><span class="n">context_words</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Center word:  </span><span class="si">{</span><span class="n">center_word</span><span class="si">}</span><span class="s2"> -&gt; "</span>
          <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">word_to_one_hot_vector</span><span class="p">(</span><span class="n">center_word</span><span class="p">,</span> <span class="n">word2Ind</span><span class="p">,</span> <span class="n">vocabulary_size</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
<pre class="example">
Context words:  ['i', 'am', 'because', 'i'] -&gt; [0.25 0.25 0.   0.5  0.  ]
Center word:  happy -&gt; [0. 0. 1. 0. 0.]

Context words:  ['am', 'happy', 'i', 'am'] -&gt; [0.5  0.   0.25 0.25 0.  ]
Center word:  because -&gt; [0. 1. 0. 0. 0.]

Context words:  ['happy', 'because', 'am', 'learning'] -&gt; [0.25 0.25 0.25 0.   0.25]
Center word:  i -&gt; [0. 0. 0. 1. 0.]

</pre>
<p>In this practice notebook you'll be performing a single iteration of training using a single example, but in this week's assignment you'll train the CBOW model using several iterations and batches of example. Here is how you would use a Python generator function (remember the `yield` keyword from the lecture?) to make it easier to iterate over a set of examples.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">get_training_example</span><span class="p">(</span><span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">half_window</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">word_to_index</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="sd">"""generates training examples</span>

<span class="sd">    Args:</span>
<span class="sd">     words: source of words</span>
<span class="sd">     half_window: half the window size</span>
<span class="sd">     word_to_index: dict with word to index mapping</span>
<span class="sd">    """</span>
    <span class="n">vocabulary_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_to_index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">context_words</span><span class="p">,</span> <span class="n">center_word</span> <span class="ow">in</span> <span class="n">get_windows</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">half_window</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">words_to_vector</span><span class="p">(</span><span class="n">context_words</span><span class="p">),</span> <span class="n">word_to_one_hot_vector</span><span class="p">(</span>
            <span class="n">center_word</span><span class="p">,</span> <span class="n">word_to_index</span><span class="p">,</span>
            <span class="n">vocabulary_size</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
<p>The output of this function can be iterated on to get successive context word vectors and center word vectors, as demonstrated in the next cell.</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">context_words_vector</span><span class="p">,</span> <span class="n">center_word_vector</span> <span class="ow">in</span> <span class="n">get_training_example</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">word2Ind</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Context words vector:  </span><span class="si">{</span><span class="n">context_words_vector</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Center word vector:  </span><span class="si">{</span><span class="n">center_word_vector</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
<pre class="example">
Context words vector:  [0.25 0.25 0.   0.5  0.  ]
Center word vector:  [0. 0. 1. 0. 0.]

Context words vector:  [0.5  0.   0.25 0.25 0.  ]
Center word vector:  [0. 1. 0. 0. 0.]

Context words vector:  [0.25 0.25 0.25 0.   0.25]
Center word vector:  [0. 0. 0. 1. 0.]

</pre>
<p>Now that the training set is ready, we can move on to the CBOW model itself which will be covered in the <a href="posts/nlp/introducing-the-cbow-model/">next post</a>.</p>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/auto-complete-building-the-auto-complete-system/">Auto-Complete: Building the Auto-Complete System</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/auto-complete-building-the-auto-complete-system/" rel="bookmark"><time class="published dt-published" datetime="2020-12-04T15:21:47-08:00" itemprop="datePublished" title="2020-12-04 15:21">2020-12-04 15:21</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#org165ed84">Build the Auto-Complete System</a>
<ul>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#orgd457a1d">Imports</a></li>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#orged44f9e">Set Up</a>
<ul>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#org361b219">The Environment</a></li>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#org6b1296d">The Data</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#org2eb4a8b">Middle</a>
<ul>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#orga17dd4a">Probabilities Again</a></li>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#org2e38c91">Suggest-a-Word</a>
<ul>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#orgadbda70">Hints</a></li>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#org9efb0eb">Test It Out</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#orgb7558b5">Multiple Suggestions</a>
<ul>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#org8604562">Test It</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#org0e466c3">Multiple Word Suggestions</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/#org47290bb">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org165ed84">
<h2 id="org165ed84">Build the Auto-Complete System</h2>
<div class="outline-text-2" id="text-org165ed84">
<p>In the <a href="posts/nlp/auto-complete-perplexity/">previous post</a> we tested the perplexity of our N-Gram Language model. In this, the final post in the series that we began <a href="posts/nlp/auto-complete/">with this post</a>, we'll implement the final system.</p>
</div>
<div class="outline-3" id="outline-container-orgd457a1d">
<h3 id="orgd457a1d">Imports</h3>
<div class="outline-text-3" id="text-orgd457a1d">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocomplete</span> <span class="kn">import</span> <span class="n">NGrams</span><span class="p">,</span> <span class="n">Tokenizer</span><span class="p">,</span> <span class="n">TrainTestSplit</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orged44f9e">
<h3 id="orged44f9e">Set Up</h3>
<div class="outline-text-3" id="text-orged44f9e"></div>
<div class="outline-4" id="outline-container-org361b219">
<h4 id="org361b219">The Environment</h4>
<div class="outline-text-4" id="text-org361b219">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org6b1296d">
<h4 id="org6b1296d">The Data</h4>
<div class="outline-text-4" id="text-org6b1296d">
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"TWITTER_AUTOCOMPLETE"</span><span class="p">]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org2eb4a8b">
<h2 id="org2eb4a8b">Middle</h2>
<div class="outline-text-2" id="text-org2eb4a8b"></div>
<div class="outline-3" id="outline-container-orga17dd4a">
<h3 id="orga17dd4a">Probabilities Again</h3>
<div class="outline-text-3" id="text-orga17dd4a">
<p>Once again the function we're defining here expects this probability function so I'm going to have to paste it in here.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">estimate_probability</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">previous_n_gram</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> 
                         <span class="n">n_gram_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                         <span class="n">n_plus1_gram_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                         <span class="n">vocabulary_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                         <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Estimate the probabilities of a next word using the n-gram counts with k-smoothing</span>

<span class="sd">    Args:</span>
<span class="sd">       word: next word</span>
<span class="sd">       previous_n_gram: A sequence of words of length n</span>
<span class="sd">       n_gram_counts: Dictionary of counts of n-grams</span>
<span class="sd">       n_plus1_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       vocabulary_size: number of words in the vocabulary</span>
<span class="sd">       k: positive constant, smoothing parameter</span>

<span class="sd">    Returns:</span>
<span class="sd">       A probability</span>
<span class="sd">    """</span>
    <span class="n">previous_n_gram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">)</span>
    <span class="n">previous_n_gram_count</span> <span class="o">=</span> <span class="n">n_gram_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">n_plus1_gram</span> <span class="o">=</span> <span class="n">previous_n_gram</span> <span class="o">+</span> <span class="p">(</span><span class="n">word</span><span class="p">,)</span>  
    <span class="n">n_plus1_gram_count</span> <span class="o">=</span> <span class="n">n_plus1_gram_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_plus1_gram</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       
    <span class="k">return</span> <span class="p">(</span><span class="n">n_plus1_gram_count</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">previous_n_gram_count</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">vocabulary_size</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">estimate_probabilities</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">,</span> <span class="n">n_gram_counts</span><span class="p">,</span> <span class="n">n_plus1_gram_counts</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Estimate the probabilities of next words using the n-gram counts with k-smoothing</span>

<span class="sd">    Args:</span>
<span class="sd">       previous_n_gram: A sequence of words of length n</span>
<span class="sd">       n_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       n_plus1_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       vocabulary: List of words</span>
<span class="sd">       k: positive constant, smoothing parameter</span>

<span class="sd">    Returns:</span>
<span class="sd">       A dictionary mapping from next words to the probability.</span>
<span class="sd">    """</span>

    <span class="c1"># convert list to tuple to use it as a dictionary key</span>
    <span class="n">previous_n_gram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">)</span>

    <span class="c1"># add &lt;e&gt; &lt;unk&gt; to the vocabulary</span>
    <span class="c1"># &lt;s&gt; is not needed since it should not appear as the next word</span>
    <span class="n">vocabulary</span> <span class="o">=</span> <span class="n">vocabulary</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"&lt;e&gt;"</span><span class="p">,</span> <span class="s2">"&lt;unk&gt;"</span><span class="p">]</span>
    <span class="n">vocabulary_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span>

    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocabulary</span><span class="p">:</span>
        <span class="n">probability</span> <span class="o">=</span> <span class="n">estimate_probability</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">previous_n_gram</span><span class="p">,</span> 
                                           <span class="n">n_gram_counts</span><span class="p">,</span> <span class="n">n_plus1_gram_counts</span><span class="p">,</span> 
                                           <span class="n">vocabulary_size</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="n">probabilities</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">probability</span>

    <span class="k">return</span> <span class="n">probabilities</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2e38c91">
<h3 id="org2e38c91">Suggest-a-Word</h3>
<div class="outline-text-3" id="text-org2e38c91">
<p>Compute probabilities for all possible next words and suggest the most likely one.</p>
<ul class="org-ul">
<li>This function also take an optional argument `start_with`, which specifies the first few letters of the next words.</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgadbda70">
<h4 id="orgadbda70">Hints</h4>
<div class="outline-text-4" id="text-orgadbda70">
<ul class="org-ul">
<li><code>estimate_probabilities</code> returns a dictionary where the key is a word and the value is the word's probability.</li>
<li>Use <code>str1.startswith(str2)</code> to determine if a string starts with the letters of another string. For example, <code>'learning'.startswith('lea')</code> returns True, whereas <code>'learning'.startswith('ear')</code> returns False. There are two additional parameters in <code>str.startswith()</code>, but you can use the default values for those parameters in this case.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C11 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1"># GRADED FUNCTION: suggest_a_word</span>
<span class="k">def</span> <span class="nf">suggest_a_word</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">n_gram_counts</span><span class="p">,</span> <span class="n">n_plus1_gram_counts</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">start_with</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Get suggestion for the next word</span>

<span class="sd">    Args:</span>
<span class="sd">       previous_tokens: The sentence you input where each token is a word. Must have length &gt; n </span>
<span class="sd">       n_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       n_plus1_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       vocabulary: List of words</span>
<span class="sd">       k: positive constant, smoothing parameter</span>
<span class="sd">       start_with: If not None, specifies the first few letters of the next word</span>

<span class="sd">    Returns:</span>
<span class="sd">       A tuple of </span>
<span class="sd">         - string of the most likely next word</span>
<span class="sd">         - corresponding probability</span>
<span class="sd">    """</span>

    <span class="c1"># length of previous words</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">n_gram_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span> 

    <span class="c1"># From the words that the user already typed</span>
    <span class="c1"># get the most recent 'n' words as the previous n-gram</span>
    <span class="n">previous_n_gram</span> <span class="o">=</span> <span class="n">previous_tokens</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>

    <span class="c1"># Estimate the probabilities that each word in the vocabulary</span>
    <span class="c1"># is the next word,</span>
    <span class="c1"># given the previous n-gram, the dictionary of n-gram counts,</span>
    <span class="c1"># the dictionary of n plus 1 gram counts, and the smoothing constant</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">estimate_probabilities</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">,</span>
                                           <span class="n">n_gram_counts</span><span class="p">,</span> <span class="n">n_plus1_gram_counts</span><span class="p">,</span>
                                           <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

    <span class="c1"># Initialize suggested word to None</span>
    <span class="c1"># This will be set to the word with highest probability</span>
    <span class="n">suggestion</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Initialize the highest word probability to 0</span>
    <span class="c1"># this will be set to the highest probability </span>
    <span class="c1"># of all words to be suggested</span>
    <span class="n">max_prob</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># For each word and its probability in the probabilities dictionary:</span>
    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1"># complete this line</span>

        <span class="c1"># If the optional start_with string is set</span>
        <span class="k">if</span> <span class="n">start_with</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># complete this line</span>

            <span class="c1"># Check if the beginning of word does not match with the letters in 'start_with'</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">start_with</span><span class="p">):</span> <span class="c1"># complete this line</span>

                <span class="c1"># if they don't match, skip this word (move onto the next word)</span>
                <span class="k">continue</span> <span class="c1"># complete this line</span>

        <span class="c1"># Check if this word's probability</span>
        <span class="c1"># is greater than the current maximum probability</span>
        <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;</span> <span class="n">max_prob</span><span class="p">:</span> <span class="c1"># complete this line</span>

            <span class="c1"># If so, save this word as the best suggestion (so far)</span>
            <span class="n">suggestion</span> <span class="o">=</span> <span class="n">word</span>

            <span class="c1"># Save the new maximum probability</span>
            <span class="n">max_prob</span> <span class="o">=</span> <span class="n">prob</span>

    <span class="c1">### END CODE HERE</span>

    <span class="k">return</span> <span class="n">suggestion</span><span class="p">,</span> <span class="n">max_prob</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org9efb0eb">
<h4 id="org9efb0eb">Test It Out</h4>
<div class="outline-text-4" id="text-org9efb0eb">
<div class="highlight">
<pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
             <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>
<span class="n">unique_words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">unigram_counts</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span>
<span class="n">bigram_counts</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span>

<span class="n">previous_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"i"</span><span class="p">,</span> <span class="s2">"like"</span><span class="p">]</span>
<span class="n">word</span><span class="p">,</span> <span class="n">probability</span> <span class="o">=</span> <span class="n">suggest_a_word</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">unigram_counts</span><span class="p">,</span> <span class="n">bigram_counts</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The previous words are 'i like',</span><span class="se">\n\t</span><span class="s2">and the suggested word is `</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">` with a probability of </span><span class="si">{</span><span class="n">probability</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expected_word</span><span class="p">,</span> <span class="n">expected_probability</span> <span class="o">=</span> <span class="s2">"a"</span><span class="p">,</span> <span class="mf">0.2727</span>
<span class="n">expect</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected_word</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">probability</span><span class="p">,</span> <span class="n">expected_probability</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># test your code when setting the starts_with</span>
<span class="n">tmp_starts_with</span> <span class="o">=</span> <span class="s1">'c'</span>
<span class="n">word</span><span class="p">,</span> <span class="n">probability</span> <span class="o">=</span> <span class="n">suggest_a_word</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">unigram_counts</span><span class="p">,</span> <span class="n">bigram_counts</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">start_with</span><span class="o">=</span><span class="n">tmp_starts_with</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The previous words are 'i like', the suggestion must start with `</span><span class="si">{</span><span class="n">tmp_starts_with</span><span class="si">}</span><span class="s2">`</span><span class="se">\n\t</span><span class="s2">and the suggested word is `</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">` with a probability of </span><span class="si">{</span><span class="n">probability</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expected_word</span><span class="p">,</span> <span class="n">expected_probability</span> <span class="o">=</span> <span class="s2">"cat"</span><span class="p">,</span> <span class="mf">0.0909</span>
<span class="n">expect</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected_word</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">probability</span><span class="p">,</span> <span class="n">expected_probability</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
<pre class="example">
The previous words are 'i like',
        and the suggested word is `a` with a probability of 0.2727

The previous words are 'i like', the suggestion must start with `c`
        and the suggested word is `cat` with a probability of 0.0909
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgb7558b5">
<h3 id="orgb7558b5">Multiple Suggestions</h3>
<div class="outline-text-3" id="text-orgb7558b5">
<p>The function defined below loops over various n-gram models to get multiple suggestions.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">n_gram_counts_list</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">start_with</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">model_counts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_gram_counts_list</span><span class="p">)</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_counts</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">n_gram_counts</span> <span class="o">=</span> <span class="n">n_gram_counts_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">n_plus1_gram_counts</span> <span class="o">=</span> <span class="n">n_gram_counts_list</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">suggestion</span> <span class="o">=</span> <span class="n">suggest_a_word</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">n_gram_counts</span><span class="p">,</span>
                                    <span class="n">n_plus1_gram_counts</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span>
                                    <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">start_with</span><span class="o">=</span><span class="n">start_with</span><span class="p">)</span>
        <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suggestion</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">suggestions</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org8604562">
<h4 id="org8604562">Test It</h4>
<div class="outline-text-4" id="text-org8604562">
<div class="highlight">
<pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
             <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>
<span class="n">unique_words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">unigram_counts</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span>
<span class="n">bigram_counts</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span>
<span class="n">trigram_counts</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span>
<span class="n">quadgram_counts</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span>
<span class="n">qintgram_counts</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span>

<span class="n">n_gram_counts_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">unigram_counts</span><span class="p">,</span> <span class="n">bigram_counts</span><span class="p">,</span> <span class="n">trigram_counts</span><span class="p">,</span> <span class="n">quadgram_counts</span><span class="p">,</span> <span class="n">qintgram_counts</span><span class="p">]</span>
<span class="n">previous_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"i"</span><span class="p">,</span> <span class="s2">"like"</span><span class="p">]</span>
<span class="n">tmp_suggest3</span> <span class="o">=</span> <span class="n">get_suggestions</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">n_gram_counts_list</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The previous words are 'i like', the suggestions are:"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">tmp_suggest3</span><span class="p">)</span>
</pre></div>
<pre class="example">
The previous words are 'i like', the suggestions are:
</pre>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<tbody>
<tr>
<td class="org-left">a</td>
<td class="org-right">0.2727272727272727</td>
</tr>
<tr>
<td class="org-left">a</td>
<td class="org-right">0.2</td>
</tr>
<tr>
<td class="org-left">like</td>
<td class="org-right">0.1111111111111111</td>
</tr>
<tr>
<td class="org-left">like</td>
<td class="org-right">0.1111111111111111</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org0e466c3">
<h3 id="org0e466c3">Multiple Word Suggestions</h3>
<div class="outline-text-3" id="text-org0e466c3">
<div class="highlight">
<pre><span></span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">splitter</span> <span class="o">=</span> <span class="n">TrainTestSplit</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenized</span><span class="p">)</span>
<span class="n">train_data_processed</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">training</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">n_gram_counts_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">NGrams</span><span class="p">(</span><span class="n">train_data_processed</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">vocabulary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">train_data_processed</span><span class="p">)))</span>
<span class="n">previous_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"i"</span><span class="p">,</span> <span class="s2">"am"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">]</span>
<span class="n">tmp_suggest4</span> <span class="o">=</span> <span class="n">get_suggestions</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">n_gram_counts_list</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The previous words are </span><span class="si">{</span><span class="n">previous_tokens</span><span class="si">}</span><span class="s2">, the suggestions are:"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">tmp_suggest4</span><span class="p">)</span>
</pre></div>
<pre class="example">
The previous words are ['i', 'am', 'to'], the suggestions are:
</pre>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<tbody>
<tr>
<td class="org-left">be</td>
<td class="org-right">0.015552924847940564</td>
</tr>
<tr>
<td class="org-left">please</td>
<td class="org-right">5.4935999560512006e-05</td>
</tr>
<tr>
<td class="org-left">please</td>
<td class="org-right">5.494354550699157e-05</td>
</tr>
<tr>
<td class="org-left">sucks</td>
<td class="org-right">2.747403703500192e-05</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">previous_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"i"</span><span class="p">,</span> <span class="s2">"want"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">,</span> <span class="s2">"go"</span><span class="p">]</span>
<span class="n">tmp_suggest5</span> <span class="o">=</span> <span class="n">get_suggestions</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">n_gram_counts_list</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The previous words are </span><span class="si">{</span><span class="n">previous_tokens</span><span class="si">}</span><span class="s2">, the suggestions are:"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">tmp_suggest5</span><span class="p">)</span>
</pre></div>
<pre class="example">
The previous words are ['i', 'want', 'to', 'go'], the suggestions are:
</pre>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<tbody>
<tr>
<td class="org-left">to</td>
<td class="org-right">0.006007762241480142</td>
</tr>
<tr>
<td class="org-left">to</td>
<td class="org-right">0.0019077728115120462</td>
</tr>
<tr>
<td class="org-left">to</td>
<td class="org-right">0.00030196552102778083</td>
</tr>
<tr>
<td class="org-left">home</td>
<td class="org-right">0.00016478989288656962</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">previous_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"hey"</span><span class="p">,</span> <span class="s2">"how"</span><span class="p">,</span> <span class="s2">"are"</span><span class="p">]</span>
<span class="n">tmp_suggest6</span> <span class="o">=</span> <span class="n">get_suggestions</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">n_gram_counts_list</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The previous words are </span><span class="si">{</span><span class="n">previous_tokens</span><span class="si">}</span><span class="s2">, the suggestions are:"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">tmp_suggest6</span><span class="p">)</span>
</pre></div>
<pre class="example">
The previous words are ['hey', 'how', 'are'], the suggestions are:
</pre>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<tbody>
<tr>
<td class="org-left">you</td>
<td class="org-right">0.010055522861602231</td>
</tr>
<tr>
<td class="org-left">you</td>
<td class="org-right">0.0014810345300458024</td>
</tr>
<tr>
<td class="org-left">you</td>
<td class="org-right">5.494656446605676e-05</td>
</tr>
<tr>
<td class="org-left">sucks</td>
<td class="org-right">2.747403703500192e-05</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">previous_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"hey"</span><span class="p">,</span> <span class="s2">"how"</span><span class="p">,</span> <span class="s2">"are"</span><span class="p">,</span> <span class="s2">"you"</span><span class="p">]</span>
<span class="n">tmp_suggest7</span> <span class="o">=</span> <span class="n">get_suggestions</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">n_gram_counts_list</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The previous words are </span><span class="si">{</span><span class="n">previous_tokens</span><span class="si">}</span><span class="s2">, the suggestions are:"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">tmp_suggest7</span><span class="p">)</span>
</pre></div>
<pre class="example">
The previous words are ['hey', 'how', 'are', 'you'], the suggestions are:
</pre>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<tbody>
<tr>
<td class="org-left">'re</td>
<td class="org-right">0.012929170630459223</td>
</tr>
<tr>
<td class="org-left">?</td>
<td class="org-right">0.0011416145691764065</td>
</tr>
<tr>
<td class="org-left">?</td>
<td class="org-right">0.0007132863295931524</td>
</tr>
<tr>
<td class="org-left">&lt;e&gt;</td>
<td class="org-right">5.494656446605676e-05</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">previous_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"hey"</span><span class="p">,</span> <span class="s2">"how"</span><span class="p">,</span> <span class="s2">"are"</span><span class="p">,</span> <span class="s2">"you"</span><span class="p">]</span>
<span class="n">tmp_suggest8</span> <span class="o">=</span> <span class="n">get_suggestions</span><span class="p">(</span><span class="n">previous_tokens</span><span class="p">,</span> <span class="n">n_gram_counts_list</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">start_with</span><span class="o">=</span><span class="s2">"d"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The previous words are </span><span class="si">{</span><span class="n">previous_tokens</span><span class="si">}</span><span class="s2">, the suggestions are:"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">tmp_suggest8</span><span class="p">)</span>
</pre></div>
<pre class="example">
The previous words are ['hey', 'how', 'are', 'you'], the suggestions are:
</pre>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<tbody>
<tr>
<td class="org-left">do</td>
<td class="org-right">0.004734930381388913</td>
</tr>
<tr>
<td class="org-left">doing</td>
<td class="org-right">0.000679532481652623</td>
</tr>
<tr>
<td class="org-left">doing</td>
<td class="org-right">0.0001646045375984198</td>
</tr>
<tr>
<td class="org-left">deserving</td>
<td class="org-right">2.747328223302838e-05</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org47290bb">
<h2 id="org47290bb">End</h2>
<div class="outline-text-2" id="text-org47290bb">
<p>So, now we have our system. Here are all the prior posts in this series.</p>
<ul class="org-ul">
<li><a href="posts/nlp/auto-complete/">Overview</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/">Pre-Processing I</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/">Pre-Processing II</a></li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/">The N-Gram Model</a></li>
<li><a href="posts/nlp/auto-complete-perplexity/">Perplexity</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/auto-complete-perplexity/">Auto-Complete: Perplexity</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/auto-complete-perplexity/" rel="bookmark"><time class="published dt-published" datetime="2020-12-04T15:19:33-08:00" itemprop="datePublished" title="2020-12-04 15:19">2020-12-04 15:19</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/auto-complete-perplexity/#orgf8f1a6d">Perplexity</a>
<ul>
<li><a href="posts/nlp/auto-complete-perplexity/#orgd655a55">Imports</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-perplexity/#orgb3e10ae">Middle</a>
<ul>
<li><a href="posts/nlp/auto-complete-perplexity/#org3e018c3">The Probability Function</a></li>
<li><a href="posts/nlp/auto-complete-perplexity/#org7ca3dad">Calculating the Perplexity</a>
<ul>
<li><a href="posts/nlp/auto-complete-perplexity/#org1c65880">Test It</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-perplexity/#org8f36ae2">Using the Class-Based Version</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-perplexity/#orgf141a2d">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgf8f1a6d">
<h2 id="orgf8f1a6d">Perplexity</h2>
<div class="outline-text-2" id="text-orgf8f1a6d">
<p>In the <a href="posts/nlp/auto-complete-the-n-gram-model/">previous post</a> we implemented the N-Gram Language Model for the auto-complete system that we began <a href="posts/nlp/auto-complete/">here</a>.</p>
<p>In this section, you will generate the perplexity score to evaluate your model on the test set.</p>
<ul class="org-ul">
<li>You will also use back-off when needed.</li>
<li>Perplexity is used as an evaluation metric of your language model.</li>
<li>To calculate the the perplexity score of the test set on an n-gram model, use:</li>
</ul>
<p>\[ PP(W) =\sqrt[N]{ \prod_{t=n+1}^N \frac{1}{P(w_t | w_{t-n} \cdots w_{t-1})} } \tag{4} \]</p>
<ul class="org-ul">
<li>where <i>N</i> is the length of the sentence.</li>
<li><i>n</i> is the number of words in the n-gram (e.g. 2 for a bigram).</li>
<li>In math, the numbering starts at one and not zero.</li>
</ul>
<p>In code, array indexing starts at zero, so the code will use ranges for <i>t</i> according to this formula:</p>
<p>\[ PP(W) =\sqrt[N]{ \prod_{t=n}^{N-1} \frac{1}{P(w_t | w_{t-n} \cdots w_{t-1})} } \tag{4.1} \]</p>
<p>The higher the probabilities are, the lower the perplexity will be.</p>
<ul class="org-ul">
<li>The more the n-grams tell us about the sentence, the lower the perplexity score will be.</li>
</ul>
</div>
<div class="outline-3" id="outline-container-orgd655a55">
<h3 id="orgd655a55">Imports</h3>
<div class="outline-text-3" id="text-orgd655a55">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">expect</span><span class="p">,</span> <span class="n">be_true</span>

<span class="kn">import</span> <span class="nn">attr</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocomplete</span> <span class="kn">import</span> <span class="n">NGrams</span><span class="p">,</span><span class="n">NGramProbability</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb3e10ae">
<h2 id="orgb3e10ae">Middle</h2>
<div class="outline-text-2" id="text-orgb3e10ae"></div>
<div class="outline-3" id="outline-container-org3e018c3">
<h3 id="org3e018c3">The Probability Function</h3>
<div class="outline-text-3" id="text-org3e018c3">
<p>This was already defined in the previous post, but the function following it assumes its existence so I'm temporarily re-defining it here.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">estimate_probability</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">previous_n_gram</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> 
                         <span class="n">n_gram_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                         <span class="n">n_plus1_gram_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                         <span class="n">vocabulary_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                         <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Estimate the probabilities of a next word using the n-gram counts with k-smoothing</span>

<span class="sd">    Args:</span>
<span class="sd">       word: next word</span>
<span class="sd">       previous_n_gram: A sequence of words of length n</span>
<span class="sd">       n_gram_counts: Dictionary of counts of n-grams</span>
<span class="sd">       n_plus1_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       vocabulary_size: number of words in the vocabulary</span>
<span class="sd">       k: positive constant, smoothing parameter</span>

<span class="sd">    Returns:</span>
<span class="sd">       A probability</span>
<span class="sd">    """</span>
    <span class="n">previous_n_gram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">)</span>
    <span class="n">previous_n_gram_count</span> <span class="o">=</span> <span class="n">n_gram_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">n_plus1_gram</span> <span class="o">=</span> <span class="n">previous_n_gram</span> <span class="o">+</span> <span class="p">(</span><span class="n">word</span><span class="p">,)</span>  
    <span class="n">n_plus1_gram_count</span> <span class="o">=</span> <span class="n">n_plus1_gram_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_plus1_gram</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       
    <span class="k">return</span> <span class="p">(</span><span class="n">n_plus1_gram_count</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">previous_n_gram_count</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">vocabulary_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7ca3dad">
<h3 id="org7ca3dad">Calculating the Perplexity</h3>
<div class="outline-text-3" id="text-org7ca3dad">
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C10 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1"># GRADED FUNCTION: calculate_perplexity</span>
<span class="k">def</span> <span class="nf">calculate_perplexity</span><span class="p">(</span><span class="n">sentence</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                         <span class="n">n_gram_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                         <span class="n">n_plus1_gram_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                         <span class="n">vocabulary_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                         <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Calculate perplexity for a list of sentences</span>

<span class="sd">    Args:</span>
<span class="sd">       sentence: List of strings</span>
<span class="sd">       n_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       n_plus1_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       vocabulary_size: number of unique words in the vocabulary</span>
<span class="sd">       k: Positive smoothing constant</span>

<span class="sd">    Returns:</span>
<span class="sd">       Perplexity score</span>
<span class="sd">    """</span>
    <span class="c1"># length of previous words</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">n_gram_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span> 

    <span class="c1"># prepend &lt;s&gt; and append &lt;e&gt;</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"&lt;s&gt;"</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">sentence</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"&lt;e&gt;"</span><span class="p">]</span>

    <span class="c1"># Cast the sentence from a list to a tuple</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>

    <span class="c1"># length of sentence (after adding &lt;s&gt; and &lt;e&gt; tokens)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>

    <span class="c1"># The variable p will hold the product</span>
    <span class="c1"># that is calculated inside the n-root</span>
    <span class="c1"># Update this in the code below</span>
    <span class="n">product_pi</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># Index t ranges from n to N - 1, inclusive on both ends</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span> <span class="c1"># complete this line</span>

        <span class="c1"># get the n-gram preceding the word at position t</span>
        <span class="n">n_gram</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="n">n</span><span class="p">:</span> <span class="n">t</span><span class="p">]</span>

        <span class="c1"># get the word at position t</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

        <span class="c1"># Estimate the probability of the word given the n-gram</span>
        <span class="c1"># using the n-gram counts, n-plus1-gram counts,</span>
        <span class="c1"># vocabulary size, and smoothing constant</span>
        <span class="n">probability</span> <span class="o">=</span> <span class="n">estimate_probability</span><span class="p">(</span>
            <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">,</span> <span class="n">previous_n_gram</span><span class="o">=</span><span class="n">n_gram</span><span class="p">,</span>
            <span class="n">vocabulary_size</span><span class="o">=</span><span class="n">vocabulary_size</span><span class="p">,</span>
            <span class="n">n_gram_counts</span><span class="o">=</span><span class="n">n_gram_counts</span><span class="p">,</span>
            <span class="n">n_plus1_gram_counts</span><span class="o">=</span><span class="n">n_plus1_gram_counts</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

        <span class="c1"># Update the product of the probabilities</span>
        <span class="c1"># This 'product_pi' is a cumulative product </span>
        <span class="c1"># of the (1/P) factors that are calculated in the loop</span>
        <span class="n">product_pi</span> <span class="o">*=</span> <span class="mi">1</span><span class="o">/</span><span class="n">probability</span>

    <span class="c1"># Take the Nth root of the product</span>
    <span class="n">perplexity</span> <span class="o">=</span> <span class="n">product_pi</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>

    <span class="c1">### END CODE HERE ### </span>
    <span class="k">return</span> <span class="n">perplexity</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org1c65880">
<h4 id="org1c65880">Test It</h4>
<div class="outline-text-4" id="text-org1c65880">
<div class="highlight">
<pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>
<span class="n">unique_words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">unigram_counts</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span>
<span class="n">bigram_counts</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">counts</span>


<span class="n">perplexity_train1</span> <span class="o">=</span> <span class="n">calculate_perplexity</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="n">unigram_counts</span><span class="p">,</span> <span class="n">bigram_counts</span><span class="p">,</span>
                                         <span class="nb">len</span><span class="p">(</span><span class="n">unique_words</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mf">2.8040</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Perplexity for first train sample: </span><span class="si">{</span><span class="n">perplexity_train1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">perplexity_train1</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">test_sentence</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">]</span>
<span class="n">perplexity_test</span> <span class="o">=</span> <span class="n">calculate_perplexity</span><span class="p">(</span><span class="n">test_sentence</span><span class="p">,</span>
                                       <span class="n">unigram_counts</span><span class="p">,</span> <span class="n">bigram_counts</span><span class="p">,</span>
                                       <span class="nb">len</span><span class="p">(</span><span class="n">unique_words</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Perplexity for test sample: </span><span class="si">{</span><span class="n">perplexity_test</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mf">3.9654</span>
<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">perplexity_test</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
<pre class="example">
Perplexity for first train sample: 2.8040
Perplexity for test sample: 3.9654
</pre>
<p><b>Note:</b> If your sentence is really long, there will be underflow when multiplying many fractions.</p>
<ul class="org-ul">
<li>To handle longer sentences, modify your implementation to take the sum of the log of the probabilities.</li>
</ul>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org8f36ae2">
<h3 id="org8f36ae2">Using the Class-Based Version</h3>
<div class="outline-text-3" id="text-org8f36ae2">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Perplexity</span><span class="p">:</span>
    <span class="sd">"""Calculate perplexity</span>

<span class="sd">    Args:</span>
<span class="sd">     data: the tokenized training input</span>
<span class="sd">     n: the size of the n-grams</span>
<span class="sd">     augment_vocabulary: whether to augment the vocabulary for toy examples</span>
<span class="sd">    """</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">augment_vocabulary</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">_probabilifier</span><span class="p">:</span> <span class="n">NGramProbability</span><span class="o">=</span><span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">probabilifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NGramProbability</span><span class="p">:</span>
        <span class="sd">"""Probability Calculator"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilifier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_probabilifier</span> <span class="o">=</span> <span class="n">NGramProbability</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
                <span class="n">augment_vocabulary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">augment_vocabulary</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilifier</span>

    <span class="k">def</span> <span class="nf">perplexity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">"""Calculates the perplexity for the sentence"""</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="s2">"&lt;s&gt;"</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">sentence</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"&lt;e&gt;"</span><span class="p">])</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>

        <span class="n">n_grams</span> <span class="o">=</span> <span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="n">position</span><span class="p">]</span>
                   <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
        <span class="n">words_n_grams</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">n_grams</span><span class="p">)</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probabilifier</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">n_gram</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">n_gram</span> <span class="ow">in</span> <span class="n">words_n_grams</span><span class="p">)</span>
        <span class="n">product</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">probability</span> <span class="k">for</span> <span class="n">probability</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">product</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Perplexity</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">augment_vocabulary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">actual</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">perplexity</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">expected</span> <span class="o">=</span> <span class="mf">2.8040</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Perplexity for first train sample: </span><span class="si">{</span><span class="n">actual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">test_sentence</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">]</span>
<span class="n">model</span>
<span class="n">perplexity_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">perplexity</span><span class="p">(</span><span class="n">test_sentence</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Perplexity for test sample: </span><span class="si">{</span><span class="n">perplexity_test</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mf">3.9654</span>
<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">perplexity_test</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf141a2d">
<h2 id="orgf141a2d">End</h2>
<div class="outline-text-2" id="text-orgf141a2d">
<p>In the next part we'll build our <a href="posts/nlp/auto-complete-building-the-auto-complete-system/">completed auto-complete system</a>.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/auto-complete-the-n-gram-model/">Auto-Complete: the N-Gram Model</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/auto-complete-the-n-gram-model/" rel="bookmark"><time class="published dt-published" datetime="2020-12-04T15:17:18-08:00" itemprop="datePublished" title="2020-12-04 15:17">2020-12-04 15:17</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#orgad8575c">Develop an N-Gram Based Language Model</a>
<ul>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org44aa047">Imports</a></li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org2cbeea8">Set Up</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org387cb33">Middle</a>
<ul>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org84a7f2d">Count N-Grams</a>
<ul>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#orgf43d383">Hints</a></li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org7d0e184">Test It</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#orgc9f7471">Probability Estimates</a>
<ul>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org704db4f">Hints</a></li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org1013585">Test Code</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#orged3d248">Estimate probabilities for all words</a>
<ul>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org4774a79">Test It</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#orgef99e02">Count and probability matrices</a>
<ul>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org749afa5">Show trigram counts</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org3be11c9">Probability Matrix</a></li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#orgf5c26a6">Bundle It Up</a>
<ul>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#orgd323693">Imports</a></li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org4842201">The N-Gram</a></li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org52ba762">N-Gram Probability</a></li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org13c8901">Test It Out</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/#org02a5048">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgad8575c">
<h2 id="orgad8575c">Develop an N-Gram Based Language Model</h2>
<div class="outline-text-2" id="text-orgad8575c">
<p>We'll continue on from the <a href="posts/nlp/auto-complete-pre-process-the-data-ii/">previous post</a> in which we finished pre-processing the data to build our <a href="posts/nlp/auto-complete/">Auto-Complete</a> system.</p>
<p>In this section, you will develop the n-grams language model.</p>
<ul class="org-ul">
<li>Assume the probability of the next word depends only on the previous n-gram.</li>
<li>The previous n-gram is the series of the previous 'n' words.</li>
</ul>
<p>The conditional probability for the word at position 't' in the sentence, given that the words preceding it are \(w_{t-1}, w_{t-2} \cdots w_{t-n}\) is:</p>
<p>\[ P(w_t | w_{t-1}\dots w_{t-n}) \tag{1} \]</p>
<p>You can estimate this probability by counting the occurrences of these series of words in the training data.</p>
<ul class="org-ul">
<li>The probability can be estimated as a ratio, where</li>
<li>The numerator is the number of times word 't' appears after words t-1 through t-n appear in the training data.</li>
<li>The denominator is the number of times word t-1 through t-n appears in the training data.</li>
</ul>
<p>\[ \hat{P}(w_t | w_{t-1}\dots w_{t-n}) = \frac{C(w_{t-1}\dots w_{t-n}, w_n)}{C(w_{t-1}\dots w_{t-n})} \tag{2} \]</p>
<ul class="org-ul">
<li>The function \(C(\cdots)\) denotes the number of occurences of the given sequence.</li>
<li>\(\hat{P}\) means the estimation of <i>P</i>.</li>
<li>Notice that denominator of the equation (2) is the number of occurence of the previous <i>n</i> words, and the numerator is the same sequence followed by the word \(w_t\).</li>
</ul>
<p>Later, you will modify the equation (2) by adding k-smoothing, which avoids errors when any counts are zero.</p>
<p>The equation (2) tells us that to estimate probabilities based on n-grams, you need the counts of n-grams (for denominator) and (n+1)-grams (for numerator).</p>
</div>
<div class="outline-3" id="outline-container-org44aa047">
<h3 id="org44aa047">Imports</h3>
<div class="outline-text-3" id="text-org44aa047">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">have_keys</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2cbeea8">
<h3 id="org2cbeea8">Set Up</h3>
<div class="outline-text-3" id="text-org2cbeea8">
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org387cb33">
<h2 id="org387cb33">Middle</h2>
<div class="outline-text-2" id="text-org387cb33"></div>
<div class="outline-3" id="outline-container-org84a7f2d">
<h3 id="org84a7f2d">Count N-Grams</h3>
<div class="outline-text-3" id="text-org84a7f2d">
<p>Next, you will implement a function that computes the counts of n-grams for an arbitrary number \(n\).</p>
<p>When computing the counts for n-grams, prepare the sentence beforehand by prepending <i>n-1</i> starting markers "&lt;s\&gt;" to indicate the beginning of the sentence.</p>
<ul class="org-ul">
<li>For example, in the bi-gram model (N=2), a sequence with two start tokens "&lt;s\&gt;&lt;s\&gt;" should predict the first word of a sentence.</li>
<li>So, if the sentence is "I like food", modify it to be "&lt;s\&gt;&lt;s\&gt; I like food".</li>
<li>Also prepare the sentence for counting by appending an end token "&lt;e\&gt;" so that the model can predict when to finish a sentence.</li>
</ul>
<p>Technical note: In this implementation, you will store the counts as a dictionary.</p>
<ul class="org-ul">
<li>The key of each key-value pair in the dictionary is a <b>tuple</b> of n words (and not a list)</li>
<li>The value in the key-value pair is the number of occurrences.</li>
<li>The reason for using a tuple as a key instead of a list is because a list in Python is a mutable object (it can be changed after it is first created). A tuple is "immutable", so it cannot be altered after it is first created. This makes a tuple suitable as a data type for the key in a dictionary.</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgf43d383">
<h4 id="orgf43d383">Hints</h4>
<div class="outline-text-4" id="text-orgf43d383">
<ul class="org-ul">
<li>To prepend or append, you can create lists and concatenate them using the + operator</li>
<li>To create a list of a repeated value, you can follow this syntax: <code>['a'] * 3</code> to get <code>['a','a','a']</code></li>
<li>To set the range for index 'i', think of this example: An n-gram where n=2 (bigram), and the sentence is length N=5 (including two start tokens and one end token). So the index positions are <code>[0,1,2,3,4]</code>. The largest index 'i' where a bigram can start is at position i=3, because the word tokens at position 3 and 4 will form the bigram.</li>
<li>Remember that the <code>range()</code> function excludes the value that is used for the maximum of the range. <code>range(3)</code> produces (0,1,2) but excludes 3.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C8 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1">### GRADED FUNCTION: count_n_grams ###</span>
<span class="k">def</span> <span class="nf">count_n_grams</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">start_token</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'&lt;s&gt;'</span><span class="p">,</span> <span class="n">end_token</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'&lt;e&gt;'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Count all n-grams in the data</span>

<span class="sd">    Args:</span>
<span class="sd">       data: List of lists of words</span>
<span class="sd">       n: number of words in a sequence</span>

<span class="sd">    Returns:</span>
<span class="sd">       A dictionary that maps a tuple of n-words to its frequency</span>
<span class="sd">    """</span>

    <span class="c1"># Initialize dictionary of n-grams and their counts</span>
    <span class="n">n_grams</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># Go through each sentence in the data</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span> <span class="c1"># complete this line</span>

        <span class="c1"># prepend start token n times, and  append &lt;e&gt; one time</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_token</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">sentence</span> <span class="o">+</span> <span class="p">[</span><span class="n">end_token</span><span class="p">]</span>

        <span class="c1"># convert list to tuple</span>
        <span class="c1"># So that the sequence of words can be used as</span>
        <span class="c1"># a key in the dictionary</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>

        <span class="c1"># Use 'i' to indicate the start of the n-gram</span>
        <span class="c1"># from index 0</span>
        <span class="c1"># to the last index where the end of the n-gram</span>
        <span class="c1"># is within the sentence.</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span> <span class="c1"># complete this line</span>

            <span class="c1"># Get the n-gram from i to i+n</span>
            <span class="n">n_gram</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span>

            <span class="c1"># check if the n-gram is in the dictionary</span>
            <span class="k">if</span> <span class="n">n_gram</span> <span class="ow">in</span> <span class="n">n_grams</span><span class="p">:</span> <span class="c1"># complete this line</span>

                <span class="c1"># Increment the count for this n-gram</span>
                <span class="n">n_grams</span><span class="p">[</span><span class="n">n_gram</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Initialize this n-gram count to 1</span>
                <span class="n">n_grams</span><span class="p">[</span><span class="n">n_gram</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">n_grams</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org7d0e184">
<h4 id="org7d0e184">Test It</h4>
<div class="outline-text-4" id="text-org7d0e184">
<div class="highlight">
<pre><span></span><span class="c1"># **** Set Up ****</span>
<span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
             <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>

<span class="c1"># **** Unigram ****</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Uni-gram:"</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">'&lt;s&gt;'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'i'</span><span class="p">,):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'like'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'a'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'cat'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'&lt;e&gt;'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'this'</span><span class="p">,):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'dog'</span><span class="p">,):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'is'</span><span class="p">,):</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>

<span class="c1"># **** Bi-Gram ****</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Bi-gram:"</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">'&lt;s&gt;'</span><span class="p">,</span> <span class="s1">'&lt;s&gt;'</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'&lt;s&gt;'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'cat'</span><span class="p">,</span> <span class="s1">'&lt;e&gt;'</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'&lt;s&gt;'</span><span class="p">,</span> <span class="s1">'this'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<pre class="example">
Uni-gram:
{('&lt;s&gt;',): 2, ('i',): 1, ('like',): 2, ('a',): 2, ('cat',): 2, ('&lt;e&gt;',): 2, ('this',): 1, ('dog',): 1, ('is',): 1}
Bi-gram:
{('&lt;s&gt;', '&lt;s&gt;'): 2, ('&lt;s&gt;', 'i'): 1, ('i', 'like'): 1, ('like', 'a'): 2, ('a', 'cat'): 2, ('cat', '&lt;e&gt;'): 2, ('&lt;s&gt;', 'this'): 1, ('this', 'dog'): 1, ('dog', 'is'): 1, ('is', 'like'): 1}
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc9f7471">
<h3 id="orgc9f7471">Probability Estimates</h3>
<div class="outline-text-3" id="text-orgc9f7471">
<p>Next, estimate the probability of a word given the prior 'n' words using the n-gram counts.</p>
<p>\[ \hat{P}(w_t | w_{t-1}\dots w_{t-n}) = \frac{C(w_{t-1}\dots w_{t-n}, w_n)}{C(w_{t-1}\dots w_{t-n})} \tag{2} \]</p>
<p>This formula doesn't work when a count of an n-gram is zero..</p>
<ul class="org-ul">
<li>Suppose we encounter an n-gram that did not occur in the training data.</li>
<li>Then, the equation (2) cannot be evaluated (it becomes zero divided by zero).</li>
</ul>
<p>A way to handle zero counts is to add k-smoothing.</p>
<ul class="org-ul">
<li>K-smoothing adds a positive constant <i>k</i> to each numerator and \(k \times |V|\) in the denominator, where \(|V|\) is the number of words in the vocabulary.</li>
</ul>
<p>\[ \hat{P}(w_t | w_{t-1}\dots w_{t-n}) = \frac{C(w_{t-1}\dots w_{t-n}, w_n) + k}{C(w_{t-1}\dots w_{t-n}) + k|V|} \tag{3} \]</p>
<p>For n-grams that have a zero count, the equation (3) becomes \(\frac{1}{|V|}\).</p>
<ul class="org-ul">
<li>This means that any n-gram with zero count has the same probability of \(\frac{1}{|V|}\).</li>
</ul>
<p>Define a function that computes the probability estimate (3) from n-gram counts and a constant <i>k</i>.</p>
<ul class="org-ul">
<li>The function takes in a dictionary 'n_gram_counts', where the key is the n-gram and the value is the count of that n-gram.</li>
<li>The function also takes another dictionary n_plus1_gram_counts, which you'll use to find the count for the previous n-gram plus the current word.</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org704db4f">
<h4 id="org704db4f">Hints</h4>
<div class="outline-text-4" id="text-org704db4f">
<ul class="org-ul">
<li>To define a tuple containing a single value, add a comma after that value. For example: <code>('apple',)</code> is a tuple containing a single string 'apple'</li>
<li>To concatenate two tuples, use the '+' operator</li>
</ul>
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C9 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1">### GRADED FUNCTION: estimate_probability ###</span>
<span class="k">def</span> <span class="nf">estimate_probability</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">previous_n_gram</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> 
                         <span class="n">n_gram_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                         <span class="n">n_plus1_gram_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                         <span class="n">vocabulary_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                         <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Estimate the probabilities of a next word using the n-gram counts with k-smoothing</span>

<span class="sd">    Args:</span>
<span class="sd">       word: next word</span>
<span class="sd">       previous_n_gram: A sequence of words of length n</span>
<span class="sd">       n_gram_counts: Dictionary of counts of n-grams</span>
<span class="sd">       n_plus1_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       vocabulary_size: number of words in the vocabulary</span>
<span class="sd">       k: positive constant, smoothing parameter</span>

<span class="sd">    Returns:</span>
<span class="sd">       A probability</span>
<span class="sd">    """</span>
    <span class="c1"># convert list to tuple to use it as a dictionary key</span>
    <span class="n">previous_n_gram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">)</span>

    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># Set the denominator</span>
    <span class="c1"># If the previous n-gram exists in the dictionary of n-gram counts,</span>
    <span class="c1"># Get its count.  Otherwise set the count to zero</span>
    <span class="c1"># Use the dictionary that has counts for n-grams</span>
    <span class="n">previous_n_gram_count</span> <span class="o">=</span> <span class="n">n_gram_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Calculate the denominator using the count of the previous n gram</span>
    <span class="c1"># and apply k-smoothing</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">previous_n_gram_count</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">vocabulary_size</span>

    <span class="c1"># Define n plus 1 gram as the previous n-gram plus the current word as a tuple</span>
    <span class="n">n_plus1_gram</span> <span class="o">=</span> <span class="n">previous_n_gram</span> <span class="o">+</span> <span class="p">(</span><span class="n">word</span><span class="p">,)</span>

    <span class="c1"># Set the count to the count in the dictionary,</span>
    <span class="c1"># otherwise 0 if not in the dictionary</span>
    <span class="c1"># use the dictionary that has counts for the n-gram plus current word</span>
    <span class="n">n_plus1_gram_count</span> <span class="o">=</span> <span class="n">n_plus1_gram_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_plus1_gram</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Define the numerator use the count of the n-gram plus current word,</span>
    <span class="c1"># and apply smoothing</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="n">n_plus1_gram_count</span> <span class="o">+</span> <span class="n">k</span>

    <span class="c1"># Calculate the probability as the numerator divided by denominator</span>
    <span class="n">probability</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span>

    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">probability</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1013585">
<h4 id="org1013585">Test Code</h4>
<div class="outline-text-4" id="text-org1013585">
<div class="highlight">
<pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
             <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>
<span class="n">unique_words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">unigram_counts</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">bigram_counts</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">estimate_probability</span><span class="p">(</span><span class="s2">"cat"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="n">unigram_counts</span><span class="p">,</span> <span class="n">bigram_counts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_words</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mf">0.3333</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The estimated probability of word 'cat' given the previous n-gram 'a' is: </span><span class="si">{</span><span class="n">actual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
<pre class="example">
The estimated probability of word 'cat' given the previous n-gram 'a' is: 0.3333
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orged3d248">
<h3 id="orged3d248">Estimate probabilities for all words</h3>
<div class="outline-text-3" id="text-orged3d248">
<p>The function defined below loops over all words in the vocabulary to calculate probabilities for all possible words.</p>
<ul class="org-ul">
<li>This function is provided for you.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">estimate_probabilities</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">,</span> <span class="n">n_gram_counts</span><span class="p">,</span> <span class="n">n_plus1_gram_counts</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Estimate the probabilities of next words using the n-gram counts with k-smoothing</span>

<span class="sd">    Args:</span>
<span class="sd">       previous_n_gram: A sequence of words of length n</span>
<span class="sd">       n_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       n_plus1_gram_counts: Dictionary of counts of (n+1)-grams</span>
<span class="sd">       vocabulary: List of words</span>
<span class="sd">       k: positive constant, smoothing parameter</span>

<span class="sd">    Returns:</span>
<span class="sd">       A dictionary mapping from next words to the probability.</span>
<span class="sd">    """</span>

    <span class="c1"># convert list to tuple to use it as a dictionary key</span>
    <span class="n">previous_n_gram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">)</span>

    <span class="c1"># add &lt;e&gt; &lt;unk&gt; to the vocabulary</span>
    <span class="c1"># &lt;s&gt; is not needed since it should not appear as the next word</span>
    <span class="n">vocabulary</span> <span class="o">=</span> <span class="n">vocabulary</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"&lt;e&gt;"</span><span class="p">,</span> <span class="s2">"&lt;unk&gt;"</span><span class="p">]</span>
    <span class="n">vocabulary_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span>

    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocabulary</span><span class="p">:</span>
        <span class="n">probability</span> <span class="o">=</span> <span class="n">estimate_probability</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">previous_n_gram</span><span class="p">,</span> 
                                           <span class="n">n_gram_counts</span><span class="p">,</span> <span class="n">n_plus1_gram_counts</span><span class="p">,</span> 
                                           <span class="n">vocabulary_size</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="n">probabilities</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">probability</span>

    <span class="k">return</span> <span class="n">probabilities</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org4774a79">
<h4 id="org4774a79">Test It</h4>
<div class="outline-text-4" id="text-org4774a79">
<div class="highlight">
<pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
             <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>
<span class="n">unique_words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">unigram_counts</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">bigram_counts</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">estimate_probabilities</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="n">unigram_counts</span><span class="p">,</span> <span class="n">bigram_counts</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">'cat'</span><span class="p">:</span> <span class="mf">0.2727272727272727</span><span class="p">,</span>
             <span class="s1">'i'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'this'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'a'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'is'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'like'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'dog'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'&lt;e&gt;'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'&lt;unk&gt;'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">}</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="o">**</span><span class="n">expected</span><span class="p">))</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
</pre></div>
<pre class="example">
{'&lt;e&gt;': 0.09090909090909091,
 '&lt;unk&gt;': 0.09090909090909091,
 'a': 0.09090909090909091,
 'cat': 0.2727272727272727,
 'dog': 0.09090909090909091,
 'i': 0.09090909090909091,
 'is': 0.09090909090909091,
 'like': 0.09090909090909091,
 'this': 0.09090909090909091}
</pre>
<div class="highlight">
<pre><span></span><span class="n">trigram_counts</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">estimate_probabilities</span><span class="p">([</span><span class="s2">"&lt;s&gt;"</span><span class="p">,</span> <span class="s2">"&lt;s&gt;"</span><span class="p">],</span> <span class="n">bigram_counts</span><span class="p">,</span> <span class="n">trigram_counts</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">'cat'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'i'</span><span class="p">:</span> <span class="mf">0.18181818181818182</span><span class="p">,</span>
             <span class="s1">'this'</span><span class="p">:</span> <span class="mf">0.18181818181818182</span><span class="p">,</span>
             <span class="s1">'a'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'is'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'like'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'dog'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'&lt;e&gt;'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'&lt;unk&gt;'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">}</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="o">**</span><span class="n">expected</span><span class="p">))</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
</pre></div>
<pre class="example">
{'&lt;e&gt;': 0.09090909090909091,
 '&lt;unk&gt;': 0.09090909090909091,
 'a': 0.09090909090909091,
 'cat': 0.09090909090909091,
 'dog': 0.09090909090909091,
 'i': 0.18181818181818182,
 'is': 0.09090909090909091,
 'like': 0.09090909090909091,
 'this': 0.18181818181818182}
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgef99e02">
<h3 id="orgef99e02">Count and probability matrices</h3>
<div class="outline-text-3" id="text-orgef99e02">
<p>As we have seen so far, the n-gram counts computed above are sufficient for computing the probabilities of the next word.</p>
<ul class="org-ul">
<li>It can be more intuitive to present them as count or probability matrices.</li>
<li>The functions defined in the next cells return count or probability matrices.</li>
<li>This function is provided for you.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">make_count_matrix</span><span class="p">(</span><span class="n">n_plus1_gram_counts</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">):</span>
    <span class="c1"># add &lt;e&gt; &lt;unk&gt; to the vocabulary</span>
    <span class="c1"># &lt;s&gt; is omitted since it should not appear as the next word</span>
    <span class="n">vocabulary</span> <span class="o">=</span> <span class="n">vocabulary</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"&lt;e&gt;"</span><span class="p">,</span> <span class="s2">"&lt;unk&gt;"</span><span class="p">]</span>

    <span class="c1"># obtain unique n-grams</span>
    <span class="n">n_grams</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n_plus1_gram</span> <span class="ow">in</span> <span class="n">n_plus1_gram_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">n_gram</span> <span class="o">=</span> <span class="n">n_plus1_gram</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n_grams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
    <span class="n">n_grams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">n_grams</span><span class="p">))</span>

    <span class="c1"># mapping from n-gram to row</span>
    <span class="n">row_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">n_gram</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n_gram</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_grams</span><span class="p">)}</span>
    <span class="c1"># mapping from next word to column</span>
    <span class="n">col_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">word</span><span class="p">:</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)}</span>

    <span class="n">nrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_grams</span><span class="p">)</span>
    <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span>
    <span class="n">count_matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n_plus1_gram</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">n_plus1_gram_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">n_gram</span> <span class="o">=</span> <span class="n">n_plus1_gram</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">n_plus1_gram</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vocabulary</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">row_index</span><span class="p">[</span><span class="n">n_gram</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">col_index</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
        <span class="n">count_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

    <span class="n">count_matrix</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">count_matrix</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">n_grams</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count_matrix</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
             <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>
<span class="n">unique_words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">bigram_counts</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'bigram counts'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">make_count_matrix</span><span class="p">(</span><span class="n">bigram_counts</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">cat</th>
<th class="org-right" scope="col">a</th>
<th class="org-right" scope="col">like</th>
<th class="org-right" scope="col">this</th>
<th class="org-right" scope="col">dog</th>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">is</th>
<th class="org-right" scope="col">&lt;e&gt;</th>
<th class="org-right" scope="col">&lt;unk&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">('dog',)</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('&lt;s&gt;',)</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('cat',)</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">2</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('is',)</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('a',)</td>
<td class="org-right">2</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('i',)</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('like',)</td>
<td class="org-right">0</td>
<td class="org-right">2</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('this',)</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
</div>
<div class="outline-4" id="outline-container-org749afa5">
<h4 id="org749afa5">Show trigram counts</h4>
<div class="outline-text-4" id="text-org749afa5">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">trigram counts'</span><span class="p">)</span>
<span class="n">trigram_counts</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">make_count_matrix</span><span class="p">(</span><span class="n">trigram_counts</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">)))</span>
</pre></div>
<p>trigram counts</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">cat</th>
<th class="org-right" scope="col">a</th>
<th class="org-right" scope="col">like</th>
<th class="org-right" scope="col">this</th>
<th class="org-right" scope="col">dog</th>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">is</th>
<th class="org-right" scope="col">&lt;e&gt;</th>
<th class="org-right" scope="col">&lt;unk&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">('&lt;s&gt;', 'i')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('i', 'like')</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('&lt;s&gt;', 'this')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('like', 'a')</td>
<td class="org-right">2</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('&lt;s&gt;', '&lt;s&gt;')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('is', 'like')</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('dog', 'is')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('this', 'dog')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('a', 'cat')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">2</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org3be11c9">
<h3 id="org3be11c9">Probability Matrix</h3>
<div class="outline-text-3" id="text-org3be11c9">
<p>The following function calculates the probabilities of each word given the previous n-gram, and stores this in matrix form.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">make_probability_matrix</span><span class="p">(</span><span class="n">n_plus1_gram_counts</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="n">count_matrix</span> <span class="o">=</span> <span class="n">make_count_matrix</span><span class="p">(</span><span class="n">n_plus1_gram_counts</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">)</span>
    <span class="n">count_matrix</span> <span class="o">+=</span> <span class="n">k</span>
    <span class="n">prob_matrix</span> <span class="o">=</span> <span class="n">count_matrix</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">count_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"rows"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prob_matrix</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>
<span class="n">unique_words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sentences</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">bigram_counts</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"bigram probabilities"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">make_probability_matrix</span><span class="p">(</span><span class="n">bigram_counts</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
<p>bigram probabilities</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">cat</th>
<th class="org-right" scope="col">a</th>
<th class="org-right" scope="col">like</th>
<th class="org-right" scope="col">this</th>
<th class="org-right" scope="col">dog</th>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">is</th>
<th class="org-right" scope="col">&lt;e&gt;</th>
<th class="org-right" scope="col">&lt;unk&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">('dog',)</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">('&lt;s&gt;',)</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.181818</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.181818</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
</tr>
<tr>
<td class="org-left">('cat',)</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.272727</td>
<td class="org-right">0.0909091</td>
</tr>
<tr>
<td class="org-left">('is',)</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">('a',)</td>
<td class="org-right">0.272727</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
</tr>
<tr>
<td class="org-left">('i',)</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">('like',)</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.272727</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
</tr>
<tr>
<td class="org-left">('this',)</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"trigram probabilities"</span><span class="p">)</span>
<span class="n">trigram_counts</span> <span class="o">=</span> <span class="n">count_n_grams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">make_probability_matrix</span><span class="p">(</span><span class="n">trigram_counts</span><span class="p">,</span> <span class="n">unique_words</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
<p>trigram probabilities</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">cat</th>
<th class="org-right" scope="col">a</th>
<th class="org-right" scope="col">like</th>
<th class="org-right" scope="col">this</th>
<th class="org-right" scope="col">dog</th>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">is</th>
<th class="org-right" scope="col">&lt;e&gt;</th>
<th class="org-right" scope="col">&lt;unk&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">('&lt;s&gt;', 'i')</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">('i', 'like')</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">('&lt;s&gt;', 'this')</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">('like', 'a')</td>
<td class="org-right">0.272727</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
</tr>
<tr>
<td class="org-left">('&lt;s&gt;', '&lt;s&gt;')</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.181818</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.181818</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
</tr>
<tr>
<td class="org-left">('is', 'like')</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">('dog', 'is')</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">('this', 'dog')</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">('a', 'cat')</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.0909091</td>
<td class="org-right">0.272727</td>
<td class="org-right">0.0909091</td>
</tr>
</tbody>
</table>
<p>Confirm that you obtain the same results as for the `estimate_probabilities` function that you implemented.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgf5c26a6">
<h3 id="orgf5c26a6">Bundle It Up</h3>
<div class="outline-text-3" id="text-orgf5c26a6">
<div class="highlight">
<pre><span></span><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">n</span><span class="o">-</span><span class="n">gram</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">start</span><span class="o">-</span><span class="n">tokens</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">end</span><span class="o">-</span><span class="n">tokens</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">sentences</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">n</span><span class="o">-</span><span class="n">grams</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">counts</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">n</span><span class="o">-</span><span class="n">gram</span><span class="o">-</span><span class="n">probability</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">n</span><span class="o">-</span><span class="n">grams</span><span class="o">-</span><span class="n">model</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">n</span><span class="o">-</span><span class="n">plus</span><span class="o">-</span><span class="n">one</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">vocabulary</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">vocabulary</span><span class="o">-</span><span class="n">size</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">probability</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">probabilities</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgd323693">
<h4 id="orgd323693">Imports</h4>
<div class="outline-text-4" id="text-orgd323693">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org4842201">
<h4 id="org4842201">The N-Gram</h4>
<div class="outline-text-4" id="text-org4842201">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NGrams</span><span class="p">:</span>
    <span class="sd">"""The N-Gram Language Model</span>

<span class="sd">    Args:</span>
<span class="sd">     data: the training data</span>
<span class="sd">     n: the size of the n-grams</span>
<span class="sd">     start_token: string to represent the start of a sentence</span>
<span class="sd">     end_token: string to represent the end of a sentence</span>
<span class="sd">    """</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">start_token</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"&lt;s&gt;"</span>
    <span class="n">end_token</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"&lt;e&gt;"</span>
    <span class="n">_start_tokens</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_end_tokens</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_sentences</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_n_grams</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="orgfb80b14"></a>Start Tokens<br>
<div class="outline-text-5" id="text-orgfb80b14">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">start_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""List of 'n' start tokens"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_tokens</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_token</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_tokens</span>
</pre></div>
</div>
</li>
<li><a id="org903566a"></a>End Tokens<br>
<div class="outline-text-5" id="text-org903566a">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">end_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""List of 1 end-tokens"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_tokens</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">end_token</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_tokens</span>
</pre></div>
</div>
</li>
<li><a id="org4245578"></a>Sentences<br>
<div class="outline-text-5" id="text-org4245578">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">sentences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""The data augmented with tags and converted to tuples"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_tokens</span> <span class="o">+</span> <span class="n">sentence</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_tokens</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span>
</pre></div>
</div>
</li>
<li><a id="orgcddb8df"></a>N-Grams<br>
<div class="outline-text-5" id="text-orgcddb8df">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">n_grams</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""The n-grams from the data</span>

<span class="sd">    Warning:</span>
<span class="sd">     this flattens the n-grams so there isn't any sentence structure</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_grams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_grams</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">([</span>
            <span class="p">[</span><span class="n">sentence</span><span class="p">[</span><span class="n">cut</span><span class="p">:</span> <span class="n">cut</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">cut</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentences</span>
        <span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_grams</span>
</pre></div>
</div>
</li>
<li><a id="org18f2709"></a>Count<br>
<div class="outline-text-5" id="text-org18f2709">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Counter</span><span class="p">:</span>
    <span class="sd">"""A count of all n-grams in the data</span>

<span class="sd">    Returns:</span>
<span class="sd">       A dictionary that maps a tuple of n-words to its frequency</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_grams</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org52ba762">
<h4 id="org52ba762">N-Gram Probability</h4>
<div class="outline-text-4" id="text-org52ba762">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NGramProbability</span><span class="p">:</span>
    <span class="sd">"""Probability model for n-grams</span>

<span class="sd">    Args:</span>
<span class="sd">     data: the source for the n-grams</span>
<span class="sd">     n: the size of the n-grams</span>
<span class="sd">     k: smoothing factor</span>
<span class="sd">     augment_vocabulary: hack because the two probability functions use different vocabularies</span>
<span class="sd">    """</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="n">augment_vocabulary</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">_n_grams</span><span class="p">:</span> <span class="n">NGrams</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_n_plus_one</span><span class="p">:</span> <span class="n">NGrams</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_vocabulary</span><span class="p">:</span> <span class="nb">set</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_vocabulary_size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_probabilities</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="org251d6a5"></a>N-Grams<br>
<div class="outline-text-5" id="text-org251d6a5">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">n_grams</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NGrams</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_grams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_grams</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_grams</span>
</pre></div>
</div>
</li>
<li><a id="orgcfa9a25"></a>N-Plus-One Grams<br>
<div class="outline-text-5" id="text-orgcfa9a25">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">n_plus_one</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NGrams</span><span class="p">:</span>
    <span class="sd">"""N+1 Grams"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_plus_one</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_plus_one</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_plus_one</span>
</pre></div>
</div>
</li>
<li><a id="org77b64ea"></a>The Vocabulary<br>
<div class="outline-text-5" id="text-org77b64ea">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
    <span class="sd">"""Unique words in the dictionary"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">augment_vocabulary</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">"&lt;e&gt;"</span><span class="p">,</span> <span class="s2">"&lt;unk&gt;"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span>
</pre></div>
</div>
</li>
<li><a id="org4310404"></a>Vocabulary Size<br>
<div class="outline-text-5" id="text-org4310404">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">vocabulary_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Number of unique tokens in the data"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span>
</pre></div>
</div>
</li>
<li><a id="org5687b20"></a>Probability<br>
<div class="outline-text-5" id="text-org5687b20">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">previous_n_gram</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""Calculates the probability of the word given the previous n-gram"""</span>
    <span class="c1"># just in case it's a list</span>
    <span class="n">previous_n_gram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">)</span>
    <span class="n">previous_n_gram_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_grams</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">previous_n_gram_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary_size</span>

    <span class="n">n_plus1_gram</span> <span class="o">=</span> <span class="n">previous_n_gram</span> <span class="o">+</span> <span class="p">(</span><span class="n">word</span><span class="p">,)</span>
    <span class="n">n_plus1_gram_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_plus_one</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_plus1_gram</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="n">n_plus1_gram_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
    <span class="k">return</span> <span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span>
</pre></div>
</div>
</li>
<li><a id="org39af3eb"></a>Probabilities<br>
<div class="outline-text-5" id="text-org39af3eb">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">previous_n_gram</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""Finds the probability of each word in the vocabulary</span>

<span class="sd">    Args:</span>
<span class="sd">     previous_n_gram: the preceding tuple to calculate probabilities</span>

<span class="sd">    Returns:</span>
<span class="sd">     word:&lt;probability word follows previous n-gram&gt; for the vocabulary</span>
<span class="sd">    """</span>
    <span class="n">previous_n_gram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">previous_n_gram</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">word</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">,</span> <span class="n">previous_n_gram</span><span class="o">=</span><span class="n">previous_n_gram</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org13c8901">
<h4 id="org13c8901">Test It Out</h4>
<div class="outline-text-4" id="text-org13c8901">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.autocomplete</span> <span class="kn">import</span> <span class="n">NGrams</span>

<span class="c1"># **** Set Up ****</span>
<span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
             <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>

<span class="c1"># **** Unigram ****</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">'&lt;s&gt;'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'i'</span><span class="p">,):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'like'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'a'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'cat'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">'&lt;e&gt;'</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'this'</span><span class="p">,):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'dog'</span><span class="p">,):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'is'</span><span class="p">,):</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">uni_grams</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">uni_grams</span><span class="o">.</span><span class="n">counts</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>

<span class="c1"># **** Bi-Gram ****</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">'&lt;s&gt;'</span><span class="p">,</span> <span class="s1">'&lt;s&gt;'</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'&lt;s&gt;'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">'cat'</span><span class="p">,</span> <span class="s1">'&lt;e&gt;'</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">'&lt;s&gt;'</span><span class="p">,</span> <span class="s1">'this'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">bi_grams</span> <span class="o">=</span> <span class="n">NGrams</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">bi_grams</span><span class="o">.</span><span class="n">counts</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.autocomplete</span> <span class="kn">import</span> <span class="n">NGramProbability</span>

<span class="n">sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">],</span>
             <span class="p">[</span><span class="s1">'this'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">]]</span>

<span class="c1"># the examples for the two probability functions don't behave the same</span>
<span class="c1"># so for this case don't augment the vocabulary with empty and unknown tokens</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">NGramProbability</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">augment_vocabulary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">probability</span><span class="p">(</span><span class="s2">"cat"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mf">0.3333</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The estimated probability of word 'cat' given the previous n-gram 'a' is: </span><span class="si">{</span><span class="n">actual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="c1"># the probabilities test examples assume that you did augment the vocabulary</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">NGramProbability</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">'cat'</span><span class="p">:</span> <span class="mf">0.2727272727272727</span><span class="p">,</span>
             <span class="s1">'i'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'this'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'a'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'is'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'like'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'dog'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'&lt;e&gt;'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'&lt;unk&gt;'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">}</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="o">**</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">NGramProbability</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">probabilities</span><span class="p">([</span><span class="s2">"&lt;s&gt;"</span><span class="p">,</span> <span class="s2">"&lt;s&gt;"</span><span class="p">])</span>

<span class="n">expected</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">'cat'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'i'</span><span class="p">:</span> <span class="mf">0.18181818181818182</span><span class="p">,</span>
             <span class="s1">'this'</span><span class="p">:</span> <span class="mf">0.18181818181818182</span><span class="p">,</span>
             <span class="s1">'a'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'is'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'like'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'dog'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'&lt;e&gt;'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">,</span>
             <span class="s1">'&lt;unk&gt;'</span><span class="p">:</span> <span class="mf">0.09090909090909091</span><span class="p">}</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="o">**</span><span class="n">expected</span><span class="p">))</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org02a5048">
<h2 id="org02a5048">End</h2>
<div class="outline-text-2" id="text-org02a5048">
<p>Now that we have the N-Gram model we'll move on to checking its <a href="posts/nlp/auto-complete-perplexity/">Perplexity</a>.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/auto-complete-pre-process-the-data-ii/">Auto-Complete: Pre-Process the Data II</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/auto-complete-pre-process-the-data-ii/" rel="bookmark"><time class="published dt-published" datetime="2020-12-04T15:12:52-08:00" itemprop="datePublished" title="2020-12-04 15:12">2020-12-04 15:12</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org67d755e">Beginning</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#orge7cd232">Imports</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#orgaf121d0">Set Up</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org4dbfbf4">The Environment</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#orge99403d">The Data</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org02fff18">Middle</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org47a1df3">Count Words</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org3a2521a">Test the Code</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org9c118cf">Out-Of-Vocabulary Words</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org68878a5">Test The Code</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#orgd00cb4f">Parts Unknown</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org1945534">Test It</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org3c1ea83">Combine Them</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org7a7efe1">Preprocess the Real Data</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org4113fe1">Put It All Together</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org4a5d0ee">The Imports</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#orgf399628">The Processor</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org743fc7b">Test It Out</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/#org9888a03">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org67d755e">
<h2 id="org67d755e">Beginning</h2>
<div class="outline-text-2" id="text-org67d755e">
<p>This is the third post in a series that begins with <a href="posts/nlp/auto-complete/">Auto-Complete</a>. In the <a href="posts/nlp/auto-complete-pre-process-the-data-i/">previous entry</a> we did some basic preprocessing to transform the raw tweet data into a form closer to what we wanted. In this post we'll add some counts to the data so that we can use it to build our model.</p>
</div>
<div class="outline-3" id="outline-container-orge7cd232">
<h3 id="orge7cd232">Imports</h3>
<div class="outline-text-3" id="text-orge7cd232">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">contain_exactly</span><span class="p">,</span>
    <span class="n">contain_only</span><span class="p">,</span>
    <span class="n">equal</span><span class="p">,</span>
    <span class="n">expect</span><span class="p">,</span>
    <span class="n">have_keys</span><span class="p">)</span>

<span class="c1"># this series</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocomplete</span> <span class="kn">import</span> <span class="n">Tokenizer</span><span class="p">,</span> <span class="n">TrainTestSplit</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgaf121d0">
<h3 id="orgaf121d0">Set Up</h3>
<div class="outline-text-3" id="text-orgaf121d0"></div>
<div class="outline-4" id="outline-container-org4dbfbf4">
<h4 id="org4dbfbf4">The Environment</h4>
<div class="outline-text-4" id="text-org4dbfbf4">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge99403d">
<h4 id="orge99403d">The Data</h4>
<div class="outline-text-4" id="text-orge99403d">
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"TWITTER_AUTOCOMPLETE"</span><span class="p">]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">splitter</span> <span class="o">=</span> <span class="n">TrainTestSplit</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenized</span><span class="p">)</span>
<span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">training</span><span class="p">,</span> <span class="n">splitter</span><span class="o">.</span><span class="n">testing</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org02fff18">
<h2 id="org02fff18">Middle</h2>
<div class="outline-text-2" id="text-org02fff18"></div>
<div class="outline-3" id="outline-container-org47a1df3">
<h3 id="org47a1df3">Count Words</h3>
<div class="outline-text-3" id="text-org47a1df3">
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C4 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1">### GRADED_FUNCTION: count_words ###</span>
<span class="k">def</span> <span class="nf">count_words</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Count the number of word appearence in the tokenized sentences</span>

<span class="sd">    Args:</span>
<span class="sd">       tokenized_sentences: List of lists of strings</span>

<span class="sd">    Returns:</span>
<span class="sd">       dict that maps word (str) to the frequency (int)</span>
<span class="sd">    """</span>

    <span class="n">word_counts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># Loop through each sentence</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">tokenized_sentences</span><span class="p">:</span> <span class="c1"># complete this line</span>

        <span class="c1"># Go through each token in the sentence</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span> <span class="c1"># complete this line</span>

            <span class="c1"># If the token is not in the dictionary yet, set the count to 1</span>
            <span class="k">if</span> <span class="n">token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">word_counts</span><span class="p">:</span> <span class="c1"># complete this line</span>
                <span class="n">word_counts</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># If the token is already in the dictionary, increment the count by 1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">word_counts</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">word_counts</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org3a2521a">
<h3 id="org3a2521a">Test the Code</h3>
<div class="outline-text-3" id="text-org3a2521a">
<div class="highlight">
<pre><span></span><span class="n">tokenized_sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">'leaves'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">'roses'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]]</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">count_words</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">'sky'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'is'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'blue'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'.'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
             <span class="s1">'leaves'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'are'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
             <span class="s1">'green'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'roses'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'red'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="o">**</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org9c118cf">
<h3 id="org9c118cf">Out-Of-Vocabulary Words</h3>
<div class="outline-text-3" id="text-org9c118cf">
<p>If your model is performing autocomplete, but encounters a word that it never saw during training, it won't have an input word to help it determine the next word to suggest. The model will not be able to predict the next word because there are no counts for the current word.</p>
<ul class="org-ul">
<li>This 'new' word is called an 'unknown word', or &lt;b&gt;out of vocabulary (OOV)&lt;/b&gt; words.</li>
<li>The percentage of unknown words in the test set is called the &lt;b&gt; OOV &lt;/b&gt; rate.</li>
</ul>
<p>To handle unknown words during prediction, use a special token to represent all unknown words 'unk'.</p>
<ul class="org-ul">
<li>Modify the training data so that it has some 'unknown' words to train on.</li>
<li>Words to convert into "unknown" words are those that do not occur very frequently in the training set.</li>
<li>Create a list of the most frequent words in the training set, called the &lt;b&gt; closed vocabulary &lt;/b&gt;.</li>
<li>Convert all the other words that are not part of the closed vocabulary to the token 'unk'.</li>
</ul>
<p>Create a function that takes in a text document and a threshold `count_threshold`.</p>
<ul class="org-ul">
<li>Any word whose count is greater than or equal to the threshold `count_threshold` is kept in the closed vocabulary.</li>
<li>Returns the word closed vocabulary list.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C5 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1">### GRADED_FUNCTION: get_words_with_nplus_frequency ###</span>
<span class="k">def</span> <span class="nf">get_words_with_nplus_frequency</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">count_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Find the words that appear N times or more</span>

<span class="sd">    Args:</span>
<span class="sd">       tokenized_sentences: List of lists of sentences</span>
<span class="sd">       count_threshold: minimum number of occurrences for a word to be in the closed vocabulary.</span>

<span class="sd">    Returns:</span>
<span class="sd">       List of words that appear N times or more</span>
<span class="sd">    """</span>
    <span class="c1"># Initialize an empty list to contain the words that</span>
    <span class="c1"># appear at least 'minimum_freq' times.</span>
    <span class="n">closed_vocab</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Get the word couts of the tokenized sentences</span>
    <span class="c1"># Use the function that you defined earlier to count the words</span>
    <span class="n">word_counts</span> <span class="o">=</span> <span class="n">count_words</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">)</span>

    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># for each word and its count</span>
    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">word_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1"># complete this line</span>

        <span class="c1"># check that the word's count</span>
        <span class="c1"># is at least as great as the minimum count</span>
        <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;=</span> <span class="n">count_threshold</span><span class="p">:</span>

            <span class="c1"># append the word to the list</span>
            <span class="n">closed_vocab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">closed_vocab</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org68878a5">
<h4 id="org68878a5">Test The Code</h4>
<div class="outline-text-4" id="text-org68878a5">
<div class="highlight">
<pre><span></span><span class="n">tokenized_sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">'leaves'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">'roses'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]]</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">get_words_with_nplus_frequency</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">,</span> <span class="n">count_threshold</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Closed vocabulary:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">]</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<pre class="example">
Closed vocabulary:
['.', 'are']
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd00cb4f">
<h3 id="orgd00cb4f">Parts Unknown</h3>
<div class="outline-text-3" id="text-orgd00cb4f">
<p>The words that appear `count_threshold` times or more are in the closed vocabulary.</p>
<ul class="org-ul">
<li>All other words are regarded as `unknown`.</li>
<li>Replace words not in the closed vocabulary with the token `&lt;unk&gt;`.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C6 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1">### GRADED_FUNCTION: replace_oov_words_by_unk ###</span>
<span class="k">def</span> <span class="nf">replace_oov_words_by_unk</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                             <span class="n">vocabulary</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                             <span class="n">unknown_token</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"&lt;unk&gt;"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Replace words not in the given vocabulary with '&lt;unk&gt;' token.</span>

<span class="sd">    Args:</span>
<span class="sd">       tokenized_sentences: List of lists of strings</span>
<span class="sd">       vocabulary: List of strings that we will use</span>
<span class="sd">       unknown_token: A string representing unknown (out-of-vocabulary) words</span>

<span class="sd">    Returns:</span>
<span class="sd">       List of lists of strings, with words not in the vocabulary replaced</span>
<span class="sd">    """</span>

    <span class="c1"># Place vocabulary into a set for faster search</span>
    <span class="n">vocabulary</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span>

    <span class="c1"># Initialize a list that will hold the sentences</span>
    <span class="c1"># after less frequent words are replaced by the unknown token</span>
    <span class="n">replaced_tokenized_sentences</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Go through each sentence</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">tokenized_sentences</span><span class="p">:</span>

        <span class="c1"># Initialize the list that will contain</span>
        <span class="c1"># a single sentence with "unknown_token" replacements</span>
        <span class="n">replaced_sentence</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

        <span class="c1"># for each token in the sentence</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span> <span class="c1"># complete this line</span>

            <span class="c1"># Check if the token is in the closed vocabulary</span>
            <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">vocabulary</span><span class="p">:</span> <span class="c1"># complete this line</span>
                <span class="c1"># If so, append the word to the replaced_sentence</span>
                <span class="n">replaced_sentence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># otherwise, append the unknown token instead</span>
                <span class="n">replaced_sentence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unknown_token</span><span class="p">)</span>
        <span class="c1">### END CODE HERE ###</span>

        <span class="c1"># Append the list of tokens to the list of lists</span>
        <span class="n">replaced_tokenized_sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">replaced_sentence</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">replaced_tokenized_sentences</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org1945534">
<h4 id="org1945534">Test It</h4>
<div class="outline-text-4" id="text-org1945534">
<div class="highlight">
<pre><span></span><span class="n">tokenized_sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">"dogs"</span><span class="p">,</span> <span class="s2">"run"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"cats"</span><span class="p">,</span> <span class="s2">"sleep"</span><span class="p">]]</span>
<span class="n">vocabulary</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"dogs"</span><span class="p">,</span> <span class="s2">"sleep"</span><span class="p">]</span>
<span class="n">tmp_replaced_tokenized_sentences</span> <span class="o">=</span> <span class="n">replace_oov_words_by_unk</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Original sentence:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">)</span>
<span class="n">expecteds</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'dogs'</span><span class="p">,</span> <span class="s1">'run'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'cats'</span><span class="p">,</span> <span class="s1">'sleep'</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">,</span> <span class="n">expecteds</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"tokenized_sentences with less frequent words converted to '&lt;unk&gt;':"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_replaced_tokenized_sentences</span><span class="p">)</span>
<span class="n">expecteds</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'dogs'</span><span class="p">,</span> <span class="s1">'&lt;unk&gt;'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'&lt;unk&gt;'</span><span class="p">,</span> <span class="s1">'sleep'</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">actual</span><span class="p">,</span><span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tmp_replaced_tokenized_sentences</span><span class="p">,</span> <span class="n">expecteds</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<pre class="example">
Original sentence:
[['dogs', 'run'], ['cats', 'sleep']]
tokenized_sentences with less frequent words converted to '&lt;unk&gt;':
[['dogs', '&lt;unk&gt;'], ['&lt;unk&gt;', 'sleep']]
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org3c1ea83">
<h3 id="org3c1ea83">Combine Them</h3>
<div class="outline-text-3" id="text-org3c1ea83">
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C7 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1">### GRADED_FUNCTION: preprocess_data ###</span>
<span class="k">def</span> <span class="nf">preprocess_data</span><span class="p">(</span><span class="n">train_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">test_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">count_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Preprocess data, i.e.,</span>
<span class="sd">       - Find tokens that appear at least N times in the training data.</span>
<span class="sd">       - Replace tokens that appear less than N times by "&lt;unk&gt;" both for training and test data.        </span>
<span class="sd">    Args:</span>
<span class="sd">       train_data, test_data: List of lists of strings.</span>
<span class="sd">       count_threshold: Words whose count is less than this are </span>
<span class="sd">                     treated as unknown.</span>

<span class="sd">    Returns:</span>
<span class="sd">       Tuple of</span>
<span class="sd">       - training data with low frequent words replaced by "&lt;unk&gt;"</span>
<span class="sd">       - test data with low frequent words replaced by "&lt;unk&gt;"</span>
<span class="sd">       - vocabulary of words that appear n times or more in the training data</span>
<span class="sd">    """</span>
    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># Get the closed vocabulary using the train data</span>
    <span class="n">vocabulary</span> <span class="o">=</span> <span class="n">get_words_with_nplus_frequency</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">count_threshold</span><span class="p">)</span>

    <span class="c1"># For the train data, replace less common words with "&lt;unk&gt;"</span>
    <span class="n">train_data_replaced</span> <span class="o">=</span> <span class="n">replace_oov_words_by_unk</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">)</span>

    <span class="c1"># For the test data, replace less common words with "&lt;unk&gt;"</span>
    <span class="n">test_data_replaced</span> <span class="o">=</span>  <span class="n">replace_oov_words_by_unk</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">)</span>

    <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">train_data_replaced</span><span class="p">,</span> <span class="n">test_data_replaced</span><span class="p">,</span> <span class="n">vocabulary</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tmp_train</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
     <span class="p">[</span><span class="s1">'leaves'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">]]</span>
<span class="n">tmp_test</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'roses'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]]</span>

<span class="n">tmp_train_repl</span><span class="p">,</span> <span class="n">tmp_test_repl</span><span class="p">,</span> <span class="n">tmp_vocab</span> <span class="o">=</span> <span class="n">preprocess_data</span><span class="p">(</span><span class="n">tmp_train</span><span class="p">,</span> 
                                                           <span class="n">tmp_test</span><span class="p">,</span> 
                                                           <span class="n">count_threshold</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"tmp_train_repl"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_train_repl</span><span class="p">)</span>
<span class="n">expecteds</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'leaves'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tmp_train_repl</span><span class="p">,</span> <span class="n">expecteds</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"tmp_test_repl"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_test_repl</span><span class="p">)</span>

<span class="n">expecteds</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'&lt;unk&gt;'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'&lt;unk&gt;'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tmp_test_repl</span><span class="p">,</span> <span class="n">expecteds</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"tmp_vocab"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_vocab</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">,</span> <span class="s1">'leaves'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">]</span>
<span class="n">expect</span><span class="p">(</span><span class="n">tmp_vocab</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<pre class="example">
tmp_train_repl
[['sky', 'is', 'blue', '.'], ['leaves', 'are', 'green']]

tmp_test_repl
[['&lt;unk&gt;', 'are', '&lt;unk&gt;', '.']]

tmp_vocab
['sky', 'is', 'blue', '.', 'leaves', 'are', 'green']
</pre></div>
</div>
<div class="outline-3" id="outline-container-org7a7efe1">
<h3 id="org7a7efe1">Preprocess the Real Data</h3>
<div class="outline-text-3" id="text-org7a7efe1">
<div class="highlight">
<pre><span></span><span class="n">minimum_freq</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">train_data_processed</span><span class="p">,</span> <span class="n">test_data_processed</span><span class="p">,</span> <span class="n">vocabulary</span> <span class="o">=</span> <span class="n">preprocess_data</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> 
                                                                        <span class="n">test_data</span><span class="p">,</span> 
                                                                        <span class="n">minimum_freq</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"last preprocessed testing sample:"</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">test_data_processed</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'personally'</span><span class="p">,</span> <span class="s1">'would'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'as'</span><span class="p">,</span> <span class="s1">'our'</span><span class="p">,</span> <span class="s1">'official'</span><span class="p">,</span> <span class="s1">'glove'</span><span class="p">,</span> <span class="s1">'of'</span><span class="p">,</span> <span class="s1">'the'</span><span class="p">,</span> <span class="s1">'team'</span><span class="p">,</span> <span class="s1">'local'</span><span class="p">,</span> <span class="s1">'company'</span><span class="p">,</span> <span class="s1">'and'</span><span class="p">,</span> <span class="s1">'quality'</span><span class="p">,</span> <span class="s1">'production'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"preprocessed training sample:"</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">train_data_processed</span><span class="p">[</span><span class="mi">9592</span><span class="p">]</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'that'</span><span class="p">,</span> <span class="s1">'picture'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'just'</span><span class="p">,</span> <span class="s1">'seen'</span><span class="p">,</span> <span class="s1">'whoa'</span><span class="p">,</span> <span class="s1">'dere'</span><span class="p">,</span> <span class="s1">'!'</span><span class="p">,</span> <span class="s1">'!'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"First 10 vocabulary:"</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">vocabulary</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'personally'</span><span class="p">,</span> <span class="s1">'would'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'as'</span><span class="p">,</span> <span class="s1">'our'</span><span class="p">,</span> <span class="s1">'official'</span><span class="p">,</span> <span class="s1">'glove'</span><span class="p">,</span> <span class="s1">'of'</span><span class="p">,</span> <span class="s1">'the'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="c1">#expect(actual).to(contain_exactly(*expected))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="n">actual</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Size of vocabulary: </span><span class="si">{</span><span class="n">actual</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mi">14821</span>
<span class="c1">#expect(actual).to(equal(expected))</span>
</pre></div>
<pre class="example">
last preprocessed testing sample:
['i', 'personally', 'would', 'like', 'as', 'our', 'official', 'glove', 'of', 'the', 'team', 'local', 'company', 'and', 'quality', 'production']

preprocessed training sample:
['that', 'picture', 'i', 'just', 'seen', 'whoa', 'dere', '!', '!', '&gt;', '&gt;', '&gt;', '&gt;', '&gt;', '&gt;', '&gt;']

First 10 vocabulary:
['d', '&amp;', 's', 'is', 'covering', 'the', 'event', 'with', 'thomas', ',']

Size of vocabulary: 14,679
</pre>
<p><b>Note:</b> My shuffling is different from theirs, even though I'm setting the seed, so it seems to come out differently.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org4113fe1">
<h3 id="org4113fe1">Put It All Together</h3>
<div class="outline-text-3" id="text-org4113fe1"></div>
<div class="outline-4" id="outline-container-org4a5d0ee">
<h4 id="org4a5d0ee">The Imports</h4>
<div class="outline-text-4" id="text-org4a5d0ee">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>

<span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgf399628">
<h4 id="orgf399628">The Processor</h4>
<div class="outline-text-4" id="text-orgf399628">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CountProcessor</span><span class="p">:</span>
    <span class="sd">"""Processes the data to have unknowns</span>

<span class="sd">    Args:</span>
<span class="sd">     training: the tokenized training data (list of lists)</span>
<span class="sd">     testing: the tokenized testing data</span>
<span class="sd">     count_threshold: minimum number of times token needs to appear</span>
<span class="sd">     unknown_token: string to use for words below threshold</span>
<span class="sd">    """</span>
    <span class="n">training</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">testing</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">count_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">unknown_token</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"&lt;unk&gt;"</span>
    <span class="n">_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_vocabulary</span><span class="p">:</span> <span class="nb">set</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_train_unknown</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_test_unknown</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="orgf85b705"></a>Counts<br>
<div class="outline-text-5" id="text-orgf85b705">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Counter</span><span class="p">:</span>
    <span class="sd">"""Count of each word in the training data"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span>
</pre></div>
</div>
</li>
<li><a id="org0091255"></a>The Vocabulary<br>
<div class="outline-text-5" id="text-org0091255">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
    <span class="sd">"""The tokens in training that appear at least ``count_threshold`` times"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_threshold</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span>
</pre></div>
</div>
</li>
<li><a id="orgc35b900"></a>Train Unknown<br>
<div class="outline-text-5" id="text-orgc35b900">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">train_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Training data with words below threshold replaced"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_unknown</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_train_unknown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts_unknown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_unknown</span>
</pre></div>
</div>
</li>
<li><a id="org0d91e48"></a>Test Unknown<br>
<div class="outline-text-5" id="text-org0d91e48">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">test_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Testing data with words below threshold replaced"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_unknown</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_unknown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts_unknown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testing</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_unknown</span>
</pre></div>
</div>
</li>
<li><a id="org48e850b"></a>Parts Unknown<br>
<div class="outline-text-5" id="text-org48e850b">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">parts_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Replaces tokens in source that aren't in vocabulary</span>

<span class="sd">    Args:</span>
<span class="sd">     source: nested list of lists with tokens to check</span>

<span class="sd">    Returns: source with unknown words replaced by unknown_token</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">token</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_token</span>
             <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">source</span>
    <span class="p">]</span>    
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org743fc7b">
<h4 id="org743fc7b">Test It Out</h4>
<div class="outline-text-4" id="text-org743fc7b">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.autocomplete</span> <span class="kn">import</span> <span class="n">CountProcessor</span>

<span class="n">tokenized_sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">'leaves'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">'roses'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]]</span>

<span class="n">testing</span> <span class="o">=</span> <span class="p">[[]]</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">CountProcessor</span><span class="p">(</span><span class="n">tokenized_sentences</span><span class="p">,</span> <span class="n">testing</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">counts</span>

<span class="n">expected</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">'sky'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'is'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'blue'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'.'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
             <span class="s1">'leaves'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'are'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
             <span class="s1">'green'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'roses'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'red'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># note to future self: if you pass key=value to have_keys it checks both</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">have_keys</span><span class="p">(</span><span class="o">**</span><span class="n">expected</span><span class="p">))</span>

<span class="n">actual</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">vocabulary</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">]</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_only</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tokenized_sentences</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">"dogs"</span><span class="p">,</span> <span class="s2">"run"</span><span class="p">,</span> <span class="s2">"sleep"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"cats"</span><span class="p">,</span> <span class="s2">"sleep"</span><span class="p">,</span> <span class="s2">"dogs"</span><span class="p">]]</span>

<span class="n">testing</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">"cows"</span><span class="p">,</span> <span class="s2">"dogs"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"pigs"</span><span class="p">,</span> <span class="s2">"sleep"</span><span class="p">]]</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">CountProcessor</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">tokenized_sentences</span><span class="p">,</span> <span class="n">testing</span><span class="o">=</span><span class="n">testing</span><span class="p">)</span>

<span class="n">actuals</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">train_unknown</span>

<span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">"&lt;unk&gt;"</span>
<span class="n">expecteds</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">"dogs"</span><span class="p">,</span> <span class="n">UNKNOWN</span><span class="p">,</span> <span class="s2">"sleep"</span><span class="p">],</span> <span class="p">[</span><span class="n">UNKNOWN</span><span class="p">,</span> <span class="s2">"sleep"</span><span class="p">,</span> <span class="s2">"dogs"</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">actual</span><span class="p">,</span><span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">actuals</span><span class="p">,</span> <span class="n">expecteds</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">actuals</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">test_unknown</span>
<span class="n">expecteds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UNKNOWN</span><span class="p">,</span> <span class="s2">"dogs"</span><span class="p">],</span> <span class="p">[</span><span class="n">UNKNOWN</span><span class="p">,</span> <span class="s2">"sleep"</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">actual</span><span class="p">,</span><span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">actuals</span><span class="p">,</span> <span class="n">expecteds</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org9888a03">
<h2 id="org9888a03">End</h2>
<div class="outline-text-2" id="text-org9888a03">
<p>Now that we have the data in the basic form we want we'll move on to building the <a href="posts/nlp/auto-complete-the-n-gram-model/">N-Gram Language Model</a>.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/auto-complete-pre-process-the-data-i/">Auto-Complete: Pre-Process the Data I</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/auto-complete-pre-process-the-data-i/" rel="bookmark"><time class="published dt-published" datetime="2020-12-03T18:24:54-08:00" itemprop="datePublished" title="2020-12-03 18:24">2020-12-03 18:24</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#orgfcc0e1f">Beginning</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org6fdf4aa">Imports</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org713b037">Set Up</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org0d08a62">The Environment</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org63a8507">Middle</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org8550ea0">Load the Data</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org6e7c320">Split To Sentences</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#orgca8f1e4">Test The Code</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#orge8d39ac">Tokenize Sentences</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org36e48d0">Test the Code</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org7628e46">Combine Split Sentences and Tokenize</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#orgaa711f5">Test It</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org8b56158">Split Train and Test Sets</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#orgc24cd7f">Object-Oriented</a>
<ul>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org8593669">Imports</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#orgbe4afb8">The Tokenizer</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org52f43f0">Train-Test-Split</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org04a4d02">Test It Out</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#org589ad32">Training And Test Sets</a></li>
</ul>
</li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/#orge1261ec">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgfcc0e1f">
<h2 id="orgfcc0e1f">Beginning</h2>
<div class="outline-text-2" id="text-orgfcc0e1f">
<p>This is the second part of a series implementing an n-gram-based auto-complete system for tweets. The starting post is <a href="posts/nlp/auto-complete/">Auto-Complete</a>.</p>
</div>
<div class="outline-3" id="outline-container-org6fdf4aa">
<h3 id="org6fdf4aa">Imports</h3>
<div class="outline-text-3" id="text-org6fdf4aa">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">contain_exactly</span><span class="p">,</span>
    <span class="n">equal</span><span class="p">,</span>
    <span class="n">expect</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">nltk</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org713b037">
<h3 id="org713b037">Set Up</h3>
<div class="outline-text-3" id="text-org713b037"></div>
<div class="outline-4" id="outline-container-org0d08a62">
<h4 id="org0d08a62">The Environment</h4>
<div class="outline-text-4" id="text-org0d08a62">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org63a8507">
<h2 id="org63a8507">Middle</h2>
<div class="outline-text-2" id="text-org63a8507"></div>
<div class="outline-3" id="outline-container-org8550ea0">
<h3 id="org8550ea0">Load the Data</h3>
<div class="outline-text-3" id="text-org8550ea0">
<p>We're going to use twitter data. There's no listing of the source, so I'm assuming it's the NLTK twitter data. But maybe not.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"TWITTER_AUTOCOMPLETE"</span><span class="p">]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Data type:"</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of letters: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"First 300 letters of the data"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"-------"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">300</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"-------"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Last 300 letters of the data"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"-------"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"-------"</span><span class="p">)</span>    
</pre></div>
<pre class="example">
Data type: &lt;class 'str'&gt;
Number of letters: 3,335,477
First 300 letters of the data
-------
How are you? Btw thanks for the RT. You gonna be in DC anytime soon? Love to see you. Been way, way too long.\nWhen you meet someone special... you'll know. Your heart will beat more rapidly and you'll smile for no reason.\nthey've decided its more fun if I don't.\nSo Tired D; Played Lazer Tag & Ran A 
-------
Last 300 letters of the data
-------
ust had one a few weeks back....hopefully we will be back soon! wish you the best yo\nColombia is with an 'o'...“: We now ship to 4 countries in South America (fist pump). Please welcome Columbia to the Stunner Family”\n#GutsiestMovesYouCanMake Giving a cat a bath.\nCoffee after 5 was a TERRIBLE idea.\n
-------
</pre>
<p>So the data looks like it's just tweets, without any metadata and is separated using newlines.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org6e7c320">
<h3 id="org6e7c320">Split To Sentences</h3>
<div class="outline-text-3" id="text-org6e7c320">
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C1 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1">### GRADED_FUNCTION: split_to_sentences ###</span>
<span class="k">def</span> <span class="nf">split_to_sentences</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Split data by linebreak "\n"</span>

<span class="sd">    Args:</span>
<span class="sd">       data: str</span>

<span class="sd">    Returns:</span>
<span class="sd">       A list of sentences</span>
<span class="sd">    """</span>
    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="c1"># Additional clearning (This part is already implemented)</span>
    <span class="c1"># - Remove leading and trailing spaces from each sentence</span>
    <span class="c1"># - Drop sentences if they are empty strings.</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">]</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sentences</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">sentences</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgca8f1e4">
<h4 id="orgca8f1e4">Test The Code</h4>
<div class="outline-text-4" id="text-orgca8f1e4">
<div class="highlight">
<pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">I have a pen.</span><span class="se">\n</span><span class="s2">I have an apple. </span><span class="se">\n</span><span class="s2">Ah</span><span class="se">\n</span><span class="s2">Apple pen.</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">"""</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'I have a pen.'</span><span class="p">,</span> <span class="s1">'I have an apple.'</span><span class="p">,</span> <span class="s1">'Ah'</span><span class="p">,</span> <span class="s1">'Apple pen.'</span><span class="p">]</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">split_to_sentences</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<pre class="example">

I have a pen.
I have an apple. 
Ah
Apple pen.

</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orge8d39ac">
<h3 id="orge8d39ac">Tokenize Sentences</h3>
<div class="outline-text-3" id="text-orge8d39ac">
<p>The next step is to tokenize sentences (split a sentence into a list of words).</p>
<ul class="org-ul">
<li>Convert all tokens into lower case so that words which are capitalized (for example, at the start of a sentence) in the original text are treated the same as the lowercase versions of the words.</li>
<li>Append each tokenized list of words into a list of tokenized sentences.</li>
</ul>
<p><b>Hints:</b></p>
<ul class="org-ul">
<li>Use <a href="https://docs.python.org/3/library/stdtypes.html?highlight=split#str.lower%22">str.lower</a> to convert strings to lowercase.</li>
<li>Please use <a href="https://www.nltk.org/api/nltk.tokenize.html#nltk.tokenize.punkt.PunktLanguageVars.word_tokenize%22">nltk.word_tokenize</a> to split sentences into tokens.</li>
<li>If you used <code>str.split</code> insteaad of <code>nltk.word_tokenize</code>, there are additional edge cases to handle, such as the punctuation (comma, period) that follows a word.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C2 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1">### GRADED_FUNCTION: tokenize_sentences ###</span>
<span class="k">def</span> <span class="nf">tokenize_sentences</span><span class="p">(</span><span class="n">sentences</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Tokenize sentences into tokens (words)</span>

<span class="sd">    Args:</span>
<span class="sd">       sentences: List of strings</span>

<span class="sd">    Returns:</span>
<span class="sd">       List of lists of tokens</span>
<span class="sd">    """</span>

    <span class="c1"># Initialize the list of lists of tokenized sentences</span>
    <span class="n">tokenized_sentences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># Go through each sentence</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>

        <span class="c1"># Convert to lowercase letters</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Convert into a list of words</span>
        <span class="n">tokenized</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>

        <span class="c1"># append the list of words to the list of lists</span>
        <span class="n">tokenized_sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokenized</span><span class="p">)</span>

    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">tokenized_sentences</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org36e48d0">
<h4 id="org36e48d0">Test the Code</h4>
<div class="outline-text-4" id="text-org36e48d0">
<div class="highlight">
<pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Sky is blue."</span><span class="p">,</span> <span class="s2">"Leaves are green."</span><span class="p">,</span> <span class="s2">"Roses are red."</span><span class="p">]</span>

<span class="n">expecteds</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'leaves'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'roses'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]]</span>

<span class="n">actuals</span> <span class="o">=</span> <span class="n">tokenize_sentences</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
<span class="k">for</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expecteds</span><span class="p">,</span> <span class="n">actuals</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org7628e46">
<h3 id="org7628e46">Combine Split Sentences and Tokenize</h3>
<div class="outline-text-3" id="text-org7628e46">
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C3 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="c1">### GRADED_FUNCTION: get_tokenized_data ###</span>
<span class="k">def</span> <span class="nf">get_tokenized_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Make a list of tokenized sentences</span>

<span class="sd">    Args:</span>
<span class="sd">       data: String</span>

<span class="sd">    Returns:</span>
<span class="sd">       List of lists of tokens</span>
<span class="sd">    """</span>
    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># Get the sentences by splitting up the data</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="n">split_to_sentences</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Get the list of lists of tokens by tokenizing the sentences</span>
    <span class="n">tokenized_sentences</span> <span class="o">=</span> <span class="n">tokenize_sentences</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>

    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">tokenized_sentences</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgaa711f5">
<h4 id="orgaa711f5">Test It</h4>
<div class="outline-text-4" id="text-orgaa711f5">
<div class="highlight">
<pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s2">"Sky is blue.</span><span class="se">\n</span><span class="s2">Leaves are green</span><span class="se">\n</span><span class="s2">Roses are red."</span>
<span class="n">actuals</span> <span class="o">=</span> <span class="n">get_tokenized_data</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">expecteds</span> <span class="o">=</span>  <span class="p">[[</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
              <span class="p">[</span><span class="s1">'leaves'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">],</span>
              <span class="p">[</span><span class="s1">'roses'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">actuals</span><span class="p">,</span> <span class="n">expecteds</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org8b56158">
<h3 id="org8b56158">Split Train and Test Sets</h3>
<div class="outline-text-3" id="text-org8b56158">
<div class="highlight">
<pre><span></span><span class="n">tokenized_data</span> <span class="o">=</span> <span class="n">get_tokenized_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">87</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">tokenized_data</span><span class="p">)</span>

<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokenized_data</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">tokenized_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">tokenized_data</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">actual_data</span><span class="p">,</span> <span class="n">expected_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenized_data</span><span class="p">),</span> <span class="mi">47961</span>
<span class="n">actual_training</span><span class="p">,</span> <span class="n">expected_training</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="p">),</span> <span class="mi">38368</span>
<span class="n">actual_testing</span><span class="p">,</span> <span class="n">expected_testing</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">),</span> <span class="mi">9593</span>

<span class="nb">print</span><span class="p">((</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">actual_data</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> are split into </span><span class="si">{</span><span class="n">actual_training</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> training entries"</span>
       <span class="sa">f</span><span class="s2">" and </span><span class="si">{</span><span class="n">actual_testing</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> test set entries."</span><span class="p">))</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="s2">"data training testing"</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
        <span class="p">(</span><span class="n">actual_data</span><span class="p">,</span> <span class="n">actual_training</span><span class="p">,</span> <span class="n">actual_testing</span><span class="p">),</span>
        <span class="p">(</span><span class="n">expected_data</span><span class="p">,</span> <span class="n">expected_training</span><span class="p">,</span> <span class="n">expected_testing</span><span class="p">)):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected</span><span class="p">)),</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
</pre></div>
<pre class="example">
47,961 are split into 38,368 training entries and 9,593 test set entries.
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"First training sample:"</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"i"</span><span class="p">,</span> <span class="s2">"personally"</span><span class="p">,</span> <span class="s2">"would"</span><span class="p">,</span> <span class="s2">"like"</span><span class="p">,</span> <span class="s2">"as"</span><span class="p">,</span> <span class="s2">"our"</span><span class="p">,</span> <span class="s2">"official"</span><span class="p">,</span> <span class="s2">"glove"</span><span class="p">,</span>
            <span class="s2">"of"</span><span class="p">,</span> <span class="s2">"the"</span><span class="p">,</span> <span class="s2">"team"</span><span class="p">,</span> <span class="s2">"local"</span><span class="p">,</span> <span class="s2">"company"</span><span class="p">,</span> <span class="s2">"and"</span><span class="p">,</span> <span class="s2">"quality"</span><span class="p">,</span>
            <span class="s2">"production"</span><span class="p">]</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<pre class="example">
First training sample:
['i', 'personally', 'would', 'like', 'as', 'our', 'official', 'glove', 'of', 'the', 'team', 'local', 'company', 'and', 'quality', 'production']
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"First test sample"</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"that"</span><span class="p">,</span> <span class="s2">"picture"</span><span class="p">,</span> <span class="s2">"i"</span><span class="p">,</span> <span class="s2">"just"</span><span class="p">,</span> <span class="s2">"seen"</span><span class="p">,</span> <span class="s2">"whoa"</span><span class="p">,</span> <span class="s2">"dere"</span><span class="p">,</span> <span class="s2">"!"</span><span class="p">,</span> <span class="s2">"!"</span><span class="p">,</span>
            <span class="s2">"&gt;"</span><span class="p">,</span> <span class="s2">"&gt;"</span><span class="p">,</span> <span class="s2">"&gt;"</span><span class="p">,</span> <span class="s2">"&gt;"</span><span class="p">,</span> <span class="s2">"&gt;"</span><span class="p">,</span> <span class="s2">"&gt;"</span><span class="p">,</span> <span class="s2">"&gt;"</span><span class="p">]</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<pre class="example">
First test sample
['that', 'picture', 'i', 'just', 'seen', 'whoa', 'dere', '!', '!', '&gt;', '&gt;', '&gt;', '&gt;', '&gt;', '&gt;', '&gt;']
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgc24cd7f">
<h3 id="orgc24cd7f">Object-Oriented</h3>
<div class="outline-text-3" id="text-orgc24cd7f">
<div class="highlight">
<pre><span></span><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">the</span><span class="o">-</span><span class="n">tokenizer</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">sentences</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">tokenized</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">train</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">split</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">shuffled</span><span class="o">-</span><span class="n">data</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">training</span><span class="o">-</span><span class="n">data</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">testing</span><span class="o">-</span><span class="n">data</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">split</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org8593669">
<h4 id="org8593669">Imports</h4>
<div class="outline-text-4" id="text-org8593669">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">nltk</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgbe4afb8">
<h4 id="orgbe4afb8">The Tokenizer</h4>
<div class="outline-text-4" id="text-orgbe4afb8">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Tokenizer</span><span class="p">:</span>
    <span class="sd">"""Tokenizes string sentences</span>

<span class="sd">    Args:</span>
<span class="sd">     source: string data to tokenize</span>
<span class="sd">     end_of_sentence: what to split sentences on</span>

<span class="sd">    """</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">end_of_sentence</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
    <span class="n">_sentences</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_tokenized</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_training_data</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="orgf04b032"></a>Sentences<br>
<div class="outline-text-5" id="text-orgf04b032">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">sentences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""The data split into sentences"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_of_sentence</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span> <span class="o">=</span> <span class="p">(</span><span class="n">sentence</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">sentence</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span> <span class="k">if</span> <span class="n">sentence</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sentences</span>
</pre></div>
</div>
</li>
<li><a id="orgc1f120f"></a>Tokenized<br>
<div class="outline-text-5" id="text-orgc1f120f">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">tokenized</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""List of tokenized sentence"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenized</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokenized</span> <span class="o">=</span> <span class="p">[</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">sentence</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                           <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentences</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenized</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org52f43f0">
<h4 id="org52f43f0">Train-Test-Split</h4>
<div class="outline-text-4" id="text-org52f43f0">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TrainTestSplit</span><span class="p">:</span>
    <span class="sd">"""splits up the training and testing sets</span>

<span class="sd">    Args:</span>
<span class="sd">     data: list of data to split</span>
<span class="sd">     training_fraction: how much to put in the training set</span>
<span class="sd">     seed: something to seed the random call</span>
<span class="sd">    """</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">training_fraction</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">87</span>
    <span class="n">_shuffled</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_training</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_testing</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_split</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="org44159bc"></a>Shuffled Data<br>
<div class="outline-text-5" id="text-org44159bc">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">shuffled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""The data shuffled"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shuffled</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shuffled</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shuffled</span>
</pre></div>
</div>
</li>
<li><a id="org25dd7e9"></a>Split<br>
<div class="outline-text-5" id="text-org25dd7e9">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""The slice value for training and testing"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_split</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_fraction</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split</span>
</pre></div>
</div>
</li>
<li><a id="org753b3fe"></a>Training Data<br>
<div class="outline-text-5" id="text-org753b3fe">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">training</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""The Training Portion of the Set"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_training</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffled</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training</span>
</pre></div>
</div>
</li>
<li><a id="org532a7bc"></a>Testing Data<br>
<div class="outline-text-5" id="text-org532a7bc">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">testing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""The testing data"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_testing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffled</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">:]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testing</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org04a4d02">
<h4 id="org04a4d02">Test It Out</h4>
<div class="outline-text-4" id="text-org04a4d02"></div>
<ul class="org-ul">
<li><a id="orgc34bd27"></a>Sentences<br>
<div class="outline-text-5" id="text-orgc34bd27">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.autocomplete</span> <span class="kn">import</span> <span class="n">Tokenizer</span><span class="p">,</span> <span class="n">TrainTestSplit</span>

<span class="n">x</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">I have a pen.</span><span class="se">\n</span><span class="s2">I have an apple. </span><span class="se">\n</span><span class="s2">Ah</span><span class="se">\n</span><span class="s2">Apple pen.</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">"""</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'I have a pen.'</span><span class="p">,</span> <span class="s1">'I have an apple.'</span><span class="p">,</span> <span class="s1">'Ah'</span><span class="p">,</span> <span class="s1">'Apple pen.'</span><span class="p">]</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">actual</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">sentences</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><a id="org3288eb3"></a>Tokens<br>
<div class="outline-text-5" id="text-org3288eb3">
<div class="highlight">
<pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">"Sky is blue."</span><span class="p">,</span> <span class="s2">"Leaves are green."</span><span class="p">,</span> <span class="s2">"Roses are red."</span><span class="p">])</span>

<span class="n">expecteds</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'leaves'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'roses'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]]</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="n">actuals</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenized</span>
<span class="k">for</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expecteds</span><span class="p">,</span> <span class="n">actuals</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org589ad32">
<h3 id="org589ad32">Training And Test Sets</h3>
<div class="outline-text-3" id="text-org589ad32">
<div class="highlight">
<pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">87</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">splitter</span> <span class="o">=</span> <span class="n">TrainTestSplit</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenized</span><span class="p">)</span>
<span class="n">actual_data</span><span class="p">,</span> <span class="n">expected_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenized</span><span class="p">),</span> <span class="mi">47961</span>
<span class="n">actual_training</span><span class="p">,</span> <span class="n">expected_training</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitter</span><span class="o">.</span><span class="n">training</span><span class="p">),</span> <span class="mi">38368</span>
<span class="n">actual_testing</span><span class="p">,</span> <span class="n">expected_testing</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitter</span><span class="o">.</span><span class="n">testing</span><span class="p">),</span> <span class="mi">9593</span>

<span class="nb">print</span><span class="p">((</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">actual_data</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> are split into </span><span class="si">{</span><span class="n">actual_training</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> training entries"</span>
       <span class="sa">f</span><span class="s2">" and </span><span class="si">{</span><span class="n">actual_testing</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> test set entries."</span><span class="p">))</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="s2">"data training testing"</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
        <span class="p">(</span><span class="n">actual_data</span><span class="p">,</span> <span class="n">actual_training</span><span class="p">,</span> <span class="n">actual_testing</span><span class="p">),</span>
        <span class="p">(</span><span class="n">expected_data</span><span class="p">,</span> <span class="n">expected_training</span><span class="p">,</span> <span class="n">expected_testing</span><span class="p">)):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected</span><span class="p">)),</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orge1261ec">
<h2 id="orge1261ec">End</h2>
<div class="outline-text-2" id="text-orge1261ec">
<p>The next post in this series is <a href="posts/nlp/auto-complete-pre-process-the-data-ii/">Pre-Processing II</a> in which we'll add counts to the tweets.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/auto-complete/">Auto-Complete</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/auto-complete/" rel="bookmark"><time class="published dt-published" datetime="2020-12-03T18:15:23-08:00" itemprop="datePublished" title="2020-12-03 18:15">2020-12-03 18:15</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-org6196551">
<h2 id="org6196551">The Parts</h2>
<div class="outline-text-2" id="text-org6196551">
<p>These are the posts that make up this series in which we'll make an auto-completer using N-Grams.</p>
<ul class="org-ul">
<li><a href="posts/nlp/auto-complete-pre-process-the-data-i/">Pre-Processing I</a></li>
<li><a href="posts/nlp/auto-complete-pre-process-the-data-ii/">Pre-Processing II</a></li>
<li><a href="posts/nlp/auto-complete-the-n-gram-model/">The N-Gram Model</a></li>
<li><a href="posts/nlp/auto-complete-perplexity/">Perplexity</a></li>
<li><a href="posts/nlp/auto-complete-building-the-auto-complete-system/">The Complete System</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/n-grams-out-of-vocabulary-words/">N-Grams: Out-of-Vocabulary Words</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/n-grams-out-of-vocabulary-words/" rel="bookmark"><time class="published dt-published" datetime="2020-12-03T14:35:57-08:00" itemprop="datePublished" title="2020-12-03 14:35">2020-12-03 14:35</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#org73a4921">Beginning</a></li>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#orgc67c9a3">Middle</a>
<ul>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#orgfd9f2e8">Build the vocabulary</a></li>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#org1a78b5b">Replace Unknown Words</a>
<ul>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#orgd85d99a">A Specific Frequency</a></li>
</ul>
</li>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#org4734318">Too Many Unknowns</a></li>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#org62297f5">Smoothing</a></li>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#orgb10aa1a">Back-Off</a></li>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#org77e0117">Interpolation</a></li>
</ul>
</li>
<li><a href="posts/nlp/n-grams-out-of-vocabulary-words/#org2f1ebd2">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org73a4921">
<h2 id="org73a4921">Beginning</h2>
<div class="outline-text-2" id="text-org73a4921">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgc67c9a3">
<h2 id="orgc67c9a3">Middle</h2>
<div class="outline-text-2" id="text-orgc67c9a3">
<p>We're going to look at a method of deciding whether an unknown word belongs to our vocabulary. It requires that we know the target size of the vocabulary in advance and the vocabulary has the words and their counts from the training set.</p>
</div>
<div class="outline-3" id="outline-container-orgfd9f2e8">
<h3 id="orgfd9f2e8">Build the vocabulary</h3>
<div class="outline-text-3" id="text-orgfd9f2e8">
<p>First we'll define the vocabulary target size.</p>
<div class="highlight">
<pre><span></span><span class="n">vocabulary_target_size</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
<p>Now build a counter - with a real vocabulary we could use the <code>Counter</code> object to build the counts directly, but since we don't have a real corpus we can create it with a dict.</p>
<div class="highlight">
<pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">({</span><span class="s2">"happy"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
          <span class="s2">"because"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
          <span class="s2">"i"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
          <span class="s2">"am"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
          <span class="s2">"learning"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
          <span class="s2">"."</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
<p>Now trim it down to our target size.</p>
<div class="highlight">
<pre><span></span><span class="n">vocabulary</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">vocabulary_target_size</span><span class="p">)</span>
</pre></div>
<p>Now get the words only.</p>
<div class="highlight">
<pre><span></span><span class="n">vocabulary</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">vocabulary</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The </span><span class="si">{</span><span class="n">vocabulary_target_size</span><span class="si">}</span><span class="s2"> most frequent words: </span><span class="si">{</span><span class="n">vocabulary</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
The 3 most frequent words: {'because', 'learning', 'happy'}
</pre></div>
</div>
<div class="outline-3" id="outline-container-org1a78b5b">
<h3 id="org1a78b5b">Replace Unknown Words</h3>
<div class="outline-text-3" id="text-org1a78b5b">
<div class="highlight">
<pre><span></span><span class="n">original</span> <span class="o">=</span> <span class="s2">"am i learning"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">original</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">word</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocabulary</span> <span class="k">else</span> <span class="s2">"&lt;UNK&gt;"</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Original: </span><span class="si">{</span><span class="n">original</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processed: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Original: ['am', 'i', 'learning']
Processed: ['&lt;UNK&gt;', '&lt;UNK&gt;', 'learning']
</pre></div>
<div class="outline-4" id="outline-container-orgd85d99a">
<h4 id="orgd85d99a">A Specific Frequency</h4>
<div class="outline-text-4" id="text-orgd85d99a">
<p>There might also be cases where we need to filter by a specific frequency instead of just the largest frequencies. Here's one way to do it.</p>
<div class="highlight">
<pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">word_counts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"happy"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
               <span class="s2">"because"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
               <span class="s2">"i"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
               <span class="s2">"am"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
               <span class="s2">"learning"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
               <span class="s2">"."</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">matches</span> <span class="o">=</span> <span class="p">(</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">word_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span><span class="o">==</span><span class="n">match</span><span class="p">)</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</pre></div>
<pre class="example">
because
learning
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org4734318">
<h3 id="org4734318">Too Many Unknowns</h3>
<div class="outline-text-3" id="text-org4734318">
<p>We're going to use perplexity to assess the performance of our model. If you have too many unknowns your perplexity will be low even though your model isn't doing well. Here's an example of this effect.</p>
<p>Rather than going through the trouble of creating the corpus, let's just pretend we calculated the probabilities (the bigram-probabilities for the training set were calculated in <a href="posts/nlp/n-gram-building-the-language-model/">the previous post</a>).</p>
<p>Here's the case where everything is known.</p>
<div class="highlight">
<pre><span></span><span class="n">training_set</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">,</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]</span>

<span class="c1"># pre-calculated probabilities</span>
<span class="n">bigram_probabilities</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">):</span> <span class="mf">1.0</span><span class="p">,</span>
                        <span class="p">(</span><span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="p">(</span><span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">):</span> <span class="mf">1.0</span><span class="p">,</span>
                        <span class="p">(</span><span class="s1">'because'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">):</span> <span class="mf">1.0</span><span class="p">,</span>
                        <span class="p">(</span><span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="p">(</span><span class="s1">'learning'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">):</span> <span class="mf">1.0</span><span class="p">}</span>
<span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">]</span>
</pre></div>
<p>And here's the case where the training set has a lot of unknowns (Out-of-Vocabulary words).</p>
<div class="highlight">
<pre><span></span><span class="n">training_set_unk</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'&lt;UNK&gt;'</span><span class="p">,</span> <span class="s1">'&lt;UNK&gt;'</span><span class="p">,</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'&lt;UNK&gt;'</span><span class="p">,</span> <span class="s1">'&lt;UNK&gt;'</span><span class="p">]</span>

<span class="n">test_set_unk</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'&lt;UNK&gt;'</span><span class="p">]</span>
</pre></div>
<p>And here's our bigram probabilities for the set with unknowns.</p>
<div class="highlight">
<pre><span></span><span class="n">bigram_probabilities_unk</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">):</span> <span class="mf">1.0</span><span class="p">,</span>
                            <span class="p">(</span><span class="s1">'am'</span><span class="p">,</span> <span class="s1">'&lt;UNK&gt;'</span><span class="p">):</span> <span class="mf">1.0</span><span class="p">,</span>
                            <span class="p">(</span><span class="s1">'&lt;UNK&gt;'</span><span class="p">,</span> <span class="s1">'&lt;UNK&gt;'</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
                            <span class="p">(</span><span class="s1">'&lt;UNK&gt;'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">):</span> <span class="mf">0.25</span><span class="p">}</span>
</pre></div>
<p>"i" is always followed by "am" so the first probability is going to be 1. "am" is always followed by "&lt;UNK&gt;" so the second probability will also be 1. Two of the four "&lt;UNK&gt;"s are followed by an "&lt;UNK&gt;" so the third probability is 1/2 and "&lt;UNK&gt;" is followed by "i" once, so the last probability is 1/4.</p>
<div class="highlight">
<pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>
<span class="n">probability</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">probability_unk</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">n</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_set</span><span class="p">),</span> <span class="mi">2</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">bigram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">test_set</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">N</span><span class="p">])</span>
    <span class="n">probability</span> <span class="o">=</span> <span class="n">probability</span> <span class="o">*</span> <span class="n">bigram_probabilities</span><span class="p">[</span><span class="n">bigram</span><span class="p">]</span>

    <span class="n">bigram_unk</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">test_set_unk</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">N</span><span class="p">])</span>
    <span class="n">probability_unk</span> <span class="o">=</span> <span class="n">probability_unk</span> <span class="o">*</span> <span class="n">bigram_probabilities_unk</span><span class="p">[</span><span class="n">bigram_unk</span><span class="p">]</span>

<span class="c1"># calculate perplexity for both original test set and test set with &lt;UNK&gt;</span>
<span class="n">perplexity</span> <span class="o">=</span> <span class="n">probability</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">M</span><span class="p">)</span>
<span class="n">perplexity_unk</span> <span class="o">=</span> <span class="n">probability_unk</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">M</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"perplexity for the training set: </span><span class="si">{</span><span class="n">perplexity</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"perplexity for the training set with &lt;UNK&gt;: </span><span class="si">{</span><span class="n">perplexity_unk</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
perplexity for the training set: 1.2599210498948732
perplexity for the training set with &lt;UNK&gt;: 1.0
</pre>
<p>So our training set with unknown words does better than our training set with all the words in our test set. It's a little mysterious to me why you would choose to put all these unknowns in the training set, unless you're trying to save space or something. I'll have to go back and read about that.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org62297f5">
<h3 id="org62297f5">Smoothing</h3>
<div class="outline-text-3" id="text-org62297f5">
<p>As with prior cases where we had to calculate probabilities, we need to be able to handle probabilities for n-grams that we didn't learn. We're going to use <code>add-k</code> smoothing here as an example.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">add_k_smoothing</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vocabulary_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_gram_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">n_gram_prefix_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span>  <span class="p">((</span><span class="n">n_gram_count</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span>
             <span class="p">(</span><span class="n">n_gram_prefix_count</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">vocabulary_size</span><span class="p">))</span>
</pre></div>
<p>We'll take a look at <code>k=1</code> (Laplacian) smoothing for a trigram.</p>
<div class="highlight">
<pre><span></span><span class="n">trigram_probabilities</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)</span> <span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">bigram_probabilities</span> <span class="o">=</span> <span class="p">{(</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)</span> <span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<span class="n">vocabulary_size</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">probability_known_trigram</span> <span class="o">=</span> <span class="n">add_k_smoothing</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">vocabulary_size</span><span class="p">,</span> <span class="n">trigram_probabilities</span><span class="p">[(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)],</span> 
                           <span class="n">bigram_probabilities</span><span class="p">[(</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)])</span>

<span class="n">probability_unknown_trigram</span> <span class="o">=</span> <span class="n">add_k_smoothing</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">vocabulary_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"probability_known_trigram: </span><span class="si">{</span><span class="n">probability_known_trigram</span><span class="si">:</span><span class="s2"> 0.03f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"probability_unknown_trigram: </span><span class="si">{</span><span class="n">probability_unknown_trigram</span><span class="si">:</span><span class="s2"> 0.03f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
probability_known_trigram:  0.200
probability_unknown_trigram:  0.200
</pre>
<p>So, here's a problem with <i>add-k</i> smoothing - when the n-gram is unknown, we still get a 20% probability, which in this case happens to be the same as a trigram that was in the training set.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgb10aa1a">
<h3 id="orgb10aa1a">Back-Off</h3>
<div class="outline-text-3" id="text-orgb10aa1a">
<p>Here's an alternate way to handle unknown n-grams - if the n-gram isn't known, use a probability for a smaller <i>n</i>.</p>
<p>Here are our pre-calculated probabilities of all types of n-grams.</p>
<div class="highlight">
<pre><span></span><span class="n">trigram_probabilities</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">):</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">bigram_probabilities</span> <span class="o">=</span> <span class="p">{(</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">):</span> <span class="mf">0.3</span><span class="p">}</span>
<span class="n">unigram_probabilities</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'happy'</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">}</span>
</pre></div>
<p>Here's the trigram that we want the probability for. As you can see, we don't have "you" in our known n-grams.</p>
<div class="highlight">
<pre><span></span><span class="n">trigram</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'are'</span><span class="p">,</span> <span class="s1">'you'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)</span>
<span class="n">bigram</span><span class="p">,</span> <span class="n">unigram</span> <span class="o">=</span> <span class="n">trigram</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span> <span class="mi">3</span><span class="p">],</span> <span class="n">trigram</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
<p>Now we can do a brute-force search for the probabilities. \(\lambda\) was discovered experimentally.</p>
<div class="highlight">
<pre><span></span><span class="n">lambda_factor</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">probability_hat_trigram</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># search for first non-zero probability starting with the trigram</span>
<span class="c1"># to generalize this for any order of n-gram hierarchy, </span>
<span class="c1"># you could loop through the probability dictionaries instead of if/else cascade</span>
<span class="k">if</span> <span class="n">trigram</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trigram_probabilities</span> <span class="ow">or</span> <span class="n">trigram_probabilities</span><span class="p">[</span><span class="n">trigram</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"probability for trigram </span><span class="si">{</span><span class="n">trigram</span><span class="si">}</span><span class="s2"> not found"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bigram</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bigram_probabilities</span> <span class="ow">or</span> <span class="n">bigram_probabilities</span><span class="p">[</span><span class="n">bigram</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"probability for bigram </span><span class="si">{</span><span class="n">bigram</span><span class="si">}</span><span class="s2"> not found"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unigram</span> <span class="ow">in</span> <span class="n">unigram_probabilities</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"probability for unigram </span><span class="si">{</span><span class="n">unigram</span><span class="si">}</span><span class="s2"> found</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="n">probability_hat_trigram</span> <span class="o">=</span> <span class="n">lambda_factor</span> <span class="o">*</span> <span class="n">lambda_factor</span> <span class="o">*</span> <span class="n">unigram_probabilities</span><span class="p">[</span><span class="n">unigram</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">probability_hat_trigram</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">probability_hat_trigram</span> <span class="o">=</span> <span class="n">lambda_factor</span> <span class="o">*</span> <span class="n">bigram_probabilities</span><span class="p">[</span><span class="n">bigram</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">probability_hat_trigram</span> <span class="o">=</span> <span class="n">trigram_probabilities</span><span class="p">[</span><span class="n">trigram</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"probability for trigram </span><span class="si">{</span><span class="n">trigram</span><span class="si">}</span><span class="s2"> estimated as </span><span class="si">{</span><span class="n">probability_hat_trigram</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
probability for trigram ('are', 'you', 'happy') not found
probability for bigram ('you', 'happy') not found
probability for unigram happy found

probability for trigram ('are', 'you', 'happy') estimated as 0.064
</pre></div>
</div>
<div class="outline-3" id="outline-container-org77e0117">
<h3 id="org77e0117">Interpolation</h3>
<div class="outline-text-3" id="text-org77e0117">
<p>Yet another way to handle unknown n-grams. In this case you always use trigrams, bigrams, and unigrams, thus eliminating some of the overhead and use a weighted value instead. As always, there's no free lunch - you have to find the best weights to make this work (but we'll take some pre-made ones).</p>
<p>Pre-calculated probabilities of all types of n-grams.</p>
<div class="highlight">
<pre><span></span><span class="n">trigram_probabilities</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">):</span> <span class="mf">0.15</span><span class="p">}</span>
<span class="n">bigram_probabilities</span> <span class="o">=</span> <span class="p">{(</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">):</span> <span class="mf">0.3</span><span class="p">}</span>
<span class="n">unigram_probabilities</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'happy'</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">}</span>
</pre></div>
<p>The weights come from optimization on a validation set.</p>
<div class="highlight">
<pre><span></span><span class="n">lambda_1</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">lambda_2</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">lambda_3</span> <span class="o">=</span> <span class="mf">0.05</span>
</pre></div>
<p>And now the trigram whose probability we want to estimate as well as derived bigrams and unigrams.</p>
<div class="highlight">
<pre><span></span><span class="n">trigram</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)</span>
<span class="n">bigram</span><span class="p">,</span> <span class="n">unigram</span> <span class="o">=</span> <span class="n">trigram</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span> <span class="mi">3</span><span class="p">],</span> <span class="n">trigram</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">probability_hat_trigram</span> <span class="o">=</span> <span class="n">lambda_1</span> <span class="o">*</span> <span class="n">trigram_probabilities</span><span class="p">[</span><span class="n">trigram</span><span class="p">]</span> 
<span class="o">+</span> <span class="n">lambda_2</span> <span class="o">*</span> <span class="n">bigram_probabilities</span><span class="p">[</span><span class="n">bigram</span><span class="p">]</span>
<span class="o">+</span> <span class="n">lambda_3</span> <span class="o">*</span> <span class="n">unigram_probabilities</span><span class="p">[</span><span class="n">unigram</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"estimated probability of the input trigram </span><span class="si">{</span><span class="n">trigram</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">probability_hat_trigram</span><span class="si">:</span><span class="s2"> 0.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
estimated probability of the input trigram ('i', 'am', 'happy') is  0.1200
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org2f1ebd2">
<h2 id="org2f1ebd2">End</h2>
<div class="outline-text-2" id="text-org2f1ebd2">
<p>So, there's various ways to handle both individual words as well as n-grams we don't recognize.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/n-gram-building-the-language-model/">N-Gram: Building the Language Model</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/n-gram-building-the-language-model/" rel="bookmark"><time class="published dt-published" datetime="2020-12-02T19:12:55-08:00" itemprop="datePublished" title="2020-12-02 19:12">2020-12-02 19:12</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/n-gram-building-the-language-model/#orgf76d107">Building the Language Model</a>
<ul>
<li><a href="posts/nlp/n-gram-building-the-language-model/#org8b47c99">Imports</a></li>
<li><a href="posts/nlp/n-gram-building-the-language-model/#org4e213b6">Set Up</a></li>
</ul>
</li>
<li><a href="posts/nlp/n-gram-building-the-language-model/#orgb4d1667">Middle</a>
<ul>
<li><a href="posts/nlp/n-gram-building-the-language-model/#org9231251">The Count Matrix</a></li>
<li><a href="posts/nlp/n-gram-building-the-language-model/#org1a9bf61">Single-Pass Trigram Count Matrix</a></li>
<li><a href="posts/nlp/n-gram-building-the-language-model/#org3d5fd82">The Probability Matrix</a>
<ul>
<li><a href="posts/nlp/n-gram-building-the-language-model/#orgff30883">Create the Probability Matrix from the Count Matrix</a></li>
<li><a href="posts/nlp/n-gram-building-the-language-model/#org404b63f">Divide Each Row By Its Sum</a></li>
<li><a href="posts/nlp/n-gram-building-the-language-model/#orgb4aafe4">Find the Probability of a Trigram</a></li>
</ul>
</li>
<li><a href="posts/nlp/n-gram-building-the-language-model/#org61ab2e1">List all the words in the vocabulary starting with a given prefix</a></li>
<li><a href="posts/nlp/n-gram-building-the-language-model/#orgedc7b9e">Building Training, Validation, and Testing Sets</a>
<ul>
<li><a href="posts/nlp/n-gram-building-the-language-model/#orga13b841">Check the Sets</a></li>
</ul>
</li>
<li><a href="posts/nlp/n-gram-building-the-language-model/#org7b73272">Perplexity</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgf76d107">
<h2 id="orgf76d107">Building the Language Model</h2>
<div class="outline-text-2" id="text-orgf76d107"></div>
<div class="outline-3" id="outline-container-org8b47c99">
<h3 id="org8b47c99">Imports</h3>
<div class="outline-text-3" id="text-org8b47c99">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org4e213b6">
<h3 id="org4e213b6">Set Up</h3>
<div class="outline-text-3" id="text-org4e213b6">
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb4d1667">
<h2 id="orgb4d1667">Middle</h2>
<div class="outline-text-2" id="text-orgb4d1667"></div>
<div class="outline-3" id="outline-container-org9231251">
<h3 id="org9231251">The Count Matrix</h3>
<div class="outline-text-3" id="text-org9231251">
<p>To calculate the n-gram probability, you will need to count frequencies of n-grams and n-gram prefixes in the training dataset. In some of the code assignment exercises, you will store the n-gram frequencies in a dictionary.</p>
<p>In other parts of the assignment, you will build a count matrix that keeps counts of (n-1)-gram prefix followed by all possible last words in the vocabulary.</p>
<p>The following code shows how to check, retrieve and update counts of n-grams in the word count dictionary.</p>
<div class="highlight">
<pre><span></span><span class="n">n_gram_counts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># get count for an n-gram tuple</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"count of n-gram </span><span class="si">{</span><span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_gram_counts</span><span class="p">[(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
count of n-gram ('i', 'am', 'happy'): 2
</pre>
<div class="highlight">
<pre><span></span><span class="c1"># check if n-gram is present in the dictionary</span>
<span class="n">n_gram</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">)</span>
<span class="n">status</span> <span class="o">=</span> <span class="s2">"found"</span> <span class="k">if</span> <span class="n">n_gram</span> <span class="ow">in</span> <span class="n">n_gram_counts</span> <span class="k">else</span> <span class="s2">"missing"</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n-gram </span><span class="si">{</span><span class="n">n_gram</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
n-gram ('i', 'am', 'learning') missing
</pre>
<div class="highlight">
<pre><span></span><span class="c1"># update the count in the word count dictionary</span>
<span class="n">n_gram_counts</span><span class="p">[</span><span class="n">n_gram</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">status</span> <span class="o">=</span> <span class="s2">"found"</span> <span class="k">if</span> <span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">n_gram_counts</span> <span class="k">else</span> <span class="s2">"missing"</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n-gram </span><span class="si">{</span><span class="n">n_gram</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
n-gram ('i', 'am', 'learning') found
</pre>
<p>The next code snippet shows how to merge two tuples in Python. That will be handy when creating the n-gram from the prefix and the last word.</p>
<p>concatenate tuple for prefix and tuple with the last word to create the n_gram</p>
<div class="highlight">
<pre><span></span><span class="n">prefix</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)</span>
<span class="n">word</span> <span class="o">=</span> <span class="s1">'because'</span>

<span class="c1"># note here the syntax for creating a tuple for a single word</span>
<span class="n">n_gram</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="n">word</span><span class="p">,)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n_gram</span><span class="p">)</span>
</pre></div>
<pre class="example">
('i', 'am', 'happy', 'because')
</pre></div>
</div>
<div class="outline-3" id="outline-container-org1a9bf61">
<h3 id="org1a9bf61">Single-Pass Trigram Count Matrix</h3>
<div class="outline-text-3" id="text-org1a9bf61">
<p>In the lecture, you've seen that the count matrix could be made in a single pass through the corpus. Here is one approach to do that.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">single_pass_trigram_count_matrix</span><span class="p">(</span><span class="n">corpus</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Creates the trigram count matrix from the input corpus in a single pass through the corpus.</span>

<span class="sd">    Args:</span>
<span class="sd">       corpus: Pre-processed and tokenized corpus. </span>

<span class="sd">    Returns:</span>
<span class="sd">       bigrams: list of all bigram prefixes, row index</span>
<span class="sd">       vocabulary: list of all found words, the column index</span>
<span class="sd">       count_matrix: pandas dataframe with bigram prefixes as rows, </span>
<span class="sd">                     vocabulary words as columns </span>
<span class="sd">                     and the counts of the bigram/word combinations (i.e. trigrams) as values</span>
<span class="sd">    """</span>
    <span class="n">bigrams</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vocabulary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">count_matrix_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># go through the corpus once with a sliding window</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># the sliding window starts at position i and contains 3 words</span>
        <span class="n">trigram</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">corpus</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>

        <span class="n">bigram</span> <span class="o">=</span> <span class="n">trigram</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bigram</span> <span class="ow">in</span> <span class="n">bigrams</span><span class="p">:</span>
            <span class="n">bigrams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bigram</span><span class="p">)</span>        

        <span class="n">last_word</span> <span class="o">=</span> <span class="n">trigram</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">last_word</span> <span class="ow">in</span> <span class="n">vocabulary</span><span class="p">:</span>
            <span class="n">vocabulary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_word</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">bigram</span><span class="p">,</span><span class="n">last_word</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">count_matrix_dict</span><span class="p">:</span>
            <span class="n">count_matrix_dict</span><span class="p">[</span><span class="n">bigram</span><span class="p">,</span><span class="n">last_word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">count_matrix_dict</span><span class="p">[</span><span class="n">bigram</span><span class="p">,</span><span class="n">last_word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># convert the count_matrix to numpy.array to fill in the blanks</span>
    <span class="n">count_matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">bigrams</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">trigram_key</span><span class="p">,</span> <span class="n">trigam_count</span> <span class="ow">in</span> <span class="n">count_matrix_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">count_matrix</span><span class="p">[</span><span class="n">bigrams</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">trigram_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="n">vocabulary</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">trigram_key</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="n">trigam_count</span>

    <span class="c1"># numpy.array to pandas dataframe conversion</span>
    <span class="n">count_matrix</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">count_matrix</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bigrams</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bigrams</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">count_matrix</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]</span>

<span class="n">bigrams</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">count_matrix</span> <span class="o">=</span> <span class="n">single_pass_trigram_count_matrix</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">count_matrix</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">happy</th>
<th class="org-right" scope="col">because</th>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">am</th>
<th class="org-right" scope="col">learning</th>
<th class="org-right" scope="col">.</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">('i', 'am')</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('am', 'happy')</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('happy', 'because')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('because', 'i')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('am', 'learning')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-org3d5fd82">
<h3 id="org3d5fd82">The Probability Matrix</h3>
<div class="outline-text-3" id="text-org3d5fd82">
<p>The next step is to build a probability matrix from the count matrix. You can use an object dataframe from library pandas and its methods <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sum.html?highlight=sum#pandas.DataFrame.sum">sum</a> and <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.div.html">div</a> to normalize the cell counts with the sum of the respective rows.</p>
</div>
<div class="outline-4" id="outline-container-orgff30883">
<h4 id="orgff30883">Create the Probability Matrix from the Count Matrix</h4>
<div class="outline-text-4" id="text-orgff30883">
<div class="highlight">
<pre><span></span><span class="n">row_sums</span> <span class="o">=</span> <span class="n">count_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org404b63f">
<h4 id="org404b63f">Divide Each Row By Its Sum</h4>
<div class="outline-text-4" id="text-org404b63f">
<div class="highlight">
<pre><span></span><span class="n">prob_matrix</span> <span class="o">=</span> <span class="n">count_matrix</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">row_sums</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"rows"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">prob_matrix</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">happy</th>
<th class="org-right" scope="col">because</th>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">am</th>
<th class="org-right" scope="col">learning</th>
<th class="org-right" scope="col">.</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">('i', 'am')</td>
<td class="org-right">0.5</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0.5</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('am', 'happy')</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('happy', 'because')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('because', 'i')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">('am', 'learning')</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-orgb4aafe4">
<h4 id="orgb4aafe4">Find the Probability of a Trigram</h4>
<div class="outline-text-4" id="text-orgb4aafe4">
<p>Since the columns of the probability matrix are the suffix-words and the index is made up of the bigram-prefix we'll need to unpack those to look up our probability.</p>
<div class="highlight">
<pre><span></span><span class="n">trigram</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">)</span>

<span class="n">bigram</span> <span class="o">=</span> <span class="n">trigram</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'prefix-bigram: </span><span class="si">{</span><span class="n">bigram</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
<pre class="example">
prefix-bigram: ('i', 'am')
</pre>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="n">trigram</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"last word of the trigram: </span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
last word of the trigram: happy
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"trigram probability: </span><span class="si">{</span><span class="n">prob_matrix</span><span class="p">[</span><span class="n">word</span><span class="p">][</span><span class="n">bigram</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
trigram probability: 0.5
</pre>
<p>Which if you look at our corpus or count matrix, is the correct value ("i am" appears twice and one of those times it's "i am happy").</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org61ab2e1">
<h3 id="org61ab2e1">List all the words in the vocabulary starting with a given prefix</h3>
<div class="outline-text-3" id="text-org61ab2e1">
<p>This is just a demonstration of checking the prefix of a string in python.</p>
<div class="highlight">
<pre><span></span><span class="n">vocabulary</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">,</span> <span class="s1">'have'</span><span class="p">,</span> <span class="s1">'you'</span><span class="p">,</span> <span class="s1">'seen'</span><span class="p">,</span><span class="s1">'it'</span><span class="p">,</span> <span class="s1">'?'</span><span class="p">]</span>
<span class="n">starts_with</span> <span class="o">=</span> <span class="s1">'ha'</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'words in vocabulary starting with prefix: </span><span class="si">{</span><span class="n">starts_with</span><span class="si">}</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">(</span><span class="n">candidate</span> <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">vocabulary</span>
             <span class="k">if</span> <span class="n">candidate</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">starts_with</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</pre></div>
<pre class="example">
words in vocabulary starting with prefix: ha

happy
have
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgedc7b9e">
<h3 id="orgedc7b9e">Building Training, Validation, and Testing Sets</h3>
<div class="outline-text-3" id="text-orgedc7b9e">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">train_validation_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">train_percent</span><span class="p">,</span> <span class="n">validation_percent</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Splits the input data to  train/validation/test according to the percentage provided</span>

<span class="sd">    Args:</span>
<span class="sd">       data: Pre-processed and tokenized corpus, i.e. list of sentences.</span>
<span class="sd">       train_percent: integer 0-100, defines the portion of input corpus allocated for training</span>
<span class="sd">       validation_percent: integer 0-100, defines the portion of input corpus allocated for validation</span>

<span class="sd">       Note: train_percent + validation_percent need to be &lt;=100</span>
<span class="sd">             the reminder to 100 is allocated for the test set</span>

<span class="sd">    Returns:</span>
<span class="sd">       train_data: list of sentences, the training part of the corpus</span>
<span class="sd">       validation_data: list of sentences, the validation part of the corpus</span>
<span class="sd">       test_data: list of sentences, the test part of the corpus</span>
<span class="sd">    """</span>
    <span class="c1"># fixed seed here for reproducibility</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">87</span><span class="p">)</span>

    <span class="c1"># reshuffle all input sentences</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">train_percent</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">train_size</span><span class="p">]</span>

    <span class="n">validation_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">validation_percent</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">validation_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">validation_size</span><span class="p">]</span>

    <span class="n">test_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">validation_size</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">validation_data</span><span class="p">,</span> <span class="n">test_data</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orga13b841">
<h4 id="orga13b841">Check the Sets</h4>
<div class="outline-text-4" id="text-orga13b841">
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

<span class="n">train_data</span><span class="p">,</span> <span class="n">validation_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">train_validation_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"split 80/10/10:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="sa">f</span><span class="s2">"train data:</span><span class="si">{</span><span class="n">train_data</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"validation data:</span><span class="si">{</span><span class="n">validation_data</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s2">"test data:</span><span class="si">{</span><span class="n">test_data</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="n">train_data</span><span class="p">,</span> <span class="n">validation_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">train_validation_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"split 98/1/1:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="sa">f</span><span class="s2">"train data:</span><span class="si">{</span><span class="n">train_data</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"validation data:</span><span class="si">{</span><span class="n">validation_data</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s2">"test data:</span><span class="si">{</span><span class="n">test_data</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
split 80/10/10:
 train data:[28, 76, 5, 0, 62, 29, 54, 95, 88, 58, 4, 22, 92, 14, 50, 77, 47, 33, 75, 68, 56, 74, 43, 80, 83, 84, 73, 93, 66, 87, 9, 91, 64, 79, 20, 51, 17, 27, 12, 31, 67, 81, 7, 34, 45, 72, 38, 30, 16, 60, 40, 86, 48, 21, 70, 59, 6, 19, 2, 99, 37, 36, 52, 61, 97, 44, 26, 57, 89, 55, 53, 85, 3, 39, 10, 71, 23, 32, 25, 8]
 validation data:[78, 65, 63, 11, 49, 98, 1, 46, 15, 41]
 test data:[90, 96, 82, 42, 35, 13, 69, 24, 94, 18]

split 98/1/1:
 train data:[66, 23, 29, 28, 52, 87, 70, 13, 15, 2, 62, 43, 82, 50, 40, 32, 30, 79, 71, 89, 6, 10, 34, 78, 11, 49, 39, 42, 26, 46, 58, 96, 97, 8, 56, 86, 33, 93, 92, 91, 57, 65, 95, 20, 72, 3, 12, 9, 47, 37, 67, 1, 16, 74, 53, 99, 54, 68, 5, 18, 27, 17, 48, 36, 24, 45, 73, 19, 41, 59, 21, 98, 0, 31, 4, 85, 80, 64, 84, 88, 25, 44, 61, 22, 60, 94, 76, 38, 77, 81, 90, 69, 63, 7, 51, 14, 55, 83]
 validation data:[35]
 test data:[75]

</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7b73272">
<h3 id="org7b73272">Perplexity</h3>
<div class="outline-text-3" id="text-org7b73272">
<p>In order to implement the <a href="https://en.wikipedia.org/wiki/Perplexity">perplexity</a> formula, you'll need to know how to implement m-th order root of a variable.</p>
\begin{equation*} PP(W)=\sqrt[M]{\prod_{i=1}^{m}{\frac{1}{P(w_i|w_{i-1})}}} \end{equation*}
<p>Remember from calculus:</p>
\begin{equation*} \sqrt[M]{\frac{1}{x}} = x^{-\frac{1}{M}} \end{equation*}
<p>Here is some code that will help you with the formula.</p>
<div class="highlight">
<pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"perplexity = </span><span class="si">{</span><span class="n">p</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">M</span><span class="p">)</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
perplexity = 316.228
</pre></div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/n-gram-pre-processing/">N-Gram Pre-Processing</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/n-gram-pre-processing/" rel="bookmark"><time class="published dt-published" datetime="2020-12-01T19:42:05-08:00" itemprop="datePublished" title="2020-12-01 19:42">2020-12-01 19:42</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/n-gram-pre-processing/#orge83ecd1">Beginning</a>
<ul>
<li><a href="posts/nlp/n-gram-pre-processing/#org12626cd">Imports</a></li>
<li><a href="posts/nlp/n-gram-pre-processing/#orgf18d48d">Set Up</a>
<ul>
<li><a href="posts/nlp/n-gram-pre-processing/#org2f1983a">The Environment</a></li>
<li><a href="posts/nlp/n-gram-pre-processing/#org9525a68">The Data Set</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/nlp/n-gram-pre-processing/#org1fee413">N-gram Corpus Preprocessing</a>
<ul>
<li><a href="posts/nlp/n-gram-pre-processing/#orgc70e5f5">Lowercase</a></li>
<li><a href="posts/nlp/n-gram-pre-processing/#orgdb42fad">Remove Special Characters</a></li>
<li><a href="posts/nlp/n-gram-pre-processing/#orgae2af9f">Splitting Text</a></li>
<li><a href="posts/nlp/n-gram-pre-processing/#orgfc4a8b3">Tokenizing Sentences</a></li>
<li><a href="posts/nlp/n-gram-pre-processing/#orgc6c599a">Find the Length of Each Word</a></li>
<li><a href="posts/nlp/n-gram-pre-processing/#org7742ea0">Convert to N-Grams</a></li>
<li><a href="posts/nlp/n-gram-pre-processing/#orgc65c567">N-Gram Prefix</a></li>
<li><a href="posts/nlp/n-gram-pre-processing/#org17b3bef">Adding Start and End Tokens</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge83ecd1">
<h2 id="orge83ecd1">Beginning</h2>
<div class="outline-text-2" id="text-orge83ecd1"></div>
<div class="outline-3" id="outline-container-org12626cd">
<h3 id="org12626cd">Imports</h3>
<div class="outline-text-3" id="text-org12626cd">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="kn">import</span> <span class="nn">nltk</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf18d48d">
<h3 id="orgf18d48d">Set Up</h3>
<div class="outline-text-3" id="text-orgf18d48d"></div>
<div class="outline-4" id="outline-container-org2f1983a">
<h4 id="org2f1983a">The Environment</h4>
<div class="outline-text-4" id="text-org2f1983a">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org9525a68">
<h4 id="org9525a68">The Data Set</h4>
<div class="outline-text-4" id="text-org9525a68">
<p>This is the pre-trained tokenizer that comes with NLTK.</p>
<div class="highlight">
<pre><span></span><span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">'punkt'</span><span class="p">)</span>
</pre></div>
<pre class="example">
[nltk_data] Downloading package punkt to /home/hades/nltk_data...
[nltk_data]   Unzipping tokenizers/punkt.zip.
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1fee413">
<h2 id="org1fee413">N-gram Corpus Preprocessing</h2>
<div class="outline-text-2" id="text-org1fee413">
<p>Some common preprocessing steps for the language models include:</p>
<ul class="org-ul">
<li>lowercasing the text</li>
<li>remove special characters</li>
<li>split text to list of sentences</li>
<li>split sentence into list words</li>
</ul>
</div>
<div class="outline-3" id="outline-container-orgc70e5f5">
<h3 id="orgc70e5f5">Lowercase</h3>
<div class="outline-text-3" id="text-orgc70e5f5">
<div class="highlight">
<pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="s2">"Learning% makes 'me' happy. I am happy be-cause I am learning! :)"</span>
<span class="n">corpus</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="c1"># note that word "learning" will now be the same regardless of its position in the sentence</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
</pre></div>
<pre class="example">
learning% makes 'me' happy. i am happy be-cause i am learning! :)
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgdb42fad">
<h3 id="orgdb42fad">Remove Special Characters</h3>
<div class="outline-text-3" id="text-orgdb42fad">
<div class="highlight">
<pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="s2">"learning% makes 'me' happy. i am happy be-cause i am learning! :)"</span>
<span class="n">corpus</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"[^a-zA-Z0-9.?! ]+"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
</pre></div>
<pre class="example">
learning makes me happy. i am happy because i am learning! 
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgae2af9f">
<h3 id="orgae2af9f">Splitting Text</h3>
<div class="outline-text-3" id="text-orgae2af9f">
<div class="highlight">
<pre><span></span><span class="c1"># split text by a delimiter to array</span>
<span class="n">input_date</span><span class="o">=</span><span class="s2">"Sat May  9 07:33:35 CEST 2020"</span>

<span class="c1"># get the date parts in array</span>
<span class="n">date_parts</span> <span class="o">=</span> <span class="n">input_date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"date parts = </span><span class="si">{</span><span class="n">date_parts</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1">#get the time parts in array</span>
<span class="n">time_parts</span> <span class="o">=</span> <span class="n">date_parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">":"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"time parts = </span><span class="si">{</span><span class="n">time_parts</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
date parts = ['Sat', 'May', '', '9', '07:33:35', 'CEST', '2020']
time parts = ['07', '33', '35']
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgfc4a8b3">
<h3 id="orgfc4a8b3">Tokenizing Sentences</h3>
<div class="outline-text-3" id="text-orgfc4a8b3">
<div class="highlight">
<pre><span></span><span class="n">sentence</span> <span class="o">=</span> <span class="s1">'i am happy because i am learning.'</span>
<span class="n">tokenized_sentence</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">sentence</span><span class="si">}</span><span class="s1"> -&gt; </span><span class="si">{</span><span class="n">tokenized_sentence</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
<pre class="example">
i am happy because i am learning. -&gt; ['i', 'am', 'happy', 'because', 'i', 'am', 'learning', '.']
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgc6c599a">
<h3 id="orgc6c599a">Find the Length of Each Word</h3>
<div class="outline-text-3" id="text-orgc6c599a">
<div class="highlight">
<pre><span></span><span class="n">sentence</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]</span>
<span class="n">word_lengths</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">))</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">]</span> <span class="c1"># Create a list with the word lengths using a list comprehension</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">' Lengths of the words: </span><span class="se">\n</span><span class="si">{</span><span class="n">word_lengths</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
<pre class="example">
 Lengths of the words: 
[('i', 1), ('am', 2), ('happy', 5), ('because', 7), ('i', 1), ('am', 2), ('learning', 8), ('.', 1)]
</pre></div>
</div>
<div class="outline-3" id="outline-container-org7742ea0">
<h3 id="org7742ea0">Convert to N-Grams</h3>
<div class="outline-text-3" id="text-org7742ea0">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">sentence_to_trigram</span><span class="p">(</span><span class="n">tokenized_sentence</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Prints all trigrams in the given tokenized sentence.</span>

<span class="sd">    Args:</span>
<span class="sd">       tokenized_sentence: The words list.</span>

<span class="sd">    Returns:</span>
<span class="sd">       No output</span>
<span class="sd">    """</span>
    <span class="c1"># note that the last position of i is 3rd to the end</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokenized_sentence</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># the sliding window starts at position i and contains 3 words</span>
        <span class="n">trigram</span> <span class="o">=</span> <span class="n">tokenized_sentence</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">trigram</span><span class="p">)</span>

<span class="n">tokenized_sentence</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'List all trigrams of sentence: </span><span class="si">{</span><span class="n">tokenized_sentence</span><span class="si">}</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<span class="n">sentence_to_trigram</span><span class="p">(</span><span class="n">tokenized_sentence</span><span class="p">)</span>
</pre></div>
<pre class="example">
List all trigrams of sentence: ['i', 'am', 'happy', 'because', 'i', 'am', 'learning', '.']

['i', 'am', 'happy']
['am', 'happy', 'because']
['happy', 'because', 'i']
['because', 'i', 'am']
['i', 'am', 'learning']
['am', 'learning', '.']
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgc65c567">
<h3 id="orgc65c567">N-Gram Prefix</h3>
<div class="outline-text-3" id="text-orgc65c567">\begin{equation*} P(w_n|w_1^{n-1})=\frac{C(w_1^n)}{C(w_1^{n-1})} \end{equation*}
<div class="highlight">
<pre><span></span><span class="c1"># get trigram prefix from a 4-gram</span>
<span class="n">fourgram</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span><span class="s1">'because'</span><span class="p">]</span>
<span class="n">trigram</span> <span class="o">=</span> <span class="n">fourgram</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Get the elements from 0, included, up to the last element, not included.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trigram</span><span class="p">)</span>
</pre></div>
<pre class="example">
['i', 'am', 'happy']
</pre></div>
</div>
<div class="outline-3" id="outline-container-org17b3bef">
<h3 id="org17b3bef">Adding Start and End Tokens</h3>
<div class="outline-text-3" id="text-org17b3bef">
<div class="highlight">
<pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">tokenized_sentence</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'because'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">]</span>
<span class="n">tokenized_sentence</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"&lt;s&gt;"</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">tokenized_sentence</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"&lt;/s&gt;"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tokenized_sentence</span><span class="p">)</span>
</pre></div>
<pre class="example">
['&lt;s&gt;', '&lt;s&gt;', 'i', 'am', 'happy', 'because', 'i', 'am', 'learning', '.', '&lt;/s&gt;']
</pre></div>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-16.html" rel="prev">Newer posts</a></li>
<li class="next"><a href="index-14.html" rel="next">Older posts</a></li>
</ul>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
<script type="text/x-mathjax-config">

        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']],},

        });
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script>
<script>

    MathJax = {
        tex: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    }
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script><!--End of body content-->
<footer id="footer"><a href="http://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
