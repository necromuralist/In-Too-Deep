<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Creating the Quora Question data generator." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Siamese Networks: The Data Generator | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/siamese-networks-the-data-generator/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../siamese-networks-the-data/" rel="prev" title="Siamese Networks: The Data" type="text/html">
<link href="../siamese-networks-defining-the-model/" rel="next" title="Siamese Networks: Defining the Model" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Siamese Networks: The Data Generator" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/siamese-networks-the-data-generator/" property="og:url">
<meta content="Creating the Quora Question data generator." property="og:description">
<meta content="article" property="og:type">
<meta content="2021-01-25T19:35:05-08:00" property="article:published_time">
<meta content="nlp" property="article:tag">
<meta content="siamese networks" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Siamese Networks: The Data Generator</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2021-01-25T19:35:05-08:00" itemprop="datePublished" title="2021-01-25 19:35">2021-01-25 19:35</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3f385a7">Beginning</a>
<ul>
<li><a href="#orgdb87694">Imports</a></li>
<li><a href="#org78feeb1">Set Up</a>
<ul>
<li><a href="#orgaf4dd33">Our Data</a></li>
<li><a href="#orgf84a969">The Idiotic Names</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org177fd5d">Middle</a>
<ul>
<li><a href="#org74e9ed7">Try It Out</a></li>
</ul>
</li>
<li><a href="#org8e14bc2">Bundling It Up</a>
<ul>
<li><a href="#org2333e8f">Imports</a></li>
<li><a href="#org0eb0cc1">The Data Generator</a>
<ul>
<li><a href="#orgd86980e">The Generator Definition</a></li>
<li><a href="#org7228b70">The Generator</a></li>
<li><a href="#org127c426">The Iter Method</a></li>
<li><a href="#org148ec3e">The Next Method</a></li>
</ul>
</li>
<li><a href="#org88941ad">Check It Out</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org3f385a7">
<h2 id="org3f385a7">Beginning</h2>
<div class="outline-text-2" id="text-org3f385a7">
<p>Most of the time in Natural Language Processing, and AI in general we use batches when training our data sets. If you were to use stochastic gradient descent with one example at a time, it would take you forever to build a model. In this example, we show you how you can build a data generator that takes in \(Q1\) and \(Q2\) and returns a batch of size <code>batch_size</code> in the following format \(([q1_1, q1_2, q1_3, ...]\), \([q2_1, q2_2,q2_3, ...])\). The tuple consists of two arrays and each array has <code>batch_size</code> questions. Again, \(q1_i\) and \(q2_i\) are duplicates, but they are not duplicates with any other elements in the batch.</p>
<p>The iterator that we're going to create returns a pair of arrays of questions.</p>
<p>We'll implement the data generator below. Here are some things we will need.</p>
<ul class="org-ul">
<li>While true loop.</li>
<li>if <code>index &gt;</code> len_Q1=, set the <code>idx</code> to \(0\).</li>
<li>The generator should return shuffled batches of data. To achieve this without modifying the actual question lists, a list containing the indexes of the questions is created. This list can be shuffled and used to get random batches everytime the index is reset.</li>
<li>Append elements of \(Q1\) and \(Q2\) to <code>input1</code> and <code>input2</code> respectively.</li>
<li>if <code>len(input1) =</code> batch_size=, determine <code>max_len</code> as the longest question in <code>input1</code> and <code>input2</code>. Ceil <code>max_len</code> to a power of \(2\) (for computation purposes) using the following command: <code>max_len = 2**int(np.ceil(np.log2(max_len)))</code>.</li>
<li>Pad every question by <code>vocab['&lt;PAD&gt;']</code> until you get the length <code>max_len</code>.</li>
<li>Use yield to return <code>input1, input2</code>.</li>
<li>Don't forget to reset <code>input1, input2</code> to empty arrays at the end (data generator resumes from where it last left).</li>
</ul>
</div>
<div class="outline-3" id="outline-container-orgdb87694">
<h3 id="orgdb87694">Imports</h3>
<div class="outline-text-3" id="text-orgdb87694">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.siamese_networks</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TOKENS</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org78feeb1">
<h3 id="org78feeb1">Set Up</h3>
<div class="outline-text-3" id="text-org78feeb1"></div>
<div class="outline-4" id="outline-container-orgaf4dd33">
<h4 id="orgaf4dd33">Our Data</h4>
<div class="outline-text-4" id="text-orgaf4dd33">
<div class="highlight">
<pre><span></span><span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgf84a969">
<h4 id="orgf84a969">The Idiotic Names</h4>
<div class="outline-text-4" id="text-orgf84a969">
<div class="highlight">
<pre><span></span><span class="n">np</span> <span class="o">=</span> <span class="n">numpy</span>
<span class="n">rnd</span> <span class="o">=</span> <span class="n">random</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org177fd5d">
<h2 id="org177fd5d">Middle</h2>
<div class="outline-text-2" id="text-org177fd5d">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">data_generator</span><span class="p">(</span><span class="n">Q1</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">Q2</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">pad</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Generator function that yields batches of data</span>

<span class="sd">    Args:</span>
<span class="sd">       Q1 (list): List of transformed (to tensor) questions.</span>
<span class="sd">       Q2 (list): List of transformed (to tensor) questions.</span>
<span class="sd">       batch_size (int): Number of elements per batch.</span>
<span class="sd">       pad (int, optional): Pad character from the vocab. Defaults to 1.</span>
<span class="sd">       shuffle (bool, optional): If the batches should be randomnized or not. Defaults to True.</span>

<span class="sd">    Yields:</span>
<span class="sd">       tuple: Of the form (input1, input2) with types (numpy.ndarray, numpy.ndarray)</span>
<span class="sd">       NOTE: input1: inputs to your model [q1a, q2a, q3a, ...] i.e. (q1a,q1b) are duplicates</span>
<span class="sd">             input2: targets to your model [q1b, q2b,q3b, ...] i.e. (q1a,q2i) i!=a are not duplicates</span>
<span class="sd">    """</span>

    <span class="n">input1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">input2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">len_q</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Q1</span><span class="p">)</span>
    <span class="n">question_indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">len_q</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
        <span class="n">rnd</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">question_indexes</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">len_q</span><span class="p">:</span>
            <span class="c1"># if idx is greater than or equal to len_q, set idx accordingly </span>
            <span class="c1"># (Hint: look at the instructions above)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># shuffle to get random batches if shuffle is set to True</span>
            <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
                <span class="n">rnd</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">question_indexes</span><span class="p">)</span>

        <span class="c1"># get questions at the `question_indexes[idx]` position in Q1 and Q2</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">Q1</span><span class="p">[</span><span class="n">question_indexes</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">Q2</span><span class="p">[</span><span class="n">question_indexes</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>

        <span class="c1"># increment idx by 1</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># append q1</span>
        <span class="n">input1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
        <span class="c1"># append q2</span>
        <span class="n">input2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span> <span class="o">==</span> <span class="n">batch_size</span><span class="p">:</span>
            <span class="c1"># determine max_len as the longest question in input1 & input 2</span>
            <span class="c1"># Hint: use the `max` function. </span>
            <span class="c1"># take max of input1 & input2 and then max out of the two of them.</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">question</span><span class="p">)</span> <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">input1</span><span class="p">),</span>
                          <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">question</span><span class="p">)</span> <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">input2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">max_len</span><span class="p">)</span>
            <span class="c1"># pad to power-of-2 (Hint: look at the instructions above)</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">max_len</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">max_len</span><span class="p">)</span>
            <span class="n">b1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">b2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">):</span>
                <span class="c1"># add [pad] to q1 until it reaches max_len</span>
                <span class="n">q1</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">+</span> <span class="p">((</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">q1</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="n">pad</span><span class="p">])</span>
                <span class="c1"># add [pad] to q2 until it reaches max_len</span>
                <span class="n">q2</span> <span class="o">=</span> <span class="n">q2</span> <span class="o">+</span> <span class="p">((</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="n">pad</span><span class="p">])</span>
                <span class="c1"># append q1</span>
                <span class="n">b1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
                <span class="c1"># append q2</span>
                <span class="n">b2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
            <span class="c1"># use b1 and b2</span>
            <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>
            <span class="c1"># reset the batches</span>
            <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># reset the batches</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org74e9ed7">
<h3 id="org74e9ed7">Try It Out</h3>
<div class="outline-text-3" id="text-org74e9ed7">
<div class="highlight">
<pre><span></span><span class="n">rnd</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">data_generator</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">question_one</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">question_two</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<span class="n">result_1</span><span class="p">,</span> <span class="n">result_2</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"First questions  : </span><span class="se">\n</span><span class="si">{</span><span class="n">result_1</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Second questions : </span><span class="se">\n</span><span class="si">{</span><span class="n">result_2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example" id="orgb268414">
11
16
First questions  : 
[[  34   37   13   50  536 1303 6428   25  924  157   28    1    1    1
     1    1]
 [  34   95  573 1444 2343   28    1    1    1    1    1    1    1    1
     1    1]]

Second questions : 
[[  34   37   13  575 1303 6428   25  924  157   28    1    1    1    1
     1    1]
 [   9  151   25  573 5642   28    1    1    1    1    1    1    1    1
     1    1]]
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org8e14bc2">
<h2 id="org8e14bc2">Bundling It Up</h2>
<div class="outline-text-2" id="text-org8e14bc2"></div>
<div class="outline-3" id="outline-container-org2333e8f">
<h3 id="org2333e8f">Imports</h3>
<div class="outline-text-3" id="text-org2333e8f">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.siamese_networks</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TOKENS</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org0eb0cc1">
<h3 id="org0eb0cc1">The Data Generator</h3>
<div class="outline-text-3" id="text-org0eb0cc1">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DataGenerator</span><span class="p">:</span>
    <span class="sd">"""Batch Generator for Quora question dataset</span>

<span class="sd">    Args:</span>
<span class="sd">     question_one: tensorized question 1</span>
<span class="sd">     question_two: tensorized question 2</span>
<span class="sd">     batch_size: size of generated batches</span>
<span class="sd">     padding: token to use to pad the lists</span>
<span class="sd">     shuffle: whether to shuffle the questions around</span>
<span class="sd">    """</span>
    <span class="n">question_one</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">question_two</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">padding</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="n">TOKENS</span><span class="o">.</span><span class="n">padding</span>
    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">_batch</span><span class="p">:</span> <span class="nb">iter</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgd86980e">
<h4 id="orgd86980e">The Generator Definition</h4>
<div class="outline-text-4" id="text-orgd86980e">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">data_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Generator function that yields batches of data</span>

<span class="sd">    Yields:</span>
<span class="sd">       tuple: (batch_question_1, batch_question_2)</span>
<span class="sd">    """</span>
    <span class="n">unpadded_1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unpadded_2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">number_of_questions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">question_one</span><span class="p">)</span>
    <span class="n">question_indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number_of_questions</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">:</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">question_indexes</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">number_of_questions</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">:</span>
                <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">question_indexes</span><span class="p">)</span>

        <span class="n">unpadded_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">question_one</span><span class="p">[</span><span class="n">question_indexes</span><span class="p">[</span><span class="n">index</span><span class="p">]])</span>
        <span class="n">unpadded_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">question_two</span><span class="p">[</span><span class="n">question_indexes</span><span class="p">[</span><span class="n">index</span><span class="p">]])</span>

        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unpadded_1</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">question</span><span class="p">)</span> <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">unpadded_1</span><span class="p">),</span>
                          <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">question</span><span class="p">)</span> <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">unpadded_2</span><span class="p">))</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">max_len</span><span class="p">)))</span>
            <span class="n">padded_1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">padded_2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">question_1</span><span class="p">,</span> <span class="n">question_2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unpadded_1</span><span class="p">,</span> <span class="n">unpadded_2</span><span class="p">):</span>
                <span class="n">padded_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">question_1</span> <span class="o">+</span> <span class="p">((</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">question_1</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">]))</span>
                <span class="n">padded_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">question_2</span> <span class="o">+</span>  <span class="p">((</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">question_2</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">]))</span>
            <span class="k">yield</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">padded_1</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">padded_2</span><span class="p">)</span>
            <span class="n">unpadded_1</span><span class="p">,</span> <span class="n">unpadded_2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org7228b70">
<h4 id="org7228b70">The Generator</h4>
<div class="outline-text-4" id="text-org7228b70">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""The generator instance"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_generator</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_batch</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org127c426">
<h4 id="org127c426">The Iter Method</h4>
<div class="outline-text-4" id="text-org127c426">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org148ec3e">
<h4 id="org148ec3e">The Next Method</h4>
<div class="outline-text-4" id="text-org148ec3e">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org88941ad">
<h3 id="org88941ad">Check It Out</h3>
<div class="outline-text-3" id="text-org88941ad">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.siamese_networks</span> <span class="kn">import</span> <span class="n">DataGenerator</span><span class="p">,</span> <span class="n">DataLoader</span>

<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">data</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">question_one</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">question_two</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">result_1</span><span class="p">,</span> <span class="n">result_2</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"First questions  : </span><span class="se">\n</span><span class="si">{</span><span class="n">result_1</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Second questions : </span><span class="se">\n</span><span class="si">{</span><span class="n">result_2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example" id="orgae553b5">
First questions  : 
[[  34   37   13   50  536 1303 6428   25  924  157   28    1    1    1
     1    1]
 [  34   95  573 1444 2343   28    1    1    1    1    1    1    1    1
     1    1]]

Second questions : 
[[  34   37   13  575 1303 6428   25  924  157   28    1    1    1    1
     1    1]
 [   9  151   25  573 5642   28    1    1    1    1    1    1    1    1
     1    1]]
</pre></div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
<li><a class="tag p-category" href="../../../categories/siamese-networks/" rel="tag">siamese networks</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../siamese-networks-the-data/" rel="prev" title="Siamese Networks: The Data">Previous post</a></li>
<li class="next"><a href="../siamese-networks-defining-the-model/" rel="next" title="Siamese Networks: Defining the Model">Next post</a></li>
</ul>
</nav>
</aside>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
<script type="text/x-mathjax-config">

        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']],},

        });
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script>
<script>

    MathJax = {
        tex: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    }
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script></article>
<!--End of body content-->
<footer id="footer"><a href="https://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://licensebuttons.net/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
