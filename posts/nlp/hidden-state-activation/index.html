<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="A look at hidden state activation in Recurrent Neural Networks." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Hidden State Activation | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/hidden-state-activation/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../../tensorflow-docker-setup/" rel="prev" title="Tensorflow Docker Setup" type="text/html">
<link href="../jax-numpy-and-perplexity/" rel="next" title="Jax, Numpy, and Perplexity" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Hidden State Activation" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/hidden-state-activation/" property="og:url">
<meta content="A look at hidden state activation in Recurrent Neural Networks." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-12-30T19:02:56-08:00" property="article:published_time">
<meta content="nlp" property="article:tag">
<meta content="rnn" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Hidden State Activation</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-12-30T19:02:56-08:00" itemprop="datePublished" title="2020-12-30 19:02">2020-12-30 19:02</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0ea4fb2">Hidden State Activation</a>
<ul>
<li><a href="#orgb96728c">Imports</a></li>
</ul>
</li>
<li><a href="#orgdf8a043">Middle</a>
<ul>
<li><a href="#org73968df">Joining</a>
<ul>
<li><a href="#orgffe04ca">Weights: Horizontal Concatenation</a></li>
<li><a href="#orgd644ad6">Hidden State & Inputs: Vertical Concatenation</a></li>
<li><a href="#orgef4d08a">Option 1: concatenate - Rows</a></li>
<li><a href="#orgb535048">Option 2: vstack</a></li>
</ul>
</li>
<li><a href="#org7515e08">Verify Formulas</a>
<ul>
<li><a href="#org7960ecf">The Data</a></li>
<li><a href="#orgab04e59">Formula 1</a></li>
<li><a href="#org8bf0f58">Formula 2</a></li>
<li><a href="#org0ab4e87">Verification</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org0ea4fb2">
<h2 id="org0ea4fb2">Hidden State Activation</h2>
<div class="outline-text-2" id="text-org0ea4fb2">
<p>This is the hidden state activation function for a vanilla RNN.</p>
<p>\[ h^{\langle t\rangle}=g(W_{h}[h^{\langle t-1\rangle},x^{\langle t\rangle}] + b_h) \]</p>
<p>Which is another way of writing this:</p>
<p>\[ h^{\langle t\rangle}=g(W_{hh}h^{\langle t-1\rangle} \oplus W_{hx}x^{\langle t\rangle} + b_h) \]</p>
<p>Where</p>
<ul class="org-ul">
<li>\(W_{h}\) in the first formula is denotes the <b>horizontal</b> concatenation of \(W_{hh}\) and \(W_{hx}\) from the second formula.</li>
<li>\(W_{h}\) in the first formula is then multiplied by \([h^{\langle t-1\rangle},x^{\langle t\rangle}]\), another concatenation of parameters from the second formula but this time in a different direction, i.e <b>vertical</b>.</li>
</ul>
<p>Let us see what this means computationally.</p>
</div>
<div class="outline-3" id="outline-container-orgb96728c">
<h3 id="orgb96728c">Imports</h3>
<div class="outline-text-3" id="text-orgb96728c">
<div class="highlight">
<pre><span></span><span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgdf8a043">
<h2 id="orgdf8a043">Middle</h2>
<div class="outline-text-2" id="text-orgdf8a043"></div>
<div class="outline-3" id="outline-container-org73968df">
<h3 id="org73968df">Joining</h3>
<div class="outline-text-3" id="text-org73968df"></div>
<div class="outline-4" id="outline-container-orgffe04ca">
<h4 id="orgffe04ca">Weights: Horizontal Concatenation</h4>
<div class="outline-text-4" id="text-orgffe04ca">
<p>A join along the vertical boundary is called a <b>horizontal concatenation</b> or <b>horizontal stack</b>.</p>
<p>Visually, it looks like this:- \(W_h = \left [ W_{hh} \ | \ W_{hx} \right ]\).</p>
<p>We'll look at two different ways to achieve this using numpy.</p>
<p><b>Note:</b> <i>The values used to populate the arrays, below, have been chosen to aid in visual illustration only. They are NOT what you'd expect to use building a model, which would typically be random variables instead.</i></p>
<p>First create some dummy data. The <a href="https://numpy.org/doc/stable/reference/generated/numpy.full.html">numpy.full</a> function creates an array of a given shape that all has the same values. Our first array is almost like <code>numpy.ones</code> except it uses the dtype of the number you pass in so it will be integers, not floats.</p>
<div class="highlight">
<pre><span></span><span class="n">w_hh</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">w_hx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
</pre></div>
<p>We could use some random initializations, but it would make it harder to see the joins.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"-- Data --</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"w_hh :"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">w_hh</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"w_hh shape :"</span><span class="p">,</span> <span class="n">w_hh</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"w_hx :"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">w_hx</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"w_hx shape :"</span><span class="p">,</span> <span class="n">w_hx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example" id="org480bdc1">
-- Data --

w_hh :
[[1 1]
 [1 1]
 [1 1]]
w_hh shape : (3, 2) 

w_hx :
[[9 9 9]
 [9 9 9]
 [9 9 9]]
w_hx shape : (3, 3) 
</pre></div>
<ul class="org-ul">
<li><a id="orge104a4f"></a>Option 1: concatenate - horizontal<br>
<div class="outline-text-5" id="text-orge104a4f">
<p>First we'll use <a href="https://numpy.org/doc/stable/reference/generated/numpy.concatenate.html">numpy.concatenate</a>.</p>
<div class="highlight">
<pre><span></span><span class="n">ROWS</span><span class="p">,</span> <span class="n">COLUMNS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">w_h1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">w_hh</span><span class="p">,</span> <span class="n">w_hx</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"option 1 : concatenate</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"w_h :"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">w_h1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"w_h shape :"</span><span class="p">,</span> <span class="n">w_h1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
option 1 : concatenate

w_h :
[[1 1 9 9 9]
 [1 1 9 9 9]
 [1 1 9 9 9]]
w_h shape : (3, 5) 

</pre></div>
</li>
<li><a id="orged44381"></a>Option 2: hstack<br>
<div class="outline-text-5" id="text-orged44381">
<p>Now we'll try <a href="https://numpy.org/doc/stable/reference/generated/numpy.hstack.html">numpy.hstack</a>.</p>
<div class="highlight">
<pre><span></span><span class="n">w_h2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">w_hh</span><span class="p">,</span> <span class="n">w_hx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"option 2 : hstack</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"w_h :"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">w_h2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"w_h shape :"</span><span class="p">,</span> <span class="n">w_h2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
option 2 : hstack

w_h :
[[1 1 9 9 9]
 [1 1 9 9 9]
 [1 1 9 9 9]]
w_h shape : (3, 5)
</pre>
<p>As you can see, <code>hstack</code> gives you the same thing as <code>concatenate</code> along columns, <code>concatenate</code> also allows you to concatenate along rows and is more general than <code>hstack</code>. Although <code>hstack</code> might be more intuitive.</p>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgd644ad6">
<h4 id="orgd644ad6">Hidden State & Inputs: Vertical Concatenation</h4>
<div class="outline-text-4" id="text-orgd644ad6">
<p>Joining along a horizontal boundary is called a vertical concatenation or vertical stack. Visually it looks like this:</p>
<p>\[ [h^{\langle t-1\rangle},x^{\langle t\rangle}] = \left[ \frac{h^{\langle t-1\rangle}}{x^{\langle t\rangle}} \right] \]</p>
<p>We'll look at two different ways to achieve this using numpy.</p>
<p>First create some more dummy data.</p>
<div class="highlight">
<pre><span></span><span class="n">h_t_prev</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x_t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"-- Data --</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"h_t_prev :"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h_t_prev</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"h_t_prev shape :"</span><span class="p">,</span> <span class="n">h_t_prev</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"x_t :"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_t</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"x_t shape :"</span><span class="p">,</span> <span class="n">x_t</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example" id="orga7cf816">
-- Data --

h_t_prev :
[[1]
 [1]]
h_t_prev shape : (2, 1) 

x_t :
[[9]
 [9]
 [9]]
x_t shape : (3, 1) 
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgef4d08a">
<h4 id="orgef4d08a">Option 1: concatenate - Rows</h4>
<div class="outline-text-4" id="text-orgef4d08a">
<div class="highlight">
<pre><span></span><span class="n">ax_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
    <span class="p">(</span><span class="n">h_t_prev</span><span class="p">,</span> <span class="n">x_t</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">ROWS</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"option 1 : concatenate</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"ax_1 :"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ax_1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"ax_1 shape :"</span><span class="p">,</span> <span class="n">ax_1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
option 1 : concatenate

ax_1 :
[[1]
 [1]
 [9]
 [9]
 [9]]
ax_1 shape : (5, 1) 

</pre></div>
</div>
<div class="outline-4" id="outline-container-orgb535048">
<h4 id="orgb535048">Option 2: vstack</h4>
<div class="outline-text-4" id="text-orgb535048">
<p><a href="https://numpy.org/doc/stable/reference/generated/numpy.vstack.html#numpy.vstack">vstack</a> is much like <code>hstack</code> except instead of inserting columns it appends rows, more of what the word <i>stack</i> would seem to suggest.</p>
<div class="highlight">
<pre><span></span><span class="n">ax_2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">h_t_prev</span><span class="p">,</span> <span class="n">x_t</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"option 2 : vstack</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"ax_2 :"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ax_2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"ax_2 shape :"</span><span class="p">,</span> <span class="n">ax_2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
option 2 : vstack

ax_2 :
[[1]
 [1]
 [9]
 [9]
 [9]]
ax_2 shape : (5, 1)
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7515e08">
<h3 id="org7515e08">Verify Formulas</h3>
<div class="outline-text-3" id="text-org7515e08">
<p>Now that we know how to do the concatenations, horizontal and vertical, let's verify that the two formulas produce the same result.</p>
<ul class="org-ul">
<li><b>Formula 1:</b> \(h^{\langle t\rangle}=g(W_{h}[h^{\langle t-1\rangle},x^{\langle t\rangle}] + b_h)\)</li>
<li><b>Formula 2:</b> \(h^{\langle t\rangle}=g(W_{hh}h^{\langle t-1\rangle} \oplus W_{hx}x^{\langle t\rangle} + b_h)\)</li>
</ul>
<p>We want to assure ourselves that <b>Formula 1</b> \(\Leftrightarrow\) <b>Formula 2</b>.</p>
<p>We will initially ignore the bias term \(b_h\) and the activation function <i>g( )</i> because the transformation will be identical for each formula. So what we really want to compare is the result of the following parameters inside each formula:</p>
<p>\[ W_{h}[h^{\langle t-1\rangle},x^{\langle t\rangle}] \quad \Leftrightarrow \quad W_{hh}h^{\langle t-1\rangle} \oplus W_{hx}x^{\langle t\rangle} \]</p>
<p>We'll see how to do this using matrix multiplication combined with the data and techniques (stacking/concatenating) from above.</p>
</div>
<div class="outline-4" id="outline-container-org7960ecf">
<h4 id="org7960ecf">The Data</h4>
<div class="outline-text-4" id="text-org7960ecf">
<div class="highlight">
<pre><span></span><span class="n">w_hh</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">w_hx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">h_t_prev</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x_t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgab04e59">
<h4 id="orgab04e59">Formula 1</h4>
<div class="outline-text-4" id="text-orgab04e59">
<div class="highlight">
<pre><span></span><span class="n">stack_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">w_hh</span><span class="p">,</span> <span class="n">w_hx</span><span class="p">))</span>
<span class="n">stack_2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">h_t_prev</span><span class="p">,</span> <span class="n">x_t</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Formula 1"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Term1:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="n">stack_1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Term2:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="n">stack_2</span><span class="p">)</span>
<span class="n">formula_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">stack_1</span><span class="p">,</span>
                         <span class="n">stack_2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Output:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">formula_1</span><span class="p">)</span>
</pre></div>
<pre class="example" id="orgc20e7c7">

Formula 1
Term1:
 [[1 1 9 9 9]
 [1 1 9 9 9]
 [1 1 9 9 9]]
Term2:
 [[1]
 [1]
 [9]
 [9]
 [9]]
Output:
[[245]
 [245]
 [245]]
</pre></div>
</div>
<div class="outline-4" id="outline-container-org8bf0f58">
<h4 id="org8bf0f58">Formula 2</h4>
<div class="outline-text-4" id="text-org8bf0f58">
<div class="highlight">
<pre><span></span><span class="n">term_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">w_hh</span><span class="p">,</span> <span class="n">h_t_prev</span><span class="p">)</span>
<span class="n">term_2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">w_hx</span><span class="p">,</span> <span class="n">x_t</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Formula 2"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Term1:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">term_1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Term2:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">term_2</span><span class="p">)</span>

<span class="n">formula_2</span> <span class="o">=</span> <span class="n">term_1</span> <span class="o">+</span> <span class="n">term_2</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Output:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">formula_2</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example" id="orgc4eff3d">

Formula 2
Term1:
 [[2]
 [2]
 [2]]
Term2:
 [[243]
 [243]
 [243]]

Output:
[[245]
 [245]
 [245]] 
</pre></div>
</div>
<div class="outline-4" id="outline-container-org0ab4e87">
<h4 id="org0ab4e87">Verification</h4>
<div class="outline-text-4" id="text-org0ab4e87">
<p><a href="https://numpy.org/doc/stable/reference/generated/numpy.allclose.html">np.allclose</a> checks that each entry in one array is within a certain tolerance of the corresponding entry in another. For this example we're using integers, so you could probably use <code>all(a == b)</code> but otherwise, when you have floats, it's better to use <code>allclose</code> since floats won't always be exact.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"-- Verify --"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Results are the same :"</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">formula_1</span><span class="p">,</span> <span class="n">formula_2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Also the same: </span><span class="si">{</span><span class="nb">all</span><span class="p">(</span><span class="n">formula_1</span><span class="o">==</span><span class="n">formula_2</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
-- Verify --
Results are the same : True
Also the same: True
</pre>
<p>Now we'll add a sigmoid activation function and bias term as a final check so we can see how this would work in action.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Calculates the sigmoid of x</span>

<span class="sd">    Args:</span>
<span class="sd">     x: numpy array or list or float</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">bias</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="n">formula_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Formula 1 Output:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">formula_1</span> <span class="o">+</span> <span class="n">bias</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Formula 2 Output:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">formula_2</span> <span class="o">+</span> <span class="n">bias</span><span class="p">))</span>

<span class="k">assert</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">formula_1</span> <span class="o">+</span> <span class="n">bias</span><span class="p">),</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">formula_2</span> <span class="o">+</span> <span class="n">bias</span><span class="p">))</span>
</pre></div>
<pre class="example">
Formula 1 Output:
 [[1.]
 [1.]
 [1.]]
Formula 2 Output:
 [[1.]
 [1.]
 [1.]]
</pre></div>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
<li><a class="tag p-category" href="../../../categories/rnn/" rel="tag">rnn</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../../tensorflow-docker-setup/" rel="prev" title="Tensorflow Docker Setup">Previous post</a></li>
<li class="next"><a href="../jax-numpy-and-perplexity/" rel="next" title="Jax, Numpy, and Perplexity">Next post</a></li>
</ul>
</nav>
</aside>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
<script type="text/x-mathjax-config">

        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']],},

        });
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script>
<script>

    MathJax = {
        tex: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    }
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script></article>
<!--End of body content-->
<footer id="footer"><a href="https://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://licensebuttons.net/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
