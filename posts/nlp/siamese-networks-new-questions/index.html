<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Testing the Siamese Networks with new questions (outside the data set)." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Siamese Networks: New Questions | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/siamese-networks-new-questions/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../siamese-networks-evaluating-the-model/" rel="prev" title="Siamese Networks: Evaluating the Model" type="text/html">
<link href="../bleu-score/" rel="next" title="Bleu Score" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Siamese Networks: New Questions" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/siamese-networks-new-questions/" property="og:url">
<meta content="Testing the Siamese Networks with new questions (outside the data set)." property="og:description">
<meta content="article" property="og:type">
<meta content="2021-01-25T19:40:55-08:00" property="article:published_time">
<meta content="neural networks" property="article:tag">
<meta content="nlp" property="article:tag">
<meta content="siamese networks" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Siamese Networks: New Questions</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2021-01-25T19:40:55-08:00" itemprop="datePublished" title="2021-01-25 19:40">2021-01-25 19:40</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgd7e7526">Trying New Questions</a>
<ul>
<li><a href="#orgd6cf36a">Imports</a></li>
<li><a href="#org3839d4a">Set Up</a>
<ul>
<li><a href="#org66e5c5f">The Data</a></li>
<li><a href="#orge7df53d">The Model</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5ca0b7c">Implementing It</a>
<ul>
<li><a href="#org5b90edf">Some Trials</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgd7e7526">
<h2 id="orgd7e7526">Trying New Questions</h2>
<div class="outline-text-2" id="text-orgd7e7526"></div>
<div class="outline-3" id="outline-container-orgd6cf36a">
<h3 id="orgd6cf36a">Imports</h3>
<div class="outline-text-3" id="text-orgd6cf36a">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">trax</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.siamese_networks</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataGenerator</span><span class="p">,</span>
    <span class="n">DataLoader</span><span class="p">,</span>
    <span class="n">SiameseModel</span><span class="p">,</span>
    <span class="n">TOKENS</span><span class="p">,</span>
 <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org3839d4a">
<h3 id="org3839d4a">Set Up</h3>
<div class="outline-text-3" id="text-org3839d4a"></div>
<div class="outline-4" id="outline-container-org66e5c5f">
<h4 id="org66e5c5f">The Data</h4>
<div class="outline-text-4" id="text-org66e5c5f">
<div class="highlight">
<pre><span></span><span class="n">data_generator</span> <span class="o">=</span> <span class="n">DataGenerator</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">()</span>
<span class="n">vocabulary</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">vocabulary</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge7df53d">
<h4 id="orge7df53d">The Model</h4>
<div class="outline-text-4" id="text-orge7df53d">
<div class="highlight">
<pre><span></span><span class="n">siamese</span> <span class="o">=</span> <span class="n">SiameseModel</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">))</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"~/models/siamese_networks/model.pkl.gz"</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">siamese</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">init_from_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">weights_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">siamese</span><span class="o">.</span><span class="n">model</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org5ca0b7c">
<h2 id="org5ca0b7c">Implementing It</h2>
<div class="outline-text-2" id="text-org5ca0b7c">
<p>Write a function =predict=that takes in two questions, the model, and the vocabulary and returns whether the questions are duplicates (<i>1</i>) or not duplicates (<i>0</i>) given a similarity threshold.</p>
<p><b>Instructions:</b></p>
<ul class="org-ul">
<li>Tokenize your question using `nltk.word_tokenize`</li>
<li>Create Q1,Q2 by encoding your questions as a list of numbers using vocab</li>
<li>pad Q1,Q2 with next(data_generator([Q1], [Q2],1,vocab['&lt;PAD&gt;']))</li>
<li>use model() to create v1, v2</li>
<li>compute the cosine similarity (dot product) of v1, v2</li>
<li>compute res by comparing d to the threshold</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">question1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">question2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">trax</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Parallel</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">vocab</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">data_generator</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="n">data_generator</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">"""Function for predicting if two questions are duplicates.</span>

<span class="sd">    Args:</span>
<span class="sd">       question1 (str): First question.</span>
<span class="sd">       question2 (str): Second question.</span>
<span class="sd">       threshold (float): Desired threshold.</span>
<span class="sd">       model (trax.layers.combinators.Parallel): The Siamese model.</span>
<span class="sd">       vocab (collections.defaultdict): The vocabulary used.</span>
<span class="sd">       data_generator (function): Data generator function. Defaults to data_generator.</span>
<span class="sd">       verbose (bool, optional): If the results should be printed out. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">       bool: True if the questions are duplicates, False otherwise.</span>
<span class="sd">    """</span>
    <span class="n">question_one</span> <span class="o">=</span> <span class="p">[[</span><span class="n">vocab</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">question1</span><span class="p">)]]</span>
    <span class="n">question_two</span> <span class="o">=</span> <span class="p">[[</span><span class="n">vocab</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">question2</span><span class="p">)]]</span>

    <span class="n">questions</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">data_generator</span><span class="p">(</span><span class="n">question_one</span><span class="p">,</span>
                                    <span class="n">question_two</span><span class="p">,</span>
                                    <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">vector_1</span><span class="p">,</span> <span class="n">vector_2</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">questions</span><span class="p">)</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector_1</span><span class="p">,</span> <span class="n">vector_2</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">same_question</span> <span class="o">=</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="n">threshold</span>

    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Q1  = </span><span class="si">{</span><span class="n">questions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Q2 = </span><span class="si">{</span><span class="n">questions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Similarity : </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">similarity</span><span class="p">)</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"They are the same question: </span><span class="si">{</span><span class="n">same_question</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">same_question</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org5b90edf">
<h3 id="org5b90edf">Some Trials</h3>
<div class="outline-text-3" id="text-org5b90edf">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TOKENS</span><span class="p">)</span>
</pre></div>
<pre class="example">
Tokens(unknown=0, padding=1, padding_token='&lt;PAD&gt;')
</pre>
<p>So if we see a 0 in the tokens then we know the word wasn't in the vocabulary.</p>
<div class="highlight">
<pre><span></span><span class="n">question1</span> <span class="o">=</span> <span class="s2">"When will I see you?"</span>
<span class="n">question2</span> <span class="o">=</span> <span class="s2">"When can I see you again?"</span>
<span class="c1"># 1 means it is duplicated, 0 otherwise</span>
<span class="n">predict</span><span class="p">(</span><span class="n">question1</span> <span class="p">,</span> <span class="n">question2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
<pre class="example">
Q1  = [[581  64  20  44  49  16   1   1]]
Q2 = [[ 581   39   20   44   49 7280   16    1]]
Similarity : 0.95
They are the same question: True
</pre>
<div class="highlight">
<pre><span></span><span class="n">question1</span> <span class="o">=</span> <span class="s2">"Do they enjoy eating the dessert?"</span>
<span class="n">question2</span> <span class="o">=</span> <span class="s2">"Do they like hiking in the desert?"</span>

<span class="n">predict</span><span class="p">(</span><span class="n">question1</span> <span class="p">,</span> <span class="n">question2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
<pre class="example">
Q1  = [[  446  1138  3159  1169    70 29016    16     1]]
Q2 = [[  446  1138    57 15302    24    70  7430    16]]
Similarity : 0.60
They are the same question: False
</pre>
<div class="highlight">
<pre><span></span><span class="n">predict</span><span class="p">(</span><span class="s2">"Do cows have butts?"</span><span class="p">,</span> <span class="s2">"Do dogs have bones?"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Q1  = [[  446  5757   216 25442    16     1     1     1]]
Q2 = [[  446   788   216 11192    16     1     1     1]]
Similarity : 0.25
They are the same question: False
</pre>
<div class="highlight">
<pre><span></span><span class="n">predict</span><span class="p">(</span><span class="s2">"Do cows from Lancashire have butts?"</span><span class="p">,</span> <span class="s2">"Do dogs have bones as big as whales?"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Q1  = [[  446  5757   125     0   216 25442    16     1     1     1     1     1
      1     1     1     1]]
Q2 = [[  446   788   216 11192   249  1124   249 30836    16     1     1     1
      1     1     1     1]]
Similarity : 0.13
They are the same question: False
</pre>
<div class="highlight">
<pre><span></span><span class="n">predict</span><span class="p">(</span><span class="s2">"Can pigs fly?"</span><span class="p">,</span> <span class="s2">"Are you my mother?"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Q1  = [[  221 14137  5750    16     1     1     1     1]]
Q2 = [[ 517   49   41 1585   16    1    1    1]]
Similarity : 0.01
They are the same question: False
</pre>
<div class="highlight">
<pre><span></span><span class="n">predict</span><span class="p">(</span><span class="s2">"Shall we dance?"</span><span class="p">,</span> <span class="s2">"Shall I fart?"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Q1  = [[19382   138  4201    16]]
Q2 = [[19382    20 18288    16]]
Similarity : 0.71
They are the same question: True
</pre>
<p>Hm… surprising that "fart" was in the data set, and it's the same as dancing.</p>
<div class="highlight">
<pre><span></span><span class="n">farts</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">training_data</span><span class="p">[</span><span class="n">loader</span><span class="o">.</span><span class="n">training_data</span><span class="o">.</span><span class="n">question2</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">"fart[^a-z]"</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">farts</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">farts</span><span class="o">.</span><span class="n">question2</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
<pre class="example">
16
19820                                    Can penguins fart?
60745       How do I control a fart when I'm about to fart?
83124           What word square starts with the word fart?
96707         Which part of human body is called fart pump?
120727    Why do people fart more when they wake up in t...
Name: question2, dtype: object
</pre>
<p>Maybe I shouldn't have been surprised.</p>
<div class="highlight">
<pre><span></span><span class="n">predict</span><span class="p">(</span><span class="s2">"Am I man or gorilla?"</span><span class="p">,</span> <span class="s2">"Am I able to eat the pasta?"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Q1  = [[4311   20 1215   75 7438   16    1    1]]
Q2 = [[ 4311    20   461    37   922    70 14552    16]]
Similarity : 0.20
They are the same question: False
</pre>
<p>It looks like the model only looks at the first words… at least when the sentences are short.</p>
<div class="highlight">
<pre><span></span><span class="n">predict</span><span class="p">(</span><span class="s2">"Will we return to Mars or go instead to Venus?"</span><span class="p">,</span> <span class="s2">"Will we eat rice with plums and cherry topping?"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Q1  = [[  168   141  8303    34  6861    72  1315  4536    34 15555    16     1
      1     1     1     1]]
Q2 = [[  168   141   927  7612   121     0     9 19275     0    16     1     1
      1     1     1     1]]
Similarity : 0.67
They are the same question: False
</pre>
<p>Siamese networks are important and useful. Many times there are several questions that are already asked in quora, or other platforms and you can use Siamese networks to avoid question duplicates.</p>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/neural-networks/" rel="tag">neural networks</a></li>
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
<li><a class="tag p-category" href="../../../categories/siamese-networks/" rel="tag">siamese networks</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../siamese-networks-evaluating-the-model/" rel="prev" title="Siamese Networks: Evaluating the Model">Previous post</a></li>
<li class="next"><a href="../bleu-score/" rel="next" title="Bleu Score">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer"><a href="https://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://licensebuttons.net/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
