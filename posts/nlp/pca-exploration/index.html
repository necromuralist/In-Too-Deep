<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Visualizing word vectors with PCA." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>PCA Exploration | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/pca-exploration/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../word-embeddings/" rel="prev" title="Word Embeddings" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="PCA Exploration" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/pca-exploration/" property="og:url">
<meta content="Visualizing word vectors with PCA." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-10-01T17:53:17-07:00" property="article:published_time">
<meta content="nlp" property="article:tag">
<meta content="pca" property="article:tag">
<meta content="visualization" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">PCA Exploration</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-10-01T17:53:17-07:00" itemprop="datePublished" title="2020-10-01 17:53">2020-10-01 17:53</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb9de00f">Beginning</a>
<ul>
<li><a href="#orgb303e74">Set Up</a></li>
</ul>
</li>
<li><a href="#orgab9123a">Middle</a>
<ul>
<li><a href="#org2b6ecfe">Some Random Uniform Data</a></li>
<li><a href="#org437a4fa">Normal Random Data</a></li>
<li><a href="#org4e6c9a3">Dimensionality Reduction</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgb9de00f">
<h2 id="orgb9de00f">Beginning</h2>
<div class="outline-text-2" id="text-orgb9de00f"></div>
<div class="outline-3" id="outline-container-orgb303e74">
<h3 id="orgb303e74">Set Up</h3>
<div class="outline-text-3" id="text-orgb303e74"></div>
<div class="outline-4" id="outline-container-org59ad248">
<h4 id="org59ad248">Imports</h4>
<div class="outline-text-4" id="text-org59ad248">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgd9c78eb">
<h4 id="orgd9c78eb">Plotting</h4>
<div class="outline-text-4" id="text-orgd9c78eb">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"pca-exploration"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span>
                <span class="n">folder_path</span><span class="o">=</span><span class="n">f</span><span class="s2">"files/posts/nlp/{SLUG}"</span><span class="p">)</span>

<span class="n">Plot</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
    <span class="n">color_cycle</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Cycle</span><span class="p">([</span><span class="s2">"#4687b7"</span><span class="p">,</span> <span class="s2">"#ce7b6d"</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org2ba5177">
<h4 id="org2ba5177">Randomness</h4>
<div class="outline-text-4" id="text-org2ba5177">
<div class="highlight">
<pre><span></span><span class="n">numpy_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgab9123a">
<h2 id="orgab9123a">Middle</h2>
<div class="outline-text-2" id="text-orgab9123a"></div>
<div class="outline-3" id="outline-container-org2b6ecfe">
<h3 id="org2b6ecfe">Some Random Uniform Data</h3>
<div class="outline-text-3" id="text-org2b6ecfe">
<p>We're going to create a data set generated by numpy's <a href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.uniform.html">uniform</a> function, which takes three arguments - <code>low</code>, <code>high</code>, and <code>size</code>.</p>
<div class="highlight">
<pre><span></span><span class="n">correlation</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">numpy_random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org5e63c2f">
<h4 id="org5e63c2f">Center It</h4>
<div class="outline-text-4" id="text-org5e63c2f">
<p>We're going to center it around the mean.</p>
<div class="highlight">
<pre><span></span><span class="n">x</span> <span class="o">-=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y</span> <span class="o">-=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgfbb24cc">
<h4 id="orgfbb24cc">Pandas and a Plot</h4>
<div class="outline-text-4" id="text-orgfbb24cc">
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span>
</pre></div>
<p>We're going to use <a href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">sklearn's PCA</a> for Principal Component Analysis. The <code>n_components</code> argument is the number of components it will keep -we'll keep 2.</p>
<div class="highlight">
<pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
<p>Now fit it to the data.</p>
<div class="highlight">
<pre><span></span><span class="n">transformation_model</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
<p>And then transform it (note that there's a <a href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html#sklearn.decomposition.PCA.fit_transform">fit_transform</a> method to do it in one step).</p>
<div class="highlight">
<pre><span></span><span class="n">pca_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">transformation_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"Principal Component 1"</span><span class="p">,</span> <span class="s2">"Principal Component 2"</span><span class="p">])</span>
</pre></div>
<p>Now Plot it.</p>
<div class="highlight">
<pre><span></span><span class="n">original</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">blue</span><span class="p">)</span>
<span class="n">transformed</span> <span class="o">=</span> <span class="n">pca_data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Principal Component 1"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Principal Component 2"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">original</span> <span class="o">*</span> <span class="n">transformed</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Correlated and PCA Data"</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"correlated_data"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="correlated_data.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Exciting. So we've taken a 2-D line and rotated it.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgc1a3fa0">
<h4 id="orgc1a3fa0">Understanding the Model</h4>
<div class="outline-text-4" id="text-orgc1a3fa0">
<p>The Eigenvectors (principal component).</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">transformation_model</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>
</pre></div>
<pre class="example">
[[ 0.70710678  0.70710678]
 [-0.70710678  0.70710678]]
</pre>
<p>The \(cos(45^o)\) is <code>0.7071</code> which is what you see as values for the Eigenvectors. So you can interpret this <a href="https://www.wikiwand.com/en/Rotation_matrix">rotation matrix</a> as:</p>
<p>\[ R = \begin{bmatrix} cos(45^o) & sin(45^o)\\ -sin(45^o) & cos(45^o)\\ \end{bmatrix} \]</p>
<p>Why \(45^o\)? If you look at the blue line in the plot (or think about the fact that \(x=y\)), our original line sits at a 45 degree angle so applying this transformation rotates it flat.</p>
<p>The Eigenvalues (explained variance).</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">transformation_model</span><span class="o">.</span><span class="n">explained_variance_</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1.59912782e-01 7.31437644e-33]
</pre>
<p>The equation for <a href="https://www.dummies.com/education/math/business-statistics/how-to-calculate-the-variance-and-standard-deviation-in-the-uniform-distribution/">variance or a uniform distribution</a> is:</p>
<p>\[ Var = \frac{(b - a)^2}{12} \]</p>
<p>When we called the <code>uniform</code> function we set <code>b</code> to 2, and <code>a</code> to 1, so we get.</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
<pre class="example">
0.08333333333333333
</pre>
<p>If you look at the Eigenvalues we got, the second term is \(7 \times 10^{-33}\) which is pretty much zero, and the second term is about <code>0.16</code>, so what we have here is.</p>
\begin{align} Var &amp;= \langle Var(x) + Var(y), 0\rangle\\ &amp;= \langle 0.083 + 0.083, 0 \rangle\\ &amp;= \langle 0.16, 0 \rangle\\ \end{align}
<p>It rounds more to 0.167, but close enough, the point is that the first component contributed all the variance and the second didn't contribute any.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org437a4fa">
<h3 id="org437a4fa">Normal Random Data</h3>
<div class="outline-text-3" id="text-org437a4fa">
<p>I'm going to use numpy's random <a href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.normal.html">normal</a> function to generate the data. The three arguments it takes are <code>loc</code> (the mean), <code>scale</code> (the standard deviation), and <code>size</code> (the number of numbers to generate).</p>
<div class="highlight">
<pre><span></span><span class="n">standard_deviation_1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">standard_deviation_2</span> <span class="o">=</span> <span class="mf">0.333</span>
<span class="n">points</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">numpy_random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">standard_deviation_1</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numpy_random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">standard_deviation_2</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
</pre></div>
<p>Even though we specify that the mean is 0, because it is random it isn't exactly zero so we should center it.</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"x mean start: {x.mean()}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"y mean start: {y.mean()}"</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">x mean: {x.mean()}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"y mean: {y.mean()}"</span><span class="p">)</span>
</pre></div>
<pre class="example">
x mean start: -0.009698529455667203
y mean start: 0.013492715633367562

x mean: 1.7763568394002505e-17
y mean: 3.552713678800501e-18
</pre>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Random Normal Data"</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"random_normal_data"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="random_normal_data.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Now we're going to put the <code>x</code> and <code>y</code> data into a matrix and rotate it.</p>
<div class="highlight">
<pre><span></span><span class="n">covariance</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">covariance</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"angle: {angle * 180/math.pi}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)],</span>
                               <span class="p">[</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)]])</span>
<span class="k">print</span><span class="p">(</span><span class="n">rotation_matrix</span><span class="p">)</span>
</pre></div>
<pre class="example">
angle: 45.0

[[ 0.70710678  0.70710678]
 [-0.70710678  0.70710678]]
</pre>
<p>You might notice that this is the same rotation matrix that we had before with the sklearn eigenvectors, so we could have used that, but this is how you would roll your own.</p>
<p>Now we can apply the rotation by taking the dot-product between the data array and the rotatiot-matrix.</p>
<div class="highlight">
<pre><span></span><span class="n">rotated</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotation_matrix</span><span class="p">)</span>
<span class="n">rotated</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">]</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">rotated</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Rotated Normal Data"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"rotated_normal_data"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="rotated_normal_data.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Now we can apply the PCA.</p>
<div class="highlight">
<pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fitted</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">rotated</span><span class="p">)</span>
</pre></div>
<p>Once again, the Eigenvectors (the transformation matirix).</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">fitted</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>
</pre></div>
<pre class="example">
[[-0.71060471 -0.70359146]
 [-0.70359146  0.71060471]]
</pre>
<p>And then the Eigenvalues (the variance).</p>
<div class="highlight">
<pre><span></span><span class="n">variance</span> <span class="o">=</span> <span class="n">fitted</span><span class="o">.</span><span class="n">explained_variance_</span>
<span class="k">print</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span>
</pre></div>
<pre class="example">
[0.98287571 0.10862302]
</pre>
<p>Now we apply the PCA and plot it.</p>
<div class="highlight">
<pre><span></span><span class="n">pca_data</span> <span class="o">=</span> <span class="n">fitted</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rotated</span><span class="p">)</span>
<span class="n">pca_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">"x y"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">FIRST_ROW</span><span class="p">,</span> <span class="n">SECOND_ROW</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">FIRST_COLUMN</span><span class="p">,</span> <span class="n">SECOND_COLUMN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">ORIGIN</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">FIRST_SCALAR</span><span class="p">,</span> <span class="n">SECOND_SCALAR</span> <span class="o">=</span> <span class="p">(</span><span class="n">standard_deviation_1</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                               <span class="n">standard_deviation_2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">COLUMNS</span> <span class="o">=</span> <span class="s2">"x y"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">first_axis</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">[</span><span class="n">ORIGIN</span><span class="p">,</span> <span class="n">ORIGIN</span><span class="p">],</span>
    <span class="n">rotation_matrix</span><span class="p">[</span><span class="n">FIRST_ROW</span><span class="p">][:]],</span>
                              <span class="n">columns</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">)</span>
<span class="n">first_axis</span> <span class="o">*=</span> <span class="n">FIRST_SCALAR</span>


<span class="n">second_axis</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">[</span><span class="n">ORIGIN</span><span class="p">,</span> <span class="n">ORIGIN</span><span class="p">],</span>
    <span class="n">rotation_matrix</span><span class="p">[</span><span class="n">SECOND_ROW</span><span class="p">][:]],</span>
                               <span class="n">columns</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">)</span>
<span class="n">second_axis</span> <span class="o">*=</span> <span class="n">SECOND_SCALAR</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">transformed</span> <span class="o">=</span> <span class="n">pca_data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">red</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rotated_plot</span> <span class="o">=</span> <span class="n">rotated</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">first_axis_plot</span> <span class="o">=</span> <span class="n">first_axis</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span>
<span class="n">second_axis_plot</span> <span class="o">=</span> <span class="n">second_axis</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">transformed</span> <span class="o">*</span> <span class="n">rotated_plot</span> <span class="o">*</span> <span class="n">first_axis_plot</span> <span class="o">*</span> <span class="n">second_axis_plot</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"PCA of Random Normal Data"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"pca_random_normal"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="pca_random_normal.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<ul class="org-ul">
<li>The rotation matrix took the original uncorrelated variables and transformed them into correllated variables (the red circles).</li>
<li>Fitting the PCA to our correlated finds the rotation matrix that was used to create the blue points.</li>
<li>Applying the PCA transformation undoes the rotation</li>
</ul>
<p>The Explained Variance is roughly our original standard deviations squared.</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">))</span>
</pre></div>
<pre class="example">
[0.99140088 0.32958007]
</pre></div>
</div>
<div class="outline-3" id="outline-container-org4e6c9a3">
<h3 id="org4e6c9a3">Dimensionality Reduction</h3>
<div class="outline-text-3" id="text-org4e6c9a3">
<p>The previous sections were meant to understand what PCA is doing, but to use the PCA for visualization we will use it to reduce the number of dimensions of a data set so that it can be plotted. First let's look at our rotated data with the dimensions separated.</p>
<div class="highlight">
<pre><span></span><span class="n">first_component</span> <span class="o">=</span> <span class="n">rotated</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">first_component</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">second_component</span> <span class="o">=</span> <span class="n">rotated</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">second_component</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">original</span> <span class="o">=</span> <span class="n">rotated</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
                                  <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">first_component</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span>
                                       <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">second</span> <span class="o">=</span> <span class="n">second_component</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">red</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">original</span> <span class="o">*</span> <span class="n">first</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Data Decomposition"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"data_decomposed"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="data_decomposed.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>This is only a teaser to doing an actual dimensionality reduction.</p>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
<li><a class="tag p-category" href="../../../categories/pca/" rel="tag">pca</a></li>
<li><a class="tag p-category" href="../../../categories/visualization/" rel="tag">visualization</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../word-embeddings/" rel="prev" title="Word Embeddings">Previous post</a></li>
</ul>
</nav>
</aside>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
<script type="text/x-mathjax-config">

        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']],},

        });
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script>
<script>

    MathJax = {
        tex: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    }
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script></article>
<!--End of body content-->
<footer id="footer"><a href="http://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
