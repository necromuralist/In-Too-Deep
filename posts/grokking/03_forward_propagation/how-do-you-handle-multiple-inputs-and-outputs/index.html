<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content='Notes from "Grokking Deep Learning" on handling multiple inputs and outputs.' name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>How do you handle multiple inputs and outputs? | Neurotic Networking</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/grokking/03_forward_propagation/how-do-you-handle-multiple-inputs-and-outputs/" rel="canonical"><!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../how-do-you-handle-multiple-outputs/" rel="prev" title="How do you handle multiple outputs?" type="text/html">
<link href="../../../nano/numpy-practice-one/" rel="next" title="NumPy Practice One" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="How do you handle multiple inputs and outputs?" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/grokking/03_forward_propagation/how-do-you-handle-multiple-inputs-and-outputs/" property="og:url">
<meta content='Notes from "Grokking Deep Learning" on handling multiple inputs and outputs.' property="og:description">
<meta content="article" property="og:type">
<meta content="2018-10-19T17:09:52-07:00" property="article:published_time">
<meta content="grokking" property="article:tag">
<meta content="neural networks" property="article:tag">
<meta content="notes" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">How do you handle multiple inputs and outputs?</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2018-10-19T17:09:52-07:00" itemprop="datePublished" title="2018-10-19 17:09">2018-10-19 17:09</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2580cbe">Beginning</a>
<ul>
<li><a href="#orgc2f9964">Imports</a></li>
<li><a href="#org68677b7">Set Up</a></li>
<li><a href="#orgde00402">What is this?</a></li>
</ul>
</li>
<li><a href="#orgd096090">Middle</a>
<ul>
<li><a href="#org7f8202a">So how do you handle multiple inputs and outputs?</a></li>
<li><a href="#orgdc59aaf">Okay, but how do you build that network?</a></li>
<li><a href="#orgbcd5259">Dot Product</a></li>
<li><a href="#org55aff56">Vector-Matrix Multiplication</a></li>
<li><a href="#org5ec0023">The Pandas Way</a></li>
</ul>
</li>
<li><a href="#org643ac74">Ending</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org2580cbe">
<h2 id="org2580cbe">Beginning</h2>
<div class="outline-text-2" id="text-org2580cbe"></div>
<div class="outline-3" id="outline-container-orgc2f9964">
<h3 id="orgc2f9964">Imports</h3>
<div class="outline-text-3" id="text-orgc2f9964"></div>
<div class="outline-4" id="outline-container-org44e1f80">
<h4 id="org44e1f80">From Python</h4>
<div class="outline-text-4" id="text-org44e1f80">
<div class="highlight">
<pre><span></span> from functools import partial
 from pathlib import Path
 from typing import List
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orged0ee1c">
<h4 id="orged0ee1c">From PyPi</h4>
<div class="outline-text-4" id="text-orged0ee1c">
<div class="highlight">
<pre><span></span>from graphviz import Digraph
from tabulate import tabulate

import holoviews
import numpy
import pandas
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org68677b7">
<h3 id="org68677b7">Set Up</h3>
<div class="outline-text-3" id="text-org68677b7"></div>
<div class="outline-4" id="outline-container-org36e606f">
<h4 id="org36e606f">Table Printer</h4>
<div class="outline-text-4" id="text-org36e606f">
<div class="highlight">
<pre><span></span>TABLE = partial(tabulate, tablefmt="orgtbl", headers="keys")
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org06f2e76">
<h4 id="org06f2e76">Plotting</h4>
<div class="outline-text-4" id="text-org06f2e76">
<div class="highlight">
<pre><span></span>SLUG = "how-do-you-handle-multiple-inputs-and-outputs"
ROOT = "../../../files/posts/grokking/03_forward_propagation/"
OUTPUT_PATH = Path(ROOT)/SLUG

Embed = partial(EmbedHoloviews, folder_path=OUTPUT_PATH)
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org500d179">
<h4 id="org500d179">Some Types</h4>
<div class="outline-text-4" id="text-org500d179">
<div class="highlight">
<pre><span></span>Vector = List[float]
Matrix = List[Vector]
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgde00402">
<h3 id="orgde00402">What is this?</h3>
<div class="outline-text-3" id="text-orgde00402">
<p>This is a continuation of my notes on Chapter Three of "Grokking Deep Learning". In the previous post we looked at a simple neural network with one input and three outputs. Here we'll look at handling multiple inputs and outputs.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgd096090">
<h2 id="orgd096090">Middle</h2>
<div class="outline-text-2" id="text-orgd096090"></div>
<div class="outline-3" id="outline-container-org7f8202a">
<h3 id="org7f8202a">So how do you handle multiple inputs and outputs?</h3>
<div class="outline-text-3" id="text-org7f8202a">
<p>You create a network that has a node for each of the inputs and each input node has an output to each of the outputs. Here's the matrix representation of the network we're going to use.</p>
<div class="highlight">
<pre><span></span>data = pandas.DataFrame(
    dict(
        source=["Toes"] * 3 + ["Wins"] * 3 + ["Fans"] * 3,
        target=["Hurt", "Win", "Sad"] * 3,
        edge = [0.1, 0.1, 0, 0.1, 0.2, 1.3, -0.3, 0.0, 0.1]))
</pre></div>
<div class="highlight">
<pre><span></span>print(TABLE(data, showindex=False))
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">source</th>
<th class="org-left" scope="col">target</th>
<th class="org-right" scope="col">edge</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Toes</td>
<td class="org-left">Hurt</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">Toes</td>
<td class="org-left">Win</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">Toes</td>
<td class="org-left">Sad</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Wins</td>
<td class="org-left">Hurt</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">Wins</td>
<td class="org-left">Win</td>
<td class="org-right">0.2</td>
</tr>
<tr>
<td class="org-left">Wins</td>
<td class="org-left">Sad</td>
<td class="org-right">1.3</td>
</tr>
<tr>
<td class="org-left">Fans</td>
<td class="org-left">Hurt</td>
<td class="org-right">-0.3</td>
</tr>
<tr>
<td class="org-left">Fans</td>
<td class="org-left">Win</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-left">Fans</td>
<td class="org-left">Sad</td>
<td class="org-right">0.1</td>
</tr>
</tbody>
</table>
<div class="figure">
<p><img alt="network.dot.png" src="network.dot.png"></p>
</div>
<p>Adding the weights to the diagram made it hard to read so here's a table version of the weights for the edges.</p>
<div class="highlight">
<pre><span></span>edges = data.pivot(index="target", columns="source", values="edge")
edges.columns.name = None
edges.index.name = None
print(TABLE(edges))
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">Fans</th>
<th class="org-right" scope="col">Toes</th>
<th class="org-right" scope="col">Wins</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Hurt</td>
<td class="org-right">-0.3</td>
<td class="org-right">0.1</td>
<td class="org-right">0.1</td>
</tr>
<tr>
<td class="org-left">Sad</td>
<td class="org-right">0.1</td>
<td class="org-right">0</td>
<td class="org-right">1.3</td>
</tr>
<tr>
<td class="org-left">Win</td>
<td class="org-right">0</td>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-orgdc59aaf">
<h3 id="orgdc59aaf">Okay, but how do you build that network?</h3>
<div class="outline-text-3" id="text-orgdc59aaf">
<p>It's basically the same as with one output except you repeat for each node - for each node you calculate the weighted sum (dot product) of the inputs.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgbcd5259">
<h3 id="orgbcd5259">Dot Product</h3>
<div class="outline-text-3" id="text-orgbcd5259">
<div class="highlight">
<pre><span></span>def weighted_sum(inputs, weights):
    """Calculates the weighted sum of the inputs

    Args:

    """
    assert len(inputs) == len(weights)
    return sum((inputs[index] * weights[index] for index in range(len(inputs))))
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org55aff56">
<h3 id="org55aff56">Vector-Matrix Multiplication</h3>
<div class="outline-text-3" id="text-org55aff56">
<p>We'll take the inputs as a vector of length three since we have three features and the weights as a matrix of three rows and three columns and then multiply the inputs by each of the rows of weights using the dot product to get our three outputs.</p>
<ul class="org-ul">
<li>for each output take the dot product of the weights of its inputs and the input vector</li>
</ul>
<div class="highlight">
<pre><span></span>def vector_matrix_multiplication(vector: Vector, matrix: Matrix) -&gt; Vector:
    """takes the dot product of each row in the matrix and the vector

    Args:
     vector: the inputs to the network
     matrix: the weights

    Returns:
     outputs: the network's outputs
    """
    vector_length = len(vector)
    assert vector_length == len(matrix)
    return [weighted_sum(vector, matrix[output])
            for output in range(vector_length)]
</pre></div>
<p>To test it out I'll convert the weights to a matrix (list of lists).</p>
<div class="highlight">
<pre><span></span>weights = edges.values
</pre></div>
<p>Now we'll create a team that averages 8.5 toes per player, has won 65 percent of its games and has 1.2 million fans. Note that we have to match the column order of our edge data-frame.</p>
<div class="highlight">
<pre><span></span>TOES = 8.5
WINS = 0.65
FANS = 1.2
inputs = [FANS, TOES, WINS]
</pre></div>
<p>What does it predict? The output of our function will be a vector with the outputs in the order of the rows in our edge-matrix.</p>
<div class="highlight">
<pre><span></span>outputs = vector_matrix_multiplication(inputs, weights)
HURT = 0.555
SAD = 0.965
WIN = 0.98
expected_outputs = [HURT, SAD, WIN]
tolerance = 0.1**5
expected_actual = zip(expected_outputs, outputs)
names = "Hurt Sad Win".split()
print("| Node| Value|")
print("|-+-|")
for index, (expected, actual) in enumerate(expected_actual):
    print(f"|{names[index]}|{actual:.3f}")
    assert abs(actual - expected) &lt; tolerance,\
            "Expected: {} Actual: {} Difference: {}".format(expected,
                                                            actual,
                                                            expected-actual)
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Node</th>
<th class="org-right" scope="col">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Hurt</td>
<td class="org-right">0.555</td>
</tr>
<tr>
<td class="org-left">Sad</td>
<td class="org-right">0.965</td>
</tr>
<tr>
<td class="org-left">Win</td>
<td class="org-right">0.980</td>
</tr>
</tbody>
</table>
<p>So we are predicting that they have a 98% chance of winning and a 97% chance of being sad? I guess the fans have emotional problems outside of sports.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org5ec0023">
<h3 id="org5ec0023">The Pandas Way</h3>
<div class="outline-text-3" id="text-org5ec0023">
<div class="highlight">
<pre><span></span>predictions = edges.dot(inputs)
print(TABLE(predictions.reset_index().rename(
    columns={"index": "Node", 0: "Value"}), showindex=False))
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Node</th>
<th class="org-right" scope="col">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Hurt</td>
<td class="org-right">0.555</td>
</tr>
<tr>
<td class="org-left">Sad</td>
<td class="org-right">0.965</td>
</tr>
<tr>
<td class="org-left">Win</td>
<td class="org-right">0.98</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org643ac74">
<h2 id="org643ac74">Ending</h2>
<div class="outline-text-2" id="text-org643ac74">
<p>So, like we saw previously that finding the charge for a neuron is just vector math and making a network of neurons doesn't really change that, instead of doing it all as one matrix we could have taken each of our output nodes and treated them as a separate vector that we used to take the dot product:</p>
<div class="highlight">
<pre><span></span>print("|Node | Value|")
print("|-+-|")
for node in edges.index:
    print(f"|{node} |{edges.loc[node].dot(inputs): 0.3f}|")
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Node</th>
<th class="org-right" scope="col">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Hurt</td>
<td class="org-right">0.555</td>
</tr>
<tr>
<td class="org-left">Sad</td>
<td class="org-right">0.965</td>
</tr>
<tr>
<td class="org-left">Win</td>
<td class="org-right">0.980</td>
</tr>
</tbody>
</table>
<p>Which is like going back to our single neuron case for each output.</p>
<div class="figure">
<p><img alt="hurt_neuron.dot.png" src="hurt_neuron.dot.png"></p>
</div>
<div class="figure">
<p><img alt="Sad_neuron.dot.png" src="Sad_neuron.dot.png"></p>
</div>
<div class="figure">
<p><img alt="Win_neuron.dot.png" src="Win_neuron.dot.png"></p>
</div>
<p>But by stacking them in a matrix it becomes easier to work with them as the network gets larger.</p>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../../categories/grokking/" rel="tag">grokking</a></li>
<li><a class="tag p-category" href="../../../../categories/neural-networks/" rel="tag">neural networks</a></li>
<li><a class="tag p-category" href="../../../../categories/notes/" rel="tag">notes</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../how-do-you-handle-multiple-outputs/" rel="prev" title="How do you handle multiple outputs?">Previous post</a></li>
<li class="next"><a href="../../../nano/numpy-practice-one/" rel="next" title="NumPy Practice One">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer"><a href="http://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
