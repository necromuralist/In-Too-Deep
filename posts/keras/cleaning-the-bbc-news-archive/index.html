<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Cleaning up the BBC news archive." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Cleaning the BBC News Archive | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/keras/cleaning-the-bbc-news-archive/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../sign-language-exercise/" rel="prev" title="Sign Language Exercise" type="text/html">
<link href="../bbc-news-classification/" rel="next" title="BBC News Classification" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Cleaning the BBC News Archive" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/keras/cleaning-the-bbc-news-archive/" property="og:url">
<meta content="Cleaning up the BBC news archive." property="og:description">
<meta content="article" property="og:type">
<meta content="2019-08-25T17:14:54-07:00" property="article:published_time">
<meta content="cleaning" property="article:tag">
<meta content="nlp" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Cleaning the BBC News Archive</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2019-08-25T17:14:54-07:00" itemprop="datePublished" title="2019-08-25 17:14">2019-08-25 17:14</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9d58703">Beginning</a>
<ul>
<li><a href="#org899b7b8">Imports</a>
<ul>
<li><a href="#orgdc2845c">Python</a></li>
<li><a href="#org2eb3f1a">PyPi</a></li>
<li><a href="#org8784dfc">Graeae</a></li>
</ul>
</li>
<li><a href="#orgfc64440">Set Up</a>
<ul>
<li><a href="#org9100c53">The Environment</a></li>
<li><a href="#org48ec7e4">The Timer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdf1e951">Middle</a>
<ul>
<li><a href="#orgc06778b">The DataSet</a></li>
<li><a href="#org59feabc">The Tokenizer</a>
<ul>
<li><a href="#orgec2c5e5">Convert the Texts To Sequences</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org1d2acbd">End</a>
<ul>
<li><a href="#orgb8b5711">Sources</a>
<ul>
<li><a href="#org4dae482">The Original Dataset</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org9d58703">
<h2 id="org9d58703">Beginning</h2>
<div class="outline-text-2" id="text-org9d58703">
<p>This is an initial look at cleaning up <a href="http://mlg.ucd.ie/datasets/bbc.html">a text dataset</a> from the BBC News archives. Although the exercise sites this as the source the dataset provided doesn't look like the actual raw dataset which is broken up into folders that classify the contents and each news item is in a separate file. Instead we're starting with a <a href="https://storage.googleapis.com/laurencemoroney-blog.appspot.com/bbc-text.csv">partially pre-processed</a> CSV that has been lower-cased and the classification is given as the first column in the dataset.</p>
</div>
<div class="outline-3" id="outline-container-org899b7b8">
<h3 id="org899b7b8">Imports</h3>
<div class="outline-text-3" id="text-org899b7b8"></div>
<div class="outline-4" id="outline-container-orgdc2845c">
<h4 id="orgdc2845c">Python</h4>
<div class="outline-text-4" id="text-orgdc2845c">
<div class="highlight">
<pre><span></span>from pathlib import Path
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org2eb3f1a">
<h4 id="org2eb3f1a">PyPi</h4>
<div class="outline-text-4" id="text-org2eb3f1a">
<div class="highlight">
<pre><span></span>from nltk.corpus import stopwords
from sklearn.feature_extraction.text import CountVectorizer
from tensorflow.keras.preprocessing.text import Tokenizer
from tensorflow.keras.preprocessing.sequence import pad_sequences
import pandas
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org8784dfc">
<h4 id="org8784dfc">Graeae</h4>
<div class="outline-text-4" id="text-org8784dfc">
<div class="highlight">
<pre><span></span>from graeae import SubPathLoader, Timer
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgfc64440">
<h3 id="orgfc64440">Set Up</h3>
<div class="outline-text-3" id="text-orgfc64440"></div>
<div class="outline-4" id="outline-container-org9100c53">
<h4 id="org9100c53">The Environment</h4>
<div class="outline-text-4" id="text-org9100c53">
<div class="highlight">
<pre><span></span>ENVIRONMENT = SubPathLoader("DATASETS")
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org48ec7e4">
<h4 id="org48ec7e4">The Timer</h4>
<div class="outline-text-4" id="text-org48ec7e4">
<div class="highlight">
<pre><span></span>TIMER = Timer()
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgdf1e951">
<h2 id="orgdf1e951">Middle</h2>
<div class="outline-text-2" id="text-orgdf1e951"></div>
<div class="outline-3" id="outline-container-orgc06778b">
<h3 id="orgc06778b">The DataSet</h3>
<div class="outline-text-3" id="text-orgc06778b">
<div class="highlight">
<pre><span></span>bbc_path = Path(ENVIRONMENT["BBC_NEWS"]).expanduser()
with TIMER:
    data = pandas.read_csv(bbc_path/"bbc-text.csv")
</pre></div>
<pre class="example">
2019-08-25 18:51:38,411 graeae.timers.timer start: Started: 2019-08-25 18:51:38.411196
2019-08-25 18:51:38,658 graeae.timers.timer end: Ended: 2019-08-25 18:51:38.658181
2019-08-25 18:51:38,658 graeae.timers.timer end: Elapsed: 0:00:00.246985
</pre>
<div class="highlight">
<pre><span></span>print(data.shape)
</pre></div>
<pre class="example">
(2225, 2)
</pre>
<div class="highlight">
<pre><span></span>print(data.sample().iloc[0])
</pre></div>
<pre class="example">
category                                                sport
text        bell set for england debut bath prop duncan be...
Name: 2134, dtype: object
</pre>
<p>So we have two columns - <code>category</code> and <code>text</code>, text being the one we have to clean up.</p>
<div class="highlight">
<pre><span></span>print(data.text.dtype)
</pre></div>
<pre class="example">
object
</pre>
<p>That's not such an informative answer, but I checked and each row of text is a single string.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org59feabc">
<h3 id="org59feabc">The Tokenizer</h3>
<div class="outline-text-3" id="text-org59feabc">
<p>The <a href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/text/Tokenizer">Keras Tokenizer</a> tokenizes the text for us as well as removing the punctuation, lower-casing the text, and some other things. We're also going to use a Out-of-Vocabulary token of "&lt;OOV&gt;" to identify words that are outside of the vocabulary when converting new texts to sequences.</p>
<div class="highlight">
<pre><span></span>tokenizer = Tokenizer(oov_token="&lt;OOV&gt;", num_words=100)
tokenizer.fit_on_texts(data.text)
word_index = tokenizer.word_index
print(len(word_index))
</pre></div>
<pre class="example">
29727
</pre>
<p>The word-index is a dict that maps words found in the documents to counts.</p>
</div>
<div class="outline-4" id="outline-container-orgec2c5e5">
<h4 id="orgec2c5e5">Convert the Texts To Sequences</h4>
<div class="outline-text-4" id="text-orgec2c5e5">
<p>We're going to convert each of our texts to a sequence of numbers representing the words in them (one-hot-encoding). The <code>pad_sequences</code> function adds zeros to the end of sequences that are shorter than the longest one so that they are all the same size.</p>
<div class="highlight">
<pre><span></span>sequences = tokenizer.texts_to_sequences(data.text)
padded = pad_sequences(sequences, padding="post")
print(padded[0])
print(padded.shape)
</pre></div>
<pre class="example">
[1 1 7 ... 0 0 0]
(2225, 4491)
</pre>
<p>Strangely there doesn't appear to be a good way to use stopwords. Maybe sklearn is more appropriate here.</p>
<div class="highlight">
<pre><span></span>vectorizer = CountVectorizer(stop_words=stopwords.words("english"),
                             lowercase=True, min_df=3,
                             max_df=0.9, max_features=5000)
vectors = vectorizer.fit_transform(data.text)
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1d2acbd">
<h2 id="org1d2acbd">End</h2>
<div class="outline-text-2" id="text-org1d2acbd"></div>
<div class="outline-3" id="outline-container-orgb8b5711">
<h3 id="orgb8b5711">Sources</h3>
<div class="outline-text-3" id="text-orgb8b5711"></div>
<div class="outline-4" id="outline-container-org4dae482">
<h4 id="org4dae482">The Original Dataset</h4>
<div class="outline-text-4" id="text-org4dae482">
<ul class="org-ul">
<li>D. Greene and P. Cunningham. "Practical Solutions to the Problem of Diagonal Dominance in Kernel Document Clustering", Proc. ICML 2006. [PDF] [BibTeX].</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/cleaning/" rel="tag">cleaning</a></li>
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../sign-language-exercise/" rel="prev" title="Sign Language Exercise">Previous post</a></li>
<li class="next"><a href="../bbc-news-classification/" rel="next" title="BBC News Classification">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer"><a href="http://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
