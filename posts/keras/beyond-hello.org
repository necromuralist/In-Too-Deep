#+BEGIN_COMMENT
.. title: Beyond Hello
.. slug: beyond-hello
.. date: 2019-06-27 11:52:14 UTC-07:00
.. tags: keras,deep learning
.. category: Keras
.. link: 
.. description: A follow-up to the Keras "hello world".
.. type: text

#+END_COMMENT
#+OPTIONS: ^:{}
#+TOC: headlines 2
#+BEGIN_SRC ipython :session hello :results none :exports none
%load_ext autoreload
%autoreload 2
#+END_SRC
* Beginning
  This is going to use [[https://keras.io/][Keras]] (and [[https://www.tensorflow.org/][tensorflow]]) to learn to categorize images in the [[https://research.zalando.com/welcome/mission/research-projects/fashion-mnist/][Fashion MNIST]] dataset.
** Imports
*** Python
#+begin_src ipython :session hello :results none
from argparse import Namespace
from functools import partial

import random
#+end_src
*** PyPi
#+begin_src ipython :session hello :results none
from tabulate import tabulate
import holoviews
import pandas
import tensorflow
#+end_src
*** My Stuff
#+begin_src ipython :session hello :results none
from graeae.visualization.embed import EmbedHoloview
from graeae.timers import Timer
#+end_src
** The Timer
#+begin_src ipython :session hello :results none
TIMER = Timer()
#+end_src
** The Plotting
#+begin_src ipython :session hello :results none
Embed = partial(EmbedHoloview, folder_path="../../files/posts/keras/beyond-hello/")
Plot = Namespace(
    height=1000,
    width=800,
)
holoviews.extension("bokeh")
#+end_src
** The Data Set
   Keras includes the Fashion MNIST dataset and can be retrieved using the [[https://keras.io/datasets/#fashion-mnist-database-of-fashion-articles][datasets.fashion_mnist]] property.
#+begin_src ipython :session hello :results none
(training_images, training_labels), (testing_images, testing_labels) = tensorflow.keras.datasets.fashion_mnist.load_data()
#+end_src

Unfortunately the function doesn't let you pass in the path to where you're going to store the files (it's stored in =~/.keras/datasets/fashion-mnist/=).

* Middle
** Looking at the Dataset
*** The Labels
    There are 10 categories of images encoded as integers in the label sets. The keras site lists them as these:

    | Label | Description |
    |-------+-------------|
    |     0 | T-shirt/top |
    |     1 | Trouser     |
    |     2 | Pullover    |
    |     3 | Dress       |
    |     4 | Coat        |
    |     5 | Sandal      |
    |     6 | Shirt       |
    |     7 | Sneaker     |
    |     8 | Bag         |
    |     9 | Ankle Boot  |

#+begin_src ipython :session hello :results none
labels = {
    0: "T-shirt/top",
    1: "Trouser",
    2: "Pullover",
    3: "Dress",
    4: "Coat",
    5: "Sandal",
    6: "Shirt",
    7 : "Sneaker",
    8: "Bag",
    9 : "Ankle Boot"
    }
#+end_src
*** The Number of images
#+begin_src ipython :session hello :results output :exports both
print(type(training_images))
rows, width, height = training_images.shape
print(f"Rows: {rows:,} Image: {width} x {height}")
rows, width, height = testing_images.shape
print(f"Rows: {rows:,} Image: {width} x {height}")
#+end_src

#+RESULTS:
: <class 'numpy.ndarray'>
: Rows: 60,000 Image: 28 x 28
: Rows: 10,000 Image: 28 x 28

So we have 60,000 grayscale 28 by 28 pixel images to use for training and 10,000 grayscale 28 by 28 pixel images to use for testing.

*** A Sample Image
#+begin_src ipython :session hello :results output raw :exports both
index = random.randrange(len(training_images))
image = training_images[index]
plot = holoviews.Image(
    image,
).opts(
    tools=["hover"],
    title=f"Label {y_train[index]} ({labels[y_train[index]]})"
    )
Embed(plot=plot, file_name="sample_image")()
#+end_src

#+RESULTS:
#+begin_export html
<object type="text/html" data="sample_image.html" style="width:100%" height=800>
  <p>Figure Missing</p>
</object>
#+end_export

Although it looks like it's a color image that's because holoviews adds artificial coloring to it.

*** Normalizing the Data
   The pixel values are from 0 (black) to 255 (white) so we need to normalize them to values from 0 to 1 to work with a neural network.

#+begin_src ipython :session hello :results output :exports both
print(f"Minimum value: {training_images.min()} Maximum Value: {training_images.max()}")
training_images_normalized = training_images / 255.0
testing_images_normalized = testing_images / 255.0
print(f"Minimum value: {training_images_normalized.min()} Maximum Value: {training_images_normalized.max()}")
#+end_src

#+RESULTS:
: Minimum value: 0 Maximum Value: 255
: Minimum value: 0.0 Maximum Value: 1.0
** The Example
   This is a worked example given in the original notebook.
*** Define the Model
    Once again the network will be a [[https://www.tensorflow.org/api_docs/python/tf/keras/Sequential][Sequential]] one - a linear stack of layers, and there will be three layers, a [[https://www.tensorflow.org/api_docs/python/tf/layers/Flatten][Flatten]] layer to flatten our image into a vector with 784 cells (instead of a 28 x 28 matrix), followed by two [[https://www.tensorflow.org/api_docs/python/tf/layers/Dense][Dense]], or fully-connected, layers.

 Each of the Dense layers will get an activation function, the first gets a [[https://www.tensorflow.org/api_docs/python/tf/nn/relu][ReLU]] ([[https://www.wikiwand.com/en/Rectifier_(neural_networks)][Rectified Linear Unit]]) which makes it non-linear (by returning the input only if greater than 0, otherwise it returns 0), and the second gets a [[https://www.tensorflow.org/api_docs/python/tf/nn/softmax][SoftMax]] to find the biggest value (and thus our most likely label for the input).

 #+begin_src ipython :session hello :results none
model = tensorflow.keras.models.Sequential()
model.add(tensorflow.keras.layers.Flatten())
model.add(tensorflow.keras.layers.Dense(128, activation=tensorflow.nn.relu))
model.add(tensorflow.keras.layers.Dense(10, activation=tensorflow.nn.softmax))
 #+end_src

There are 10 labels to predict so the last layer has 10 neurons.
*** Compile the Model
    This time we're going to compile the model using the [[https://www.tensorflow.org/api_docs/python/tf/train/AdamOptimizer][Adam Optimizer]]. Confusingly, there's two of them in TensorFlow, the "regular" one, and a [[https://www.tensorflow.org/api_docs/python/tf/keras/optimizers/Adam][Keras]] version. We'll use the non-keras version. The loss, however, is the [[https://www.tensorflow.org/api_docs/python/tf/keras/losses/SparseCategoricalCrossentropy][Keras version]] as is the [[https://www.tensorflow.org/api_docs/python/tf/keras/metrics/Accuracy][accuracy]], which is just the number correct divided by the total count.

 #+begin_src ipython :session hello :results none
model.compile(optimizer = tensorflow.train.AdamOptimizer(),
              loss = 'sparse_categorical_crossentropy',
              metrics=['accuracy'])
 #+end_src

 And now we fit it
 #+begin_src ipython :session hello :results output :exports both
model.fit(training_images_normalized, training_labels, epochs=5)
 #+end_src

 #+RESULTS:
 #+begin_example
Epoch 1/5
   32/60000 [..............................] - ETA: 2:05 - loss: 2.5485 - acc: 0.0000e+00  832/60000 [..............................] - ETA: 8s - loss: 1.4661 - acc: 0.5192       1600/60000 [..............................] - ETA: 6s - loss: 1.1724 - acc: 0.6087 2368/60000 [>.............................] - ETA: 5s - loss: 1.0205 - acc: 0.6588 2976/60000 [>.............................] - ETA: 5s - loss: 0.9481 - acc: 0.6808 3616/60000 [>.............................] - ETA: 5s - loss: 0.8927 - acc: 0.6980 4256/60000 [=>............................] - ETA: 4s - loss: 0.8450 - acc: 0.7115 4928/60000 [=>............................] - ETA: 4s - loss: 0.8104 - acc: 0.7226 5632/60000 [=>............................] - ETA: 4s - loss: 0.7917 - acc: 0.7276 6496/60000 [==>...........................] - ETA: 4s - loss: 0.7677 - acc: 0.7375 7360/60000 [==>...........................] - ETA: 4s - loss: 0.7397 - acc: 0.7473 8192/60000 [===>..........................] - ETA: 4s - loss: 0.7216 - acc: 0.7543 9184/60000 [===>..........................] - ETA: 3s - loss: 0.7026 - acc: 0.7588 9920/60000 [===>..........................] - ETA: 3s - loss: 0.6979 - acc: 0.760510592/60000 [====>.........................] - ETA: 3s - loss: 0.6869 - acc: 0.763311232/60000 [====>.........................] - ETA: 3s - loss: 0.6742 - acc: 0.767911904/60000 [====>.........................] - ETA: 3s - loss: 0.6666 - acc: 0.770612544/60000 [=====>........................] - ETA: 3s - loss: 0.6651 - acc: 0.771113184/60000 [=====>........................] - ETA: 3s - loss: 0.6574 - acc: 0.774013824/60000 [=====>........................] - ETA: 3s - loss: 0.6498 - acc: 0.776314400/60000 [======>.......................] - ETA: 3s - loss: 0.6437 - acc: 0.778415040/60000 [======>.......................] - ETA: 3s - loss: 0.6397 - acc: 0.779415616/60000 [======>.......................] - ETA: 3s - loss: 0.6352 - acc: 0.781516288/60000 [=======>......................] - ETA: 3s - loss: 0.6308 - acc: 0.782916928/60000 [=======>......................] - ETA: 3s - loss: 0.6250 - acc: 0.784717568/60000 [=======>......................] - ETA: 3s - loss: 0.6193 - acc: 0.786418336/60000 [========>.....................] - ETA: 3s - loss: 0.6144 - acc: 0.787619104/60000 [========>.....................] - ETA: 3s - loss: 0.6091 - acc: 0.789619744/60000 [========>.....................] - ETA: 3s - loss: 0.6041 - acc: 0.791420384/60000 [=========>....................] - ETA: 3s - loss: 0.6022 - acc: 0.792020992/60000 [=========>....................] - ETA: 2s - loss: 0.5984 - acc: 0.793221632/60000 [=========>....................] - ETA: 2s - loss: 0.5966 - acc: 0.794022272/60000 [==========>...................] - ETA: 2s - loss: 0.5949 - acc: 0.794823008/60000 [==========>...................] - ETA: 2s - loss: 0.5900 - acc: 0.796523648/60000 [==========>...................] - ETA: 2s - loss: 0.5869 - acc: 0.797024256/60000 [===========>..................] - ETA: 2s - loss: 0.5841 - acc: 0.798024864/60000 [===========>..................] - ETA: 2s - loss: 0.5830 - acc: 0.798125440/60000 [===========>..................] - ETA: 2s - loss: 0.5808 - acc: 0.798726080/60000 [============>.................] - ETA: 2s - loss: 0.5785 - acc: 0.799826752/60000 [============>.................] - ETA: 2s - loss: 0.5734 - acc: 0.801527328/60000 [============>.................] - ETA: 2s - loss: 0.5711 - acc: 0.801927936/60000 [============>.................] - ETA: 2s - loss: 0.5691 - acc: 0.802528576/60000 [=============>................] - ETA: 2s - loss: 0.5675 - acc: 0.802929216/60000 [=============>................] - ETA: 2s - loss: 0.5657 - acc: 0.803029792/60000 [=============>................] - ETA: 2s - loss: 0.5638 - acc: 0.803930432/60000 [==============>...............] - ETA: 2s - loss: 0.5611 - acc: 0.804931072/60000 [==============>...............] - ETA: 2s - loss: 0.5586 - acc: 0.806131712/60000 [==============>...............] - ETA: 2s - loss: 0.5575 - acc: 0.806932320/60000 [===============>..............] - ETA: 2s - loss: 0.5544 - acc: 0.808032960/60000 [===============>..............] - ETA: 2s - loss: 0.5526 - acc: 0.808833440/60000 [===============>..............] - ETA: 2s - loss: 0.5515 - acc: 0.809034080/60000 [================>.............] - ETA: 2s - loss: 0.5502 - acc: 0.808934880/60000 [================>.............] - ETA: 1s - loss: 0.5477 - acc: 0.810135712/60000 [================>.............] - ETA: 1s - loss: 0.5456 - acc: 0.811036640/60000 [=================>............] - ETA: 1s - loss: 0.5443 - acc: 0.811337472/60000 [=================>............] - ETA: 1s - loss: 0.5418 - acc: 0.811938176/60000 [==================>...........] - ETA: 1s - loss: 0.5415 - acc: 0.812038688/60000 [==================>...........] - ETA: 1s - loss: 0.5398 - acc: 0.812439264/60000 [==================>...........] - ETA: 1s - loss: 0.5394 - acc: 0.812439808/60000 [==================>...........] - ETA: 1s - loss: 0.5383 - acc: 0.812940384/60000 [===================>..........] - ETA: 1s - loss: 0.5361 - acc: 0.813440960/60000 [===================>..........] - ETA: 1s - loss: 0.5346 - acc: 0.814041728/60000 [===================>..........] - ETA: 1s - loss: 0.5333 - acc: 0.814342464/60000 [====================>.........] - ETA: 1s - loss: 0.5310 - acc: 0.815143040/60000 [====================>.........] - ETA: 1s - loss: 0.5295 - acc: 0.815643616/60000 [====================>.........] - ETA: 1s - loss: 0.5279 - acc: 0.816044256/60000 [=====================>........] - ETA: 1s - loss: 0.5266 - acc: 0.816344832/60000 [=====================>........] - ETA: 1s - loss: 0.5257 - acc: 0.816245472/60000 [=====================>........] - ETA: 1s - loss: 0.5244 - acc: 0.816746112/60000 [======================>.......] - ETA: 1s - loss: 0.5228 - acc: 0.817346624/60000 [======================>.......] - ETA: 1s - loss: 0.5219 - acc: 0.817547200/60000 [======================>.......] - ETA: 1s - loss: 0.5208 - acc: 0.818047840/60000 [======================>.......] - ETA: 0s - loss: 0.5197 - acc: 0.818548480/60000 [=======================>......] - ETA: 0s - loss: 0.5182 - acc: 0.819149056/60000 [=======================>......] - ETA: 0s - loss: 0.5174 - acc: 0.819449632/60000 [=======================>......] - ETA: 0s - loss: 0.5168 - acc: 0.819550432/60000 [========================>.....] - ETA: 0s - loss: 0.5143 - acc: 0.820451040/60000 [========================>.....] - ETA: 0s - loss: 0.5136 - acc: 0.820751776/60000 [========================>.....] - ETA: 0s - loss: 0.5131 - acc: 0.820952480/60000 [=========================>....] - ETA: 0s - loss: 0.5126 - acc: 0.821053248/60000 [=========================>....] - ETA: 0s - loss: 0.5110 - acc: 0.821653888/60000 [=========================>....] - ETA: 0s - loss: 0.5098 - acc: 0.821954496/60000 [==========================>...] - ETA: 0s - loss: 0.5089 - acc: 0.822155104/60000 [==========================>...] - ETA: 0s - loss: 0.5078 - acc: 0.822555744/60000 [==========================>...] - ETA: 0s - loss: 0.5072 - acc: 0.822756384/60000 [===========================>..] - ETA: 0s - loss: 0.5062 - acc: 0.823056960/60000 [===========================>..] - ETA: 0s - loss: 0.5056 - acc: 0.823057568/60000 [===========================>..] - ETA: 0s - loss: 0.5047 - acc: 0.823558144/60000 [============================>.] - ETA: 0s - loss: 0.5035 - acc: 0.823958752/60000 [============================>.] - ETA: 0s - loss: 0.5028 - acc: 0.824259296/60000 [============================>.] - ETA: 0s - loss: 0.5018 - acc: 0.824559872/60000 [============================>.] - ETA: 0s - loss: 0.5008 - acc: 0.824860000/60000 [==============================] - 5s 79us/sample - loss: 0.5006 - acc: 0.8249
Epoch 2/5
   32/60000 [..............................] - ETA: 9s - loss: 0.2213 - acc: 0.9062  768/60000 [..............................] - ETA: 4s - loss: 0.4124 - acc: 0.8685 1376/60000 [..............................] - ETA: 4s - loss: 0.3903 - acc: 0.8757 2016/60000 [>.............................] - ETA: 4s - loss: 0.3983 - acc: 0.8725 2912/60000 [>.............................] - ETA: 4s - loss: 0.3920 - acc: 0.8692 3808/60000 [>.............................] - ETA: 3s - loss: 0.3926 - acc: 0.8650 4576/60000 [=>............................] - ETA: 3s - loss: 0.3995 - acc: 0.8632 5472/60000 [=>............................] - ETA: 3s - loss: 0.3969 - acc: 0.8607 6176/60000 [==>...........................] - ETA: 3s - loss: 0.3937 - acc: 0.8617 6848/60000 [==>...........................] - ETA: 3s - loss: 0.3967 - acc: 0.8605 7520/60000 [==>...........................] - ETA: 3s - loss: 0.4021 - acc: 0.8586 8064/60000 [===>..........................] - ETA: 3s - loss: 0.4016 - acc: 0.8586 8704/60000 [===>..........................] - ETA: 3s - loss: 0.3993 - acc: 0.8587 9504/60000 [===>..........................] - ETA: 3s - loss: 0.3953 - acc: 0.860510176/60000 [====>.........................] - ETA: 3s - loss: 0.3968 - acc: 0.858710976/60000 [====>.........................] - ETA: 3s - loss: 0.3944 - acc: 0.859111904/60000 [====>.........................] - ETA: 3s - loss: 0.3957 - acc: 0.858312736/60000 [=====>........................] - ETA: 3s - loss: 0.3948 - acc: 0.858713440/60000 [=====>........................] - ETA: 3s - loss: 0.3922 - acc: 0.859714080/60000 [======>.......................] - ETA: 3s - loss: 0.3907 - acc: 0.859914816/60000 [======>.......................] - ETA: 3s - loss: 0.3908 - acc: 0.859415584/60000 [======>.......................] - ETA: 3s - loss: 0.3896 - acc: 0.859616480/60000 [=======>......................] - ETA: 2s - loss: 0.3865 - acc: 0.860617280/60000 [=======>......................] - ETA: 2s - loss: 0.3847 - acc: 0.860418080/60000 [========>.....................] - ETA: 2s - loss: 0.3828 - acc: 0.861418880/60000 [========>.....................] - ETA: 2s - loss: 0.3824 - acc: 0.861119680/60000 [========>.....................] - ETA: 2s - loss: 0.3834 - acc: 0.860420480/60000 [=========>....................] - ETA: 2s - loss: 0.3844 - acc: 0.860121248/60000 [=========>....................] - ETA: 2s - loss: 0.3845 - acc: 0.860221984/60000 [=========>....................] - ETA: 2s - loss: 0.3844 - acc: 0.860422720/60000 [==========>...................] - ETA: 2s - loss: 0.3859 - acc: 0.859623424/60000 [==========>...................] - ETA: 2s - loss: 0.3859 - acc: 0.859224064/60000 [===========>..................] - ETA: 2s - loss: 0.3862 - acc: 0.859324736/60000 [===========>..................] - ETA: 2s - loss: 0.3864 - acc: 0.859025376/60000 [===========>..................] - ETA: 2s - loss: 0.3860 - acc: 0.859225888/60000 [===========>..................] - ETA: 2s - loss: 0.3860 - acc: 0.859226496/60000 [============>.................] - ETA: 2s - loss: 0.3855 - acc: 0.859727072/60000 [============>.................] - ETA: 2s - loss: 0.3858 - acc: 0.859627744/60000 [============>.................] - ETA: 2s - loss: 0.3860 - acc: 0.859628320/60000 [=============>................] - ETA: 2s - loss: 0.3856 - acc: 0.860028864/60000 [=============>................] - ETA: 2s - loss: 0.3849 - acc: 0.860329440/60000 [=============>................] - ETA: 2s - loss: 0.3841 - acc: 0.860530016/60000 [==============>...............] - ETA: 2s - loss: 0.3840 - acc: 0.860730656/60000 [==============>...............] - ETA: 2s - loss: 0.3847 - acc: 0.860231264/60000 [==============>...............] - ETA: 2s - loss: 0.3849 - acc: 0.860331936/60000 [==============>...............] - ETA: 2s - loss: 0.3850 - acc: 0.860432576/60000 [===============>..............] - ETA: 1s - loss: 0.3856 - acc: 0.860433312/60000 [===============>..............] - ETA: 1s - loss: 0.3858 - acc: 0.860434080/60000 [================>.............] - ETA: 1s - loss: 0.3857 - acc: 0.860534944/60000 [================>.............] - ETA: 1s - loss: 0.3852 - acc: 0.860835840/60000 [================>.............] - ETA: 1s - loss: 0.3840 - acc: 0.861336608/60000 [=================>............] - ETA: 1s - loss: 0.3829 - acc: 0.861937312/60000 [=================>............] - ETA: 1s - loss: 0.3834 - acc: 0.861838080/60000 [==================>...........] - ETA: 1s - loss: 0.3827 - acc: 0.862138720/60000 [==================>...........] - ETA: 1s - loss: 0.3826 - acc: 0.862339328/60000 [==================>...........] - ETA: 1s - loss: 0.3821 - acc: 0.862639936/60000 [==================>...........] - ETA: 1s - loss: 0.3824 - acc: 0.862440576/60000 [===================>..........] - ETA: 1s - loss: 0.3829 - acc: 0.862441184/60000 [===================>..........] - ETA: 1s - loss: 0.3827 - acc: 0.862441696/60000 [===================>..........] - ETA: 1s - loss: 0.3823 - acc: 0.862642272/60000 [====================>.........] - ETA: 1s - loss: 0.3816 - acc: 0.862942848/60000 [====================>.........] - ETA: 1s - loss: 0.3813 - acc: 0.862843296/60000 [====================>.........] - ETA: 1s - loss: 0.3813 - acc: 0.862843872/60000 [====================>.........] - ETA: 1s - loss: 0.3819 - acc: 0.862444480/60000 [=====================>........] - ETA: 1s - loss: 0.3825 - acc: 0.862245120/60000 [=====================>........] - ETA: 1s - loss: 0.3820 - acc: 0.862345760/60000 [=====================>........] - ETA: 1s - loss: 0.3814 - acc: 0.862546368/60000 [======================>.......] - ETA: 1s - loss: 0.3814 - acc: 0.862447040/60000 [======================>.......] - ETA: 0s - loss: 0.3823 - acc: 0.862147680/60000 [======================>.......] - ETA: 0s - loss: 0.3833 - acc: 0.861948320/60000 [=======================>......] - ETA: 0s - loss: 0.3824 - acc: 0.862248960/60000 [=======================>......] - ETA: 0s - loss: 0.3814 - acc: 0.862549536/60000 [=======================>......] - ETA: 0s - loss: 0.3821 - acc: 0.862250240/60000 [========================>.....] - ETA: 0s - loss: 0.3817 - acc: 0.862350848/60000 [========================>.....] - ETA: 0s - loss: 0.3811 - acc: 0.862451520/60000 [========================>.....] - ETA: 0s - loss: 0.3802 - acc: 0.862652128/60000 [=========================>....] - ETA: 0s - loss: 0.3802 - acc: 0.862652832/60000 [=========================>....] - ETA: 0s - loss: 0.3795 - acc: 0.862853472/60000 [=========================>....] - ETA: 0s - loss: 0.3798 - acc: 0.862854144/60000 [==========================>...] - ETA: 0s - loss: 0.3799 - acc: 0.862854688/60000 [==========================>...] - ETA: 0s - loss: 0.3802 - acc: 0.862855232/60000 [==========================>...] - ETA: 0s - loss: 0.3796 - acc: 0.863255808/60000 [==========================>...] - ETA: 0s - loss: 0.3794 - acc: 0.863456288/60000 [===========================>..] - ETA: 0s - loss: 0.3791 - acc: 0.863556864/60000 [===========================>..] - ETA: 0s - loss: 0.3790 - acc: 0.863557472/60000 [===========================>..] - ETA: 0s - loss: 0.3793 - acc: 0.863558048/60000 [============================>.] - ETA: 0s - loss: 0.3792 - acc: 0.863558624/60000 [============================>.] - ETA: 0s - loss: 0.3790 - acc: 0.863759200/60000 [============================>.] - ETA: 0s - loss: 0.3788 - acc: 0.863759840/60000 [============================>.] - ETA: 0s - loss: 0.3786 - acc: 0.863760000/60000 [==============================] - 5s 77us/sample - loss: 0.3785 - acc: 0.8638
Epoch 3/5
   32/60000 [..............................] - ETA: 9s - loss: 0.4539 - acc: 0.7812  960/60000 [..............................] - ETA: 3s - loss: 0.3339 - acc: 0.8792 1824/60000 [..............................] - ETA: 3s - loss: 0.3455 - acc: 0.8739 2688/60000 [>.............................] - ETA: 3s - loss: 0.3403 - acc: 0.8728 3584/60000 [>.............................] - ETA: 3s - loss: 0.3392 - acc: 0.8736 4224/60000 [=>............................] - ETA: 3s - loss: 0.3411 - acc: 0.8731 4896/60000 [=>............................] - ETA: 3s - loss: 0.3485 - acc: 0.8713 5472/60000 [=>............................] - ETA: 3s - loss: 0.3518 - acc: 0.8704 6080/60000 [==>...........................] - ETA: 3s - loss: 0.3538 - acc: 0.8706 6688/60000 [==>...........................] - ETA: 3s - loss: 0.3521 - acc: 0.8728 7392/60000 [==>...........................] - ETA: 3s - loss: 0.3505 - acc: 0.8730 7936/60000 [==>...........................] - ETA: 3s - loss: 0.3470 - acc: 0.8735 8416/60000 [===>..........................] - ETA: 3s - loss: 0.3443 - acc: 0.8743 9056/60000 [===>..........................] - ETA: 3s - loss: 0.3427 - acc: 0.8739 9664/60000 [===>..........................] - ETA: 3s - loss: 0.3426 - acc: 0.873110240/60000 [====>.........................] - ETA: 3s - loss: 0.3440 - acc: 0.873010816/60000 [====>.........................] - ETA: 3s - loss: 0.3438 - acc: 0.873011392/60000 [====>.........................] - ETA: 3s - loss: 0.3437 - acc: 0.873112032/60000 [=====>........................] - ETA: 3s - loss: 0.3390 - acc: 0.874912608/60000 [=====>........................] - ETA: 3s - loss: 0.3370 - acc: 0.875613184/60000 [=====>........................] - ETA: 3s - loss: 0.3364 - acc: 0.875813760/60000 [=====>........................] - ETA: 3s - loss: 0.3373 - acc: 0.875414432/60000 [======>.......................] - ETA: 3s - loss: 0.3372 - acc: 0.875615040/60000 [======>.......................] - ETA: 3s - loss: 0.3350 - acc: 0.876515584/60000 [======>.......................] - ETA: 3s - loss: 0.3358 - acc: 0.876416288/60000 [=======>......................] - ETA: 3s - loss: 0.3370 - acc: 0.875917024/60000 [=======>......................] - ETA: 3s - loss: 0.3367 - acc: 0.876217760/60000 [=======>......................] - ETA: 3s - loss: 0.3365 - acc: 0.876318528/60000 [========>.....................] - ETA: 3s - loss: 0.3358 - acc: 0.876119392/60000 [========>.....................] - ETA: 3s - loss: 0.3370 - acc: 0.876020256/60000 [=========>....................] - ETA: 3s - loss: 0.3368 - acc: 0.876120992/60000 [=========>....................] - ETA: 2s - loss: 0.3376 - acc: 0.875821696/60000 [=========>....................] - ETA: 2s - loss: 0.3364 - acc: 0.876122272/60000 [==========>...................] - ETA: 2s - loss: 0.3379 - acc: 0.875822816/60000 [==========>...................] - ETA: 2s - loss: 0.3385 - acc: 0.875423360/60000 [==========>...................] - ETA: 2s - loss: 0.3378 - acc: 0.875323968/60000 [==========>...................] - ETA: 2s - loss: 0.3382 - acc: 0.875324480/60000 [===========>..................] - ETA: 2s - loss: 0.3377 - acc: 0.875425056/60000 [===========>..................] - ETA: 2s - loss: 0.3380 - acc: 0.875125664/60000 [===========>..................] - ETA: 2s - loss: 0.3395 - acc: 0.874626336/60000 [============>.................] - ETA: 2s - loss: 0.3397 - acc: 0.874627136/60000 [============>.................] - ETA: 2s - loss: 0.3402 - acc: 0.874227840/60000 [============>.................] - ETA: 2s - loss: 0.3408 - acc: 0.873928384/60000 [=============>................] - ETA: 2s - loss: 0.3393 - acc: 0.874529152/60000 [=============>................] - ETA: 2s - loss: 0.3390 - acc: 0.874730080/60000 [==============>...............] - ETA: 2s - loss: 0.3402 - acc: 0.874130848/60000 [==============>...............] - ETA: 2s - loss: 0.3395 - acc: 0.874431744/60000 [==============>...............] - ETA: 2s - loss: 0.3388 - acc: 0.874632288/60000 [===============>..............] - ETA: 2s - loss: 0.3390 - acc: 0.874732960/60000 [===============>..............] - ETA: 2s - loss: 0.3390 - acc: 0.874833600/60000 [===============>..............] - ETA: 2s - loss: 0.3386 - acc: 0.875034208/60000 [================>.............] - ETA: 1s - loss: 0.3396 - acc: 0.874734848/60000 [================>.............] - ETA: 1s - loss: 0.3407 - acc: 0.874335456/60000 [================>.............] - ETA: 1s - loss: 0.3418 - acc: 0.874236032/60000 [=================>............] - ETA: 1s - loss: 0.3413 - acc: 0.874436672/60000 [=================>............] - ETA: 1s - loss: 0.3416 - acc: 0.874637216/60000 [=================>............] - ETA: 1s - loss: 0.3419 - acc: 0.874537696/60000 [=================>............] - ETA: 1s - loss: 0.3412 - acc: 0.874838336/60000 [==================>...........] - ETA: 1s - loss: 0.3416 - acc: 0.874838912/60000 [==================>...........] - ETA: 1s - loss: 0.3411 - acc: 0.875039552/60000 [==================>...........] - ETA: 1s - loss: 0.3418 - acc: 0.874840096/60000 [===================>..........] - ETA: 1s - loss: 0.3415 - acc: 0.874840704/60000 [===================>..........] - ETA: 1s - loss: 0.3416 - acc: 0.874941344/60000 [===================>..........] - ETA: 1s - loss: 0.3425 - acc: 0.874741984/60000 [===================>..........] - ETA: 1s - loss: 0.3421 - acc: 0.874842592/60000 [====================>.........] - ETA: 1s - loss: 0.3419 - acc: 0.874843168/60000 [====================>.........] - ETA: 1s - loss: 0.3411 - acc: 0.875143744/60000 [====================>.........] - ETA: 1s - loss: 0.3403 - acc: 0.875644352/60000 [=====================>........] - ETA: 1s - loss: 0.3403 - acc: 0.875644960/60000 [=====================>........] - ETA: 1s - loss: 0.3396 - acc: 0.875945568/60000 [=====================>........] - ETA: 1s - loss: 0.3399 - acc: 0.875646208/60000 [======================>.......] - ETA: 1s - loss: 0.3395 - acc: 0.875746880/60000 [======================>.......] - ETA: 1s - loss: 0.3398 - acc: 0.875647488/60000 [======================>.......] - ETA: 0s - loss: 0.3394 - acc: 0.875848096/60000 [=======================>......] - ETA: 0s - loss: 0.3394 - acc: 0.875648672/60000 [=======================>......] - ETA: 0s - loss: 0.3391 - acc: 0.875749280/60000 [=======================>......] - ETA: 0s - loss: 0.3390 - acc: 0.875849888/60000 [=======================>......] - ETA: 0s - loss: 0.3386 - acc: 0.875950528/60000 [========================>.....] - ETA: 0s - loss: 0.3394 - acc: 0.875751328/60000 [========================>.....] - ETA: 0s - loss: 0.3394 - acc: 0.875852096/60000 [=========================>....] - ETA: 0s - loss: 0.3398 - acc: 0.875752736/60000 [=========================>....] - ETA: 0s - loss: 0.3398 - acc: 0.875853344/60000 [=========================>....] - ETA: 0s - loss: 0.3397 - acc: 0.876053856/60000 [=========================>....] - ETA: 0s - loss: 0.3395 - acc: 0.876354432/60000 [==========================>...] - ETA: 0s - loss: 0.3392 - acc: 0.876655072/60000 [==========================>...] - ETA: 0s - loss: 0.3392 - acc: 0.876755680/60000 [==========================>...] - ETA: 0s - loss: 0.3396 - acc: 0.876756352/60000 [===========================>..] - ETA: 0s - loss: 0.3399 - acc: 0.876757184/60000 [===========================>..] - ETA: 0s - loss: 0.3399 - acc: 0.876757920/60000 [===========================>..] - ETA: 0s - loss: 0.3395 - acc: 0.877158720/60000 [============================>.] - ETA: 0s - loss: 0.3391 - acc: 0.877059520/60000 [============================>.] - ETA: 0s - loss: 0.3389 - acc: 0.877160000/60000 [==============================] - 5s 79us/sample - loss: 0.3392 - acc: 0.8769
Epoch 4/5
   32/60000 [..............................] - ETA: 9s - loss: 0.5298 - acc: 0.7812  768/60000 [..............................] - ETA: 4s - loss: 0.3346 - acc: 0.8737 1376/60000 [..............................] - ETA: 4s - loss: 0.3209 - acc: 0.8881 1952/60000 [..............................] - ETA: 4s - loss: 0.3313 - acc: 0.8842 2496/60000 [>.............................] - ETA: 4s - loss: 0.3206 - acc: 0.8842 3168/60000 [>.............................] - ETA: 4s - loss: 0.3262 - acc: 0.8801 3744/60000 [>.............................] - ETA: 4s - loss: 0.3207 - acc: 0.8827 4288/60000 [=>............................] - ETA: 4s - loss: 0.3231 - acc: 0.8820 4864/60000 [=>............................] - ETA: 4s - loss: 0.3223 - acc: 0.8824 5472/60000 [=>............................] - ETA: 4s - loss: 0.3225 - acc: 0.8818 6112/60000 [==>...........................] - ETA: 4s - loss: 0.3252 - acc: 0.8801 6752/60000 [==>...........................] - ETA: 4s - loss: 0.3294 - acc: 0.8790 7392/60000 [==>...........................] - ETA: 4s - loss: 0.3316 - acc: 0.8773 8000/60000 [===>..........................] - ETA: 4s - loss: 0.3322 - acc: 0.8770 8608/60000 [===>..........................] - ETA: 4s - loss: 0.3313 - acc: 0.8773 9216/60000 [===>..........................] - ETA: 4s - loss: 0.3280 - acc: 0.8785 9824/60000 [===>..........................] - ETA: 4s - loss: 0.3269 - acc: 0.879110432/60000 [====>.........................] - ETA: 4s - loss: 0.3265 - acc: 0.879211104/60000 [====>.........................] - ETA: 4s - loss: 0.3272 - acc: 0.878611776/60000 [====>.........................] - ETA: 4s - loss: 0.3245 - acc: 0.879112352/60000 [=====>........................] - ETA: 3s - loss: 0.3249 - acc: 0.879412992/60000 [=====>........................] - ETA: 3s - loss: 0.3225 - acc: 0.880513632/60000 [=====>........................] - ETA: 3s - loss: 0.3211 - acc: 0.881214240/60000 [======>.......................] - ETA: 3s - loss: 0.3219 - acc: 0.881314848/60000 [======>.......................] - ETA: 3s - loss: 0.3219 - acc: 0.881515456/60000 [======>.......................] - ETA: 3s - loss: 0.3192 - acc: 0.882716192/60000 [=======>......................] - ETA: 3s - loss: 0.3183 - acc: 0.883116992/60000 [=======>......................] - ETA: 3s - loss: 0.3171 - acc: 0.883217568/60000 [=======>......................] - ETA: 3s - loss: 0.3161 - acc: 0.883318304/60000 [========>.....................] - ETA: 3s - loss: 0.3157 - acc: 0.883518912/60000 [========>.....................] - ETA: 3s - loss: 0.3142 - acc: 0.884119520/60000 [========>.....................] - ETA: 3s - loss: 0.3144 - acc: 0.884520160/60000 [=========>....................] - ETA: 3s - loss: 0.3142 - acc: 0.884620768/60000 [=========>....................] - ETA: 3s - loss: 0.3148 - acc: 0.884721408/60000 [=========>....................] - ETA: 3s - loss: 0.3142 - acc: 0.884822016/60000 [==========>...................] - ETA: 3s - loss: 0.3124 - acc: 0.885322592/60000 [==========>...................] - ETA: 3s - loss: 0.3137 - acc: 0.884923264/60000 [==========>...................] - ETA: 3s - loss: 0.3123 - acc: 0.885023872/60000 [==========>...................] - ETA: 2s - loss: 0.3131 - acc: 0.885024640/60000 [===========>..................] - ETA: 2s - loss: 0.3133 - acc: 0.884925504/60000 [===========>..................] - ETA: 2s - loss: 0.3144 - acc: 0.884126336/60000 [============>.................] - ETA: 2s - loss: 0.3163 - acc: 0.883427104/60000 [============>.................] - ETA: 2s - loss: 0.3156 - acc: 0.883627712/60000 [============>.................] - ETA: 2s - loss: 0.3151 - acc: 0.883928320/60000 [=============>................] - ETA: 2s - loss: 0.3162 - acc: 0.883328960/60000 [=============>................] - ETA: 2s - loss: 0.3167 - acc: 0.882929600/60000 [=============>................] - ETA: 2s - loss: 0.3165 - acc: 0.883330048/60000 [==============>...............] - ETA: 2s - loss: 0.3170 - acc: 0.882930624/60000 [==============>...............] - ETA: 2s - loss: 0.3165 - acc: 0.882631232/60000 [==============>...............] - ETA: 2s - loss: 0.3168 - acc: 0.882731744/60000 [==============>...............] - ETA: 2s - loss: 0.3168 - acc: 0.882732320/60000 [===============>..............] - ETA: 2s - loss: 0.3165 - acc: 0.882932896/60000 [===============>..............] - ETA: 2s - loss: 0.3169 - acc: 0.882533504/60000 [===============>..............] - ETA: 2s - loss: 0.3173 - acc: 0.882634144/60000 [================>.............] - ETA: 2s - loss: 0.3174 - acc: 0.882834752/60000 [================>.............] - ETA: 2s - loss: 0.3181 - acc: 0.882835424/60000 [================>.............] - ETA: 1s - loss: 0.3186 - acc: 0.882736064/60000 [=================>............] - ETA: 1s - loss: 0.3191 - acc: 0.882836608/60000 [=================>............] - ETA: 1s - loss: 0.3186 - acc: 0.883237248/60000 [=================>............] - ETA: 1s - loss: 0.3173 - acc: 0.883837888/60000 [=================>............] - ETA: 1s - loss: 0.3174 - acc: 0.883438496/60000 [==================>...........] - ETA: 1s - loss: 0.3174 - acc: 0.883439104/60000 [==================>...........] - ETA: 1s - loss: 0.3172 - acc: 0.883639680/60000 [==================>...........] - ETA: 1s - loss: 0.3167 - acc: 0.883940320/60000 [===================>..........] - ETA: 1s - loss: 0.3168 - acc: 0.884141024/60000 [===================>..........] - ETA: 1s - loss: 0.3171 - acc: 0.883841888/60000 [===================>..........] - ETA: 1s - loss: 0.3163 - acc: 0.884242624/60000 [====================>.........] - ETA: 1s - loss: 0.3161 - acc: 0.884243296/60000 [====================>.........] - ETA: 1s - loss: 0.3164 - acc: 0.884143872/60000 [====================>.........] - ETA: 1s - loss: 0.3162 - acc: 0.884144448/60000 [=====================>........] - ETA: 1s - loss: 0.3158 - acc: 0.884245056/60000 [=====================>........] - ETA: 1s - loss: 0.3151 - acc: 0.884345696/60000 [=====================>........] - ETA: 1s - loss: 0.3149 - acc: 0.884546304/60000 [======================>.......] - ETA: 1s - loss: 0.3152 - acc: 0.884546848/60000 [======================>.......] - ETA: 1s - loss: 0.3156 - acc: 0.884547520/60000 [======================>.......] - ETA: 1s - loss: 0.3154 - acc: 0.884548160/60000 [=======================>......] - ETA: 0s - loss: 0.3153 - acc: 0.884648832/60000 [=======================>......] - ETA: 0s - loss: 0.3148 - acc: 0.884649440/60000 [=======================>......] - ETA: 0s - loss: 0.3156 - acc: 0.884450048/60000 [========================>.....] - ETA: 0s - loss: 0.3158 - acc: 0.884350624/60000 [========================>.....] - ETA: 0s - loss: 0.3151 - acc: 0.884651232/60000 [========================>.....] - ETA: 0s - loss: 0.3152 - acc: 0.884552064/60000 [=========================>....] - ETA: 0s - loss: 0.3154 - acc: 0.884752864/60000 [=========================>....] - ETA: 0s - loss: 0.3150 - acc: 0.884953728/60000 [=========================>....] - ETA: 0s - loss: 0.3160 - acc: 0.884554656/60000 [==========================>...] - ETA: 0s - loss: 0.3164 - acc: 0.884355360/60000 [==========================>...] - ETA: 0s - loss: 0.3162 - acc: 0.884455936/60000 [==========================>...] - ETA: 0s - loss: 0.3162 - acc: 0.884456480/60000 [===========================>..] - ETA: 0s - loss: 0.3159 - acc: 0.884657056/60000 [===========================>..] - ETA: 0s - loss: 0.3161 - acc: 0.884557696/60000 [===========================>..] - ETA: 0s - loss: 0.3161 - acc: 0.884658368/60000 [============================>.] - ETA: 0s - loss: 0.3164 - acc: 0.884658976/60000 [============================>.] - ETA: 0s - loss: 0.3160 - acc: 0.884859616/60000 [============================>.] - ETA: 0s - loss: 0.3165 - acc: 0.884560000/60000 [==============================] - 5s 80us/sample - loss: 0.3164 - acc: 0.8844
Epoch 5/5
   32/60000 [..............................] - ETA: 9s - loss: 0.5951 - acc: 0.7812  640/60000 [..............................] - ETA: 5s - loss: 0.2977 - acc: 0.8938 1248/60000 [..............................] - ETA: 5s - loss: 0.2805 - acc: 0.9006 1888/60000 [..............................] - ETA: 4s - loss: 0.2735 - acc: 0.8999 2528/60000 [>.............................] - ETA: 4s - loss: 0.2660 - acc: 0.9027 3136/60000 [>.............................] - ETA: 4s - loss: 0.2761 - acc: 0.8925 3776/60000 [>.............................] - ETA: 4s - loss: 0.2846 - acc: 0.8890 4352/60000 [=>............................] - ETA: 4s - loss: 0.2871 - acc: 0.8895 4992/60000 [=>............................] - ETA: 4s - loss: 0.2868 - acc: 0.8898 5632/60000 [=>............................] - ETA: 4s - loss: 0.2851 - acc: 0.8926 6304/60000 [==>...........................] - ETA: 4s - loss: 0.2893 - acc: 0.8904 7104/60000 [==>...........................] - ETA: 4s - loss: 0.2876 - acc: 0.8910 7776/60000 [==>...........................] - ETA: 4s - loss: 0.2932 - acc: 0.8885 8416/60000 [===>..........................] - ETA: 4s - loss: 0.2930 - acc: 0.8891 9056/60000 [===>..........................] - ETA: 4s - loss: 0.2949 - acc: 0.8887 9664/60000 [===>..........................] - ETA: 4s - loss: 0.2953 - acc: 0.889210272/60000 [====>.........................] - ETA: 4s - loss: 0.2957 - acc: 0.889310880/60000 [====>.........................] - ETA: 3s - loss: 0.2974 - acc: 0.888711520/60000 [====>.........................] - ETA: 3s - loss: 0.2973 - acc: 0.889212128/60000 [=====>........................] - ETA: 3s - loss: 0.2955 - acc: 0.890412736/60000 [=====>........................] - ETA: 3s - loss: 0.2937 - acc: 0.891213376/60000 [=====>........................] - ETA: 3s - loss: 0.2940 - acc: 0.891414048/60000 [======>.......................] - ETA: 3s - loss: 0.2952 - acc: 0.891014656/60000 [======>.......................] - ETA: 3s - loss: 0.2948 - acc: 0.890815328/60000 [======>.......................] - ETA: 3s - loss: 0.2939 - acc: 0.891015936/60000 [======>.......................] - ETA: 3s - loss: 0.2942 - acc: 0.890916576/60000 [=======>......................] - ETA: 3s - loss: 0.2942 - acc: 0.890917184/60000 [=======>......................] - ETA: 3s - loss: 0.2946 - acc: 0.890417824/60000 [=======>......................] - ETA: 3s - loss: 0.2941 - acc: 0.890518432/60000 [========>.....................] - ETA: 3s - loss: 0.2945 - acc: 0.890419104/60000 [========>.....................] - ETA: 3s - loss: 0.2974 - acc: 0.889319936/60000 [========>.....................] - ETA: 3s - loss: 0.2990 - acc: 0.888720896/60000 [=========>....................] - ETA: 3s - loss: 0.2982 - acc: 0.889221888/60000 [=========>....................] - ETA: 2s - loss: 0.2976 - acc: 0.889822784/60000 [==========>...................] - ETA: 2s - loss: 0.2963 - acc: 0.890623520/60000 [==========>...................] - ETA: 2s - loss: 0.2960 - acc: 0.890624224/60000 [===========>..................] - ETA: 2s - loss: 0.2965 - acc: 0.889824832/60000 [===========>..................] - ETA: 2s - loss: 0.2968 - acc: 0.889525472/60000 [===========>..................] - ETA: 2s - loss: 0.2968 - acc: 0.889426080/60000 [============>.................] - ETA: 2s - loss: 0.2967 - acc: 0.889626688/60000 [============>.................] - ETA: 2s - loss: 0.2974 - acc: 0.889327328/60000 [============>.................] - ETA: 2s - loss: 0.2973 - acc: 0.889327968/60000 [============>.................] - ETA: 2s - loss: 0.2978 - acc: 0.888628480/60000 [=============>................] - ETA: 2s - loss: 0.2978 - acc: 0.888729024/60000 [=============>................] - ETA: 2s - loss: 0.2979 - acc: 0.888729600/60000 [=============>................] - ETA: 2s - loss: 0.2983 - acc: 0.888530240/60000 [==============>...............] - ETA: 2s - loss: 0.2975 - acc: 0.889130848/60000 [==============>...............] - ETA: 2s - loss: 0.2969 - acc: 0.889231488/60000 [==============>...............] - ETA: 2s - loss: 0.2975 - acc: 0.889332192/60000 [===============>..............] - ETA: 2s - loss: 0.2975 - acc: 0.889333024/60000 [===============>..............] - ETA: 2s - loss: 0.2970 - acc: 0.889533728/60000 [===============>..............] - ETA: 2s - loss: 0.2966 - acc: 0.889734272/60000 [================>.............] - ETA: 2s - loss: 0.2969 - acc: 0.889534912/60000 [================>.............] - ETA: 1s - loss: 0.2971 - acc: 0.889535552/60000 [================>.............] - ETA: 1s - loss: 0.2980 - acc: 0.889336192/60000 [=================>............] - ETA: 1s - loss: 0.2983 - acc: 0.889336768/60000 [=================>............] - ETA: 1s - loss: 0.2988 - acc: 0.889037312/60000 [=================>............] - ETA: 1s - loss: 0.2987 - acc: 0.889137952/60000 [=================>............] - ETA: 1s - loss: 0.2990 - acc: 0.888938592/60000 [==================>...........] - ETA: 1s - loss: 0.2994 - acc: 0.888839200/60000 [==================>...........] - ETA: 1s - loss: 0.2998 - acc: 0.888739840/60000 [==================>...........] - ETA: 1s - loss: 0.2997 - acc: 0.889040384/60000 [===================>..........] - ETA: 1s - loss: 0.3006 - acc: 0.888640992/60000 [===================>..........] - ETA: 1s - loss: 0.3006 - acc: 0.888641568/60000 [===================>..........] - ETA: 1s - loss: 0.3006 - acc: 0.888742208/60000 [====================>.........] - ETA: 1s - loss: 0.3002 - acc: 0.888842720/60000 [====================>.........] - ETA: 1s - loss: 0.3000 - acc: 0.888843360/60000 [====================>.........] - ETA: 1s - loss: 0.2997 - acc: 0.889043904/60000 [====================>.........] - ETA: 1s - loss: 0.2990 - acc: 0.889244544/60000 [=====================>........] - ETA: 1s - loss: 0.2988 - acc: 0.889545184/60000 [=====================>........] - ETA: 1s - loss: 0.2994 - acc: 0.889245824/60000 [=====================>........] - ETA: 1s - loss: 0.2997 - acc: 0.889146432/60000 [======================>.......] - ETA: 1s - loss: 0.2999 - acc: 0.888947040/60000 [======================>.......] - ETA: 1s - loss: 0.3001 - acc: 0.888647744/60000 [======================>.......] - ETA: 0s - loss: 0.3008 - acc: 0.888548640/60000 [=======================>......] - ETA: 0s - loss: 0.3009 - acc: 0.888349504/60000 [=======================>......] - ETA: 0s - loss: 0.3010 - acc: 0.888350368/60000 [========================>.....] - ETA: 0s - loss: 0.3015 - acc: 0.888251136/60000 [========================>.....] - ETA: 0s - loss: 0.3012 - acc: 0.888551744/60000 [========================>.....] - ETA: 0s - loss: 0.3010 - acc: 0.888652352/60000 [=========================>....] - ETA: 0s - loss: 0.3004 - acc: 0.888752992/60000 [=========================>....] - ETA: 0s - loss: 0.2997 - acc: 0.889053600/60000 [=========================>....] - ETA: 0s - loss: 0.2995 - acc: 0.889254176/60000 [==========================>...] - ETA: 0s - loss: 0.2986 - acc: 0.889754784/60000 [==========================>...] - ETA: 0s - loss: 0.2989 - acc: 0.889755360/60000 [==========================>...] - ETA: 0s - loss: 0.2998 - acc: 0.889455968/60000 [==========================>...] - ETA: 0s - loss: 0.2999 - acc: 0.889456544/60000 [===========================>..] - ETA: 0s - loss: 0.2998 - acc: 0.889357248/60000 [===========================>..] - ETA: 0s - loss: 0.3001 - acc: 0.889258048/60000 [============================>.] - ETA: 0s - loss: 0.3004 - acc: 0.889358688/60000 [============================>.] - ETA: 0s - loss: 0.3001 - acc: 0.889459296/60000 [============================>.] - ETA: 0s - loss: 0.2995 - acc: 0.889659840/60000 [============================>.] - ETA: 0s - loss: 0.3002 - acc: 0.889360000/60000 [==============================] - 5s 79us/sample - loss: 0.3000 - acc: 0.8893
 #+end_example

 At the end of training the model is about 89% accurate.
*** Check The Model Against the Test-Data
    The Sequential model's [[https://www.tensorflow.org/api_docs/python/tf/keras/Sequential#evaluate][evaluate]] method will let us test it against the test set.
   
 #+begin_src ipython :session hello :results output :exports both
loss, accuracy = model.evaluate(testing_images, testing_labels, verbose=0)
outcomes = {128: (loss, accuracy)}
print(f"Loss: {loss} Accuracy: {accuracy}")
 #+end_src

 #+RESULTS:
 : Loss: 62.076625914764406 Accuracy: 0.8482000231742859

 It had an accuracy of about 85%.
** Exercises
*** Exercise 1
    What does the output of the next code-block mean?

#+begin_src ipython :session hello :results output :exports both
classifications = model.predict(testing_images)
print(classifications[0])
#+end_src

#+RESULTS:
: [0. 0. 0. 0. 0. 0. 0. 0. 0. 1.]

Since we used the softmax method, the output is a vector representing the 10 labels, with a 1 where the predicted label is (so in this case it predicts 9).

#+begin_src ipython :session hello :results output raw :exports both
image = testing_images[0]
plot = holoviews.Image(
    image,
).opts(
    tools=["hover"],
    title=f"Label {y_train[index]} ({labels[y_train[index]]})"
    )
Embed(plot=plot, file_name="exercise_1_image")()
#+end_src

#+RESULTS:
#+begin_export html
<object type="text/html" data="exercise_1_image.html" style="width:100%" height=800>
  <p>Figure Missing</p>
</object>
#+end_export

#+begin_src ipython :session hello :results output :exports both
print(f"Expected Label: {testing_labels[0]}, {labels[testing_labels[0]]}")
print(f"Actual Label: {classifications[0].argmax()}, {labels[classifications[0].argmax()]}")
#+end_src

#+RESULTS:
: Expected Label: 9, Ankle Boot
: Actual Label: 9, Ankle Boot

So our model predicts that the first image is an /Ankle Boot/, which is correct.
*** Exercise 2
    Experiment with different values for the number of /units/ in the  **dense** layer.

#+begin_src ipython :session hello :results none
def create_and_test_model(units: int, epochs: int=5):
    """Creates, trains and tests the model

    Args:
     units: number of units for the dense layer
     epochs: number of times to train the model
    """
    print(f"Building a model with {units} units in the Dense layer")
    model = tensorflow.keras.models.Sequential()
    # add the matrix -> vector layer
    model.add(tensorflow.keras.layers.Flatten())
    
    # add the layer that does the work
    model.add(tensorflow.keras.layers.Dense(units=units,
                                            activation=tensorflow.nn.relu))
    model.add(tensorflow.keras.layers.Dense(10, activation=tensorflow.nn.softmax))
    
    model.compile(optimizer = tensorflow.train.AdamOptimizer(),
              loss = 'sparse_categorical_crossentropy',
              metrics=['accuracy'])
    TIMER.message = "Finished Training the Model"
    with TIMER:
        model.fit(training_images_normalized, training_labels, epochs=epochs, verbose=2)
    print()
    loss, accuracy = model.evaluate(testing_images, testing_labels, verbose=0)
    print(f"Testing: loss={loss}, accuracy={100 * accuracy}%")
    classifications = model.predict(testing_images)
    index = random.randrange(len(classifications))
    selected = classifications[index]
    print(selected)
    
    print(f"Expected Label: {testing_labels[index]}, {labels[testing_labels[index]]}")
    print(f"Actual Label: {selected.argmax()}, {labels[selected.argmax()]}")
    return loss, accuracy
#+end_src
**** 512 Neurons
#+begin_src ipython :session hello :results output :exports both
units = 512
loss, accuracy = create_and_test_model(units)
outcomes[units] = (loss, accuracy)
#+end_src

#+RESULTS:
#+begin_example
Building a model with 512 units in the Dense layer
Epoch 1/5
60000/60000 - 7s - loss: 0.4798 - acc: 0.8291
Epoch 2/5
60000/60000 - 7s - loss: 0.3588 - acc: 0.8693
Epoch 3/5
60000/60000 - 7s - loss: 0.3214 - acc: 0.8817
Epoch 4/5
60000/60000 - 6s - loss: 0.2977 - acc: 0.8896
Epoch 5/5
60000/60000 - 7s - loss: 0.2789 - acc: 0.8963

Testing: loss=61.61892818756103, accuracy=85.33999919891357%
[0. 0. 0. 0. 1. 0. 0. 0. 0. 0.]
Expected Label: 4, Coat
Actual Label: 4, Coat
#+end_example

**** 1020 Neurons
#+begin_src ipython :session hello :results output :exports both
units = 1024
loss, accuracy = create_and_test_model(units)
outcomes[units] = (loss, accuracy)
#+end_src

#+RESULTS:
#+begin_example
Building a model with 1024 units in the Dense layer
Epoch 1/5
60000/60000 - 8s - loss: 0.4686 - acc: 0.8309
Epoch 2/5
60000/60000 - 8s - loss: 0.3584 - acc: 0.8698
Epoch 3/5
60000/60000 - 8s - loss: 0.3209 - acc: 0.8806
Epoch 4/5
60000/60000 - 9s - loss: 0.2971 - acc: 0.8899
Epoch 5/5
60000/60000 - 9s - loss: 0.2797 - acc: 0.8956

Testing: loss=67.69376539611817, accuracy=84.96999740600586%
[0.0000000e+00 0.0000000e+00 0.0000000e+00 0.0000000e+00 1.0000000e+00
 0.0000000e+00 1.2684782e-26 0.0000000e+00 0.0000000e+00 0.0000000e+00]
Expected Label: 2, Pullover
Actual Label: 4, Coat
#+end_example

The model did slightly better than the original 128 unit model, probably because fewer nodes don't give it enough "knobs" to tune to make an accurate match. Oddly it didn't do as well as the 512 unit model, perhaps because with that many neurons we need more data (or more epochs?).
#+begin_src ipython :session hello :results output :exports both
units = 1024
loss, accuracy = create_and_test_model(units, epochs=10)
outcomes[units] = (loss, accuracy)
#+end_src

#+RESULTS:
#+begin_example
Building a model with 1024 units in the Dense layer
Epoch 1/10
60000/60000 - 8s - loss: 0.4705 - acc: 0.8299
Epoch 2/10
60000/60000 - 7s - loss: 0.3563 - acc: 0.8687
Epoch 3/10
60000/60000 - 8s - loss: 0.3207 - acc: 0.8820
Epoch 4/10
60000/60000 - 8s - loss: 0.2967 - acc: 0.8905
Epoch 5/10
60000/60000 - 8s - loss: 0.2771 - acc: 0.8972
Epoch 6/10
60000/60000 - 8s - loss: 0.2617 - acc: 0.9031
Epoch 7/10
60000/60000 - 8s - loss: 0.2477 - acc: 0.9071
Epoch 8/10
60000/60000 - 8s - loss: 0.2388 - acc: 0.9099
Epoch 9/10
60000/60000 - 8s - loss: 0.2275 - acc: 0.9155
Epoch 10/10
60000/60000 - 8s - loss: 0.2195 - acc: 0.9164

Testing: loss=70.63339872589111, accuracy=85.57000160217285%
[0. 0. 0. 0. 0. 0. 0. 0. 0. 1.]
Expected Label: 9, Ankle Boot
Actual Label: 9, Ankle Boot
#+end_example

It seems to be overfitting the data, it looks like we'd need more data for this many nodes. According to the original notebook, this should be more accurate, but that's not true of the test-set. Maybe they meant in comparison to the original 128 unit network, not the 512 unit network.

#+begin_src ipython :session hello :results output raw :exports both
print("|Units | Loss | Accuracy|")
print("|-+-+-|")
for units, (loss, accuracy) in outcomes.items():
    print(f"|{units}| {loss:.2f}| {accuracy: .2f}|")
#+end_src

#+RESULTS:
| Units |  Loss | Accuracy |
|-------+-------+----------|
|   128 | 62.08 |     0.85 |
|  1024 | 70.63 |     0.86 |
|   512 | 51.65 |     0.87 |

*** Exercise: Another Layer
    What happens if you add another layer between the 512 unit layer and the output?
#+begin_src ipython :session hello :results output :exports both
print("Adding an extra layer with 256 units")
model = tensorflow.keras.models.Sequential()

model.add(tensorflow.keras.layers.Flatten())
    
model.add(tensorflow.keras.layers.Dense(units=512,
                                        activation=tensorflow.nn.relu))
model.add(tensorflow.keras.layers.Dense(units=256,
                                        activation=tensorflow.nn.relu))
model.add(tensorflow.keras.layers.Dense(10, activation=tensorflow.nn.softmax))
    
model.compile(optimizer = tensorflow.train.AdamOptimizer(),
              loss = 'sparse_categorical_crossentropy',
              metrics=['accuracy'])
model.fit(training_images_normalized, training_labels, epochs=5, verbose=2)
print()
loss, accuracy = model.evaluate(testing_images, testing_labels, verbose=0)
print(f"Testing: loss={loss}, accuracy={100 * accuracy}%")
classifications = model.predict(testing_images)
print(classifications[0])
    
print(f"Expected Label: {testing_labels[0]}, {labels[testing_labels[0]]}")
print(f"Actual Label: {classifications.argmax()}, {labels[classifications.argmax()]}")
#+end_src

#+RESULTS:
#+begin_example
Adding an extra layer with 256 units
Epoch 1/5
60000/60000 - 10s - loss: 0.4709 - acc: 0.8297
Epoch 2/5
60000/60000 - 10s - loss: 0.3563 - acc: 0.8697
Epoch 3/5
60000/60000 - 10s - loss: 0.3216 - acc: 0.8799
Epoch 4/5
60000/60000 - 10s - loss: 0.2966 - acc: 0.8890
Epoch 5/5
60000/60000 - 10s - loss: 0.2790 - acc: 0.8965

Testing: loss=47.22748269696074, accuracy=86.2999975681305%
[0. 0. 0. 0. 0. 0. 0. 0. 0. 1.]
Expected Label: 9, Ankle Boot
Actual Label: 9, Ankle Boot
#+end_example

The testing accuracy was slightly lower (pretty much the same).

*** Exercise: More Epochs
    What happens if you train for 15 or 30 epochs?
**** 15 Epochs
#+begin_src ipython :session hello :results output :exports both
create_and_test_model(512, 15)
#+end_src

#+RESULTS:
#+begin_example
Building a model with 512 units in the Dense layer
Epoch 1/15
60000/60000 - 7s - loss: 0.4790 - acc: 0.8282
Epoch 2/15
60000/60000 - 7s - loss: 0.3589 - acc: 0.8683
Epoch 3/15
60000/60000 - 7s - loss: 0.3221 - acc: 0.8822
Epoch 4/15
60000/60000 - 7s - loss: 0.2989 - acc: 0.8883
Epoch 5/15
60000/60000 - 7s - loss: 0.2796 - acc: 0.8959
Epoch 6/15
60000/60000 - 7s - loss: 0.2652 - acc: 0.9014
Epoch 7/15
60000/60000 - 7s - loss: 0.2514 - acc: 0.9057
Epoch 8/15
60000/60000 - 7s - loss: 0.2404 - acc: 0.9102
Epoch 9/15
60000/60000 - 7s - loss: 0.2313 - acc: 0.9134
Epoch 10/15
60000/60000 - 7s - loss: 0.2203 - acc: 0.9174
Epoch 11/15
60000/60000 - 7s - loss: 0.2130 - acc: 0.9199
Epoch 12/15
60000/60000 - 7s - loss: 0.2048 - acc: 0.9229
Epoch 13/15
60000/60000 - 7s - loss: 0.1972 - acc: 0.9255
Epoch 14/15
60000/60000 - 7s - loss: 0.1916 - acc: 0.9259
Epoch 15/15
60000/60000 - 7s - loss: 0.1877 - acc: 0.9291

Testing: loss=66.3996201549865, accuracy=87.1399998664856%
[0. 0. 0. 0. 0. 0. 0. 0. 0. 1.]
Expected Label: 9, Ankle Boot
Actual Label: 9, Ankle Boot
#+end_example

The accuracy went up slightly, but the loss went up even more.
**** 30 Epochs
#+begin_src ipython :session hello :results output :exports both
create_and_test_model(512, 30)
#+end_src

#+RESULTS:
#+begin_example
Building a model with 512 units in the Dense layer
Epoch 1/30
60000/60000 - 5s - loss: 0.4718 - acc: 0.8314
Epoch 2/30
60000/60000 - 5s - loss: 0.3580 - acc: 0.8691
Epoch 3/30
60000/60000 - 5s - loss: 0.3217 - acc: 0.8811
Epoch 4/30
60000/60000 - 5s - loss: 0.2996 - acc: 0.8884
Epoch 5/30
60000/60000 - 5s - loss: 0.2789 - acc: 0.8961
Epoch 6/30
60000/60000 - 5s - loss: 0.2645 - acc: 0.9015
Epoch 7/30
60000/60000 - 5s - loss: 0.2519 - acc: 0.9046
Epoch 8/30
60000/60000 - 5s - loss: 0.2404 - acc: 0.9101
Epoch 9/30
60000/60000 - 5s - loss: 0.2302 - acc: 0.9124
Epoch 10/30
60000/60000 - 5s - loss: 0.2205 - acc: 0.9170
Epoch 11/30
60000/60000 - 5s - loss: 0.2136 - acc: 0.9197
Epoch 12/30
60000/60000 - 5s - loss: 0.2058 - acc: 0.9212
Epoch 13/30
60000/60000 - 5s - loss: 0.1980 - acc: 0.9258
Epoch 14/30
60000/60000 - 6s - loss: 0.1903 - acc: 0.9279
Epoch 15/30
60000/60000 - 5s - loss: 0.1864 - acc: 0.9296
Epoch 16/30
60000/60000 - 5s - loss: 0.1802 - acc: 0.9328
Epoch 17/30
60000/60000 - 5s - loss: 0.1765 - acc: 0.9332
Epoch 18/30
60000/60000 - 5s - loss: 0.1676 - acc: 0.9373
Epoch 19/30
60000/60000 - 5s - loss: 0.1636 - acc: 0.9379
Epoch 20/30
60000/60000 - 5s - loss: 0.1584 - acc: 0.9406
Epoch 21/30
60000/60000 - 6s - loss: 0.1542 - acc: 0.9412
Epoch 22/30
60000/60000 - 6s - loss: 0.1489 - acc: 0.9439
Epoch 23/30
60000/60000 - 5s - loss: 0.1475 - acc: 0.9448
Epoch 24/30
60000/60000 - 5s - loss: 0.1401 - acc: 0.9473
Epoch 25/30
60000/60000 - 5s - loss: 0.1377 - acc: 0.9485
Epoch 26/30
60000/60000 - 5s - loss: 0.1318 - acc: 0.9502
Epoch 27/30
60000/60000 - 5s - loss: 0.1304 - acc: 0.9509
Epoch 28/30
60000/60000 - 5s - loss: 0.1262 - acc: 0.9515
Epoch 29/30
60000/60000 - 5s - loss: 0.1238 - acc: 0.9526
Epoch 30/30
60000/60000 - 5s - loss: 0.1243 - acc: 0.9527

Testing: loss=95.97473628044128, accuracy=87.05000281333923%
[0. 0. 0. 0. 0. 0. 0. 0. 0. 1.]
Expected Label: 9, Ankle Boot
Actual Label: 9, Ankle Boot
#+end_example

The accuracy seems to be around the same, but the loss is getting pretty high.
* End
** Source
   This is a re-do of the [[https://github.com/lmoroney/dlaicourse/blob/master/Course%201%20-%20Part%204%20-%20Lesson%202%20-%20Notebook.ipynb][Beyond Hello World, A Computer Vision Example]] notebook on github by [[https://github.com/lmoroney][Laurence Moroney]].



# #Exercise 7: 
# 
# Before you trained, you normalized the data, going from values that were 0-255 to values that were 0-1. What would be the impact of removing that? Here's the complete code to give it a try. Why do you think you get different results? 

# In[ ]:


import tensorflow as tf
print(tf.__version__)
mnist = tf.keras.datasets.mnist
(training_images, training_labels), (test_images, test_labels) = mnist.load_data()
training_images=training_images/255.0
test_images=test_images/255.0
model = tf.keras.models.Sequential([
  tf.keras.layers.Flatten(),
  tf.keras.layers.Dense(512, activation=tf.nn.relu),
  tf.keras.layers.Dense(10, activation=tf.nn.softmax)
])
model.compile(optimizer='adam', loss='sparse_categorical_crossentropy')
model.fit(training_images, training_labels, epochs=5)
model.evaluate(test_images, test_labels)
classifications = model.predict(test_images)
print(classifications[0])
print(test_labels[0])


# #Exercise 8: 
# 
# Earlier when you trained for extra epochs you had an issue where your loss might change. It might have taken a bit of time for you to wait for the training to do that, and you might have thought 'wouldn't it be nice if I could stop the training when I reach a desired value?' -- i.e. 95% accuracy might be enough for you, and if you reach that after 3 epochs, why sit around waiting for it to finish a lot more epochs....So how would you fix that? Like any other program...you have callbacks! Let's see them in action...

# In[ ]:


import tensorflow as tf
print(tf.__version__)

class myCallback(tf.keras.callbacks.Callback):
  def on_epoch_end(self, epoch, logs={}):
    if(logs.get('loss')<0.4):
      print("\nReached 60% accuracy so cancelling training!")
      self.model.stop_training = True

callbacks = myCallback()
mnist = tf.keras.datasets.fashion_mnist
(training_images, training_labels), (test_images, test_labels) = mnist.load_data()
training_images=training_images/255.0
test_images=test_images/255.0
model = tf.keras.models.Sequential([
  tf.keras.layers.Flatten(),
  tf.keras.layers.Dense(512, activation=tf.nn.relu),
  tf.keras.layers.Dense(10, activation=tf.nn.softmax)
])
model.compile(optimizer='adam', loss='sparse_categorical_crossentropy')
model.fit(training_images, training_labels, epochs=5, callbacks=[callbacks])


