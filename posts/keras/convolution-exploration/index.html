<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Exploring Convolutional Neural Networks." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Convolution Exploration | In Too Deep</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/In-Too-Deep/posts/keras/convolution-exploration/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script async src="../../../assets/javascript/bokeh-1.3.4.min.js" type="text/javascript"></script>
<meta content="Cloistered Monkey" name="author">
<link href="/posts/keras/convolutional-neural-networks-and-fashion-mnist/" rel="prev" title="Convolutional Neural Networks and Fashion MNIST" type="text/html">
<link href="/posts/keras/horses-and-humans/" rel="next" title="Horses And Humans" type="text/html">
<meta content="In Too Deep" property="og:site_name">
<meta content="Convolution Exploration" property="og:title">
<meta content="https://necromuralist.github.io/In-Too-Deep/posts/keras/convolution-exploration/" property="og:url">
<meta content="Exploring Convolutional Neural Networks." property="og:description">
<meta content="article" property="og:type">
<meta content="2019-07-03T22:03:25-07:00" property="article:published_time">
<meta content="cnn" property="article:tag">
<meta content="exploration" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/In-Too-Deep/"><span id="blog-title">In Too Deep</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="/categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="/rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/In-Too-Deep/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="/posts/keras/convolution-exploration/index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href="/posts/keras/convolution-exploration/">Convolution Exploration</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/keras/convolution-exploration/" rel="bookmark"><time class="published dt-published" datetime="2019-07-03T22:03:25-07:00" itemprop="datePublished" title="2019-07-03 22:03">2019-07-03 22:03</time></a></p>
<p class="sourceline"><a class="sourcelink" href="/posts/keras/convolution-exploration/index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/keras/convolution-exploration/#orgfa635f8">Beginning</a>
<ul>
<li><a href="/posts/keras/convolution-exploration/#org468837e">Imports</a>
<ul>
<li><a href="/posts/keras/convolution-exploration/#org0ac8137">Python</a></li>
<li><a href="/posts/keras/convolution-exploration/#org832d61b">PyPi</a></li>
<li><a href="/posts/keras/convolution-exploration/#org753afa5">My Stuff</a></li>
</ul>
</li>
<li><a href="/posts/keras/convolution-exploration/#org76af345">Some Setup</a>
<ul>
<li><a href="/posts/keras/convolution-exploration/#org2ff918f">The Plotting</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/keras/convolution-exploration/#org45a8582">Middle</a>
<ul>
<li><a href="/posts/keras/convolution-exploration/#orgc26707a">The Ascent</a></li>
<li><a href="/posts/keras/convolution-exploration/#org455e2da">Creating Filters</a>
<ul>
<li><a href="/posts/keras/convolution-exploration/#orgfbccc70">A First Filter</a></li>
<li><a href="/posts/keras/convolution-exploration/#org9eecf99">Try Another Filter</a></li>
<li><a href="/posts/keras/convolution-exploration/#org3cfdf81">Filter 3</a></li>
</ul>
</li>
<li><a href="/posts/keras/convolution-exploration/#orgb1b82ac">Pooling</a></li>
</ul>
</li>
<li><a href="/posts/keras/convolution-exploration/#orgd46e190">End</a>
<ul>
<li><a href="/posts/keras/convolution-exploration/#orga7ba514">Source</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgfa635f8">
<h2 id="orgfa635f8">Beginning</h2>
<div class="outline-text-2" id="text-orgfa635f8">
<p>This is a look at how convolution and pooling works. We're going to create three filters and apply them to an image to see how it changes them. Then we're going to apply Max-Pooling to the same image to see how this affects it.</p>
</div>
<div class="outline-3" id="outline-container-org468837e">
<h3 id="org468837e">Imports</h3>
<div class="outline-text-3" id="text-org468837e"></div>
<div class="outline-4" id="outline-container-org0ac8137">
<h4 id="org0ac8137">Python</h4>
<div class="outline-text-4" id="text-org0ac8137">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org832d61b">
<h4 id="org832d61b">PyPi</h4>
<div class="outline-text-4" id="text-org832d61b">
<div class="highlight">
<pre><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">misc</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org753afa5">
<h4 id="org753afa5">My Stuff</h4>
<div class="outline-text-4" id="text-org753afa5">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org76af345">
<h3 id="org76af345">Some Setup</h3>
<div class="outline-text-3" id="text-org76af345"></div>
<div class="outline-4" id="outline-container-org2ff918f">
<h4 id="org2ff918f">The Plotting</h4>
<div class="outline-text-4" id="text-org2ff918f">
<div class="highlight">
<pre><span></span><span class="n">holoviews</span><span class="o">.</span><span class="n">extension</span><span class="p">(</span><span class="s2">"bokeh"</span><span class="p">)</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span>
               <span class="n">folder_path</span><span class="o">=</span><span class="s2">"../../files/posts/keras/convolution-exploration/"</span><span class="p">)</span>
<span class="n">Plot</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org45a8582">
<h2 id="org45a8582">Middle</h2>
<div class="outline-text-2" id="text-org45a8582"></div>
<div class="outline-3" id="outline-container-orgc26707a">
<h3 id="orgc26707a">The Ascent</h3>
<div class="outline-text-3" id="text-orgc26707a">
<p>This is an exploration of how convolutions work that uses a grayscale image provided by scipy called <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.misc.ascent.html#scipy.misc.ascent">ascent</a>.</p>
<div class="highlight">
<pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">ascent</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Ascent"</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">"hover"</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"ascent"</span><span class="p">)()</span>
</pre></div>
<object data="/posts/keras/convolution-exploration/ascent.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Note that, as I mentioned before, this is a grayscale image - Holoviews artificially tints it.</p>
<p>Now we're going to make a copy of the image and get its dimensions.</p>
<div class="highlight">
<pre><span></span><span class="n">transformed_image</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">transformed_image</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Rows: {rows}, Columns: {columns}"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Rows: 512, Columns: 512

</pre></div>
</div>
<div class="outline-3" id="outline-container-org455e2da">
<h3 id="org455e2da">Creating Filters</h3>
<div class="outline-text-3" id="text-org455e2da"></div>
<div class="outline-4" id="outline-container-orgfbccc70">
<h4 id="orgfbccc70">A First Filter</h4>
<div class="outline-text-4" id="text-orgfbccc70">
<p>Our filter is going to be a 3 x 3 array. The original lesson said that it is an edge-detector, but I don't think that that's the case.</p>
<div class="highlight">
<pre><span></span><span class="n">filter_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="k">print</span><span class="p">(</span><span class="n">filter_1</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
<pre class="example">
0

</pre></div>
<ul class="org-ul">
<li><a id="org45bf44e"></a>Applying the Filter<br>
<div class="outline-text-5" id="text-org45bf44e">
<p>To apply the filter we need to traverse the cells and multiply the filter by the values of the image that match the current location of the filter. Since the filter is a 3 x 3 array, there is a 1-pixel "padding" around the center so when we do the traversals we start and end one row and column away from the each edge. After multiplying the filter by the section of the image that it overlays, we sum it and then make sure that it stays within the 0 - 255 range that's valid for images. Finally, the value our filter created is stored back into our <code>transformed_image</code>.</p>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Convolver</span><span class="p">:</span>
    <span class="sd">"""Applies a convolution to an image</span>

<span class="sd">    Args:</span>
<span class="sd">     image: the source image to convolve</span>
<span class="sd">     image_filter: the filter to apply</span>
<span class="sd">     identifier: something to identify the filter</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">image_filter</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                 <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image_filter</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_filter</span> <span class="o">=</span> <span class="n">image_filter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_image</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">image_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">"""The filter to apply to the image"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_filter</span>

    <span class="nd">@image_filter.setter</span>
    <span class="k">def</span> <span class="nf">image_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_filter</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sd">"""Stores the filter normalized to zero or one"""</span>
        <span class="k">if</span> <span class="n">new_filter</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_filter</span> <span class="o">=</span> <span class="n">new_filter</span><span class="o">/</span><span class="n">new_filter</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Filter sum: {new_filter.sum()}"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image_filter</span> <span class="o">=</span> <span class="n">new_filter</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""the number of rows in the image"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""number of columns in the image"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transformed_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">"""The image to transform"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_image</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">convolution</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_image</span><span class="p">[</span>
                            <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> 
                            <span class="n">column</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">column</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_filter</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="n">convolution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">convolution</span><span class="p">)</span>
                    <span class="n">convolution</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="n">convolution</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_image</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">convolution</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_image</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sd">"""Plots the transformed image</span>
<span class="sd">       """</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">width</span> <span class="o">=</span> <span class="n">Plot</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">200</span>
        <span class="n">image_1</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformed_image</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">image_2</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">image_2</span> <span class="o">+</span> <span class="n">image_1</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">f</span><span class="s2">"Ascent Transformed ({self.identifier})"</span>
        <span class="p">)</span>
        <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> 
              <span class="n">height_in_pixels</span><span class="o">=</span><span class="n">height</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)()</span>
</pre></div>
</div>
</li>
<li><a id="org1fde7c5"></a>Looking at the Convolution's Output<br>
<div class="outline-text-5" id="text-org1fde7c5">
<div class="highlight">
<pre><span></span><span class="n">convolver</span> <span class="o">=</span> <span class="n">Convolver</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">filter_1</span><span class="p">,</span> <span class="s2">"filter_1"</span><span class="p">)</span>
<span class="n">convolver</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
<object data="/posts/keras/convolution-exploration/filter_1.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>This looks like it might be a contrast filter.</p>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org9eecf99">
<h4 id="org9eecf99">Try Another Filter</h4>
<div class="outline-text-4" id="text-org9eecf99">
<div class="highlight">
<pre><span></span><span class="n">filter_2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">convolver</span> <span class="o">=</span> <span class="n">Convolver</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">filter_2</span><span class="p">,</span> <span class="s2">"filter_2"</span><span class="p">)</span>
<span class="n">convolver</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
<object data="/posts/keras/convolution-exploration/filter_2.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>I'm not sure what that filter is. It seems to find the darkest parts of the image.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org3cfdf81">
<h4 id="org3cfdf81">Filter 3</h4>
<div class="outline-text-4" id="text-org3cfdf81">
<div class="highlight">
<pre><span></span><span class="n">filter_3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
    <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> 
    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">convolver</span> <span class="o">=</span> <span class="n">Convolver</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">filter_3</span><span class="p">,</span> <span class="s2">"filter_3"</span><span class="p">)</span>
<span class="n">convolver</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
<object data="/posts/keras/convolution-exploration/filter_3.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>I'm not sure exactly what that's doing. Based on what the filter looks like I would guess that it's finding vertical and horizontal lines.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgb1b82ac">
<h3 id="orgb1b82ac">Pooling</h3>
<div class="outline-text-3" id="text-orgb1b82ac">
<p>Now we'll look at what happens when you apply a halving (2, 2) pooling to an image. This iterates over every other pixel, looking at the current pixel, the pixel to the right, below and diagonally below and to the right and keeping the highest value in those four pixels.</p>
<div class="highlight">
<pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">rows</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">stride</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">stride</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">stride</span><span class="p">):</span>
        <span class="n">pixel</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">column</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">output</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">column</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pixel</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Original Shape: {image.shape}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Pooled Shape: {output.shape}"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Original Shape: (512, 512)
Pooled Shape: (256, 256)

</pre>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Ascent With Pooling"</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"pooling"</span><span class="p">)()</span>
</pre></div>
<object data="/posts/keras/convolution-exploration/pooling.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>The thing to note here is that, even though the image is half the size, you can still make out the features (although there is some loss of resolution).</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgd46e190">
<h2 id="orgd46e190">End</h2>
<div class="outline-text-2" id="text-orgd46e190"></div>
<div class="outline-3" id="outline-container-orga7ba514">
<h3 id="orga7ba514">Source</h3>
<div class="outline-text-3" id="text-orga7ba514">
<ul class="org-ul">
<li><a href="https://github.com/lmoroney/dlaicourse/blob/master/Course%201%20-%20Part%206%20-%20Lesson%203%20-%20Notebook.ipynb">Course 1 - Part 6 - Lesson 3</a></li>
</ul>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="/categories/cnn/" rel="tag">cnn</a></li>
<li><a class="tag p-category" href="/categories/exploration/" rel="tag">exploration</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="/posts/keras/convolutional-neural-networks-and-fashion-mnist/" rel="prev" title="Convolutional Neural Networks and Fashion MNIST">Previous post</a></li>
<li class="next"><a href="/posts/keras/horses-and-humans/" rel="next" title="Horses And Humans">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2019 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="/assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script> 
</body>
</html>
