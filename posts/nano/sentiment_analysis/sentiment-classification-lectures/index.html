<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Lectures on using Deep Learning for Sentiment Analysis." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Sentiment Classification Lectures | Neurotic Networking</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nano/sentiment_analysis/sentiment-classification-lectures/" rel="canonical"><!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../../site.webmanifest" rel="manifest">
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<meta content="Cloistered Monkey" name="author">
<link href="../../../notes/notes-on-the-deep-learning-revolution/" rel="prev" title="Notes on The Deep Learning Revolution" type="text/html">
<link href="../../bike-sharing/bike-sharing-project-feedback/" rel="next" title="Bike Sharing Project Feedback" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Sentiment Classification Lectures" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nano/sentiment_analysis/sentiment-classification-lectures/" property="og:url">
<meta content="Lectures on using Deep Learning for Sentiment Analysis." property="og:description">
<meta content="article" property="og:type">
<meta content="2018-11-04T14:17:10-08:00" property="article:published_time">
<meta content="lecture" property="article:tag">
<meta content="sentiment analysis" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/Neurotic-Networking/"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Sentiment Classification Lectures</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2018-11-04T14:17:10-08:00" itemprop="datePublished" title="2018-11-04 14:17">2018-11-04 14:17</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1e9f375">Sentiment Classification & How To "Frame Problems" for a Neural Network</a></li>
<li><a href="#org349327e">Set Up</a></li>
<li><a href="#orgd138c2b">Analysis: What's Going on in the Weights?</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org1e9f375">
<h2 id="org1e9f375">Sentiment Classification & How To "Frame Problems" for a Neural Network</h2>
<div class="outline-text-2" id="text-org1e9f375">
<p>by Andrew Trask</p>
<ul class="org-ul">
<li><b>Twitter</b>: @iamtrask</li>
<li><b>Blog</b>: <a href="http://iamtrask.github.io">http://iamtrask.github.io</a></li>
</ul>
</div>
<div class="outline-3" id="outline-container-orgf4ead2e">
<h3 id="orgf4ead2e">What You Should Already Know</h3>
<div class="outline-text-3" id="text-orgf4ead2e">
<ul class="org-ul">
<li>neural networks, forward and back-propagation</li>
<li>stochastic gradient descent</li>
<li>mean squared error</li>
<li>and train/test splits</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-orgfa65358">
<h3 id="orgfa65358">Where to Get Help if You Need it</h3>
<div class="outline-text-3" id="text-orgfa65358">
<ul class="org-ul">
<li>Re-watch previous Udacity Lectures</li>
<li>Leverage the recommended Course Reading Material - <a href="https://www.manning.com/books/grokking-deep-learning">Grokking Deep Learning</a></li>
<li>Shoot me Andrew a tweet @iamtrask</li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org349327e">
<h2 id="org349327e">Set Up</h2>
<div class="outline-text-2" id="text-org349327e"></div>
<div class="outline-3" id="outline-container-org40a691a">
<h3 id="org40a691a">Debug</h3>
<div class="outline-text-3" id="text-org40a691a">
<div class="highlight">
<pre><span></span>%load_ext autoreload
%autoreload 2
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org3efbf7e">
<h3 id="org3efbf7e">Imports</h3>
<div class="outline-text-3" id="text-org3efbf7e"></div>
<div class="outline-4" id="outline-container-orgf9c8688">
<h4 id="orgf9c8688">Python Standard Library</h4>
<div class="outline-text-4" id="text-orgf9c8688">
<div class="highlight">
<pre><span></span>from datetime import datetime
from functools import partial
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1118cef">
<h4 id="org1118cef">From Pypi</h4>
<div class="outline-text-4" id="text-org1118cef">
<div class="highlight">
<pre><span></span>from graphviz import Graph
from tabulate import tabulate
import matplotlib.pyplot as pyplot
import numpy
import seaborn
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org40f3b2f">
<h4 id="org40f3b2f">This Project</h4>
<div class="outline-text-4" id="text-org40f3b2f">
<div class="highlight">
<pre><span></span>from neurotic.tangles.data_paths import DataPath
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgea05b3d">
<h3 id="orgea05b3d">Tables</h3>
<div class="outline-text-3" id="text-orgea05b3d">
<div class="highlight">
<pre><span></span>table = partial(tabulate, tablefmt="orgtbl", headers="keys")
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org8ae9801">
<h3 id="org8ae9801">Printing</h3>
<div class="outline-text-3" id="text-org8ae9801">
<div class="highlight">
<pre><span></span>%matplotlib inline
seaborn.set_style("whitegrid")
FIGURE_SIZE = (12, 10)
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgd138c2b">
<h2 id="orgd138c2b">Analysis: What's Going on in the Weights?</h2>
<div class="outline-text-2" id="text-orgd138c2b">
<p>Let's start with a model that doesn't have any noise cancellation.</p>
<div class="highlight">
<pre><span></span>mlp_full = SentimentNoiseReduction(reviews=x_train, labels=y_train,
                                   lower_bound=0,
                                   polarity_cutoff=0,
                                   learning_rate=0.01)
</pre></div>
<div class="highlight">
<pre><span></span>mlp_full.train()
</pre></div>
<pre class="example">
Progress: 0.00 % Speed(reviews/sec): 0.00 Error: [-0.5] #Correct: 1 #Trained: 1 Training Accuracy: 100.00 %
Progress: 4.17 % Speed(reviews/sec): 100.00 Error: [-0.38320156] #Correct: 740 #Trained: 1001 Training Accuracy: 73.93 %
Progress: 8.33 % Speed(reviews/sec): 181.82 Error: [-0.26004622] #Correct: 1529 #Trained: 2001 Training Accuracy: 76.41 %
Progress: 12.50 % Speed(reviews/sec): 250.00 Error: [-0.40350302] #Correct: 2376 #Trained: 3001 Training Accuracy: 79.17 %
Progress: 16.67 % Speed(reviews/sec): 285.71 Error: [-0.23990249] #Correct: 3187 #Trained: 4001 Training Accuracy: 79.66 %
Progress: 20.83 % Speed(reviews/sec): 333.33 Error: [-0.14119144] #Correct: 4002 #Trained: 5001 Training Accuracy: 80.02 %
Progress: 25.00 % Speed(reviews/sec): 375.00 Error: [-0.06442389] #Correct: 4829 #Trained: 6001 Training Accuracy: 80.47 %
Progress: 29.17 % Speed(reviews/sec): 411.76 Error: [-0.03508728] #Correct: 5690 #Trained: 7001 Training Accuracy: 81.27 %
Progress: 33.33 % Speed(reviews/sec): 444.44 Error: [-0.05110633] #Correct: 6548 #Trained: 8001 Training Accuracy: 81.84 %
Progress: 37.50 % Speed(reviews/sec): 450.00 Error: [-0.07432703] #Correct: 7404 #Trained: 9001 Training Accuracy: 82.26 %
Progress: 41.67 % Speed(reviews/sec): 476.19 Error: [-0.26512013] #Correct: 8272 #Trained: 10001 Training Accuracy: 82.71 %
Progress: 45.83 % Speed(reviews/sec): 500.00 Error: [-0.14067275] #Correct: 9129 #Trained: 11001 Training Accuracy: 82.98 %
Progress: 50.00 % Speed(reviews/sec): 521.74 Error: [-0.01215903] #Correct: 9994 #Trained: 12001 Training Accuracy: 83.28 %
Progress: 54.17 % Speed(reviews/sec): 541.67 Error: [-0.33825111] #Correct: 10864 #Trained: 13001 Training Accuracy: 83.56 %
Progress: 58.33 % Speed(reviews/sec): 560.00 Error: [-0.00522004] #Correct: 11721 #Trained: 14001 Training Accuracy: 83.72 %
Progress: 62.50 % Speed(reviews/sec): 555.56 Error: [-0.49523538] #Correct: 12553 #Trained: 15001 Training Accuracy: 83.68 %
Progress: 66.67 % Speed(reviews/sec): 571.43 Error: [-0.20026672] #Correct: 13390 #Trained: 16001 Training Accuracy: 83.68 %
Progress: 70.83 % Speed(reviews/sec): 586.21 Error: [-0.20786817] #Correct: 14243 #Trained: 17001 Training Accuracy: 83.78 %
Progress: 75.00 % Speed(reviews/sec): 580.65 Error: [-0.03469862] #Correct: 15108 #Trained: 18001 Training Accuracy: 83.93 %
Progress: 79.17 % Speed(reviews/sec): 593.75 Error: [-0.99460657] #Correct: 15982 #Trained: 19001 Training Accuracy: 84.11 %
Progress: 83.33 % Speed(reviews/sec): 606.06 Error: [-0.0523489] #Correct: 16867 #Trained: 20001 Training Accuracy: 84.33 %
Progress: 87.50 % Speed(reviews/sec): 617.65 Error: [-0.28370015] #Correct: 17734 #Trained: 21001 Training Accuracy: 84.44 %
Progress: 91.67 % Speed(reviews/sec): 611.11 Error: [-0.33222958] #Correct: 18616 #Trained: 22001 Training Accuracy: 84.61 %
Progress: 95.83 % Speed(reviews/sec): 621.62 Error: [-0.17177784] #Correct: 19475 #Trained: 23001 Training Accuracy: 84.67 %
Training Time: 0:00:38.794351
</pre>
<p>Now here's a function to find the similarity of words in the vocabulary to a word, based on the dot product of the weights from the input layer to the hidden layer.</p>
<div class="highlight">
<pre><span></span>def get_most_similar_words(focus: str="horrible", count:int=10) -&gt; list:
    """Returns a list of similar words based on weights"""
    most_similar = Counter()
    for word in mlp_full.word_to_index:
        most_similar[word] = numpy.dot(
            mlp_full.weights_input_to_hidden[mlp_full.word_to_index[word]],
            mlp_full.weights_input_to_hidden[mlp_full.word_to_index[focus]])    
    return most_similar.most_common(count)
</pre></div>
<div class="highlight">
<pre><span></span>print(get_most_similar_words("excellent"))
</pre></div>
<pre class="example">
[('excellent', 0.14672474869646132), ('perfect', 0.12529721850063252), ('great', 0.1072983586254582), ('amazing', 0.10168346112776101), ('wonderful', 0.0971402564667566), ('best', 0.09640599864254018), ('today', 0.09064606014006837), ('fun', 0.08859560811231239), ('loved', 0.07914150763452406), ('definitely', 0.07693307843353574)]

</pre>
<p><i>excellent</i> was, ouf course, most similar to itself, but we can see that the network's weights are most similar to each other when the words are most similar to each other - the network has 'learned' what words are similar to <i>excellent</i> using the training set.</p>
<p>Now a negative example.</p>
<div class="highlight">
<pre><span></span>print(get_most_similar_words("terrible"))
</pre></div>
<pre class="example">
[('worst', 0.1761389721390966), ('awful', 0.12576492326546337), ('waste', 0.11989143949659276), ('poor', 0.10186721140388931), ('boring', 0.09740050873489904), ('terrible', 0.09719144477251088), ('bad', 0.08198016341605044), ('dull', 0.0812576973066953), ('worse', 0.07504920898991188), ('poorly', 0.07494303321254764)]

</pre>
<p>Once again, the more similar words were in sentiment, the closer the weights leading from their inputs became.</p>
<div class="highlight">
<pre><span></span>import matplotlib.colors as colors

words_to_visualize = list()
for word, ratio in pos_neg_ratios.most_common(500):
    if(word in mlp_full.word_to_index):
        words_to_visualize.append(word)

for word, ratio in list(reversed(pos_neg_ratios.most_common()))[0:500]:
    if(word in mlp_full.word_to_index):
        words_to_visualize.append(word)
</pre></div>
<div class="highlight">
<pre><span></span>pos = 0
neg = 0

colors_list = list()
vectors_list = list()
for word in words_to_visualize:
    if word in pos_neg_ratios.keys():
        vectors_list.append(mlp_full.weights_input_to_hidden[mlp_full.word_to_index[word]])
        if(pos_neg_ratios[word] &gt; 0):
            pos+=1
            colors_list.append("#00ff00")
        else:
            neg+=1
            colors_list.append("#000000")
</pre></div>
<div class="highlight">
<pre><span></span>from sklearn.manifold import TSNE
tsne = TSNE(n_components=2, random_state=0)
words_top_ted_tsne = tsne.fit_transform(vectors_list)
</pre></div>
<p>p = figure(tools="pan,wheel_zoom,reset,save", toolbar_location="above", title="vector T-SNE for most polarized words")</p>
<p>source = ColumnDataSource(data=dict(x1=words_top_ted_tsne[:,0], x2=words_top_ted_tsne[:,1], names=words_to_visualize, color=colors_list))</p>
<p>p.scatter(x="x1", y="x2", size=8, source=source, fill_color="color")</p>
<p>word_labels = LabelSet(x="x1", y="x2", text="names", y_offset=6, text_font_size="8pt", text_color="#555555", source=source, text_align='center') p.add_layout(word_labels)</p>
<p>show(p)</p>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../../categories/lecture/" rel="tag">lecture</a></li>
<li><a class="tag p-category" href="../../../../categories/sentiment-analysis/" rel="tag">sentiment analysis</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../../../notes/notes-on-the-deep-learning-revolution/" rel="prev" title="Notes on The Deep Learning Revolution">Previous post</a></li>
<li class="next"><a href="../../bike-sharing/bike-sharing-project-feedback/" rel="next" title="Bike Sharing Project Feedback">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2020 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
