<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Studies in Deep Learning." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Neurotic Networking (old posts, page 13) | Neurotic Networking</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/index-13.html" rel="canonical">
<link href="index-14.html" rel="prev" type="text/html">
<link href="index-12.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<link href="apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="site.webmanifest" rel="manifest">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="."><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/autocorrect-minimum-edit-distance/">Autocorrect: Minimum Edit Distance</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/autocorrect-minimum-edit-distance/" rel="bookmark"><time class="published dt-published" datetime="2020-11-07T22:23:42-08:00" itemprop="datePublished" title="2020-11-07 22:23">2020-11-07 22:23</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org19bf8eb">Beginning</a>
<ul>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org1d06426">Imports</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org0631328">Set Up</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org934fb8b">Minimum Edit distance</a>
<ul>
<li>
<ul>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org54034e3">Dynamic Programming</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org254f5d0">Testing the Function</a>
<ul>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#orgc4d8978">play to stay</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org740c5dd">eer to near</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org8188bf3">intention to execution</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org7932991">Finding the Closest of Multiple Strings</a>
<ul>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#orgf2220f7">One Letter Edits</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org8e02fdf">Two Letter Edits</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org7cd0625">End</a>
<ul>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org4626af6">A Class-Based Minimum Edit Distance</a>
<ul>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org0e9b329">Imports</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#orgbaeb263">The Minimum Edit Distance</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org89e1b1a">Rows</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org8961fd4">Columns</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org65b4c7d">The Table</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org6929808">Distance Frame</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#orgdeb3de0">Minimum Distance</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#org2ae0e22">Distance String</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/#orgfc54235">Test Out the Minimum Distance</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org19bf8eb">
<h2 id="org19bf8eb">Beginning</h2>
<div class="outline-text-2" id="text-org19bf8eb">
<p>This is a post in the series of posts introduced <a href="posts/nlp/autocorrect-the-system/">here</a>. Now that we <a href="posts/nlp/autocorrect-system-combining-the-edits/">implemented auto-correct</a>, how do we evaluate the similarity between two strings (e.g. 'waht' and 'what')?</p>
<p>Also how do you efficiently find the shortest path to go from the word, 'waht' to the word 'what'?</p>
<p>We'll implement a dynamic programming system that will tell us the minimum number of edits required to convert a string into another string.</p>
</div>
<div class="outline-3" id="outline-container-org1d06426">
<h3 id="org1d06426">Imports</h3>
<div class="outline-text-3" id="text-org1d06426">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># from pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this repo</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.preprocessing</span> <span class="kn">import</span> <span class="n">CorpusBuilder</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.suggestor</span> <span class="kn">import</span> <span class="n">WordSuggestor</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org0631328">
<h3 id="org0631328">Set Up</h3>
<div class="outline-text-3" id="text-org0631328">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"SHAKESPEARE"</span><span class="p">])</span>
<span class="n">corpus</span> <span class="o">=</span> <span class="n">CorpusBuilder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">suggestor</span> <span class="o">=</span> <span class="n">WordSuggestor</span><span class="p">(</span><span class="n">corpus</span><span class="o">=</span><span class="n">corpus</span><span class="p">,</span> <span class="n">suggestions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">want_switches</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org934fb8b">
<h2 id="org934fb8b">Minimum Edit distance</h2>
<div class="outline-text-2" id="text-org934fb8b"></div>
<div class="outline-4" id="outline-container-org54034e3">
<h4 id="org54034e3">Dynamic Programming</h4>
<div class="outline-text-4" id="text-org54034e3">
<p>Dynamic Programming breaks a problem down into subproblems which can be combined to form the final solution. Here, given a string \(source_{[0 \ldots i]}\) and a string \(target_{[0 \ldots j]}\), we will compute all the combinations of \(substrings_{[i, j]}\) and calculate their edit distance. To do this efficiently, we will use a table to maintain the previously computed substrings and use those to calculate larger substrings.</p>
<p>We'll create a matrix and update each element in the matrix as follows:</p>
<p>\[ \text{Initialization} \]</p>
\begin{align} D[0,0] &amp;= 0 \\ D[i,0] &amp;= D[i-1,0] + del\_cost(source[i]) \tag{4}\\ D[0,j] &amp;= D[0,j-1] + ins\_cost(target[j]) \\ \end{align}
<p>\[ \text{Per Cell Operations} \]</p>
\begin{align} D[i,j] =min \begin{cases} D[i-1,j] + del\_cost\\ D[i,j-1] + ins\_cost\\ D[i-1,j-1] + \left\{\begin{matrix} rep\_cost; & \textit{if src}[i]\neq tar[j]\\ 0 ; & \textit{if src}[i]=tar[j] \end{matrix}\right. \end{cases} \tag{5} \end{align}
<p>So converting the source word <b>play</b> to the target word <b>stay</b>, using an insert cost of one, a delete cost of 1, and replace cost of 2 would give you the following table:</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<tbody>
<tr>
<td class="org-left">&nbsp;</td>
<td class="org-right">#</td>
<td class="org-right">s</td>
<td class="org-right">t</td>
<td class="org-right">a</td>
<td class="org-right">y</td>
</tr>
<tr>
<td class="org-left">#</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>
<tr>
<td class="org-left">p</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">l</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">a</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">y</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">5</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>The operations used in this algorithm are 'insert', 'delete', and 'replace'. These correspond to the functions that you defined earlier: insert_letter(), delete_letter() and replace_letter(). switch_letter() is not used here.</p>
<p>The diagram below describes how to initialize the table. Each entry in D[i,j] represents the minimum cost of converting string source[0:i] to string target[0:j]. The first column is initialized to represent the cumulative cost of deleting the source characters to convert string "EER" to "". The first row is initialized to represent the cumulative cost of inserting the target characters to convert from "" to "NEAR".</p>
\begin{align} D[i,j] =min \begin{cases} D[i-1,j] + del\_cost\\ D[i,j-1] + ins\_cost\\ D[i-1,j-1] + \left\{\begin{matrix} rep\_cost; & if src[i]\neq tar[j]\\ 0 ; & if src[i]=tar[j] \end{matrix}\right. \end{cases} \tag{5} \end{align}
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">min_edit_distance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">ins_cost</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">del_cost</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rep_cost</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Input: </span>
<span class="sd">       source: a string corresponding to the string you are starting with</span>
<span class="sd">       target: a string corresponding to the string you want to end with</span>
<span class="sd">       ins_cost: an integer setting the insert cost</span>
<span class="sd">       del_cost: an integer setting the delete cost</span>
<span class="sd">       rep_cost: an integer setting the replace cost</span>
<span class="sd">    Output:</span>
<span class="sd">       D: a matrix of len(source)+1 by len(target)+1 containing minimum edit distances</span>
<span class="sd">       med: the minimum edit distance (med) required to convert the source string to the target</span>
<span class="sd">    '''</span>
    <span class="c1"># use deletion and insert cost as  1</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> 
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> 
    <span class="c1">#initialize cost matrix with zeros and dimensions (m+1,n+1) </span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> 

    <span class="c1">### START CODE HERE (Replace instances of 'None' with your code) ###</span>

    <span class="c1"># Fill in column 0, from row 1 to row m, both inclusive</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> <span class="c1"># Replace None with the proper range</span>
        <span class="n">D</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">del_cost</span>

    <span class="c1"># Fill in row 0, for all columns from 1 to n, both inclusive</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> <span class="c1"># Replace None with the proper range</span>
        <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins_cost</span>

    <span class="c1"># Loop through row 1 to row m, both inclusive</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> 

        <span class="c1"># Loop through column 1 to column n, both inclusive</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">r_cost</span> <span class="o">=</span> <span class="n">rep_cost</span>

            <span class="k">if</span> <span class="n">source</span><span class="p">[</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">target</span><span class="p">[</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">r_cost</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">D</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">D</span><span class="p">[</span><span class="n">row</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">+</span> <span class="n">del_cost</span><span class="p">),</span>
                             <span class="n">D</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ins_cost</span><span class="p">,</span>
                             <span class="n">D</span><span class="p">[</span><span class="n">row</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r_cost</span><span class="p">)</span>

    <span class="c1"># Set the minimum edit distance with the cost found at row m, column n</span>
    <span class="n">med</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>

    <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">D</span><span class="p">,</span> <span class="n">med</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org254f5d0">
<h3 id="org254f5d0">Testing the Function</h3>
<div class="outline-text-3" id="text-org254f5d0"></div>
<div class="outline-4" id="outline-container-orgc4d8978">
<h4 id="orgc4d8978">play to stay</h4>
<div class="outline-text-4" id="text-orgc4d8978">
<div class="highlight">
<pre><span></span><span class="n">source</span> <span class="o">=</span>  <span class="s1">'play'</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">'stay'</span>
<span class="n">matrix</span><span class="p">,</span> <span class="n">min_edits</span> <span class="o">=</span> <span class="n">min_edit_distance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"minimum edits: "</span><span class="p">,</span><span class="n">min_edits</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">'#'</span> <span class="o">+</span> <span class="n">source</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">'#'</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">4</span><span class="p">],</span>
<span class="p">]),</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span> <span class="n">cols</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">min_edits</span><span class="o">==</span><span class="mi">4</span>

<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span><span class="p">)</span>
</pre></div>
<pre class="example">
minimum edits:  4 

   #  s  t  a  y
#  0  1  2  3  4
p  1  2  3  4  5
l  2  3  4  5  6
a  3  4  5  4  5
y  4  5  6  5  4
</pre></div>
</div>
<div class="outline-4" id="outline-container-org740c5dd">
<h4 id="org740c5dd">eer to near</h4>
<div class="outline-text-4" id="text-org740c5dd">
<div class="highlight">
<pre><span></span><span class="n">source</span> <span class="o">=</span>  <span class="s1">'eer'</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">'near'</span>
<span class="n">matrix</span><span class="p">,</span> <span class="n">min_edits</span> <span class="o">=</span> <span class="n">min_edit_distance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"minimum edits: "</span><span class="p">,</span><span class="n">min_edits</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="n">idx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="n">cols</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span> <span class="n">cols</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
    <span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">min_edits</span> <span class="o">==</span> <span class="mi">3</span>
</pre></div>
<pre class="example">
minimum edits:  3 

   #  n  e  a  r
#  0  1  2  3  4
e  1  2  1  2  3
e  2  3  2  3  4
r  3  4  3  4  3
</pre></div>
</div>
<div class="outline-4" id="outline-container-org8188bf3">
<h4 id="org8188bf3">intention to execution</h4>
<div class="outline-text-4" id="text-org8188bf3">
<div class="highlight">
<pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="s2">"intention"</span>
<span class="n">target</span> <span class="o">=</span> <span class="s2">"execution"</span>
<span class="n">matrix</span><span class="p">,</span> <span class="n">min_edits</span> <span class="o">=</span> <span class="n">min_edit_distance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"minimum edits: "</span><span class="p">,</span><span class="n">min_edits</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"#"</span> <span class="o">+</span> <span class="n">source</span><span class="p">)</span>
<span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"#"</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">7</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">8</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">9</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">8</span><span class="p">],</span>
<span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">min_edits</span> <span class="o">==</span> <span class="mi">8</span>
</pre></div>
<pre class="example">
minimum edits:  8 

   #  e  x   e   c   u   t   i   o   n
#  0  1  2   3   4   5   6   7   8   9
i  1  2  3   4   5   6   7   6   7   8
n  2  3  4   5   6   7   8   7   8   7
t  3  4  5   6   7   8   7   8   9   8
e  4  3  4   5   6   7   8   9  10   9
n  5  4  5   6   7   8   9  10  11  10
t  6  5  6   7   8   9   8   9  10  11
i  7  6  7   8   9  10   9   8   9  10
o  8  7  8   9  10  11  10   9   8   9
n  9  8  9  10  11  12  11  10   9   8
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7932991">
<h3 id="org7932991">Finding the Closest of Multiple Strings</h3>
<div class="outline-text-3" id="text-org7932991"></div>
<div class="outline-4" id="outline-container-orgf2220f7">
<h4 id="orgf2220f7">One Letter Edits</h4>
<div class="outline-text-4" id="text-orgf2220f7">
<div class="highlight">
<pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="s2">"eer"</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">suggestor</span><span class="o">.</span><span class="n">one_letter_edits</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="n">rep_cost</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">min_edits</span> <span class="o">=</span> <span class="n">min_edit_distance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">rep_cost</span><span class="o">=</span><span class="n">rep_cost</span><span class="p">)</span>  <span class="c1"># set ins, del, sub costs all to one</span>
    <span class="k">if</span> <span class="n">min_edits</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">min_edits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org8e02fdf">
<h4 id="org8e02fdf">Two Letter Edits</h4>
<div class="outline-text-4" id="text-org8e02fdf">
<p>The 'replace()' routine utilizes all letters a-z one of which returns the original word.</p>
<div class="highlight">
<pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="s2">"eer"</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">suggestor</span><span class="o">.</span><span class="n">two_letter_edits</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">min_edits</span> <span class="o">=</span> <span class="n">min_edit_distance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span><span class="n">rep_cost</span><span class="o">=</span><span class="n">rep_cost</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">min_edits</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">min_edits</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">min_edits</span><span class="p">)</span>
</pre></div>
<pre class="example">
eer eer 0
</pre>
<p>We have to allow single edits here because some two_edits will restore a single edit.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org7cd0625">
<h2 id="org7cd0625">End</h2>
<div class="outline-text-2" id="text-org7cd0625">
<p>The next post will be about <a href="posts/nlp/autocorrect-minimum-edit-distance-backtrace/">implementing backtrace</a> to find the shortest path to the minimum edit distance.</p>
</div>
<div class="outline-3" id="outline-container-org4626af6">
<h3 id="org4626af6">A Class-Based Minimum Edit Distance</h3>
<div class="outline-text-3" id="text-org4626af6">
<div class="highlight">
<pre><span></span><span class="o">&lt;&lt;</span><span class="n">distance</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">distance</span><span class="o">-</span><span class="n">class</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">distance</span><span class="o">-</span><span class="n">rows</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">distance</span><span class="o">-</span><span class="n">columns</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">distance</span><span class="o">-</span><span class="n">table</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">distance</span><span class="o">-</span><span class="n">frame</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">distance</span><span class="o">-</span><span class="n">minimum</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">distance</span><span class="o">-</span><span class="n">string</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org0e9b329">
<h4 id="org0e9b329">Imports</h4>
<div class="outline-text-4" id="text-org0e9b329">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgbaeb263">
<h4 id="orgbaeb263">The Minimum Edit Distance</h4>
<div class="outline-text-4" id="text-orgbaeb263">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MinimumEdits</span><span class="p">:</span>
    <span class="sd">"""Calculates the minimum edit distance between two strings</span>

<span class="sd">    Uses the Levenshtein distance</span>

<span class="sd">    Args:</span>
<span class="sd">     source: the starting string</span>
<span class="sd">     target: what to transform the source to</span>
<span class="sd">     insertion_cost: how much inserting a character costs</span>
<span class="sd">     deletion_cost: how much deleting a character costs</span>
<span class="sd">     replacement_cost: how much swapping out a character costs</span>
<span class="sd">     table_format: tabluate table format for printing table</span>
<span class="sd">    """</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">insertion_cost</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">deletion_cost</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">replacement_cost</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">table_format</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"orgtbl"</span>
    <span class="n">_rows</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_columns</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_distance_table</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_distance_frame</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_minimum_distance</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_backtrace</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org89e1b1a">
<h4 id="org89e1b1a">Rows</h4>
<div class="outline-text-4" id="text-org89e1b1a">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Rows in the table"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rows</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org8961fd4">
<h4 id="org8961fd4">Columns</h4>
<div class="outline-text-4" id="text-org8961fd4">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Number of columns for the table"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org65b4c7d">
<h4 id="org65b4c7d">The Table</h4>
<div class="outline-text-4" id="text-org65b4c7d">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">distance_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Table of edit distances"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                           <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># initialize the first row</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span><span class="p">[</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deletion_cost</span><span class="p">)</span>
        <span class="c1"># initialize the first column</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                               <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">insertion_cost</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">one_row_back</span> <span class="o">=</span> <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">one_column_back</span> <span class="o">=</span> <span class="n">column</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">replacement_cost</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">one_row_back</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="n">one_column_back</span><span class="p">]</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">replacement_cost</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span><span class="p">[</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span>
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deletion_cost</span><span class="p">),</span>
                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">one_column_back</span><span class="p">]</span>
                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">insertion_cost</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span><span class="p">[</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">one_column_back</span><span class="p">]</span>
                     <span class="o">+</span> <span class="n">replacement_cost</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_table</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org6929808">
<h4 id="org6929808">Distance Frame</h4>
<div class="outline-text-4" id="text-org6929808">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">distance_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">"""pandas dataframe of the distance table"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distance_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance_table</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"#"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">),</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"#"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_frame</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgdeb3de0">
<h4 id="orgdeb3de0">Minimum Distance</h4>
<div class="outline-text-4" id="text-orgdeb3de0">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">minimum_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""The minimum edit distance from source to target"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_table</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_distance</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org2ae0e22">
<h4 id="org2ae0e22">Distance String</h4>
<div class="outline-text-4" id="text-org2ae0e22">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""tabluate version of distance frame</span>

<span class="sd">    Returns:</span>
<span class="sd">     table formatted string of distance table</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">tabulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_frame</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_format</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgfc54235">
<h3 id="orgfc54235">Test Out the Minimum Distance</h3>
<div class="outline-text-3" id="text-orgfc54235">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.distance</span> <span class="kn">import</span> <span class="n">MinimumEdits</span>

<span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="s2">"cow"</span><span class="p">,</span> <span class="s2">"dog"</span>
<span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">SOURCE</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">TARGET</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">TARGET</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TARGET</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                                              <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                              <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                                              <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">minimum_distance</span> <span class="o">==</span> <span class="mi">4</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">"play"</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">"stay"</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">minimum_distance</span> <span class="o">==</span> <span class="mi">4</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">"eer"</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">"near"</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">minimum_distance</span> <span class="o">==</span> <span class="mi">3</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">"intention"</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">"execution"</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">minimum_distance</span> <span class="o">==</span> <span class="mi">8</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_frame</span><span class="p">)</span>
</pre></div>
<pre class="example">
   #  d  o  g
#  0  1  2  3
c  1  2  3  4
o  2  3  2  3
w  3  4  3  4
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">editor</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">#</th>
<th class="org-right" scope="col">d</th>
<th class="org-right" scope="col">o</th>
<th class="org-right" scope="col">g</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">#</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">c</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>
<tr>
<td class="org-left">o</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">w</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/autocorrect-system-combining-the-edits/">Autocorrect System: Combining the Edits</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/autocorrect-system-combining-the-edits/" rel="bookmark"><time class="published dt-published" datetime="2020-11-06T21:11:43-08:00" itemprop="datePublished" title="2020-11-06 21:11">2020-11-06 21:11</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/autocorrect-system-combining-the-edits/#org3f9d5f4">Beginning</a>
<ul>
<li><a href="posts/nlp/autocorrect-system-combining-the-edits/#org1ae8931">Imports</a></li>
<li><a href="posts/nlp/autocorrect-system-combining-the-edits/#orgc9b0a16">Set Up</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-system-combining-the-edits/#org47c6c87">Middle</a>
<ul>
<li><a href="posts/nlp/autocorrect-system-combining-the-edits/#org49cd534">Combining the edits</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-system-combining-the-edits/#org58ef7a9">End</a>
<ul>
<li><a href="posts/nlp/autocorrect-system-combining-the-edits/#orgad3a480">A Suggestor</a></li>
<li><a href="posts/nlp/autocorrect-system-combining-the-edits/#org94b8e76">Test the Suggestor</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org3f9d5f4">
<h2 id="org3f9d5f4">Beginning</h2>
<div class="outline-text-2" id="text-org3f9d5f4">
<p>This is a continuation of a series of posts that were introduced <a href="posts/nlp/autocorrect-the-system/">here</a>. Now that we've <a href="posts/nlp/autocorrect-system-edits/">implemented the string manipulations</a>, we'll create two functions that, given a string, will return all the possible single and double edits on that string. These will be <code>edit_one_letter()</code> and <code>edit_two_letters()</code>.</p>
</div>
<div class="outline-3" id="outline-container-org1ae8931">
<h3 id="org1ae8931">Imports</h3>
<div class="outline-text-3" id="text-org1ae8931">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="c1"># this repo</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.edits</span> <span class="kn">import</span> <span class="n">TheEditor</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.preprocessing</span> <span class="kn">import</span> <span class="n">CorpusBuilder</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc9b0a16">
<h3 id="orgc9b0a16">Set Up</h3>
<div class="outline-text-3" id="text-orgc9b0a16">
<p>The CorpusBuilder has both the vocabulary and the probability for each word in the vocabulary. It gets the path to the text-file with the vocabulary in it from an envirnoment variable named <code>SHAKESPEARE</code> so we have to load that first.</p>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"SHAKESPEARE"</span><span class="p">])</span>
</pre></div>
<p>And then build the corpus.</p>
<div class="highlight">
<pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="n">CorpusBuilder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org47c6c87">
<h2 id="org47c6c87">Middle</h2>
<div class="outline-text-2" id="text-org47c6c87"></div>
<div class="outline-3" id="outline-container-org49cd534">
<h3 id="org49cd534">Combining the edits</h3>
<div class="outline-text-3" id="text-org49cd534"></div>
<div class="outline-4" id="outline-container-org78942cc">
<h4 id="org78942cc">Edit one letter</h4>
<div class="outline-text-4" id="text-org78942cc">
<p><b>Instructions</b>: Implement the <code>edit_one_letter</code> function to get all the possible edits that are one edit away from a word. The edits consist of the replace, insert, delete, and optionally the switch operation. You should use the previous functions you have already implemented to complete this function. The 'switch' function is a less common edit function, so its use will be selected by an "allow_switches" input argument.</p>
<p>Note that those functions return <b>lists</b> while this function should return a <b>python set</b>. Utilizing a set eliminates any duplicate entries.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">edit_one_letter</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allow_switches</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
    <span class="sd">"""Get all possible words one edit away from the original</span>

<span class="sd">    Args:</span>
<span class="sd">      word: word for which we will generate all possible words one edit away.</span>

<span class="sd">    Returns:</span>
<span class="sd">      edit_one_set: a set of words with one possible edit.</span>
<span class="sd">    """</span>

    <span class="n">edit_one_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1">### START CODE HERE ###</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">TheEditor</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="n">edits</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">replaced</span> <span class="o">+</span> <span class="n">editor</span><span class="o">.</span><span class="n">inserted</span> <span class="o">+</span> <span class="n">editor</span><span class="o">.</span><span class="n">deleted</span>
    <span class="k">if</span> <span class="n">allow_switches</span><span class="p">:</span>
        <span class="n">edits</span> <span class="o">+=</span> <span class="n">editor</span><span class="o">.</span><span class="n">switched</span>
    <span class="n">edit_one_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">edits</span><span class="p">)</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">edit_one_set</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tmp_word</span> <span class="o">=</span> <span class="s2">"at"</span>
<span class="n">tmp_edit_one_set</span> <span class="o">=</span> <span class="n">edit_one_letter</span><span class="p">(</span><span class="n">tmp_word</span><span class="p">)</span>
<span class="c1"># turn this into a list to sort it, in order to view it</span>
<span class="n">tmp_edit_one_l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tmp_edit_one_set</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"input word </span><span class="si">{</span><span class="n">tmp_word</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">edit_one_l </span><span class="se">\n</span><span class="si">{</span><span class="n">tmp_edit_one_l</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The type of the returned object should be a set </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tmp_edit_one_set</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of outputs from edit_one_letter('at') is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">edit_one_letter</span><span class="p">(</span><span class="s1">'at'</span><span class="p">))</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'aa'</span><span class="p">,</span> <span class="s1">'aat'</span><span class="p">,</span> <span class="s1">'ab'</span><span class="p">,</span> <span class="s1">'abt'</span><span class="p">,</span> <span class="s1">'ac'</span><span class="p">,</span> <span class="s1">'act'</span><span class="p">,</span> <span class="s1">'ad'</span><span class="p">,</span> <span class="s1">'adt'</span><span class="p">,</span> <span class="s1">'ae'</span><span class="p">,</span> <span class="s1">'aet'</span><span class="p">,</span> <span class="s1">'af'</span><span class="p">,</span> <span class="s1">'aft'</span><span class="p">,</span> <span class="s1">'ag'</span><span class="p">,</span> <span class="s1">'agt'</span><span class="p">,</span> <span class="s1">'ah'</span><span class="p">,</span> <span class="s1">'aht'</span><span class="p">,</span> <span class="s1">'ai'</span><span class="p">,</span> <span class="s1">'ait'</span><span class="p">,</span> <span class="s1">'aj'</span><span class="p">,</span> <span class="s1">'ajt'</span><span class="p">,</span> <span class="s1">'ak'</span><span class="p">,</span> <span class="s1">'akt'</span><span class="p">,</span> <span class="s1">'al'</span><span class="p">,</span> <span class="s1">'alt'</span><span class="p">,</span> <span class="s1">'am'</span><span class="p">,</span> <span class="s1">'amt'</span><span class="p">,</span> <span class="s1">'an'</span><span class="p">,</span> <span class="s1">'ant'</span><span class="p">,</span> <span class="s1">'ao'</span><span class="p">,</span> <span class="s1">'aot'</span><span class="p">,</span> <span class="s1">'ap'</span><span class="p">,</span> <span class="s1">'apt'</span><span class="p">,</span> <span class="s1">'aq'</span><span class="p">,</span> <span class="s1">'aqt'</span><span class="p">,</span> <span class="s1">'ar'</span><span class="p">,</span> <span class="s1">'art'</span><span class="p">,</span> <span class="s1">'as'</span><span class="p">,</span> <span class="s1">'ast'</span><span class="p">,</span> <span class="s1">'ata'</span><span class="p">,</span> <span class="s1">'atb'</span><span class="p">,</span> <span class="s1">'atc'</span><span class="p">,</span> <span class="s1">'atd'</span><span class="p">,</span> <span class="s1">'ate'</span><span class="p">,</span> <span class="s1">'atf'</span><span class="p">,</span> <span class="s1">'atg'</span><span class="p">,</span> <span class="s1">'ath'</span><span class="p">,</span> <span class="s1">'ati'</span><span class="p">,</span> <span class="s1">'atj'</span><span class="p">,</span> <span class="s1">'atk'</span><span class="p">,</span> <span class="s1">'atl'</span><span class="p">,</span> <span class="s1">'atm'</span><span class="p">,</span> <span class="s1">'atn'</span><span class="p">,</span> <span class="s1">'ato'</span><span class="p">,</span> <span class="s1">'atp'</span><span class="p">,</span> <span class="s1">'atq'</span><span class="p">,</span> <span class="s1">'atr'</span><span class="p">,</span> <span class="s1">'ats'</span><span class="p">,</span> <span class="s1">'att'</span><span class="p">,</span> <span class="s1">'atu'</span><span class="p">,</span> <span class="s1">'atv'</span><span class="p">,</span> <span class="s1">'atw'</span><span class="p">,</span> <span class="s1">'atx'</span><span class="p">,</span> <span class="s1">'aty'</span><span class="p">,</span> <span class="s1">'atz'</span><span class="p">,</span> <span class="s1">'au'</span><span class="p">,</span> <span class="s1">'aut'</span><span class="p">,</span> <span class="s1">'av'</span><span class="p">,</span> <span class="s1">'avt'</span><span class="p">,</span> <span class="s1">'aw'</span><span class="p">,</span> <span class="s1">'awt'</span><span class="p">,</span> <span class="s1">'ax'</span><span class="p">,</span> <span class="s1">'axt'</span><span class="p">,</span> <span class="s1">'ay'</span><span class="p">,</span> <span class="s1">'ayt'</span><span class="p">,</span> <span class="s1">'az'</span><span class="p">,</span> <span class="s1">'azt'</span><span class="p">,</span> <span class="s1">'bat'</span><span class="p">,</span> <span class="s1">'bt'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">,</span> <span class="s1">'ct'</span><span class="p">,</span> <span class="s1">'dat'</span><span class="p">,</span> <span class="s1">'dt'</span><span class="p">,</span> <span class="s1">'eat'</span><span class="p">,</span> <span class="s1">'et'</span><span class="p">,</span> <span class="s1">'fat'</span><span class="p">,</span> <span class="s1">'ft'</span><span class="p">,</span> <span class="s1">'gat'</span><span class="p">,</span> <span class="s1">'gt'</span><span class="p">,</span> <span class="s1">'hat'</span><span class="p">,</span> <span class="s1">'ht'</span><span class="p">,</span> <span class="s1">'iat'</span><span class="p">,</span> <span class="s1">'it'</span><span class="p">,</span> <span class="s1">'jat'</span><span class="p">,</span> <span class="s1">'jt'</span><span class="p">,</span> <span class="s1">'kat'</span><span class="p">,</span> <span class="s1">'kt'</span><span class="p">,</span> <span class="s1">'lat'</span><span class="p">,</span> <span class="s1">'lt'</span><span class="p">,</span> <span class="s1">'mat'</span><span class="p">,</span> <span class="s1">'mt'</span><span class="p">,</span> <span class="s1">'nat'</span><span class="p">,</span> <span class="s1">'nt'</span><span class="p">,</span> <span class="s1">'oat'</span><span class="p">,</span> <span class="s1">'ot'</span><span class="p">,</span> <span class="s1">'pat'</span><span class="p">,</span> <span class="s1">'pt'</span><span class="p">,</span> <span class="s1">'qat'</span><span class="p">,</span> <span class="s1">'qt'</span><span class="p">,</span> <span class="s1">'rat'</span><span class="p">,</span> <span class="s1">'rt'</span><span class="p">,</span> <span class="s1">'sat'</span><span class="p">,</span> <span class="s1">'st'</span><span class="p">,</span> <span class="s1">'t'</span><span class="p">,</span> <span class="s1">'ta'</span><span class="p">,</span> <span class="s1">'tat'</span><span class="p">,</span> <span class="s1">'tt'</span><span class="p">,</span> <span class="s1">'uat'</span><span class="p">,</span> <span class="s1">'ut'</span><span class="p">,</span> <span class="s1">'vat'</span><span class="p">,</span> <span class="s1">'vt'</span><span class="p">,</span> <span class="s1">'wat'</span><span class="p">,</span> <span class="s1">'wt'</span><span class="p">,</span> <span class="s1">'xat'</span><span class="p">,</span> <span class="s1">'xt'</span><span class="p">,</span> <span class="s1">'yat'</span><span class="p">,</span> <span class="s1">'yt'</span><span class="p">,</span> <span class="s1">'zat'</span><span class="p">,</span> <span class="s1">'zt'</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">tmp_edit_one_l</span> <span class="o">==</span> <span class="n">expected</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">edit_one_letter</span><span class="p">(</span><span class="s2">"at"</span><span class="p">))</span> <span class="o">==</span> <span class="mi">129</span>
</pre></div>
<pre class="example">
input word at 
edit_one_l 
['a', 'aa', 'aat', 'ab', 'abt', 'ac', 'act', 'ad', 'adt', 'ae', 'aet', 'af', 'aft', 'ag', 'agt', 'ah', 'aht', 'ai', 'ait', 'aj', 'ajt', 'ak', 'akt', 'al', 'alt', 'am', 'amt', 'an', 'ant', 'ao', 'aot', 'ap', 'apt', 'aq', 'aqt', 'ar', 'art', 'as', 'ast', 'ata', 'atb', 'atc', 'atd', 'ate', 'atf', 'atg', 'ath', 'ati', 'atj', 'atk', 'atl', 'atm', 'atn', 'ato', 'atp', 'atq', 'atr', 'ats', 'att', 'atu', 'atv', 'atw', 'atx', 'aty', 'atz', 'au', 'aut', 'av', 'avt', 'aw', 'awt', 'ax', 'axt', 'ay', 'ayt', 'az', 'azt', 'bat', 'bt', 'cat', 'ct', 'dat', 'dt', 'eat', 'et', 'fat', 'ft', 'gat', 'gt', 'hat', 'ht', 'iat', 'it', 'jat', 'jt', 'kat', 'kt', 'lat', 'lt', 'mat', 'mt', 'nat', 'nt', 'oat', 'ot', 'pat', 'pt', 'qat', 'qt', 'rat', 'rt', 'sat', 'st', 't', 'ta', 'tat', 'tt', 'uat', 'ut', 'vat', 'vt', 'wat', 'wt', 'xat', 'xt', 'yat', 'yt', 'zat', 'zt']

The type of the returned object should be a set &lt;class 'set'&gt;
Number of outputs from edit_one_letter('at') is 129
</pre></div>
</div>
<div class="outline-4" id="outline-container-org537d8f9">
<h4 id="org537d8f9">Edit two letters</h4>
<div class="outline-text-4" id="text-org537d8f9">
<p>Now you can generalize this to implement to get two edits on a word. To do so, you would have to get all the possible edits on a single word and then for each modified word, you would have to modify it again.</p>
<p><b>Instructions</b>: Implement the <code>edit_two_letters</code> function that returns a set of words that are two edits away. Note that creating additional edits based on the <code>edit_one_letter</code> function may 'restore' some one_edits to zero or one edits. That is allowed here. This accounted for in get_corrections.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">edit_two_letters</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allow_switches</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
    <span class="sd">"""Make two-letter edits</span>

<span class="sd">    Args:</span>
<span class="sd">      word: the input string/word </span>

<span class="sd">    Returns:</span>
<span class="sd">       edit_two_set: a set of strings with all possible two edits</span>
<span class="sd">    """</span>

    <span class="n">edit_two_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1">### START CODE HERE ###</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="n">edit_one_letter</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">allow_switches</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">ones</span><span class="p">:</span>
        <span class="n">edit_two_set</span> <span class="o">=</span> <span class="n">edit_two_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">edit_one_letter</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">allow_switches</span><span class="p">))</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">edit_two_set</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tmp_edit_two_set</span> <span class="o">=</span> <span class="n">edit_two_letters</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>
<span class="n">tmp_edit_two_l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tmp_edit_two_set</span><span class="p">))</span>
<span class="n">twos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_edit_two_l</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">twos</span> <span class="o">==</span> <span class="mi">2654</span><span class="p">,</span> <span class="n">twos</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of strings with edit distance of two: </span><span class="si">{</span><span class="n">twos</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">first_ten</span> <span class="o">=</span> <span class="n">tmp_edit_two_l</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">first_ten</span> <span class="o">==</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'aa'</span><span class="p">,</span> <span class="s1">'aaa'</span><span class="p">,</span> <span class="s1">'aab'</span><span class="p">,</span> <span class="s1">'aac'</span><span class="p">,</span> <span class="s1">'aad'</span><span class="p">,</span> <span class="s1">'aae'</span><span class="p">,</span> <span class="s1">'aaf'</span><span class="p">,</span> <span class="s1">'aag'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"First 10 strings </span><span class="si">{</span><span class="n">first_ten</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">last_ten</span> <span class="o">=</span> <span class="n">tmp_edit_two_l</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
<span class="k">assert</span> <span class="n">last_ten</span> <span class="o">==</span> <span class="p">[</span><span class="s1">'zv'</span><span class="p">,</span> <span class="s1">'zva'</span><span class="p">,</span> <span class="s1">'zw'</span><span class="p">,</span> <span class="s1">'zwa'</span><span class="p">,</span> <span class="s1">'zx'</span><span class="p">,</span> <span class="s1">'zxa'</span><span class="p">,</span> <span class="s1">'zy'</span><span class="p">,</span> <span class="s1">'zya'</span><span class="p">,</span> <span class="s1">'zz'</span><span class="p">,</span> <span class="s1">'zza'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Last 10 strings </span><span class="si">{</span><span class="n">last_ten</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The data type of the returned object should be a set </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tmp_edit_two_set</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">actual</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edit_two_letters</span><span class="p">(</span><span class="s1">'at'</span><span class="p">))</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mi">7154</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span><span class="p">,</span> <span class="n">actual</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of strings that are 2 edit distances from 'at' is </span><span class="si">{</span><span class="n">actual</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Number of strings with edit distance of two: 2654
First 10 strings ['', 'a', 'aa', 'aaa', 'aab', 'aac', 'aad', 'aae', 'aaf', 'aag']
Last 10 strings ['zv', 'zva', 'zw', 'zwa', 'zx', 'zxa', 'zy', 'zya', 'zz', 'zza']
The data type of the returned object should be a set &lt;class 'set'&gt;
Number of strings that are 2 edit distances from 'at' is 7154
</pre></div>
</div>
<div class="outline-4" id="outline-container-org073e840">
<h4 id="org073e840">Suggest Spelling Corrections</h4>
<div class="outline-text-4" id="text-org073e840">
<p>Now you will use your <code>edit_two_letters</code> function to get a set of all the possible 2 edits on your word. You will then use those strings to get the most probable word you meant to type aka your typing suggestion.</p>
<p><b>Instructions</b>: Implement <code>get_corrections</code>, which returns a list of zero to n possible suggestion tuples of the form (word, probability_of_word).</p>
<ul class="org-ul">
<li><b>Step 1:</b> Generate suggestions for a supplied word: You'll use the edit functions you have developed. The 'suggestion algorithm' should follow this logic:
<ul class="org-ul">
<li>If the word is in the vocabulary, suggest the word.</li>
<li>Otherwise, if there are suggestions from <code>edit_one_letter</code> that are in the vocabulary, use those.</li>
<li>Otherwise, if there are suggestions from <code>edit_two_letters</code> that are in the vocabulary, use those.</li>
<li>Otherwise, suggest the input word.*</li>
<li>The idea is that words generated from fewer edits are more likely than words with more edits.</li>
</ul>
</li>
</ul>
<p>Note:</p>
<ul class="org-ul">
<li>Edits of one or two letters may 'restore' strings to either zero or one edit. This algorithm accounts for this by preferentially selecting lower distance edits first.</li>
</ul>
</div>
<ul class="org-ul">
<li><a id="org6a5bbf6"></a>Short circuit<br>
<div class="outline-text-5" id="text-org6a5bbf6">
<p>In Python, logical operations such as <code>and</code> and <code>or</code> have two useful properties. They can operate on lists and they have ['short-circuit' behavior](<a href="https://docs.python.org/3/library/stdtypes.html">https://docs.python.org/3/library/stdtypes.html</a>). Try these:</p>
<p>Example of logical operation on lists or sets.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span> <span class="p">[]</span> <span class="ow">and</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">]</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="p">[]</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">]</span> <span class="p">)</span>
<span class="c1">#example of Short circuit behavior</span>
<span class="n">val1</span> <span class="o">=</span>  <span class="p">[</span><span class="s2">"Most"</span><span class="p">,</span><span class="s2">"Likely"</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">"Less"</span><span class="p">,</span><span class="s2">"so"</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">"least"</span><span class="p">,</span><span class="s2">"of"</span><span class="p">,</span><span class="s2">"all"</span><span class="p">]</span>  <span class="c1"># selects first, does not evalute remainder</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span>
<span class="n">val2</span> <span class="o">=</span>  <span class="p">[]</span> <span class="ow">or</span> <span class="p">[]</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">"least"</span><span class="p">,</span><span class="s2">"of"</span><span class="p">,</span><span class="s2">"all"</span><span class="p">]</span> <span class="c1"># continues evaluation until there is a non-empty list</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val2</span><span class="p">)</span>
</pre></div>
<pre class="example">
[]
['a', 'b']
['Most', 'Likely']
['least', 'of', 'all']
</pre>
<p>The logical <code>or</code> could be used to implement the suggestion algorithm very compactly. Alternately, if/then constructs could be used.</p>
<p><b>Step 2</b>: Create a 'best_words' dictionary where the 'key' is a suggestion and the 'value' is the probability of that word in your vocabulary. If the word is not in the vocabulary, assign it a probability of 0.</p>
<p><b>Step 3</b>: Select the n best suggestions. There may be fewer than n.</p>
<ul class="org-ul">
<li><code>edit_one_letter</code> and <code>edit_two_letters</code> return <b>python sets</b>.</li>
<li>Sets have a handy <a href="https://docs.python.org/2/library/sets.html">set.intersection</a> feature</li>
<li>To find the keys that have the highest values in a dictionary, you can use the Counter dictionary to create a Counter object from a regular dictionary. Then you can use Counter.most_common(n) to get the n most common keys.</li>
<li>To find the intersection of two sets, you can use set.intersection or the & operator.</li>
<li>If you are not as familiar with short circuit syntax (as shown above), feel free to use if else statements instead.</li>
<li>To use an if statement to check of a set is empty, use 'if not x:' syntax</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">get_corrections</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">probs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">vocab</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Gets corrections within n edits</span>

<span class="sd">    Args: </span>
<span class="sd">       word: a user entered string to check for suggestions</span>
<span class="sd">       probs: a dictionary that maps each word to its probability in the corpus</span>
<span class="sd">       vocab: a set containing all the vocabulary</span>
<span class="sd">       n: number of possible word corrections you want returned in the dictionary</span>

<span class="sd">    Returns: </span>
<span class="sd">       n_best: a list of tuples with the most probable n corrected words and their probabilities.</span>
<span class="sd">    """</span>

    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_best</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">### START CODE HERE ###</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">:</span>
        <span class="n">n_best</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span> <span class="n">probs</span><span class="p">[</span><span class="n">word</span><span class="p">])]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="n">vocab</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">edit_one_letter</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="n">suggestions</span> <span class="o">=</span> <span class="n">vocab</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">edit_two_letters</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([(</span><span class="n">probs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">suggestion</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">suggestion</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">suggestion</span> <span class="ow">in</span> <span class="n">suggestions</span><span class="p">])))</span>
            <span class="n">n_best</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span> <span class="n">probability</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">probability</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">[:</span><span class="n">n</span><span class="p">]]</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"entered word = "</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">suggestions = "</span><span class="p">,</span> <span class="n">suggestions</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n_best</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s2">"dbadd"</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">get_corrections</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">probs</span><span class="o">=</span><span class="n">corpus</span><span class="o">.</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">corpus</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
<pre class="example">
entered word =  dbadd 
suggestions =  {'bade', 'band', 'add', 'dead', 'bad'}
[('dead', 0.0006341627186928787), ('bad', 0.0002051702913418137)]
</pre>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s2">"days"</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">get_corrections</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">probs</span><span class="o">=</span><span class="n">corpus</span><span class="o">.</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">corpus</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">test</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
<pre class="example">
entered word =  days 
suggestions =  []
[('days', 0.0004103405826836274)]
</pre>
<div class="highlight">
<pre><span></span><span class="c1"># Test your implementation - feel free to try other words in my word</span>
<span class="n">my_word</span> <span class="o">=</span> <span class="s1">'dys'</span>
<span class="n">tmp_corrections</span> <span class="o">=</span> <span class="n">get_corrections</span><span class="p">(</span><span class="n">my_word</span><span class="p">,</span> <span class="n">corpus</span><span class="o">.</span><span class="n">probabilities</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">words</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># keep verbose=True</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word_prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tmp_corrections</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"word </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">word_prob</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, probability </span><span class="si">{</span><span class="n">word_prob</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"data type of corrections </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tmp_corrections</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="mf">0.000410</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">tmp_corrections</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">),</span> <span class="n">actual</span>

<span class="n">expected</span> <span class="o">=</span> <span class="mf">0.000019</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">tmp_corrections</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">),</span> <span class="n">actual</span>
</pre></div>
<pre class="example">
entered word =  dys 
suggestions =  {'days', 'dye'}
word 0: days, probability 0.000410
word 1: dye, probability 0.000019
data type of corrections &lt;class 'list'&gt;
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org58ef7a9">
<h2 id="org58ef7a9">End</h2>
<div class="outline-text-2" id="text-org58ef7a9">
<p>The next step is to write some code to find the <a href="posts/nlp/autocorrect-minimum-edit-distance/">Minimum Edit Distance</a> needed to transform one word into another word.</p>
</div>
<div class="outline-3" id="outline-container-orgad3a480">
<h3 id="orgad3a480">A Suggestor</h3>
<div class="outline-text-3" id="text-orgad3a480"></div>
<div class="outline-4" id="outline-container-org2628317">
<h4 id="org2628317">Imports</h4>
<div class="outline-text-4" id="text-org2628317">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>

<span class="c1"># this repository</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.edits</span> <span class="kn">import</span> <span class="n">TheEditor</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgac39cd4">
<h4 id="orgac39cd4">The Suggestor</h4>
<div class="outline-text-4" id="text-orgac39cd4">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">WordSuggestor</span><span class="p">:</span>
    <span class="sd">"""Suggests Words for Autocorrection</span>

<span class="sd">    Args:</span>
<span class="sd">     corpus: a Corpus Builder object</span>
<span class="sd">     suggestions: number of suggestions to return for each word</span>
<span class="sd">     want_switches: also do the =switch= edit</span>
<span class="sd">    """</span>
    <span class="n">corpus</span><span class="p">:</span> <span class="nb">object</span>
    <span class="n">suggestions</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">want_switches</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgae794a7">
<h4 id="orgae794a7">Edit One Letter</h4>
<div class="outline-text-4" id="text-orgae794a7">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">one_letter_edits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
    <span class="sd">"""Get all possible words one edit away from the original</span>

<span class="sd">    Args:</span>
<span class="sd">      word: word for which we will generate all possible words one edit away.</span>

<span class="sd">    Returns:</span>
<span class="sd">      set of words with one possible edit.</span>
<span class="sd">    """</span>    
    <span class="n">editor</span> <span class="o">=</span> <span class="n">TheEditor</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="n">edits</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">replaced</span> <span class="o">+</span> <span class="n">editor</span><span class="o">.</span><span class="n">inserted</span> <span class="o">+</span> <span class="n">editor</span><span class="o">.</span><span class="n">deleted</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">want_switches</span><span class="p">:</span>
        <span class="n">edits</span> <span class="o">+=</span> <span class="n">editor</span><span class="o">.</span><span class="n">switched</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">edits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge9273c8">
<h4 id="orge9273c8">Two-Letter Edits</h4>
<div class="outline-text-4" id="text-orge9273c8">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">two_letter_edits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
    <span class="sd">"""Make two-letter edits</span>

<span class="sd">    Args:</span>
<span class="sd">      word: the input string/word </span>

<span class="sd">    Returns:</span>
<span class="sd">      set of strings with all possible two-letter edits</span>
<span class="sd">    """</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_letter_edits</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_letter_edits</span><span class="p">(</span><span class="n">one</span><span class="p">)</span> <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">ones</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org926e696">
<h4 id="org926e696">The Call</h4>
<div class="outline-text-4" id="text-org926e696">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Finds the closest words to the word</span>

<span class="sd">    If the word is in our corpus then it just returns the word</span>

<span class="sd">    Args:</span>
<span class="sd">     word: potential word to correct</span>

<span class="sd">    Returns:</span>
<span class="sd">     list of (word, probability) tuples</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">:</span>
        <span class="n">best</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">probabilities</span><span class="p">[</span><span class="n">word</span><span class="p">])]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">vocabulary</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_letter_edits</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="n">suggestions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">vocabulary</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">two_letter_edits</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span>
                <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="o">.</span><span class="n">probabilities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">suggestion</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">suggestion</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">suggestion</span> <span class="ow">in</span> <span class="n">suggestions</span><span class="p">])))</span>
            <span class="n">best</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span> <span class="n">probability</span><span class="p">)</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">probability</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">[</span>
                            <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">suggestions</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">best</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">best</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org94b8e76">
<h3 id="org94b8e76">Test the Suggestor</h3>
<div class="outline-text-3" id="text-org94b8e76">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.suggestor</span> <span class="kn">import</span> <span class="n">WordSuggestor</span>
<span class="n">suggestor</span> <span class="o">=</span> <span class="n">WordSuggestor</span><span class="p">(</span><span class="n">corpus</span><span class="o">=</span><span class="n">corpus</span><span class="p">,</span> <span class="n">suggestions</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="c1"># this doesn't have any one-letter-edits in the corpus so it won't return anything</span>
<span class="c1"># unless the two-letter-edits is working</span>
<span class="n">word</span> <span class="o">=</span> <span class="s2">"dbadd"</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">suggestor</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
<pre class="example">
[('dead', 0.0006341627186928787), ('bad', 0.0002051702913418137)]
</pre>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s2">"days"</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">suggestor</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">test</span>
<span class="k">assert</span> <span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">word</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
<pre class="example">
[('days', 0.0004103405826836274)]
</pre>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s1">'dys'</span>
<span class="n">tmp_corrections</span> <span class="o">=</span> <span class="n">suggestor</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word_prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tmp_corrections</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"word </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">word_prob</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, probability </span><span class="si">{</span><span class="n">word_prob</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"data type of corrections </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tmp_corrections</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="mf">0.000410</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">tmp_corrections</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">),</span> <span class="n">actual</span>

<span class="n">expected</span> <span class="o">=</span> <span class="mf">0.000019</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">tmp_corrections</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">),</span> <span class="n">actual</span>
</pre></div>
<pre class="example">
word 0: days, probability 0.000410
word 1: dye, probability 0.000019
data type of corrections &lt;class 'list'&gt;
</pre></div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/autocorrect-system-edits/">Autocorrect System: Edits</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/autocorrect-system-edits/" rel="bookmark"><time class="published dt-published" datetime="2020-11-05T21:04:06-08:00" itemprop="datePublished" title="2020-11-05 21:04">2020-11-05 21:04</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/autocorrect-system-edits/#org4da2b9b">Beginning</a></li>
<li><a href="posts/nlp/autocorrect-system-edits/#org4adcf82">Middle</a>
<ul>
<li><a href="posts/nlp/autocorrect-system-edits/#orgc1937f3">Delete Letter</a></li>
<li><a href="posts/nlp/autocorrect-system-edits/#orgb3847f1">Switch Letter</a></li>
<li><a href="posts/nlp/autocorrect-system-edits/#org9d0e3a5">Replace Letter</a></li>
<li><a href="posts/nlp/autocorrect-system-edits/#orga8147d4">Insert Letter</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-system-edits/#org21316b6">End</a>
<ul>
<li><a href="posts/nlp/autocorrect-system-edits/#org0374a54">The Editor</a></li>
<li><a href="posts/nlp/autocorrect-system-edits/#org6553c85">Checking the Editor</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org4da2b9b">
<h2 id="org4da2b9b">Beginning</h2>
<div class="outline-text-2" id="text-org4da2b9b">
<p>This is part of a series that's introduced in <a href="posts/nlp/autocorrect-the-system/">Autocorrect: The System</a>. In the <a href="posts/nlp/autocorrect-system-data-preprocessing/">previous post</a> of this series we computed \(P(w_i)\) for all the words in the corpus, so now we'll write a few functions to manipulate strings so that we can edit the erroneous strings and return the right spellings of the words. In this section, we'll implement four functions:</p>
<ul class="org-ul">
<li><code>delete_letter</code>: given a word, it returns all the possible strings that have <b>one character removed</b>.</li>
<li><code>switch_letter</code>: given a word, it returns all the possible strings that have <b>two adjacent letters switched</b>.</li>
<li><code>replace_letter</code>: given a word, it returns all the possible strings that have <b>one character replaced by another different letter</b>.</li>
<li><code>insert_letter</code>: given a word, it returns all the possible strings that have an <b>additional character inserted</b>.</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org4adcf82">
<h2 id="org4adcf82">Middle</h2>
<div class="outline-text-2" id="text-org4adcf82"></div>
<div class="outline-3" id="outline-container-orgc1937f3">
<h3 id="orgc1937f3">Delete Letter</h3>
<div class="outline-text-3" id="text-orgc1937f3">
<p>We're going to implement a function that, given a word, returns a list of strings with one character deleted.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">delete_letter</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Delete one letter at a time</span>

<span class="sd">    Args:</span>
<span class="sd">      word: the string/word for which you will generate all possible words </span>
<span class="sd">               in the vocabulary which have 1 missing character</span>
<span class="sd">    Returns:</span>
<span class="sd">      delete_l: a list of all possible strings obtained by deleting 1 character from word</span>
<span class="sd">    """</span>

    <span class="n">delete_l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">split_l</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">### START CODE HERE ###</span>
    <span class="n">split_l</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">delete_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">split_l</span> <span class="k">if</span> <span class="n">right</span><span class="p">]</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"input word </span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">, </span><span class="se">\n</span><span class="s2">split_l = </span><span class="si">{</span><span class="n">split_l</span><span class="si">}</span><span class="s2">, </span><span class="se">\n</span><span class="s2">delete_l = </span><span class="si">{</span><span class="n">delete_l</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">delete_l</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">delete_word_l</span> <span class="o">=</span> <span class="n">delete_letter</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">"cans"</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">delete_word_l</span> <span class="o">==</span> <span class="p">[</span><span class="s1">'ans'</span><span class="p">,</span> <span class="s1">'cns'</span><span class="p">,</span> <span class="s1">'cas'</span><span class="p">,</span> <span class="s1">'can'</span><span class="p">]</span>
</pre></div>
<pre class="example">
input word cans, 
split_l = [('', 'cans'), ('c', 'ans'), ('ca', 'ns'), ('can', 's'), ('cans', '')], 
delete_l = ['ans', 'cns', 'cas', 'can']
</pre>
<div class="highlight">
<pre><span></span><span class="n">deleted</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">delete_letter</span><span class="p">(</span><span class="s1">'at'</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of outputs of delete_letter('at') is </span><span class="si">{</span><span class="n">deleted</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">deleted</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
<pre class="example">
Number of outputs of delete_letter('at') is 2
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgb3847f1">
<h3 id="orgb3847f1">Switch Letter</h3>
<div class="outline-text-3" id="text-orgb3847f1">
<p>Now implement a function that switches two letters in a word. It takes in a word and returns a list of all the possible switches of two letters <b>that are adjacent to each other</b>.</p>
<ul class="org-ul">
<li>For example, given the word 'eta', it returns {'eat', 'tea'}, but does not return 'ate'.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">switch_letter</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Switches pairs of adjacent letters</span>

<span class="sd">    Args:</span>
<span class="sd">      word: input string</span>
<span class="sd">    Returns:</span>
<span class="sd">      switches: a list of all possible strings with one adjacent charater switched</span>
<span class="sd">    """</span>

    <span class="n">switch_l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">split_l</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">### START CODE HERE ###</span>
    <span class="n">split_l</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">switch_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">left</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">split_l</span>
                <span class="k">if</span> <span class="n">left</span> <span class="ow">and</span> <span class="n">right</span><span class="p">]</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Input word = </span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">split_l = </span><span class="si">{</span><span class="n">split_l</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">switch_l = </span><span class="si">{</span><span class="n">switch_l</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> 

    <span class="k">return</span> <span class="n">switch_l</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">switch_word_l</span> <span class="o">=</span> <span class="n">switch_letter</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">"eta"</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">switch_word_l</span> <span class="o">==</span> <span class="p">[</span><span class="s1">'tea'</span><span class="p">,</span> <span class="s1">'eat'</span><span class="p">]</span>
</pre></div>
<pre class="example">
Input word = eta 
split_l = [('', 'eta'), ('e', 'ta'), ('et', 'a'), ('eta', '')] 
switch_l = ['tea', 'eat']
</pre>
<div class="highlight">
<pre><span></span><span class="n">switches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">switch_letter</span><span class="p">(</span><span class="s1">'at'</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of outputs of switch_letter('at') is </span><span class="si">{</span><span class="n">switches</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">switches</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
<pre class="example">
Number of outputs of switch_letter('at') is 1
</pre></div>
</div>
<div class="outline-3" id="outline-container-org9d0e3a5">
<h3 id="org9d0e3a5">Replace Letter</h3>
<div class="outline-text-3" id="text-org9d0e3a5">
<p>Now implement a function that takes in a word and returns a list of strings with one <b>replaced letter</b> from the original word.</p>
<ul class="org-ul">
<li><b>Step 1:</b> is the same as in `delete_letter()`</li>
<li><b>Step 2:</b> A list comprehension or for loop which form strings by replacing letters. This can be of the form:</li>
</ul>
<p><code>[f(a,b,c) for a, b in splits if condition for c in string]</code> Note the use of the second for loop. It is expected in this routine that one or more of the replacements will include the original word. For example, replacing the first letter of 'ear' with 'e' will return 'ear'.</p>
<ul class="org-ul">
<li><b>Step 3:</b> Remove the original input letter from the output.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">replace_letter</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Replace each letter in the string with another letter in the alphabet</span>

<span class="sd">    Args:</span>
<span class="sd">      word: the input string/word </span>

<span class="sd">    Returns:</span>
<span class="sd">      replaces: a list of all possible strings where we replaced one letter from the original word. </span>
<span class="sd">    """</span>

    <span class="n">letters</span> <span class="o">=</span> <span class="s1">'abcdefghijklmnopqrstuvwxyz'</span>
    <span class="n">replace_l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">split_l</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">### START CODE HERE ###</span>
    <span class="n">split_l</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">replace_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span> <span class="o">+</span> <span class="n">letter</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">split_l</span> <span class="k">if</span> <span class="n">right</span>
                <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]</span>
    <span class="n">replace_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">replace_l</span><span class="p">)</span>
    <span class="n">replace_set</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="c1"># turn the set back into a list and sort it, for easier viewing</span>
    <span class="n">replace_l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">replace_set</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Input word = </span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">split_l = </span><span class="si">{</span><span class="n">split_l</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">replace_l </span><span class="si">{</span><span class="n">replace_l</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>   

    <span class="k">return</span> <span class="n">replace_l</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s2">"can"</span>
<span class="n">replace_l</span> <span class="o">=</span> <span class="n">replace_letter</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">expected_replacements</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">*</span> <span class="mi">26</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">replace_l</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_replacements</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Replacements: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">replace_l</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'aan'</span><span class="p">,</span> <span class="s1">'ban'</span><span class="p">,</span> <span class="s1">'caa'</span><span class="p">,</span> <span class="s1">'cab'</span><span class="p">,</span> <span class="s1">'cac'</span><span class="p">,</span> <span class="s1">'cad'</span><span class="p">,</span> <span class="s1">'cae'</span><span class="p">,</span> <span class="s1">'caf'</span><span class="p">,</span> <span class="s1">'cag'</span><span class="p">,</span> <span class="s1">'cah'</span><span class="p">,</span> <span class="s1">'cai'</span><span class="p">,</span> <span class="s1">'caj'</span><span class="p">,</span> <span class="s1">'cak'</span><span class="p">,</span> <span class="s1">'cal'</span><span class="p">,</span> <span class="s1">'cam'</span><span class="p">,</span> <span class="s1">'cao'</span><span class="p">,</span> <span class="s1">'cap'</span><span class="p">,</span> <span class="s1">'caq'</span><span class="p">,</span> <span class="s1">'car'</span><span class="p">,</span> <span class="s1">'cas'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">,</span> <span class="s1">'cau'</span><span class="p">,</span> <span class="s1">'cav'</span><span class="p">,</span> <span class="s1">'caw'</span><span class="p">,</span> <span class="s1">'cax'</span><span class="p">,</span> <span class="s1">'cay'</span><span class="p">,</span> <span class="s1">'caz'</span><span class="p">,</span> <span class="s1">'cbn'</span><span class="p">,</span> <span class="s1">'ccn'</span><span class="p">,</span> <span class="s1">'cdn'</span><span class="p">,</span> <span class="s1">'cen'</span><span class="p">,</span> <span class="s1">'cfn'</span><span class="p">,</span> <span class="s1">'cgn'</span><span class="p">,</span> <span class="s1">'chn'</span><span class="p">,</span> <span class="s1">'cin'</span><span class="p">,</span> <span class="s1">'cjn'</span><span class="p">,</span> <span class="s1">'ckn'</span><span class="p">,</span> <span class="s1">'cln'</span><span class="p">,</span> <span class="s1">'cmn'</span><span class="p">,</span> <span class="s1">'cnn'</span><span class="p">,</span> <span class="s1">'con'</span><span class="p">,</span> <span class="s1">'cpn'</span><span class="p">,</span> <span class="s1">'cqn'</span><span class="p">,</span> <span class="s1">'crn'</span><span class="p">,</span> <span class="s1">'csn'</span><span class="p">,</span> <span class="s1">'ctn'</span><span class="p">,</span> <span class="s1">'cun'</span><span class="p">,</span> <span class="s1">'cvn'</span><span class="p">,</span> <span class="s1">'cwn'</span><span class="p">,</span> <span class="s1">'cxn'</span><span class="p">,</span> <span class="s1">'cyn'</span><span class="p">,</span> <span class="s1">'czn'</span><span class="p">,</span> <span class="s1">'dan'</span><span class="p">,</span> <span class="s1">'ean'</span><span class="p">,</span> <span class="s1">'fan'</span><span class="p">,</span> <span class="s1">'gan'</span><span class="p">,</span> <span class="s1">'han'</span><span class="p">,</span> <span class="s1">'ian'</span><span class="p">,</span> <span class="s1">'jan'</span><span class="p">,</span> <span class="s1">'kan'</span><span class="p">,</span> <span class="s1">'lan'</span><span class="p">,</span> <span class="s1">'man'</span><span class="p">,</span> <span class="s1">'nan'</span><span class="p">,</span> <span class="s1">'oan'</span><span class="p">,</span> <span class="s1">'pan'</span><span class="p">,</span> <span class="s1">'qan'</span><span class="p">,</span> <span class="s1">'ran'</span><span class="p">,</span> <span class="s1">'san'</span><span class="p">,</span> <span class="s1">'tan'</span><span class="p">,</span> <span class="s1">'uan'</span><span class="p">,</span> <span class="s1">'van'</span><span class="p">,</span> <span class="s1">'wan'</span><span class="p">,</span> <span class="s1">'xan'</span><span class="p">,</span> <span class="s1">'yan'</span><span class="p">,</span> <span class="s1">'zan'</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">replace_l</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
<pre class="example">
Input word = can 
split_l = [('', 'can'), ('c', 'an'), ('ca', 'n'), ('can', '')] 
replace_l ['aan', 'ban', 'caa', 'cab', 'cac', 'cad', 'cae', 'caf', 'cag', 'cah', 'cai', 'caj', 'cak', 'cal', 'cam', 'cao', 'cap', 'caq', 'car', 'cas', 'cat', 'cau', 'cav', 'caw', 'cax', 'cay', 'caz', 'cbn', 'ccn', 'cdn', 'cen', 'cfn', 'cgn', 'chn', 'cin', 'cjn', 'ckn', 'cln', 'cmn', 'cnn', 'con', 'cpn', 'cqn', 'crn', 'csn', 'ctn', 'cun', 'cvn', 'cwn', 'cxn', 'cyn', 'czn', 'dan', 'ean', 'fan', 'gan', 'han', 'ian', 'jan', 'kan', 'lan', 'man', 'nan', 'oan', 'pan', 'qan', 'ran', 'san', 'tan', 'uan', 'van', 'wan', 'xan', 'yan', 'zan']
Replacements: 75
</pre>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s2">"at"</span>
<span class="n">replacements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">replace_letter</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of outputs of replace_letter('at') is </span><span class="si">{</span><span class="n">replacements</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">*</span> <span class="mi">26</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">replacements</span>
</pre></div>
<pre class="example">
Number of outputs of replace_letter('at') is 50
</pre></div>
</div>
<div class="outline-3" id="outline-container-orga8147d4">
<h3 id="orga8147d4">Insert Letter</h3>
<div class="outline-text-3" id="text-orga8147d4">
<p>Now implement a function that takes in a word and returns a list with a letter inserted at every offset.</p>
<ul class="org-ul">
<li><b>Step 1:</b> is the same as in `delete_letter()`</li>
<li><b>Step 2:</b> This can be a list comprehension of the form: <code>[f(a,b,c) for a, b in splits if condition for c in string]</code></li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">insert_letter</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Stick a letter before and after each letter in the word</span>

<span class="sd">    Args:</span>
<span class="sd">      word: the input string/word </span>

<span class="sd">    Returns:</span>
<span class="sd">      inserts: a set of all possible strings with one new letter inserted at every offset</span>
<span class="sd">    """</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="s1">'abcdefghijklmnopqrstuvwxyz'</span>
    <span class="n">insert_l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">split_l</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">### START CODE HERE ###</span>
    <span class="n">split_l</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">insert_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span> <span class="o">+</span> <span class="n">letter</span> <span class="o">+</span> <span class="n">right</span> <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">split_l</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Input word </span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">split_l = </span><span class="si">{</span><span class="n">split_l</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">insert_l = </span><span class="si">{</span><span class="n">insert_l</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">insert_l</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s2">"at"</span>
<span class="n">insert_l</span> <span class="o">=</span> <span class="n">insert_letter</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">inserted</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_l</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of strings output by insert_letter('at') is </span><span class="si">{</span><span class="n">inserted</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">inserted</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">26</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'aat'</span><span class="p">,</span> <span class="s1">'bat'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">,</span> <span class="s1">'dat'</span><span class="p">,</span> <span class="s1">'eat'</span><span class="p">,</span> <span class="s1">'fat'</span><span class="p">,</span> <span class="s1">'gat'</span><span class="p">,</span> <span class="s1">'hat'</span><span class="p">,</span> <span class="s1">'iat'</span><span class="p">,</span> <span class="s1">'jat'</span><span class="p">,</span> <span class="s1">'kat'</span><span class="p">,</span> <span class="s1">'lat'</span><span class="p">,</span> <span class="s1">'mat'</span><span class="p">,</span> <span class="s1">'nat'</span><span class="p">,</span> <span class="s1">'oat'</span><span class="p">,</span> <span class="s1">'pat'</span><span class="p">,</span> <span class="s1">'qat'</span><span class="p">,</span> <span class="s1">'rat'</span><span class="p">,</span> <span class="s1">'sat'</span><span class="p">,</span> <span class="s1">'tat'</span><span class="p">,</span> <span class="s1">'uat'</span><span class="p">,</span> <span class="s1">'vat'</span><span class="p">,</span> <span class="s1">'wat'</span><span class="p">,</span> <span class="s1">'xat'</span><span class="p">,</span> <span class="s1">'yat'</span><span class="p">,</span> <span class="s1">'zat'</span><span class="p">,</span> <span class="s1">'aat'</span><span class="p">,</span> <span class="s1">'abt'</span><span class="p">,</span> <span class="s1">'act'</span><span class="p">,</span> <span class="s1">'adt'</span><span class="p">,</span> <span class="s1">'aet'</span><span class="p">,</span> <span class="s1">'aft'</span><span class="p">,</span> <span class="s1">'agt'</span><span class="p">,</span> <span class="s1">'aht'</span><span class="p">,</span> <span class="s1">'ait'</span><span class="p">,</span> <span class="s1">'ajt'</span><span class="p">,</span> <span class="s1">'akt'</span><span class="p">,</span> <span class="s1">'alt'</span><span class="p">,</span> <span class="s1">'amt'</span><span class="p">,</span> <span class="s1">'ant'</span><span class="p">,</span> <span class="s1">'aot'</span><span class="p">,</span> <span class="s1">'apt'</span><span class="p">,</span> <span class="s1">'aqt'</span><span class="p">,</span> <span class="s1">'art'</span><span class="p">,</span> <span class="s1">'ast'</span><span class="p">,</span> <span class="s1">'att'</span><span class="p">,</span> <span class="s1">'aut'</span><span class="p">,</span> <span class="s1">'avt'</span><span class="p">,</span> <span class="s1">'awt'</span><span class="p">,</span> <span class="s1">'axt'</span><span class="p">,</span> <span class="s1">'ayt'</span><span class="p">,</span> <span class="s1">'azt'</span><span class="p">,</span> <span class="s1">'ata'</span><span class="p">,</span> <span class="s1">'atb'</span><span class="p">,</span> <span class="s1">'atc'</span><span class="p">,</span> <span class="s1">'atd'</span><span class="p">,</span> <span class="s1">'ate'</span><span class="p">,</span> <span class="s1">'atf'</span><span class="p">,</span> <span class="s1">'atg'</span><span class="p">,</span> <span class="s1">'ath'</span><span class="p">,</span> <span class="s1">'ati'</span><span class="p">,</span> <span class="s1">'atj'</span><span class="p">,</span> <span class="s1">'atk'</span><span class="p">,</span> <span class="s1">'atl'</span><span class="p">,</span> <span class="s1">'atm'</span><span class="p">,</span> <span class="s1">'atn'</span><span class="p">,</span> <span class="s1">'ato'</span><span class="p">,</span> <span class="s1">'atp'</span><span class="p">,</span> <span class="s1">'atq'</span><span class="p">,</span> <span class="s1">'atr'</span><span class="p">,</span> <span class="s1">'ats'</span><span class="p">,</span> <span class="s1">'att'</span><span class="p">,</span> <span class="s1">'atu'</span><span class="p">,</span> <span class="s1">'atv'</span><span class="p">,</span> <span class="s1">'atw'</span><span class="p">,</span> <span class="s1">'atx'</span><span class="p">,</span> <span class="s1">'aty'</span><span class="p">,</span> <span class="s1">'atz'</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">insert_l</span>
</pre></div>
<pre class="example">
Input word at 
split_l = [('', 'at'), ('a', 't'), ('at', '')] 
insert_l = ['aat', 'bat', 'cat', 'dat', 'eat', 'fat', 'gat', 'hat', 'iat', 'jat', 'kat', 'lat', 'mat', 'nat', 'oat', 'pat', 'qat', 'rat', 'sat', 'tat', 'uat', 'vat', 'wat', 'xat', 'yat', 'zat', 'aat', 'abt', 'act', 'adt', 'aet', 'aft', 'agt', 'aht', 'ait', 'ajt', 'akt', 'alt', 'amt', 'ant', 'aot', 'apt', 'aqt', 'art', 'ast', 'att', 'aut', 'avt', 'awt', 'axt', 'ayt', 'azt', 'ata', 'atb', 'atc', 'atd', 'ate', 'atf', 'atg', 'ath', 'ati', 'atj', 'atk', 'atl', 'atm', 'atn', 'ato', 'atp', 'atq', 'atr', 'ats', 'att', 'atu', 'atv', 'atw', 'atx', 'aty', 'atz']
Number of strings output by insert_letter('at') is 78
</pre>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s2">"at"</span>
<span class="n">inserted</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_letter</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of outputs of insert_letter('at') is </span><span class="si">{</span><span class="n">inserted</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">26</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">inserted</span>
</pre></div>
<pre class="example">
Number of outputs of insert_letter('at') is 78
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org21316b6">
<h2 id="org21316b6">End</h2>
<div class="outline-text-2" id="text-org21316b6"></div>
<div class="outline-3" id="outline-container-org0374a54">
<h3 id="org0374a54">The Editor</h3>
<div class="outline-text-3" id="text-org0374a54">
<p>Now to bundle it up for later.</p>
</div>
<div class="outline-4" id="outline-container-orgb6091cf">
<h4 id="orgb6091cf">Imports</h4>
<div class="outline-text-4" id="text-orgb6091cf">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">ascii_lowercase</span>
<span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orga415e5a">
<h4 id="orga415e5a">The Editor Class</h4>
<div class="outline-text-4" id="text-orga415e5a">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TheEditor</span><span class="p">:</span>
    <span class="sd">"""Does various edits to words</span>

<span class="sd">    Args:</span>
<span class="sd">     word: string to edit</span>
<span class="sd">    """</span>
    <span class="n">word</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_splits</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_deleted</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_switched</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_replaced</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_inserted</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1c88dd7">
<h4 id="org1c88dd7">Splits</h4>
<div class="outline-text-4" id="text-org1c88dd7">
<p>A list of splits.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">splits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Tuples of splits for word"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_splits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_splits</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
                        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_splits</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge57ce8a">
<h4 id="orge57ce8a">Deleted</h4>
<div class="outline-text-4" id="text-orge57ce8a">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Deletes one letter at a time from the word</span>

<span class="sd">    Returns:</span>
<span class="sd">     list of all possible strings created by deleting one letter</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                         <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splits</span> <span class="k">if</span> <span class="n">right</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3200209">
<h4 id="org3200209">Switched</h4>
<div class="outline-text-4" id="text-org3200209">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">switched</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""switches one letter pair at a time</span>

<span class="sd">    Returns:</span>
<span class="sd">     all possible strings with one adjacent charater switched</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_switched</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_switched</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">left</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                          <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splits</span>
                          <span class="k">if</span> <span class="n">left</span> <span class="ow">and</span> <span class="n">right</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_switched</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge964ba4">
<h4 id="orge964ba4">Replace a Letter</h4>
<div class="outline-text-4" id="text-orge964ba4">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">replaced</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Replace each letter with every other letter of the alphabet</span>

<span class="sd">    Returns:</span>
<span class="sd">     replacements in alphabetical order (doesn't include original word)</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replaced</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replaced</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">left</span> <span class="o">+</span> <span class="n">letter</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                              <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splits</span> <span class="k">if</span> <span class="n">right</span>
                              <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">ascii_lowercase</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replaced</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replaced</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_replaced</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replaced</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgaa60bc2">
<h4 id="orgaa60bc2">Insert Letters</h4>
<div class="outline-text-4" id="text-orgaa60bc2">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">inserted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Adds letters before and after each letter</span>

<span class="sd">    Returns:</span>
<span class="sd">      all possible strings with one new letter inserted at every offset</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inserted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inserted</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span> <span class="o">+</span> <span class="n">letter</span> <span class="o">+</span> <span class="n">right</span>
                          <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splits</span>
                          <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">ascii_lowercase</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inserted</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org6553c85">
<h3 id="org6553c85">Checking the Editor</h3>
<div class="outline-text-3" id="text-org6553c85">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.edits</span> <span class="kn">import</span> <span class="n">TheEditor</span>

<span class="n">editor</span> <span class="o">=</span> <span class="n">TheEditor</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">"cans"</span><span class="p">)</span>

<span class="c1"># splits</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'cans'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'c'</span><span class="p">,</span> <span class="s1">'ans'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'ca'</span><span class="p">,</span> <span class="s1">'ns'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'can'</span><span class="p">,</span> <span class="s1">'s'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'cans'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)]</span>
<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">splits</span> <span class="o">==</span> <span class="n">expected</span><span class="p">,</span> <span class="n">editor</span><span class="o">.</span><span class="n">splits</span>

<span class="c1"># deletions</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'ans'</span><span class="p">,</span> <span class="s1">'cns'</span><span class="p">,</span> <span class="s1">'cas'</span><span class="p">,</span> <span class="s1">'can'</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">deleted</span> <span class="o">==</span> <span class="n">expected</span>

<span class="c1"># switches</span>
<span class="n">word</span> <span class="o">=</span> <span class="s2">"eta"</span>
<span class="n">editor</span> <span class="o">=</span> <span class="n">TheEditor</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'tea'</span><span class="p">,</span> <span class="s1">'eat'</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">editor</span><span class="o">.</span><span class="n">switched</span> <span class="o">==</span> <span class="n">expected</span>

<span class="n">editor</span> <span class="o">=</span> <span class="n">TheEditor</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">"at"</span><span class="p">)</span>
<span class="n">switches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">switched</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of outputs of switch_letter('at') is </span><span class="si">{</span><span class="n">switches</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">switches</span> <span class="o">==</span> <span class="mi">1</span>

<span class="c1"># replacements</span>
<span class="n">word</span> <span class="o">=</span> <span class="s2">"can"</span>
<span class="n">editor</span> <span class="o">=</span> <span class="n">TheEditor</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="n">replacements</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">replaced</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">*</span> <span class="mi">26</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">replacements</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"expected: </span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s2"> actual: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">replacements</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'aan'</span><span class="p">,</span> <span class="s1">'ban'</span><span class="p">,</span> <span class="s1">'caa'</span><span class="p">,</span> <span class="s1">'cab'</span><span class="p">,</span> <span class="s1">'cac'</span><span class="p">,</span> <span class="s1">'cad'</span><span class="p">,</span> <span class="s1">'cae'</span><span class="p">,</span> <span class="s1">'caf'</span><span class="p">,</span> <span class="s1">'cag'</span><span class="p">,</span> <span class="s1">'cah'</span><span class="p">,</span> <span class="s1">'cai'</span><span class="p">,</span> <span class="s1">'caj'</span><span class="p">,</span> <span class="s1">'cak'</span><span class="p">,</span> <span class="s1">'cal'</span><span class="p">,</span> <span class="s1">'cam'</span><span class="p">,</span> <span class="s1">'cao'</span><span class="p">,</span> <span class="s1">'cap'</span><span class="p">,</span> <span class="s1">'caq'</span><span class="p">,</span> <span class="s1">'car'</span><span class="p">,</span> <span class="s1">'cas'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">,</span> <span class="s1">'cau'</span><span class="p">,</span> <span class="s1">'cav'</span><span class="p">,</span> <span class="s1">'caw'</span><span class="p">,</span> <span class="s1">'cax'</span><span class="p">,</span> <span class="s1">'cay'</span><span class="p">,</span> <span class="s1">'caz'</span><span class="p">,</span> <span class="s1">'cbn'</span><span class="p">,</span> <span class="s1">'ccn'</span><span class="p">,</span> <span class="s1">'cdn'</span><span class="p">,</span> <span class="s1">'cen'</span><span class="p">,</span> <span class="s1">'cfn'</span><span class="p">,</span> <span class="s1">'cgn'</span><span class="p">,</span> <span class="s1">'chn'</span><span class="p">,</span> <span class="s1">'cin'</span><span class="p">,</span> <span class="s1">'cjn'</span><span class="p">,</span> <span class="s1">'ckn'</span><span class="p">,</span> <span class="s1">'cln'</span><span class="p">,</span> <span class="s1">'cmn'</span><span class="p">,</span> <span class="s1">'cnn'</span><span class="p">,</span> <span class="s1">'con'</span><span class="p">,</span> <span class="s1">'cpn'</span><span class="p">,</span> <span class="s1">'cqn'</span><span class="p">,</span> <span class="s1">'crn'</span><span class="p">,</span> <span class="s1">'csn'</span><span class="p">,</span> <span class="s1">'ctn'</span><span class="p">,</span> <span class="s1">'cun'</span><span class="p">,</span> <span class="s1">'cvn'</span><span class="p">,</span> <span class="s1">'cwn'</span><span class="p">,</span> <span class="s1">'cxn'</span><span class="p">,</span> <span class="s1">'cyn'</span><span class="p">,</span> <span class="s1">'czn'</span><span class="p">,</span> <span class="s1">'dan'</span><span class="p">,</span> <span class="s1">'ean'</span><span class="p">,</span> <span class="s1">'fan'</span><span class="p">,</span> <span class="s1">'gan'</span><span class="p">,</span> <span class="s1">'han'</span><span class="p">,</span> <span class="s1">'ian'</span><span class="p">,</span> <span class="s1">'jan'</span><span class="p">,</span> <span class="s1">'kan'</span><span class="p">,</span> <span class="s1">'lan'</span><span class="p">,</span> <span class="s1">'man'</span><span class="p">,</span> <span class="s1">'nan'</span><span class="p">,</span> <span class="s1">'oan'</span><span class="p">,</span> <span class="s1">'pan'</span><span class="p">,</span> <span class="s1">'qan'</span><span class="p">,</span> <span class="s1">'ran'</span><span class="p">,</span> <span class="s1">'san'</span><span class="p">,</span> <span class="s1">'tan'</span><span class="p">,</span> <span class="s1">'uan'</span><span class="p">,</span> <span class="s1">'van'</span><span class="p">,</span> <span class="s1">'wan'</span><span class="p">,</span> <span class="s1">'xan'</span><span class="p">,</span> <span class="s1">'yan'</span><span class="p">,</span> <span class="s1">'zan'</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">replacements</span> <span class="o">==</span> <span class="n">expected</span>

<span class="n">word</span> <span class="o">=</span> <span class="s2">"at"</span>
<span class="n">editor</span> <span class="o">=</span> <span class="n">TheEditor</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">*</span> <span class="mi">26</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">replaced</span><span class="p">)</span>

<span class="c1"># Insertions</span>
<span class="n">inserted</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">inserted</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">inserted</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">26</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'aat'</span><span class="p">,</span> <span class="s1">'bat'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">,</span> <span class="s1">'dat'</span><span class="p">,</span> <span class="s1">'eat'</span><span class="p">,</span> <span class="s1">'fat'</span><span class="p">,</span> <span class="s1">'gat'</span><span class="p">,</span> <span class="s1">'hat'</span><span class="p">,</span> <span class="s1">'iat'</span><span class="p">,</span> <span class="s1">'jat'</span><span class="p">,</span> <span class="s1">'kat'</span><span class="p">,</span> <span class="s1">'lat'</span><span class="p">,</span> <span class="s1">'mat'</span><span class="p">,</span> <span class="s1">'nat'</span><span class="p">,</span> <span class="s1">'oat'</span><span class="p">,</span> <span class="s1">'pat'</span><span class="p">,</span> <span class="s1">'qat'</span><span class="p">,</span> <span class="s1">'rat'</span><span class="p">,</span> <span class="s1">'sat'</span><span class="p">,</span> <span class="s1">'tat'</span><span class="p">,</span> <span class="s1">'uat'</span><span class="p">,</span> <span class="s1">'vat'</span><span class="p">,</span> <span class="s1">'wat'</span><span class="p">,</span> <span class="s1">'xat'</span><span class="p">,</span> <span class="s1">'yat'</span><span class="p">,</span> <span class="s1">'zat'</span><span class="p">,</span> <span class="s1">'aat'</span><span class="p">,</span> <span class="s1">'abt'</span><span class="p">,</span> <span class="s1">'act'</span><span class="p">,</span> <span class="s1">'adt'</span><span class="p">,</span> <span class="s1">'aet'</span><span class="p">,</span> <span class="s1">'aft'</span><span class="p">,</span> <span class="s1">'agt'</span><span class="p">,</span> <span class="s1">'aht'</span><span class="p">,</span> <span class="s1">'ait'</span><span class="p">,</span> <span class="s1">'ajt'</span><span class="p">,</span> <span class="s1">'akt'</span><span class="p">,</span> <span class="s1">'alt'</span><span class="p">,</span> <span class="s1">'amt'</span><span class="p">,</span> <span class="s1">'ant'</span><span class="p">,</span> <span class="s1">'aot'</span><span class="p">,</span> <span class="s1">'apt'</span><span class="p">,</span> <span class="s1">'aqt'</span><span class="p">,</span> <span class="s1">'art'</span><span class="p">,</span> <span class="s1">'ast'</span><span class="p">,</span> <span class="s1">'att'</span><span class="p">,</span> <span class="s1">'aut'</span><span class="p">,</span> <span class="s1">'avt'</span><span class="p">,</span> <span class="s1">'awt'</span><span class="p">,</span> <span class="s1">'axt'</span><span class="p">,</span> <span class="s1">'ayt'</span><span class="p">,</span> <span class="s1">'azt'</span><span class="p">,</span> <span class="s1">'ata'</span><span class="p">,</span> <span class="s1">'atb'</span><span class="p">,</span> <span class="s1">'atc'</span><span class="p">,</span> <span class="s1">'atd'</span><span class="p">,</span> <span class="s1">'ate'</span><span class="p">,</span> <span class="s1">'atf'</span><span class="p">,</span> <span class="s1">'atg'</span><span class="p">,</span> <span class="s1">'ath'</span><span class="p">,</span> <span class="s1">'ati'</span><span class="p">,</span> <span class="s1">'atj'</span><span class="p">,</span> <span class="s1">'atk'</span><span class="p">,</span> <span class="s1">'atl'</span><span class="p">,</span> <span class="s1">'atm'</span><span class="p">,</span> <span class="s1">'atn'</span><span class="p">,</span> <span class="s1">'ato'</span><span class="p">,</span> <span class="s1">'atp'</span><span class="p">,</span> <span class="s1">'atq'</span><span class="p">,</span> <span class="s1">'atr'</span><span class="p">,</span> <span class="s1">'ats'</span><span class="p">,</span> <span class="s1">'att'</span><span class="p">,</span> <span class="s1">'atu'</span><span class="p">,</span> <span class="s1">'atv'</span><span class="p">,</span> <span class="s1">'atw'</span><span class="p">,</span> <span class="s1">'atx'</span><span class="p">,</span> <span class="s1">'aty'</span><span class="p">,</span> <span class="s1">'atz'</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">editor</span><span class="o">.</span><span class="n">inserted</span>

<span class="n">word</span> <span class="o">=</span> <span class="s2">"at"</span>
<span class="n">editor</span> <span class="o">=</span> <span class="n">TheEditor</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="n">inserted</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">inserted</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of outputs of insert_letter('at') is </span><span class="si">{</span><span class="n">inserted</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">26</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">inserted</span>
</pre></div>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/autocorrect-system-data-preprocessing/">Autocorrect System: Data Preprocessing</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/autocorrect-system-data-preprocessing/" rel="bookmark"><time class="published dt-published" datetime="2020-11-05T18:42:59-08:00" itemprop="datePublished" title="2020-11-05 18:42">2020-11-05 18:42</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#orgc4dc713">Beginning</a>
<ul>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#org7221288">Imports</a></li>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#org2e1de6e">Set Up</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#orgacef71b">Middle</a>
<ul>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#orgfead697">The Process Data Function</a></li>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#org95553ff">Get Count</a></li>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#org92c0b44">Get Probability</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#org7a0ae59">End</a>
<ul>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#org0c25ad1">Imports</a></li>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#orgebce82a">Corpus Builder</a></li>
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/#orgc0eb5ac">Testing the Corpus</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgc4dc713">
<h2 id="orgc4dc713">Beginning</h2>
<div class="outline-text-2" id="text-orgc4dc713">
<p>This is part of a series that builds an autocorrect system. The introduction is <a href="posts/nlp/autocorrect-the-system/">this post</a>.</p>
</div>
<div class="outline-3" id="outline-container-org7221288">
<h3 id="org7221288">Imports</h3>
<div class="outline-text-3" id="text-org7221288">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2e1de6e">
<h3 id="org2e1de6e">Set Up</h3>
<div class="outline-text-3" id="text-org2e1de6e"></div>
<div class="outline-4" id="outline-container-org30242d8">
<h4 id="org30242d8">The Environment</h4>
<div class="outline-text-4" id="text-org30242d8">
<p>This loads our environment variables.</p>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgacef71b">
<h2 id="orgacef71b">Middle</h2>
<div class="outline-text-2" id="text-orgacef71b">
<p>Our corpus is going to come from a text file with some plays of Shakespeare in it.</p>
</div>
<div class="outline-3" id="outline-container-orgfead697">
<h3 id="orgfead697">The Process Data Function</h3>
<div class="outline-text-3" id="text-orgfead697">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    pre-processes the text file</span>

<span class="sd">    Note:</span>
<span class="sd">     The original assignment assumes the file will be in the same directory as </span>
<span class="sd">    the code - so it's called file_name for now but it's really the path to </span>
<span class="sd">    the file</span>

<span class="sd">    Args: </span>
<span class="sd">       a path to the text file</span>

<span class="sd">    Returns: </span>
<span class="sd">       words: list of all words in the corpus (text file you read) lower-cased</span>
<span class="sd">    """</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">"\w+"</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">words</span> <span class="o">+=</span> <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">words</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">words</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"SHAKESPEARE"</span><span class="p">])</span>
<span class="n">vocabulary</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>  <span class="c1"># this will be your new vocabulary</span>
<span class="n">first_ten</span> <span class="o">=</span> <span class="n">words</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The first ten words in the text are: </span><span class="se">\n</span><span class="si">{</span><span class="n">first_ten</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique words in the vocabulary."</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="s2">"o for a muse of fire that would ascend the"</span>
<span class="n">actual</span> <span class="o">=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">first_ten</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span><span class="p">,</span> <span class="n">actual</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6116</span>
</pre></div>
<pre class="example">
The first ten words in the text are: 
['o', 'for', 'a', 'muse', 'of', 'fire', 'that', 'would', 'ascend', 'the']
There are 6116 unique words in the vocabulary.
</pre></div>
</div>
<div class="outline-3" id="outline-container-org95553ff">
<h3 id="org95553ff">Get Count</h3>
<div class="outline-text-3" id="text-org95553ff">
<p>This creates a dictionary of word: count pairs.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">get_count</span><span class="p">(</span><span class="n">word_l</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Counter</span><span class="p">:</span>
    <span class="sd">"""Creates a counter for the words</span>

<span class="sd">    Args:</span>
<span class="sd">       word_l: a list of words representing the corpus. </span>

<span class="sd">    Returns:</span>
<span class="sd">       word_counter: word-frequency dictionary</span>
<span class="sd">    """</span>

    <span class="n">word_count_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># fill this with word counts</span>
    <span class="c1">### START CODE HERE </span>
    <span class="n">word_count_dict</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">word_l</span><span class="p">)</span>
    <span class="c1">### END CODE HERE ### </span>
    <span class="k">return</span> <span class="n">word_count_dict</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">word_counter</span> <span class="o">=</span> <span class="n">get_count</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">word_counter</span><span class="p">)</span><span class="si">}</span><span class="s2"> key values pairs"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The count for the word 'thee' is </span><span class="si">{</span><span class="n">word_counter</span><span class="p">[</span><span class="s1">'thee'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_counter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6116</span>
<span class="k">assert</span> <span class="n">word_counter</span><span class="p">[</span><span class="s1">'thee'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">240</span>
</pre></div>
<pre class="example">
There are 6116 key values pairs
The count for the word 'thee' is 240
</pre></div>
</div>
<div class="outline-3" id="outline-container-org92c0b44">
<h3 id="org92c0b44">Get Probability</h3>
<div class="outline-text-3" id="text-org92c0b44">
<p>Given the dictionary of word counts, compute the probability that each word will appear if randomly selected from the corpus of words.</p>
<p>\[ P(w_i) = \frac{C(w_i)}{M} \tag{Equation-2} \]</p>
<p>where</p>
<p>\(C(w_i)\) is the total number of times \(w_i\) appears in the corpus.</p>
<p><i>M</i> is the total number of words in the corpus.</p>
<p>For example, the probability of the word 'am' in the sentence <b>'I am happy because I am learning'</b> is:</p>
<p>\[ P(am) = \frac{C(w_i)}{M} = \frac {2}{7} \tag{Equation-3} \]</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">get_probs</span><span class="p">(</span><span class="n">word_count_dict</span><span class="p">:</span> <span class="n">Counter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""Calculates the probability of each word</span>

<span class="sd">    Args:</span>
<span class="sd">      word_count_dict: word:frequency dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">      probs: word:probability of word dictionary</span>
<span class="sd">    """</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># return this variable correctly</span>

    <span class="c1">### START CODE HERE ###</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">word_count_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">word</span><span class="p">:</span> <span class="n">word_count_dict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">/</span><span class="n">total</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_count_dict</span><span class="p">}</span>
    <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">probs</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">probabilities</span> <span class="o">=</span> <span class="n">get_probs</span><span class="p">(</span><span class="n">word_counter</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Length of probabilities is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">thee_probability</span> <span class="o">=</span> <span class="n">probabilities</span><span class="p">[</span><span class="s2">"thee"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"P('thee') is </span><span class="si">{</span><span class="n">thee_probability</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6116</span>
<span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">thee_probability</span><span class="p">,</span> <span class="mf">0.0045</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-04</span><span class="p">),</span> <span class="n">thee_probability</span>
</pre></div>
<pre class="example">
Length of probabilities is 6116
P('thee') is 0.0045
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org7a0ae59">
<h2 id="org7a0ae59">End</h2>
<div class="outline-text-2" id="text-org7a0ae59">
<p>Now that we have the skeleton I'll put it all into a class to make it easier to use it in another notebook.</p>
</div>
<div class="outline-3" id="outline-container-org0c25ad1">
<h3 id="org0c25ad1">Imports</h3>
<div class="outline-text-3" id="text-org0c25ad1">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgebce82a">
<h3 id="orgebce82a">Corpus Builder</h3>
<div class="outline-text-3" id="text-orgebce82a">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CorpusBuilder</span><span class="p">:</span>
    <span class="sd">"""Builds the autocorrect corpus counts</span>

<span class="sd">    Args:</span>
<span class="sd">     path: Path to the corpus source file</span>
<span class="sd">    """</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">Path</span>
    <span class="n">_words</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_counts</span><span class="p">:</span> <span class="n">Counter</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_probabilities</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_vocabulary</span><span class="p">:</span> <span class="nb">set</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org01bf279">
<h4 id="org01bf279">Corpus Words</h4>
<div class="outline-text-4" id="text-org01bf279">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">words</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    The processed words from the source file</span>

<span class="sd">    Returns: </span>
<span class="sd">      words: list of all words in the corpus lower-cased</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_words</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">tokenized</span> <span class="o">=</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">"\w+"</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">tokenized</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_words</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgeab703e">
<h4 id="orgeab703e">Corpus Word Counts</h4>
<div class="outline-text-4" id="text-orgeab703e">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Counter</span><span class="p">:</span>
    <span class="sd">"""The counter for the words in the corpus</span>

<span class="sd">    Returns:</span>
<span class="sd">     word: word-frequency counter</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org58e37d7">
<h4 id="org58e37d7">Corpus Word Probabilities</h4>
<div class="outline-text-4" id="text-org58e37d7">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""The probability for each word in the corpus</span>

<span class="sd">    Returns:</span>
<span class="sd">     word:probability dictionary</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities</span> <span class="o">=</span> <span class="p">{</span><span class="n">word</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">/</span><span class="n">total</span>
                               <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgdccbe37">
<h4 id="orgdccbe37">Vocabulary</h4>
<div class="outline-text-4" id="text-orgdccbe37">
<p>The final code is going to use set operations so for convenience I'll duplicate the <code>words</code> as a set.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
    <span class="sd">"""The set of vocabulary words"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc0eb5ac">
<h3 id="orgc0eb5ac">Testing the Corpus</h3>
<div class="outline-text-3" id="text-orgc0eb5ac">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.preprocessing</span> <span class="kn">import</span> <span class="n">CorpusBuilder</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"SHAKESPEARE"</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>

<span class="n">corpus</span> <span class="o">=</span> <span class="n">CorpusBuilder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="n">words</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">words</span>
<span class="n">vocabulary</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">vocabulary</span>  <span class="c1"># this will be your new vocabulary</span>
<span class="n">first_ten</span> <span class="o">=</span> <span class="n">words</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The first ten words in the text are: </span><span class="se">\n</span><span class="si">{</span><span class="n">first_ten</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique words in the vocabulary."</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="s2">"o for a muse of fire that would ascend the"</span>
<span class="n">actual</span> <span class="o">=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">first_ten</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span><span class="p">,</span> <span class="n">actual</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6116</span>
</pre></div>
<pre class="example">
The first ten words in the text are: 
['o', 'for', 'a', 'muse', 'of', 'fire', 'that', 'would', 'ascend', 'the']
There are 6116 unique words in the vocabulary.
</pre>
<div class="highlight">
<pre><span></span><span class="n">word_counter</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">counts</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">word_counter</span><span class="p">)</span><span class="si">}</span><span class="s2"> key values pairs"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The count for the word 'thee' is </span><span class="si">{</span><span class="n">word_counter</span><span class="p">[</span><span class="s1">'thee'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_counter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6116</span>
<span class="k">assert</span> <span class="n">word_counter</span><span class="p">[</span><span class="s1">'thee'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">240</span>
</pre></div>
<pre class="example">
There are 6116 key values pairs
The count for the word 'thee' is 240
</pre>
<div class="highlight">
<pre><span></span><span class="n">probabilities</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">probabilities</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Length of probabilities is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">thee_probability</span> <span class="o">=</span> <span class="n">probabilities</span><span class="p">[</span><span class="s2">"thee"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"P('thee') is </span><span class="si">{</span><span class="n">thee_probability</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6116</span>
<span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">thee_probability</span><span class="p">,</span> <span class="mf">0.0045</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-04</span><span class="p">),</span> <span class="n">thee_probability</span>
</pre></div>
<pre class="example">
Length of probabilities is 6116
P('thee') is 0.0045
</pre>
<p>So, now we have a corpus builder. In the next part - <a href="posts/nlp/autocorrect-system-edits/">Autocorrect System: Edits</a> - we'll implement some functions to help with creating candidate replacements using edits.</p>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/autocorrect-the-system/">Autocorrect: The System</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/autocorrect-the-system/" rel="bookmark"><time class="published dt-published" datetime="2020-11-05T18:17:54-08:00" itemprop="datePublished" title="2020-11-05 18:17">2020-11-05 18:17</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/autocorrect-the-system/#org4e1fd49">The Posts In the Series</a></li>
<li><a href="posts/nlp/autocorrect-the-system/#orga138a35">Beginning</a></li>
<li><a href="posts/nlp/autocorrect-the-system/#org0d4816d">Middle</a>
<ul>
<li><a href="posts/nlp/autocorrect-the-system/#orge61d262">Edit Distance</a></li>
<li><a href="posts/nlp/autocorrect-the-system/#orgf115364">Optional - Backtrace</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-the-system/#org32fd434">End</a></li>
<li><a href="posts/nlp/autocorrect-the-system/#org6ddad92">Raw</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org4e1fd49">
<h2 id="org4e1fd49">The Posts In the Series</h2>
<div class="outline-text-2" id="text-org4e1fd49">
<ul class="org-ul">
<li><a href="posts/nlp/autocorrect-system-data-preprocessing/">Data Preprocessing</a></li>
<li><a href="posts/nlp/autocorrect-system-edits/">Edits</a></li>
<li><a href="posts/nlp/autocorrect-system-combining-the-edits/">Combining the Edits</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance/">Finding the Closest Candidate</a></li>
<li><a href="posts/nlp/autocorrect-minimum-edit-distance-backtrace/">Finding the Shortest Path</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orga138a35">
<h2 id="orga138a35">Beginning</h2>
</div>
<div class="outline-2" id="outline-container-org0d4816d">
<h2 id="org0d4816d">Middle</h2>
<div class="outline-text-2" id="text-org0d4816d"></div>
<div class="outline-3" id="outline-container-orge61d262">
<h3 id="orge61d262">Edit Distance</h3>
<div class="outline-text-3" id="text-orge61d262">
<p>In this assignment, you will implement models that correct words that are 1 and 2 edit distances away.</p>
<ul class="org-ul">
<li>We say two words are <i>n</i> edit distance away from each other when we need <i>n</i> edits to change one word into another.</li>
</ul>
<p>An edit could consist of one of the following options:</p>
<ul class="org-ul">
<li>Delete (remove a letter): ‘hat’ =&gt; ‘at, ha, ht’</li>
<li>Switch (swap 2 adjacent letters): ‘eta’ =&gt; ‘eat, tea,…’</li>
<li>Replace (change 1 letter to another): ‘jat’ =&gt; ‘hat, rat, cat, mat, …’</li>
<li>Insert (add a letter): ‘te’ =&gt; ‘the, ten, ate, …’</li>
</ul>
<p>You will be using the four methods above to implement an Auto-correct system.</p>
<ul class="org-ul">
<li>To do so, you will need to compute probabilities that a certain word is correct given an input.</li>
</ul>
<p>This auto-correct system was first created by <a href="https://en.wikipedia.org/wiki/Peter_Norvig">Peter Norvig</a> in 2007 in <a href="https://norvig.com/spell-correct.html">this article</a>.</p>
<p>The goal of our spell check model is to compute the following probability:</p>
<p>\[ P(c|w) = \frac{P(w|c)\times P(c)}{P(w)} \tag{Equation 1} \]</p>
<p>The equation above is <a href="https://en.wikipedia.org/wiki/Bayes%27_theorem">Bayes Rule</a>.</p>
<ul class="org-ul">
<li>Equation 1 says that the probability of a word being correct \(P(c|w)\) is equal to the probability of having a certain word <i>w</i>, given that it is correct \(P(w|c)\), multiplied by the probability of being correct in general \(P(C)\) divided by the probability of that word <i>w</i> appearing \(P(w)\) in general.</li>
<li>To compute equation 1, you will first import a data set and then create all the probabilities that you need using that data set.</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-orgf115364">
<h3 id="orgf115364">Optional - Backtrace</h3>
<div class="outline-text-3" id="text-orgf115364"></div>
</div>
</div>
<div class="outline-2" id="outline-container-org32fd434">
<h2 id="org32fd434">End</h2>
</div>
<div class="outline-2" id="outline-container-org6ddad92">
<h2 id="org6ddad92">Raw</h2>
<div class="outline-text-2" id="text-org6ddad92">
<pre class="example">
# # Assignment 1: Auto Correct
# 
# Welcome to the first assignment of Course 2. This assignment will give you a chance to brush up on your python and probability skills. In doing so, you will implement an auto-correct system that is very effective and useful.

# ## Outline
# - [0. Overview](#0)
#     - [0.1 Edit Distance](#0-1)
# - [1. Data Preprocessing](#1)
#     - [1.1 Exercise 1](#ex-1)
#     - [1.2 Exercise 2](#ex-2)
#     - [1.3 Exercise 3](#ex-3)
# - [2. String Manipulation](#2)
#     - [2.1 Exercise 4](#ex-4)
#     - [2.2 Exercise 5](#ex-5)
#     - [2.3 Exercise 6](#ex-6)
#     - [2.4 Exercise 7](#ex-7)
# - [3. Combining the edits](#3)
#     - [3.1 Exercise 8](#ex-8)
#     - [3.2 Exercise 9](#ex-9)
#     - [3.3 Exercise 10](#ex-10)
# - [4. Minimum Edit Distance](#4)
#     - [4.1 Exercise 11](#ex-11)
# - [5. Backtrace (Optional)](#5)

# &lt;a name='0'&gt;&lt;/a&gt;
# ## 0. Overview
# 
# You use autocorrect every day on your cell phone and computer. In this assignment, you will explore what really goes on behind the scenes. Of course, the model you are about to implement is not identical to the one used in your phone, but it is still quite good. 
# 
# By completing this assignment you will learn how to: 
# 
# - Get a word count given a corpus
# - Get a word probability in the corpus 
# - Manipulate strings 
# - Filter strings 
# - Implement Minimum edit distance to compare strings and to help find the optimal path for the edits. 
# - Understand how dynamic programming works
# 
# 
# Similar systems are used everywhere. 
# - For example, if you type in the word **"I am lerningg"**, chances are very high that you meant to write **"learning"**, as shown in **Figure 1**. 

# &lt;div style="width:image width px; font-size:100%; text-align:center;"&gt;&lt;img src='auto-correct.png' alt="alternate text" width="width" height="height" style="width:300px;height:250px;" /&gt; Figure 1 &lt;/div&gt;

# &lt;a name='1'&gt;&lt;/a&gt;
# # Part 1: Data Preprocessing 

# In[ ]:


import re
from collections import Counter
import numpy as np
import pandas as pd


# As in any other machine learning task, the first thing you have to do is process your data set. 
# - Many courses load in pre-processed data for you. 
# - However, in the real world, when you build these NLP systems, you load the datasets and process them.
# - So let's get some real world practice in pre-processing the data!
# 
# Your first task is to read in a file called **'shakespeare.txt'** which is found in your file directory. To look at this file you can go to `File ==&gt; Open `. 

# &lt;a name='ex-1'&gt;&lt;/a&gt;
# ### Exercise 1
# Implement the function `process_data` which 
# 
# 1) Reads in a corpus (text file)
# 
# 2) Changes everything to lowercase
# 
# 3) Returns a list of words. 

# #### Options and Hints
# - If you would like more of a real-life practice, don't open the 'Hints' below (yet) and try searching the web to derive your answer.
# - If you want a little help, click on the green "General Hints" section by clicking on it with your mouse.
# - If you get stuck or are not getting the expected results, click on the green 'Detailed Hints' section to get hints for each step that you'll take to complete this function.

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;General Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
#     
# General Hints to get started
# &lt;ul&gt;
#     &lt;li&gt;Python &lt;a href="https://docs.python.org/3/tutorial/inputoutput.html"&gt;input and output&lt;a&gt;&lt;/li&gt;
#     &lt;li&gt;Python &lt;a href="https://docs.python.org/3/library/re.html" &gt;'re' documentation &lt;/a&gt; &lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Detailed Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;     
# Detailed hints if you're stuck
# &lt;ul&gt;
#     &lt;li&gt;Use 'with' syntax to read a file&lt;/li&gt;
#     &lt;li&gt;Decide whether to use 'read()' or 'readline().  What's the difference?&lt;/li&gt;
#     &lt;li&gt;Choose whether to use either str.lower() or str.lowercase().  What is the difference?&lt;/li&gt;
#     &lt;li&gt;Use re.findall(pattern, string)&lt;/li&gt;
#     &lt;li&gt;Look for the "Raw String Notation" section in the Python 're' documentation to understand the difference between r'\W', r'\W' and '\\W'. &lt;/li&gt;
#     &lt;li&gt;For the pattern, decide between using '\s', '\w', '\s+' or '\w+'.  What do you think are the differences?&lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# In[ ]:


# UNQ_C1 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# GRADED FUNCTION: process_data
def process_data(file_name):
    """
    Input: 
        A file_name which is found in your current directory. You just have to read it in. 
    Output: 
        words: a list containing all the words in the corpus (text file you read) in lower case. 
    """
    words = [] # return this variable correctly

    ### START CODE HERE ### 
    
    ### END CODE HERE ###
    
    return words


# Note, in the following cell, 'words' is converted to a python `set`. This eliminates any duplicate entries.

# In[ ]:


#DO NOT MODIFY THIS CELL
word_l = process_data('shakespeare.txt')
vocab = set(word_l)  # this will be your new vocabulary
print(f"The first ten words in the text are: \n{word_l[0:10]}")
print(f"There are {len(vocab)} unique words in the vocabulary.")


# #### Expected Output
# ```Python
# The first ten words in the text are: 
# ['o', 'for', 'a', 'muse', 'of', 'fire', 'that', 'would', 'ascend', 'the']
# There are 6116 unique words in the vocabulary.
# ```

# &lt;a name='ex-2'&gt;&lt;/a&gt;
# ### Exercise 2
# 
# Implement a `get_count` function that returns a dictionary
# - The dictionary's keys are words
# - The value for each word is the number of times that word appears in the corpus. 
# 
# For example, given the following sentence: **"I am happy because I am learning"**, your dictionary should return the following: 
# &lt;table style="width:20%"&gt;
# 
#   &lt;tr&gt;
#     &lt;td&gt; &lt;b&gt;Key &lt;/b&gt;  &lt;/td&gt;
#     &lt;td&gt; &lt;b&gt;Value &lt;/b&gt; &lt;/td&gt; 
# 
# 
#   &lt;/tr&gt;
#   &lt;tr&gt;
#     &lt;td&gt; I  &lt;/td&gt;
#     &lt;td&gt; 2&lt;/td&gt; 
#  
#   &lt;/tr&gt;
#    
#   &lt;tr&gt;
#     &lt;td&gt;am&lt;/td&gt;
#     &lt;td&gt;2&lt;/td&gt; 
#   &lt;/tr&gt;
# 
#   &lt;tr&gt;
#     &lt;td&gt;happy&lt;/td&gt;
#     &lt;td&gt;1&lt;/td&gt; 
#   &lt;/tr&gt;
#   
#    &lt;tr&gt;
#     &lt;td&gt;because&lt;/td&gt;
#     &lt;td&gt;1&lt;/td&gt; 
#   &lt;/tr&gt;
#   
#    &lt;tr&gt;
#     &lt;td&gt;learning&lt;/td&gt;
#     &lt;td&gt;1&lt;/td&gt; 
#   &lt;/tr&gt;
# &lt;/table&gt;
# 
# 
# **Instructions**: 
# Implement a `get_count` which returns a dictionary where the key is a word and the value is the number of times the word appears in the list.  
# 

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt;Try implementing this using a for loop and a regular dictionary. This may be good practice for similar coding interview questions&lt;/li&gt;
#     &lt;li&gt;You can also use defaultdict instead of a regualr dictionary, along with the for loop&lt;/li&gt;
#     &lt;li&gt;Otherwise, to skip using a for loop, you can use Python's &lt;a href="https://docs.python.org/3.7/library/collections.html#collections.Counter" &gt; Counter class&lt;/a&gt; &lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;

# In[ ]:


# UNQ_C2 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# UNIT TEST COMMENT: Candidate for Table Driven Tests
# GRADED FUNCTION: get_count
def get_count(word_l):
    '''
    Input:
        word_l: a set of words representing the corpus. 
    Output:
        word_count_dict: The wordcount dictionary where key is the word and value is its frequency.
    '''
    
    word_count_dict = {}  # fill this with word counts
    ### START CODE HERE 
            
    ### END CODE HERE ### 
    return word_count_dict


# In[ ]:


#DO NOT MODIFY THIS CELL
word_count_dict = get_count(word_l)
print(f"There are {len(word_count_dict)} key values pairs")
print(f"The count for the word 'thee' is {word_count_dict.get('thee',0)}")


# 
# #### Expected Output
# ```Python
# There are 6116 key values pairs
# The count for the word 'thee' is 240
# ```

# &lt;a name='ex-3'&gt;&lt;/a&gt;
# ### Exercise 3
# Given the dictionary of word counts, compute the probability that each word will appear if randomly selected from the corpus of words.
# 
# $$P(w_i) = \frac{C(w_i)}{M} \tag{Eqn-2}$$
# where 
# 
# $C(w_i)$ is the total number of times $w_i$ appears in the corpus.
# 
# $M$ is the total number of words in the corpus.
# 
# For example, the probability of the word 'am' in the sentence **'I am happy because I am learning'** is:
# 
# $$P(am) = \frac{C(w_i)}{M} = \frac {2}{7} \tag{Eqn-3}.$$
# 
# **Instructions:** Implement `get_probs` function which gives you the probability 
# that a word occurs in a sample. This returns a dictionary where the keys are words, and the value for each word is its probability in the corpus of words.

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# General advice
# &lt;ul&gt;
#     &lt;li&gt; Use dictionary.values() &lt;/li&gt;
#     &lt;li&gt; Use sum() &lt;/li&gt;
#     &lt;li&gt; The cardinality (number of words in the corpus should be equal to len(word_l).  You will calculate this same number, but using the word count dictionary.&lt;/li&gt;
# &lt;/ul&gt;
#     
# If you're using a for loop:
# &lt;ul&gt;
#     &lt;li&gt; Use dictionary.keys() &lt;/li&gt;
# &lt;/ul&gt;
#     
# If you're using a dictionary comprehension:
# &lt;ul&gt;
#     &lt;li&gt;Use dictionary.items() &lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# In[ ]:


# UNQ_C3 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# GRADED FUNCTION: get_probs
def get_probs(word_count_dict):
    '''
    Input:
        word_count_dict: The wordcount dictionary where key is the word and value is its frequency.
    Output:
        probs: A dictionary where keys are the words and the values are the probability that a word will occur. 
    '''
    probs = {}  # return this variable correctly
    
    ### START CODE HERE ###
    
    ### END CODE HERE ###
    return probs


# In[ ]:


#DO NOT MODIFY THIS CELL
probs = get_probs(word_count_dict)
print(f"Length of probs is {len(probs)}")
print(f"P('thee') is {probs['thee']:.4f}")


# #### Expected Output
# 
# ```Python
# Length of probs is 6116
# P('thee') is 0.0045
# ```

# &lt;a name='2'&gt;&lt;/a&gt;
# # Part 2: String Manipulations
# 
# Now, that you have computed $P(w_i)$ for all the words in the corpus, you will write a few functions to manipulate strings so that you can edit the erroneous strings and return the right spellings of the words. In this section, you will implement four functions: 
# 
# * `delete_letter`: given a word, it returns all the possible strings that have **one character removed**. 
# * `switch_letter`: given a word, it returns all the possible strings that have **two adjacent letters switched**.
# * `replace_letter`: given a word, it returns all the possible strings that have **one character replaced by another different letter**.
# * `insert_letter`: given a word, it returns all the possible strings that have an **additional character inserted**. 
# 

# #### List comprehensions
# 
# String and list manipulation in python will often make use of a python feature called  [list comprehensions](https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions). The routines below will be described as using list comprehensions, but if you would rather implement them in another way, you are free to do so as long as the result is the same. Further, the following section will provide detailed instructions on how to use list comprehensions and how to implement the desired functions. If you are a python expert, feel free to skip the python hints and move to implementing the routines directly.

# Python List Comprehensions embed a looping structure inside of a list declaration, collapsing many lines of code into a single line. If you are not familiar with them, they seem slightly out of order relative to for loops. 

# &lt;div style="width:image width px; font-size:100%; text-align:center;"&gt;&lt;img src='GenericListComp3.PNG' alt="alternate text" width="width" height="height"  style="width:800px;height:400px;"/&gt; Figure 2 &lt;/div&gt;

# The diagram above shows that the components of a list comprehension are the same components you would find in a typical for loop that appends to a list, but in a different order. With that in mind, we'll continue the specifics of this assignment. We will be very descriptive for the first function, `deletes()`, and less so in later functions as you become familiar with list comprehensions.

# &lt;a name='ex-4'&gt;&lt;/a&gt;
# ### Exercise 4
# 
# **Instructions for delete_letter():** Implement a `delete_letter()` function that, given a word, returns a list of strings with one character deleted. 
# 
# For example, given the word **nice**, it would return the set: {'ice', 'nce', 'nic', 'nie'}. 
# 
# **Step 1:** Create a list of 'splits'. This is all the ways you can split a word into Left and Right: For example,   
# 'nice is split into : `[('', 'nice'), ('n', 'ice'), ('ni', 'ce'), ('nic', 'e'), ('nice', '')]`
# This is common to all four functions (delete, replace, switch, insert).
# 

# &lt;div style="width:image width px; font-size:100%; text-align:center;"&gt;&lt;img src='Splits1.PNG' alt="alternate text" width="width" height="height" style="width:650px;height:200px;" /&gt; Figure 3 &lt;/div&gt;

# **Step 2:** This is specific to `delete_letter`. Here, we are generating all words that result from deleting one character.  
# This can be done in a single line with a list comprehension. You can make use of this type of syntax:  
# `[f(a,b) for a, b in splits if condition]`  
# 
# For our 'nice' example you get: 
# ['ice', 'nce', 'nie', 'nic']

# &lt;div style="width:image width px; font-size:100%; text-align:center;"&gt;&lt;img src='ListComp2.PNG' alt="alternate text" width="width" height="height" style="width:550px;height:300px;" /&gt; Figure 4 &lt;/div&gt;

# #### Levels of assistance
# 
# Try this exercise with these levels of assistance.  
# - We hope that this will make it both a meaningful experience but also not a frustrating experience. 
# - Start with level 1, then move onto level 2, and 3 as needed.
# 
#     - Level 1. Try to think this through and implement this yourself.
#     - Level 2. Click on the "Level 2 Hints" section for some hints to get started.
#     - Level 3. If you would prefer more guidance, please click on the "Level 3 Hints" cell for step by step instructions.
#     
# - If you are still stuck, look at the images in the "list comprehensions" section above.
# 

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Level 2 Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt;&lt;a href="" &gt; Use array slicing like my_string[0:2] &lt;/a&gt; &lt;/li&gt;
#     &lt;li&gt;&lt;a href="" &gt; Use list comprehensions or for loops &lt;/a&gt; &lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Level 3 Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt;splits: Use array slicing, like my_str[0:2], to separate a string into two pieces.&lt;/li&gt;
#     &lt;li&gt;Do this in a loop or list comprehension, so that you have a list of tuples.
#     &lt;li&gt; For example, "cake" can get split into "ca" and "ke". They're stored in a tuple ("ca","ke"), and the tuple is appended to a list.  We'll refer to these as L and R, so the tuple is (L,R)&lt;/li&gt;
#     &lt;li&gt;When choosing the range for your loop, if you input the word "cans" and generate the tuple  ('cans',''), make sure to include an if statement to check the length of that right-side string (R) in the tuple (L,R) &lt;/li&gt;
#     &lt;li&gt;deletes: Go through the list of tuples and combine the two strings together. You can use the + operator to combine two strings&lt;/li&gt;
#     &lt;li&gt;When combining the tuples, make sure that you leave out a middle character.&lt;/li&gt;
#     &lt;li&gt;Use array slicing to leave out the first character of the right substring.&lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;

# In[ ]:


# UNQ_C4 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# UNIT TEST COMMENT: Candidate for Table Driven Tests
# GRADED FUNCTION: deletes
def delete_letter(word, verbose=False):
    '''
    Input:
        word: the string/word for which you will generate all possible words 
                in the vocabulary which have 1 missing character
    Output:
        delete_l: a list of all possible strings obtained by deleting 1 character from word
    '''
    
    delete_l = []
    split_l = []
    
    ### START CODE HERE ###
    
    ### END CODE HERE ###

    if verbose: print(f"input word {word}, \nsplit_l = {split_l}, \ndelete_l = {delete_l}")

    return delete_l


# In[ ]:


delete_word_l = delete_letter(word="cans",
                        verbose=True)


# #### Expected Output
# ```CPP
# Note: You might get a slightly different result with split_l
# 
# input word cans, 
# split_l = [('', 'cans'), ('c', 'ans'), ('ca', 'ns'), ('can', 's')], 
# delete_l = ['ans', 'cns', 'cas', 'can']
# ```

# #### Note 1
# - Notice how it has the extra tuple `('cans', '')`.
# - This will be fine as long as you have checked the size of the right-side substring in tuple (L,R).
# - Can you explain why this will give you the same result for the list of deletion strings (delete_l)?
# 
# ```CPP
# input word cans, 
# split_l = [('', 'cans'), ('c', 'ans'), ('ca', 'ns'), ('can', 's'), ('cans', '')], 
# delete_l = ['ans', 'cns', 'cas', 'can']
# ```

# #### Note 2
# If you end up getting the same word as your input word, like this:
# 
# ```Python
# input word cans, 
# split_l = [('', 'cans'), ('c', 'ans'), ('ca', 'ns'), ('can', 's'), ('cans', '')], 
# delete_l = ['ans', 'cns', 'cas', 'can', 'cans']
# ```
# 
# - Check how you set the `range`.
# - See if you check the length of the string on the right-side of the split.

# In[ ]:


# test # 2
print(f"Number of outputs of delete_letter('at') is {len(delete_letter('at'))}")


# #### Expected output
# 
# ```CPP
# Number of outputs of delete_letter('at') is 2
# ```

# &lt;a name='ex-5'&gt;&lt;/a&gt;
# ### Exercise 5
# 
# **Instructions for switch_letter()**: Now implement a function that switches two letters in a word. It takes in a word and returns a list of all the possible switches of two letters **that are adjacent to each other**. 
# - For example, given the word 'eta', it returns {'eat', 'tea'}, but does not return 'ate'.
# 
# **Step 1:** is the same as in delete_letter()  
# **Step 2:** A list comprehension or for loop which forms strings by swapping adjacent letters. This is of the form:  
# `[f(L,R) for L, R in splits if condition]`  where 'condition' will test the length of R in a given iteration. See below.

# &lt;div style="width:image width px; font-size:100%; text-align:center;"&gt;&lt;img src='Switches1.PNG' alt="alternate text" width="width" height="height" style="width:600px;height:200px;"/&gt; Figure 5 &lt;/div&gt;      

# #### Levels of difficulty
# 
# Try this exercise with these levels of difficulty.  
# - Level 1. Try to think this through and implement this yourself.
# - Level 2. Click on the "Level 2 Hints" section for some hints to get started.
# - Level 3. If you would prefer more guidance, please click on the "Level 3 Hints" cell for step by step instructions.

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Level 2 Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt;&lt;a href="" &gt; Use array slicing like my_string[0:2] &lt;/a&gt; &lt;/li&gt;
#     &lt;li&gt;&lt;a href="" &gt; Use list comprehensions or for loops &lt;/a&gt; &lt;/li&gt;
#     &lt;li&gt;To do a switch, think of the whole word as divided into 4 distinct parts.  Write out 'cupcakes' on a piece of paper and see how you can split it into ('cupc', 'k', 'a', 'es')&lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Level 3 Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt;splits: Use array slicing, like my_str[0:2], to separate a string into two pieces.&lt;/li&gt;
#     &lt;li&gt;Splitting is the same as for delete_letter&lt;/li&gt;
#     &lt;li&gt;To perform the switch, go through the list of tuples and combine four strings together. You can use the + operator to combine strings&lt;/li&gt;
#     &lt;li&gt;The four strings will be the left substring from the split tuple, followed by the first (index 1) character of the right substring, then the zero-th character (index 0) of the right substring, and then the remaining part of the right substring.&lt;/li&gt;
#     &lt;li&gt;Unlike delete_letter, you will want to check that your right substring is at least a minimum length.  To see why, review the previous hint bullet point (directly before this one).&lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;

# In[ ]:


# UNQ_C5 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# UNIT TEST COMMENT: Candidate for Table Driven Tests
# GRADED FUNCTION: switches
def switch_letter(word, verbose=False):
    '''
    Input:
        word: input string
     Output:
        switches: a list of all possible strings with one adjacent charater switched
    ''' 
    
    switch_l = []
    split_l = []
    
    ### START CODE HERE ###
    
    ### END CODE HERE ###
    
    if verbose: print(f"Input word = {word} \nsplit_l = {split_l} \nswitch_l = {switch_l}") 

    return switch_l


# In[ ]:


switch_word_l = switch_letter(word="eta",
                         verbose=True)


# #### Expected output
# 
# ```Python
# Input word = eta 
# split_l = [('', 'eta'), ('e', 'ta'), ('et', 'a')] 
# switch_l = ['tea', 'eat']
# ```

# #### Note 1
# 
# You may get this:
# ```Python
# Input word = eta 
# split_l = [('', 'eta'), ('e', 'ta'), ('et', 'a'), ('eta', '')] 
# switch_l = ['tea', 'eat']
# ```
# - Notice how it has the extra tuple `('eta', '')`.
# - This is also correct.
# - Can you think of why this is the case?

# #### Note 2
# 
# If you get an error
# ```Python
# IndexError: string index out of range
# ```
# - Please see if you have checked the length of the strings when switching characters.

# In[ ]:


# test # 2
print(f"Number of outputs of switch_letter('at') is {len(switch_letter('at'))}")


# #### Expected output
# 
# ```CPP
# Number of outputs of switch_letter('at') is 1
# ```

# &lt;a name='ex-6'&gt;&lt;/a&gt;
# ### Exercise 6
# **Instructions for replace_letter()**: Now implement a function that takes in a word and returns a list of strings with one **replaced letter** from the original word. 
# 
# **Step 1:** is the same as in `delete_letter()`
# 
# **Step 2:** A list comprehension or for loop which form strings by replacing letters.  This can be of the form:  
# `[f(a,b,c) for a, b in splits if condition for c in string]`   Note the use of the second for loop.  
# It is expected in this routine that one or more of the replacements will include the original word. For example, replacing the first letter of 'ear' with 'e' will return 'ear'.
# 
# **Step 3:** Remove the original input letter from the output.

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt;To remove a word from a list, first store its contents inside a set()&lt;/li&gt;
#     &lt;li&gt;Use set.discard('the_word') to remove a word in a set (if the word does not exist in the set, then it will not throw a KeyError.  Using set.remove('the_word') throws a KeyError if the word does not exist in the set. &lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# In[ ]:


# UNQ_C6 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# UNIT TEST COMMENT: Candidate for Table Driven Tests
# GRADED FUNCTION: replaces
def replace_letter(word, verbose=False):
    '''
    Input:
        word: the input string/word 
    Output:
        replaces: a list of all possible strings where we replaced one letter from the original word. 
    ''' 
    
    letters = 'abcdefghijklmnopqrstuvwxyz'
    replace_l = []
    split_l = []
    
    ### START CODE HERE ###

    ### END CODE HERE ###
    
    # turn the set back into a list and sort it, for easier viewing
    replace_l = sorted(list(replace_set))
    
    if verbose: print(f"Input word = {word} \nsplit_l = {split_l} \nreplace_l {replace_l}")   
    
    return replace_l


# In[ ]:


replace_l = replace_letter(word='can',
                              verbose=True)


# #### Expected Output**: 
# ```Python
# Input word = can 
# split_l = [('', 'can'), ('c', 'an'), ('ca', 'n')] 
# replace_l ['aan', 'ban', 'caa', 'cab', 'cac', 'cad', 'cae', 'caf', 'cag', 'cah', 'cai', 'caj', 'cak', 'cal', 'cam', 'cao', 'cap', 'caq', 'car', 'cas', 'cat', 'cau', 'cav', 'caw', 'cax', 'cay', 'caz', 'cbn', 'ccn', 'cdn', 'cen', 'cfn', 'cgn', 'chn', 'cin', 'cjn', 'ckn', 'cln', 'cmn', 'cnn', 'con', 'cpn', 'cqn', 'crn', 'csn', 'ctn', 'cun', 'cvn', 'cwn', 'cxn', 'cyn', 'czn', 'dan', 'ean', 'fan', 'gan', 'han', 'ian', 'jan', 'kan', 'lan', 'man', 'nan', 'oan', 'pan', 'qan', 'ran', 'san', 'tan', 'uan', 'van', 'wan', 'xan', 'yan', 'zan']
# ```
# - Note how the input word 'can' should not be one of the output words.

# #### Note 1
# If you get something like this:
# 
# ```Python
# Input word = can 
# split_l = [('', 'can'), ('c', 'an'), ('ca', 'n'), ('can', '')] 
# replace_l ['aan', 'ban', 'caa', 'cab', 'cac', 'cad', 'cae', 'caf', 'cag', 'cah', 'cai', 'caj', 'cak', 'cal', 'cam', 'cao', 'cap', 'caq', 'car', 'cas', 'cat', 'cau', 'cav', 'caw', 'cax', 'cay', 'caz', 'cbn', 'ccn', 'cdn', 'cen', 'cfn', 'cgn', 'chn', 'cin', 'cjn', 'ckn', 'cln', 'cmn', 'cnn', 'con', 'cpn', 'cqn', 'crn', 'csn', 'ctn', 'cun', 'cvn', 'cwn', 'cxn', 'cyn', 'czn', 'dan', 'ean', 'fan', 'gan', 'han', 'ian', 'jan', 'kan', 'lan', 'man', 'nan', 'oan', 'pan', 'qan', 'ran', 'san', 'tan', 'uan', 'van', 'wan', 'xan', 'yan', 'zan']
# ```
# - Notice how split_l has an extra tuple `('can', '')`, but the output is still the same, so this is okay.

# #### Note 2
# If you get something like this:
# ```Python
# Input word = can 
# split_l = [('', 'can'), ('c', 'an'), ('ca', 'n'), ('can', '')] 
# replace_l ['aan', 'ban', 'caa', 'cab', 'cac', 'cad', 'cae', 'caf', 'cag', 'cah', 'cai', 'caj', 'cak', 'cal', 'cam', 'cana', 'canb', 'canc', 'cand', 'cane', 'canf', 'cang', 'canh', 'cani', 'canj', 'cank', 'canl', 'canm', 'cann', 'cano', 'canp', 'canq', 'canr', 'cans', 'cant', 'canu', 'canv', 'canw', 'canx', 'cany', 'canz', 'cao', 'cap', 'caq', 'car', 'cas', 'cat', 'cau', 'cav', 'caw', 'cax', 'cay', 'caz', 'cbn', 'ccn', 'cdn', 'cen', 'cfn', 'cgn', 'chn', 'cin', 'cjn', 'ckn', 'cln', 'cmn', 'cnn', 'con', 'cpn', 'cqn', 'crn', 'csn', 'ctn', 'cun', 'cvn', 'cwn', 'cxn', 'cyn', 'czn', 'dan', 'ean', 'fan', 'gan', 'han', 'ian', 'jan', 'kan', 'lan', 'man', 'nan', 'oan', 'pan', 'qan', 'ran', 'san', 'tan', 'uan', 'van', 'wan', 'xan', 'yan', 'zan']
# ```
# - Notice how there are strings that are 1 letter longer than the original word, such as `cana`.
# - Please check for the case when there is an empty string `''`, and if so, do not use that empty string when setting replace_l.

# In[ ]:


# test # 2
print(f"Number of outputs of switch_letter('at') is {len(switch_letter('at'))}")


# #### Expected output
# ```CPP
# Number of outputs of switch_letter('at') is 1
# ```

# &lt;a name='ex-7'&gt;&lt;/a&gt;
# ### Exercise 7
# 
# **Instructions for insert_letter()**: Now implement a function that takes in a word and returns a list with a letter inserted at every offset.
# 
# **Step 1:** is the same as in `delete_letter()`
# 
# **Step 2:** This can be a list comprehension of the form:  
# `[f(a,b,c) for a, b in splits if condition for c in string]`   

# In[ ]:


# UNQ_C7 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# UNIT TEST COMMENT: Candidate for Table Driven Tests
# GRADED FUNCTION: inserts
def insert_letter(word, verbose=False):
    '''
    Input:
        word: the input string/word 
    Output:
        inserts: a set of all possible strings with one new letter inserted at every offset
    ''' 
    letters = 'abcdefghijklmnopqrstuvwxyz'
    insert_l = []
    split_l = []
    
    ### START CODE HERE ###

    ### END CODE HERE ###

    if verbose: print(f"Input word {word} \nsplit_l = {split_l} \ninsert_l = {insert_l}")
    
    return insert_l


# In[ ]:


insert_l = insert_letter('at', True)
print(f"Number of strings output by insert_letter('at') is {len(insert_l)}")


# #### Expected output
# 
# ```Python
# Input word at 
# split_l = [('', 'at'), ('a', 't'), ('at', '')] 
# insert_l = ['aat', 'bat', 'cat', 'dat', 'eat', 'fat', 'gat', 'hat', 'iat', 'jat', 'kat', 'lat', 'mat', 'nat', 'oat', 'pat', 'qat', 'rat', 'sat', 'tat', 'uat', 'vat', 'wat', 'xat', 'yat', 'zat', 'aat', 'abt', 'act', 'adt', 'aet', 'aft', 'agt', 'aht', 'ait', 'ajt', 'akt', 'alt', 'amt', 'ant', 'aot', 'apt', 'aqt', 'art', 'ast', 'att', 'aut', 'avt', 'awt', 'axt', 'ayt', 'azt', 'ata', 'atb', 'atc', 'atd', 'ate', 'atf', 'atg', 'ath', 'ati', 'atj', 'atk', 'atl', 'atm', 'atn', 'ato', 'atp', 'atq', 'atr', 'ats', 'att', 'atu', 'atv', 'atw', 'atx', 'aty', 'atz']
# Number of strings output by insert_letter('at') is 78
# ```

# #### Note 1
# 
# If you get a split_l like this:
# ```Python
# Input word at 
# split_l = [('', 'at'), ('a', 't')] 
# insert_l = ['aat', 'bat', 'cat', 'dat', 'eat', 'fat', 'gat', 'hat', 'iat', 'jat', 'kat', 'lat', 'mat', 'nat', 'oat', 'pat', 'qat', 'rat', 'sat', 'tat', 'uat', 'vat', 'wat', 'xat', 'yat', 'zat', 'aat', 'abt', 'act', 'adt', 'aet', 'aft', 'agt', 'aht', 'ait', 'ajt', 'akt', 'alt', 'amt', 'ant', 'aot', 'apt', 'aqt', 'art', 'ast', 'att', 'aut', 'avt', 'awt', 'axt', 'ayt', 'azt']
# Number of strings output by insert_letter('at') is 52
# ```
# - Notice that split_l is missing the extra tuple ('at', '').  For insertion, we actually **WANT** this tuple.
# - The function is not creating all the desired output strings.
# - Check the range that you use for the for loop.

# #### Note 2
# If you see this:
# ```Python
# Input word at 
# split_l = [('', 'at'), ('a', 't'), ('at', '')] 
# insert_l = ['aat', 'bat', 'cat', 'dat', 'eat', 'fat', 'gat', 'hat', 'iat', 'jat', 'kat', 'lat', 'mat', 'nat', 'oat', 'pat', 'qat', 'rat', 'sat', 'tat', 'uat', 'vat', 'wat', 'xat', 'yat', 'zat', 'aat', 'abt', 'act', 'adt', 'aet', 'aft', 'agt', 'aht', 'ait', 'ajt', 'akt', 'alt', 'amt', 'ant', 'aot', 'apt', 'aqt', 'art', 'ast', 'att', 'aut', 'avt', 'awt', 'axt', 'ayt', 'azt']
# Number of strings output by insert_letter('at') is 52
# ```
# 
# - Even though you may have fixed the split_l so that it contains the tuple `('at', '')`, notice that you're still missing some output strings.
#     - Notice that it's missing strings such as 'ata', 'atb', 'atc' all the way to 'atz'.
# - To fix this, make sure that when you set insert_l, you allow the use of the empty string `''`.

# In[ ]:


# test # 2
print(f"Number of outputs of insert_letter('at') is {len(insert_letter('at'))}")


# #### Expected output
# 
# ```CPP
# Number of outputs of insert_letter('at') is 78
# ```

# &lt;a name='3'&gt;&lt;/a&gt;
# 
# # Part 3: Combining the edits
# 
# Now that you have implemented the string manipulations, you will create two functions that, given a string, will return all the possible single and double edits on that string. These will be `edit_one_letter()` and `edit_two_letters()`.

# &lt;a name='3-1'&gt;&lt;/a&gt;
# ## 3.1 Edit one letter
# 
# &lt;a name='ex-8'&gt;&lt;/a&gt;
# ### Exercise 8
# 
# **Instructions**: Implement the `edit_one_letter` function to get all the possible edits that are one edit away from a word. The edits  consist of the replace, insert, delete, and optionally the switch operation. You should use the previous functions you have already implemented to complete this function. The 'switch' function  is a less common edit function, so its use will be selected by an "allow_switches" input argument.
# 
# Note that those functions return *lists* while this function should return a *python set*. Utilizing a set eliminates any duplicate entries.

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt; Each of the functions returns a list.  You can combine lists using the `+` operator. &lt;/li&gt;
#     &lt;li&gt; To get unique strings (avoid duplicates), you can use the set() function. &lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# In[ ]:


# UNQ_C8 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# UNIT TEST COMMENT: Candidate for Table Driven Tests
# GRADED FUNCTION: edit_one_letter
def edit_one_letter(word, allow_switches = True):
    """
    Input:
        word: the string/word for which we will generate all possible wordsthat are one edit away.
    Output:
        edit_one_set: a set of words with one possible edit. Please return a set. and not a list.
    """
    
    edit_one_set = set()
    
    ### START CODE HERE ###

    ### END CODE HERE ###

    return edit_one_set


# In[ ]:


tmp_word = "at"
tmp_edit_one_set = edit_one_letter(tmp_word)
# turn this into a list to sort it, in order to view it
tmp_edit_one_l = sorted(list(tmp_edit_one_set))

print(f"input word {tmp_word} \nedit_one_l \n{tmp_edit_one_l}\n")
print(f"The type of the returned object should be a set {type(tmp_edit_one_set)}")
print(f"Number of outputs from edit_one_letter('at') is {len(edit_one_letter('at'))}")


# #### Expected Output
# ```CPP
# input word at 
# edit_one_l 
# ['a', 'aa', 'aat', 'ab', 'abt', 'ac', 'act', 'ad', 'adt', 'ae', 'aet', 'af', 'aft', 'ag', 'agt', 'ah', 'aht', 'ai', 'ait', 'aj', 'ajt', 'ak', 'akt', 'al', 'alt', 'am', 'amt', 'an', 'ant', 'ao', 'aot', 'ap', 'apt', 'aq', 'aqt', 'ar', 'art', 'as', 'ast', 'ata', 'atb', 'atc', 'atd', 'ate', 'atf', 'atg', 'ath', 'ati', 'atj', 'atk', 'atl', 'atm', 'atn', 'ato', 'atp', 'atq', 'atr', 'ats', 'att', 'atu', 'atv', 'atw', 'atx', 'aty', 'atz', 'au', 'aut', 'av', 'avt', 'aw', 'awt', 'ax', 'axt', 'ay', 'ayt', 'az', 'azt', 'bat', 'bt', 'cat', 'ct', 'dat', 'dt', 'eat', 'et', 'fat', 'ft', 'gat', 'gt', 'hat', 'ht', 'iat', 'it', 'jat', 'jt', 'kat', 'kt', 'lat', 'lt', 'mat', 'mt', 'nat', 'nt', 'oat', 'ot', 'pat', 'pt', 'qat', 'qt', 'rat', 'rt', 'sat', 'st', 't', 'ta', 'tat', 'tt', 'uat', 'ut', 'vat', 'vt', 'wat', 'wt', 'xat', 'xt', 'yat', 'yt', 'zat', 'zt']
# 
# The type of the returned object should be a set &lt;class 'set'&gt;
# Number of outputs from edit_one_letter('at') is 129
# ```

# &lt;a name='3-2'&gt;&lt;/a&gt;
# ## Part 3.2 Edit two letters
# 
# &lt;a name='ex-9'&gt;&lt;/a&gt;
# ### Exercise 9
# 
# Now you can generalize this to implement to get two edits on a word. To do so, you would have to get all the possible edits on a single word and then for each modified word, you would have to modify it again. 
# 
# **Instructions**: Implement the `edit_two_letters` function that returns a set of words that are two edits away. Note that creating additional edits based on the `edit_one_letter` function may 'restore' some one_edits to zero or one edits. That is allowed here. This accounted for in get_corrections.

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt;You will likely want to take the union of two sets.&lt;/li&gt;
#     &lt;li&gt;You can either use set.union() or use the '|' (or operator) to union two sets&lt;/li&gt;
#     &lt;li&gt;See the documentation &lt;a href="https://docs.python.org/2/library/sets.html" &gt; Python sets &lt;/a&gt; for examples of using operators or functions of the Python set.&lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# In[ ]:


# UNQ_C9 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# UNIT TEST COMMENT: Candidate for Table Driven Tests
# GRADED FUNCTION: edit_two_letters
def edit_two_letters(word, allow_switches = True):
    '''
    Input:
        word: the input string/word 
    Output:
        edit_two_set: a set of strings with all possible two edits
    '''
    
    edit_two_set = set()
    
    ### START CODE HERE ###

    ### END CODE HERE ###
    
    return edit_two_set


# In[ ]:


tmp_edit_two_set = edit_two_letters("a")
tmp_edit_two_l = sorted(list(tmp_edit_two_set))
print(f"Number of strings with edit distance of two: {len(tmp_edit_two_l)}")
print(f"First 10 strings {tmp_edit_two_l[:10]}")
print(f"Last 10 strings {tmp_edit_two_l[-10:]}")
print(f"The data type of the returned object should be a set {type(tmp_edit_two_set)}")
print(f"Number of strings that are 2 edit distances from 'at' is {len(edit_two_letters('at'))}")


# #### Expected Output
# 
# ```CPP
# Number of strings with edit distance of two: 2654
# First 10 strings ['', 'a', 'aa', 'aaa', 'aab', 'aac', 'aad', 'aae', 'aaf', 'aag']
# Last 10 strings ['zv', 'zva', 'zw', 'zwa', 'zx', 'zxa', 'zy', 'zya', 'zz', 'zza']
# The data type of the returned object should be a set &lt;class 'set'&gt;
# Number of strings that are 2 edit distances from 'at' is 7154
# ```

# &lt;a name='3-3'&gt;&lt;/a&gt;
# ## Part 3-3: suggest spelling suggestions
# 
# Now you will use your `edit_two_letters` function to get a set of all the possible 2 edits on your word. You will then use those strings to get the most probable word you meant to type aka your typing suggestion.
# 
# &lt;a name='ex-10'&gt;&lt;/a&gt;
# ### Exercise 10
# **Instructions**: Implement `get_corrections`, which returns a list of zero to n possible suggestion tuples of the form (word, probability_of_word). 
# 
# **Step 1:** Generate suggestions for a supplied word: You'll use the edit functions you have developed. The 'suggestion algorithm' should follow this logic: 
# * If the word is in the vocabulary, suggest the word. 
# * Otherwise, if there are suggestions from `edit_one_letter` that are in the vocabulary, use those. 
# * Otherwise, if there are suggestions from `edit_two_letters` that are in the vocabulary, use those. 
# * Otherwise, suggest the input word.*  
# * The idea is that words generated from fewer edits are more likely than words with more edits.
# 
# 
# Note: 
# - Edits of one or two letters may 'restore' strings to either zero or one edit. This algorithm accounts for this by preferentially selecting lower distance edits first.

# #### Short circuit
# In Python, logical operations such as `and` and `or` have two useful properties. They can operate on lists and they have ['short-circuit' behavior](https://docs.python.org/3/library/stdtypes.html). Try these:

# In[ ]:


# example of logical operation on lists or sets
print( [] and ["a","b"] )
print( [] or ["a","b"] )
#example of Short circuit behavior
val1 =  ["Most","Likely"] or ["Less","so"] or ["least","of","all"]  # selects first, does not evalute remainder
print(val1)
val2 =  [] or [] or ["least","of","all"] # continues evaluation until there is a non-empty list
print(val2)


# The logical `or` could be used to implement the suggestion algorithm very compactly. Alternately, if/then constructs could be used.
#  
# **Step 2**: Create a 'best_words' dictionary where the 'key' is a suggestion and the 'value' is the probability of that word in your vocabulary. If the word is not in the vocabulary, assign it a probability of 0.
# 
# **Step 3**: Select the n best suggestions. There may be fewer than n.

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt;edit_one_letter and edit_two_letters return *python sets*. &lt;/li&gt;
#     &lt;li&gt; Sets have a handy &lt;a href="https://docs.python.org/2/library/sets.html" &gt; set.intersection &lt;/a&gt; feature&lt;/li&gt;
#     &lt;li&gt;To find the keys that have the highest values in a dictionary, you can use the Counter dictionary to create a Counter object from a regular dictionary.  Then you can use Counter.most_common(n) to get the n most common keys.
#     &lt;/li&gt;
#     &lt;li&gt;To find the intersection of two sets, you can use set.intersection or the & operator.&lt;/li&gt;
#     &lt;li&gt;If you are not as familiar with short circuit syntax (as shown above), feel free to use if else statements instead.&lt;/li&gt;
#     &lt;li&gt;To use an if statement to check of a set is empty, use 'if not x:' syntax &lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# In[ ]:


# UNQ_C10 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# UNIT TEST COMMENT: Candidate for Table Driven Tests
# GRADED FUNCTION: get_corrections
def get_corrections(word, probs, vocab, n=2, verbose = False):
    '''
    Input: 
        word: a user entered string to check for suggestions
        probs: a dictionary that maps each word to its probability in the corpus
        vocab: a set containing all the vocabulary
        n: number of possible word corrections you want returned in the dictionary
    Output: 
        n_best: a list of tuples with the most probable n corrected words and their probabilities.
    '''
    
    suggestions = []
    n_best = []
    
    ### START CODE HERE ###

    ### END CODE HERE ###
    
    if verbose: print("entered word = ", word, "\nsuggestions = ", suggestions)

    return n_best


# In[ ]:


# Test your implementation - feel free to try other words in my word
my_word = 'dys' 
tmp_corrections = get_corrections(my_word, probs, vocab, 2, verbose=True) # keep verbose=True
for i, word_prob in enumerate(tmp_corrections):
    print(f"word {i}: {word_prob[0]}, probability {word_prob[1]:.6f}")

# CODE REVIEW COMMENT: using "tmp_corrections" insteads of "cors". "cors" is not defined
print(f"data type of corrections {type(tmp_corrections)}")


# #### Expected Output
# - Note: This expected output is for `my_word = 'dys'`. Also, keep `verbose=True`
# ```CPP
# entered word =  dys 
# suggestions =  {'days', 'dye'}
# word 0: days, probability 0.000410
# word 1: dye, probability 0.000019
# data type of corrections &lt;class 'list'&gt;
# ```

# &lt;a name='4'&gt;&lt;/a&gt;
# # Part 4: Minimum Edit distance
# 
# Now that you have implemented your auto-correct, how do you evaluate the similarity between two strings? For example: 'waht' and 'what'
# 
# Also how do you efficiently find the shortest path to go from the word, 'waht' to the word 'what'?
# 
# You will implement a dynamic programming system that will tell you the minimum number of edits required to convert a string into another string.

# &lt;a name='4-1'&gt;&lt;/a&gt;
# ### Part 4.1 Dynamic Programming
# 
# Dynamic Programming breaks a problem down into subproblems which can be combined to form the final solution. Here, given a string source[0..i] and a string target[0..j], we will compute all the combinations of substrings[i, j] and calculate their edit distance. To do this efficiently, we will use a table to maintain the previously computed substrings and use those to calculate larger substrings.
# 
# You have to create a matrix and update each element in the matrix as follows:  

# $$\text{Initialization}$$
# 
# \begin{align}
# D[0,0] &amp;= 0 \\
# D[i,0] &amp;= D[i-1,0] + del\_cost(source[i]) \tag{4}\\
# D[0,j] &amp;= D[0,j-1] + ins\_cost(target[j]) \\
# \end{align}

# 
# $$\text{Per Cell Operations}$$
# \begin{align}
#  \\
# D[i,j] =min
# \begin{cases}
# D[i-1,j] + del\_cost\\
# D[i,j-1] + ins\_cost\\
# D[i-1,j-1] + \left\{\begin{matrix}
# rep\_cost; & if src[i]\neq tar[j]\\
# 0 ; & if src[i]=tar[j]
# \end{matrix}\right.
# \end{cases}
# \tag{5}
# \end{align}

# So converting the source word **play** to the target word **stay**, using an input cost of one, a delete cost of 1, and replace cost of 2 would give you the following table:
# &lt;table style="width:20%"&gt;
# 
#   &lt;tr&gt;
#     &lt;td&gt; &lt;b&gt; &lt;/b&gt;  &lt;/td&gt;
#     &lt;td&gt; &lt;b&gt;# &lt;/b&gt;  &lt;/td&gt;
#     &lt;td&gt; &lt;b&gt;s &lt;/b&gt;  &lt;/td&gt;
#     &lt;td&gt; &lt;b&gt;t &lt;/b&gt; &lt;/td&gt; 
#     &lt;td&gt; &lt;b&gt;a &lt;/b&gt; &lt;/td&gt; 
#     &lt;td&gt; &lt;b&gt;y &lt;/b&gt; &lt;/td&gt; 
#   &lt;/tr&gt;
#    &lt;tr&gt;
#     &lt;td&gt; &lt;b&gt;  #  &lt;/b&gt;&lt;/td&gt;
#     &lt;td&gt; 0&lt;/td&gt; 
#     &lt;td&gt; 1&lt;/td&gt; 
#     &lt;td&gt; 2&lt;/td&gt; 
#     &lt;td&gt; 3&lt;/td&gt; 
#     &lt;td&gt; 4&lt;/td&gt; 
#  
#   &lt;/tr&gt;
#   &lt;tr&gt;
#     &lt;td&gt; &lt;b&gt;  p  &lt;/b&gt;&lt;/td&gt;
#     &lt;td&gt; 1&lt;/td&gt; 
#  &lt;td&gt; 2&lt;/td&gt; 
#     &lt;td&gt; 3&lt;/td&gt; 
#     &lt;td&gt; 4&lt;/td&gt; 
#    &lt;td&gt; 5&lt;/td&gt;
#   &lt;/tr&gt;
#    
#   &lt;tr&gt;
#     &lt;td&gt; &lt;b&gt; l &lt;/b&gt;&lt;/td&gt;
#     &lt;td&gt;2&lt;/td&gt; 
#     &lt;td&gt;3&lt;/td&gt; 
#     &lt;td&gt;4&lt;/td&gt; 
#     &lt;td&gt;5&lt;/td&gt; 
#     &lt;td&gt;6&lt;/td&gt;
#   &lt;/tr&gt;
# 
#   &lt;tr&gt;
#     &lt;td&gt; &lt;b&gt; a &lt;/b&gt;&lt;/td&gt;
#     &lt;td&gt;3&lt;/td&gt; 
#      &lt;td&gt;4&lt;/td&gt; 
#      &lt;td&gt;5&lt;/td&gt; 
#      &lt;td&gt;4&lt;/td&gt;
#      &lt;td&gt;5&lt;/td&gt; 
#   &lt;/tr&gt;
#   
#    &lt;tr&gt;
#     &lt;td&gt; &lt;b&gt; y &lt;/b&gt;&lt;/td&gt;
#     &lt;td&gt;4&lt;/td&gt; 
#       &lt;td&gt;5&lt;/td&gt; 
#      &lt;td&gt;6&lt;/td&gt; 
#      &lt;td&gt;5&lt;/td&gt;
#      &lt;td&gt;4&lt;/td&gt; 
#   &lt;/tr&gt;
#   
# 
# &lt;/table&gt;
# 
# 

# The operations used in this algorithm are 'insert', 'delete', and 'replace'. These correspond to the functions that you defined earlier: insert_letter(), delete_letter() and replace_letter(). switch_letter() is not used here.

# The diagram below describes how to initialize the table. Each entry in D[i,j] represents the minimum cost of converting string source[0:i] to string target[0:j]. The first column is initialized to represent the cumulative cost of deleting the source characters to convert string "EER" to "". The first row is initialized to represent the cumulative cost of inserting the target characters to convert from "" to "NEAR".

# &lt;div style="width:image width px; font-size:100%; text-align:center;"&gt;&lt;img src='EditDistInit4.PNG' alt="alternate text" width="width" height="height" style="width:1000px;height:400px;"/&gt; Figure 6 Initializing Distance Matrix&lt;/div&gt;     

# Filling in the remainder of the table utilizes the 'Per Cell Operations' in the equation (5) above. Note, the diagram below includes in the table some of the 3 sub-calculations shown in light grey. Only 'min' of those operations is stored in the table in the `min_edit_distance()` function.

# &lt;div style="width:image width px; font-size:100%; text-align:center;"&gt;&lt;img src='EditDistFill2.PNG' alt="alternate text" width="width" height="height" style="width:800px;height:400px;"/&gt; Figure 7 Filling Distance Matrix&lt;/div&gt;     

# Note that the formula for $D[i,j]$ shown in the image is equivalent to:
# 
# \begin{align}
#  \\
# D[i,j] =min
# \begin{cases}
# D[i-1,j] + del\_cost\\
# D[i,j-1] + ins\_cost\\
# D[i-1,j-1] + \left\{\begin{matrix}
# rep\_cost; & if src[i]\neq tar[j]\\
# 0 ; & if src[i]=tar[j]
# \end{matrix}\right.
# \end{cases}
# \tag{5}
# \end{align}
# 
# The variable `sub_cost` (for substitution cost) is the same as `rep_cost`; replacement cost.  We will stick with the term "replace" whenever possible.

# Below are some examples of cells where replacement is used. This also shows the minimum path from the lower right final position where "EER" has been replaced by "NEAR" back to the start. This provides a starting point for the optional 'backtrace' algorithm below.

# &lt;div style="width:image width px; font-size:100%; text-align:center;"&gt;&lt;img src='EditDistExample1.PNG' alt="alternate text" width="width" height="height" style="width:1200px;height:400px;"/&gt; Figure 8 Examples Distance Matrix&lt;/div&gt;    

# &lt;a name='ex-11'&gt;&lt;/a&gt;
# ### Exercise 11
# 
# Again, the word "substitution" appears in the figure, but think of this as "replacement".

# **Instructions**: Implement the function below to get the minimum amount of edits required given a source string and a target string. 

# &lt;details&gt;    
# &lt;summary&gt;
#     &lt;font size="3" color="darkgreen"&gt;&lt;b&gt;Hints&lt;/b&gt;&lt;/font&gt;
# &lt;/summary&gt;
# &lt;p&gt;
# &lt;ul&gt;
#     &lt;li&gt;The range(start, stop, step) function excludes 'stop' from its output&lt;/li&gt;
#     &lt;li&gt;&lt;a href="" &gt; words &lt;/a&gt; &lt;/li&gt;
# &lt;/ul&gt;
# &lt;/p&gt;
# 

# In[ ]:


# UNQ_C11 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)
# GRADED FUNCTION: min_edit_distance
def min_edit_distance(source, target, ins_cost = 1, del_cost = 1, rep_cost = 2):
    '''
    Input: 
        source: a string corresponding to the string you are starting with
        target: a string corresponding to the string you want to end with
        ins_cost: an integer setting the insert cost
        del_cost: an integer setting the delete cost
        rep_cost: an integer setting the replace cost
    Output:
        D: a matrix of len(source)+1 by len(target)+1 containing minimum edit distances
        med: the minimum edit distance (med) required to convert the source string to the target
    '''
    # use deletion and insert cost as  1
    m = len(source) 
    n = len(target) 
    #initialize cost matrix with zeros and dimensions (m+1,n+1) 
    D = np.zeros((m+1, n+1), dtype=int) 
    
    ### START CODE HERE (Replace instances of 'None' with your code) ###
    
    # Fill in column 0, from row 1 to row m, both inclusive
    for row in range(None,None): # Replace None with the proper range
        D[row,0] = None
        
    # Fill in row 0, for all columns from 1 to n, both inclusive
    for col in range(None,None): # Replace None with the proper range
        D[0,col] = None
        
    # Loop through row 1 to row m, both inclusive
    for row in range(None,None): 
        
        # Loop through column 1 to column n, both inclusive
        for col in range(None,None):
            
            # Intialize r_cost to the 'replace' cost that is passed into this function
            r_cost = None
            
            # Check to see if source character at the previous row
            # matches the target character at the previous column, 
            if None
                # Update the replacement cost to 0 if source and target are the same
                r_cost = None
                
            # Update the cost at row, col based on previous entries in the cost matrix
            # Refer to the equation calculate for D[i,j] (the minimum of three calculated costs)
            D[row,col] = None
          
    # Set the minimum edit distance with the cost found at row m, column n
    med = None
    
    ### END CODE HERE ###
    return D, med


# In[ ]:


#DO NOT MODIFY THIS CELL
# testing your implementation 
source =  'play'
target = 'stay'
matrix, min_edits = min_edit_distance(source, target)
print("minimum edits: ",min_edits, "\n")
idx = list('#' + source)
cols = list('#' + target)
df = pd.DataFrame(matrix, index=idx, columns= cols)
print(df)


# **Expected Results:**  
# 
# ```CPP
# minimum edits:  4
#     
#    #  s  t  a  y
# #  0  1  2  3  4
# p  1  2  3  4  5
# l  2  3  4  5  6
# a  3  4  5  4  5
# y  4  5  6  5  4
# ```

# In[ ]:


#DO NOT MODIFY THIS CELL
# testing your implementation 
source =  'eer'
target = 'near'
matrix, min_edits = min_edit_distance(source, target)
print("minimum edits: ",min_edits, "\n")
idx = list(source)
idx.insert(0, '#')
cols = list(target)
cols.insert(0, '#')
df = pd.DataFrame(matrix, index=idx, columns= cols)
print(df)


# **Expected Results**  
# ```CPP
# minimum edits:  3 
# 
#    #  n  e  a  r
# #  0  1  2  3  4
# e  1  2  1  2  3
# e  2  3  2  3  4
# r  3  4  3  4  3
# ```

# We can now test several of our routines at once:

# In[ ]:


source = "eer"
targets = edit_one_letter(source,allow_switches = False)  #disable switches since min_edit_distance does not include them
for t in targets:
    _, min_edits = min_edit_distance(source, t,1,1,1)  # set ins, del, sub costs all to one
    if min_edits != 1: print(source, t, min_edits)


# **Expected Results**  
# ```CPP
# (empty)
# ```
# 
# The 'replace()' routine utilizes all letters a-z one of which returns the original word.

# In[ ]:


source = "eer"
targets = edit_two_letters(source,allow_switches = False) #disable switches since min_edit_distance does not include them
for t in targets:
    _, min_edits = min_edit_distance(source, t,1,1,1)  # set ins, del, sub costs all to one
    if min_edits != 2 and min_edits != 1: print(source, t, min_edits)


# **Expected Results**  
# ```CPP
# eer eer 0
# ```
# 
# We have to allow single edits here because some two_edits will restore a single edit.

# # Submission
# Make sure you submit your assignment before you modify anything below
# 

# &lt;a name='5'&gt;&lt;/a&gt;
# 
# # Part 5: Optional - Backtrace
# 
# 
# Once you have computed your matrix using minimum edit distance, how would find the shortest path from the top left corner to the bottom right corner? 
# 
# Note that you could use backtrace algorithm.  Try to find the shortest path given the matrix that your `min_edit_distance` function returned.
# 
# You can use these [lecture slides on minimum edit distance](https://web.stanford.edu/class/cs124/lec/med.pdf) by Dan Jurafsky to learn about the algorithm for backtrace.

# In[ ]:


# Experiment with back trace - insert your code here


# #### References
# - Dan Jurafsky - Speech and Language Processing - Textbook
# - This auto-correct explanation was first done by Peter Norvig in 2007 
</pre></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/autocorrect-finding-candidates-using-edits/">Autocorrect: Finding Candidates Using Edits</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/autocorrect-finding-candidates-using-edits/" rel="bookmark"><time class="published dt-published" datetime="2020-11-05T17:30:56-08:00" itemprop="datePublished" title="2020-11-05 17:30">2020-11-05 17:30</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/autocorrect-finding-candidates-using-edits/#orgf9f46e3">Beginning</a></li>
<li><a href="posts/nlp/autocorrect-finding-candidates-using-edits/#org31eaeff">Middle</a>
<ul>
<li><a href="posts/nlp/autocorrect-finding-candidates-using-edits/#org8636f19">Our Data</a></li>
<li><a href="posts/nlp/autocorrect-finding-candidates-using-edits/#orgc29ced8">Splits</a></li>
<li><a href="posts/nlp/autocorrect-finding-candidates-using-edits/#org5a3b568">Delete</a></li>
<li><a href="posts/nlp/autocorrect-finding-candidates-using-edits/#org68367a5">Filter Out</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-finding-candidates-using-edits/#org0be9a12">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgf9f46e3">
<h2 id="orgf9f46e3">Beginning</h2>
</div>
<div class="outline-2" id="outline-container-org31eaeff">
<h2 id="org31eaeff">Middle</h2>
<div class="outline-text-2" id="text-org31eaeff"></div>
<div class="outline-3" id="outline-container-org8636f19">
<h3 id="org8636f19">Our Data</h3>
<div class="outline-text-3" id="text-org8636f19">
<p>This is the word we are going to autocorrect.</p>
<div class="highlight">
<pre><span></span><span class="n">word</span> <span class="o">=</span> <span class="s2">"dearz"</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc29ced8">
<h3 id="orgc29ced8">Splits</h3>
<div class="outline-text-3" id="text-orgc29ced8">
<p>This finds all the splits in our word.</p>
<div class="highlight">
<pre><span></span><span class="n">splits</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
</pre></div>
<pre class="example">
('', 'dearz')
('d', 'earz')
('de', 'arz')
('dea', 'rz')
('dear', 'z')
('dearz', '')
</pre></div>
</div>
<div class="outline-3" id="outline-container-org5a3b568">
<h3 id="org5a3b568">Delete</h3>
<div class="outline-text-3" id="text-org5a3b568">
<p>Starting with the splits, delete the first letter of the second element of each tuple. This means that each letter gets deleted exactly once.</p>
<div class="highlight">
<pre><span></span><span class="n">deletes</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">splits</span> <span class="k">if</span> <span class="n">right</span><span class="p">]</span>
<span class="k">for</span> <span class="n">deleted</span> <span class="ow">in</span> <span class="n">deletes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" - </span><span class="si">{</span><span class="n">deleted</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
- earz
- darz
- derz
- deaz
- dear
</pre>
<p>These are now the candidates to use for the correction.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org68367a5">
<h3 id="org68367a5">Filter Out</h3>
<div class="outline-text-3" id="text-org68367a5">
<p>Since not all the candidates are real words you need to filter out all but the real candidates using a pre-defined vocabulary.</p>
<div class="highlight">
<pre><span></span><span class="n">vocabulary</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'dean'</span><span class="p">,</span><span class="s1">'deer'</span><span class="p">,</span><span class="s1">'dear'</span><span class="p">,</span><span class="s1">'fries'</span><span class="p">,</span><span class="s1">'and'</span><span class="p">,</span><span class="s1">'coke'</span><span class="p">]</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">deletes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
</pre></div>
<pre class="example">
{'dear'}
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org0be9a12">
<h2 id="org0be9a12">End</h2>
<div class="outline-text-2" id="text-org0be9a12">
<p>This doesn't demonstrate all the edits (nor the use of edit distance) but the remaining types of edits are done in a similar manner to these two.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/autocorrect-building-the-vocabulary/">Autocorrect: Building the Vocabulary</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/autocorrect-building-the-vocabulary/" rel="bookmark"><time class="published dt-published" datetime="2020-11-04T19:13:20-08:00" itemprop="datePublished" title="2020-11-04 19:13">2020-11-04 19:13</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/autocorrect-building-the-vocabulary/#orge099d0a">Beginning</a>
<ul>
<li><a href="posts/nlp/autocorrect-building-the-vocabulary/#orgace42ba">Set Up</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-building-the-vocabulary/#orga7669dc">Middle</a>
<ul>
<li><a href="posts/nlp/autocorrect-building-the-vocabulary/#org8fbed20">Set Up the Corpus</a></li>
<li><a href="posts/nlp/autocorrect-building-the-vocabulary/#org04fb182">Preprocessing</a></li>
<li><a href="posts/nlp/autocorrect-building-the-vocabulary/#org85cfaa8">Create the Vocabulary</a></li>
</ul>
</li>
<li><a href="posts/nlp/autocorrect-building-the-vocabulary/#orgdb5df4d">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge099d0a">
<h2 id="orge099d0a">Beginning</h2>
<div class="outline-text-2" id="text-orge099d0a">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgace42ba">
<h3 id="orgace42ba">Set Up</h3>
<div class="outline-text-3" id="text-orgace42ba"></div>
<div class="outline-4" id="outline-container-orgaaa60f2">
<h4 id="orgaaa60f2">Plotting</h4>
<div class="outline-text-4" id="text-orgaaa60f2">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"autocorrect-building-the-vocabulary"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span>
                <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/nlp/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">/"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orga7669dc">
<h2 id="orga7669dc">Middle</h2>
<div class="outline-text-2" id="text-orga7669dc"></div>
<div class="outline-3" id="outline-container-org8fbed20">
<h3 id="org8fbed20">Set Up the Corpus</h3>
<div class="outline-text-3" id="text-org8fbed20">
<div class="highlight">
<pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="s1">'red pink pink blue blue yellow ORANGE BLUE BLUE PINK'</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"String Length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
red pink pink blue blue yellow ORANGE BLUE BLUE PINK
String Length: 52
</pre></div>
</div>
<div class="outline-3" id="outline-container-org04fb182">
<h3 id="org04fb182">Preprocessing</h3>
<div class="outline-text-3" id="text-org04fb182"></div>
<div class="outline-4" id="outline-container-org9446190">
<h4 id="org9446190">Lowercasing</h4>
<div class="outline-text-4" id="text-org9446190">
<div class="highlight">
<pre><span></span><span class="n">text_lowercased</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text_lowercased</span><span class="p">)</span>
</pre></div>
<pre class="example">
red pink pink blue blue yellow orange blue blue pink
</pre></div>
</div>
<div class="outline-4" id="outline-container-org0c4b926">
<h4 id="org0c4b926">Tokenizing</h4>
<div class="outline-text-4" id="text-org0c4b926">
<div class="highlight">
<pre><span></span><span class="n">ALPHANUMERIC_UNDERSCORE</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"\w"</span>
<span class="n">ONE_OR_MORE</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"+"</span>

<span class="n">TOKEN</span> <span class="o">=</span> <span class="n">ALPHANUMERIC_UNDERSCORE</span> <span class="o">+</span> <span class="n">ONE_OR_MORE</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">TOKEN</span><span class="p">,</span> <span class="n">text_lowercased</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Tokens: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Tokens: 10
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org85cfaa8">
<h3 id="org85cfaa8">Create the Vocabulary</h3>
<div class="outline-text-3" id="text-org85cfaa8"></div>
<div class="outline-4" id="outline-container-org6f9705d">
<h4 id="org6f9705d">First Way: Distinct Words</h4>
<div class="outline-text-4" id="text-org6f9705d">
<div class="highlight">
<pre><span></span><span class="n">vocabulary</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Count: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
{'pink', 'red', 'orange', 'blue', 'yellow'}
Count: 5
</pre></div>
</div>
<div class="outline-4" id="outline-container-org8a8b27b">
<h4 id="org8a8b27b">Second Way: Add Word Counts</h4>
<div class="outline-text-4" id="text-org8a8b27b"></div>
<ul class="org-ul">
<li><a id="org2f4dea6"></a>With a Dictionary<br>
<div class="outline-text-5" id="text-org2f4dea6">
<div class="highlight">
<pre><span></span><span class="n">counts_from_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">token</span><span class="p">:</span> <span class="n">tokens</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">counts_from_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Unique: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">counts_from_dict</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
{'red': 1, 'pink': 3, 'blue': 4, 'yellow': 1, 'orange': 1}
Unique: 5
</pre></div>
</li>
<li><a id="org8dc86d9"></a>With a Counter<br>
<div class="outline-text-5" id="text-org8dc86d9">
<div class="highlight">
<pre><span></span><span class="n">counts_from_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">counts_from_counter</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Unique: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">counts_from_counter</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts_from_counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">count</span> <span class="o">==</span> <span class="n">counts_from_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</pre></div>
<pre class="example">
Counter({'blue': 4, 'pink': 3, 'red': 1, 'yellow': 1, 'orange': 1})
Unique: 5
</pre></div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgf5ecd9c">
<h4 id="orgf5ecd9c">Plot the Vocabulary</h4>
<div class="outline-text-4" id="text-orgf5ecd9c">
<div class="highlight">
<pre><span></span><span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">counts_from_counter</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Cycle</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">Count</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">counts_from_counter</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
    <span class="n">Token</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span>
                        <span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Token"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Token Counts"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
    <span class="n">color_index</span><span class="o">=</span><span class="s2">"Token"</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"token_counts"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="posts/nlp/autocorrect-building-the-vocabulary/token_counts.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgdb5df4d">
<h2 id="orgdb5df4d">End</h2>
<div class="outline-text-2" id="text-orgdb5df4d">
<p>This is the basic way that we'll be creating a vocabulary for the autocorrect feature.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/machine-translation-with-locality-sensitive-hashing/">Locality-Sensitive Hashing (LSH) for Machine Translation</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/" rel="bookmark"><time class="published dt-published" datetime="2020-10-22T17:43:58-07:00" itemprop="datePublished" title="2020-10-22 17:43">2020-10-22 17:43</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/#org395cecd">Beginning</a>
<ul>
<li><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/#org91f69e8">Imports</a></li>
<li><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/#orge0f4a54">Set Up</a></li>
</ul>
</li>
<li><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/#orgea1bb6e">Middle</a>
<ul>
<li><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/#orge53e588">Locality-Sensitive Hashing (LSH)</a></li>
<li><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/#orge514985">Bundling It Up</a></li>
<li><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/#org27f639c">Testing the Classes</a></li>
<li><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/#orgbdc7ab2">The Data</a></li>
</ul>
</li>
<li><a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/#orgf3372ed">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org395cecd">
<h2 id="org395cecd">Beginning</h2>
<div class="outline-text-2" id="text-org395cecd">
<p>This is a continuation of the post in which we implemented <a href="posts/nlp/machine-translation-k-nearest-neighbors/">k-Nearest Neighbors</a>. It's part of a series of posts on building an English to French translator whose links are gathered in the <a href="posts/nlp/machine-translation/">this post</a>.</p>
</div>
<div class="outline-3" id="outline-container-org91f69e8">
<h3 id="org91f69e8">Imports</h3>
<div class="outline-text-3" id="text-org91f69e8">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">twitter_samples</span>

<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># my code</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.embeddings</span> <span class="kn">import</span> <span class="n">EmbeddingsLoader</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.twitter.processor</span> <span class="kn">import</span> <span class="n">TwitterProcessor</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orge0f4a54">
<h3 id="orge0f4a54">Set Up</h3>
<div class="outline-text-3" id="text-orge0f4a54"></div>
<div class="outline-4" id="outline-container-org1dee823">
<h4 id="org1dee823">The Timer</h4>
<div class="outline-text-4" id="text-org1dee823">
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc209a4c">
<h4 id="orgc209a4c">The Environment</h4>
<div class="outline-text-4" id="text-orgc209a4c">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org8d95141">
<h4 id="org8d95141">The Tweets</h4>
<div class="outline-text-4" id="text-org8d95141">
<div class="highlight">
<pre><span></span><span class="n">positive_tweets</span> <span class="o">=</span> <span class="n">twitter_samples</span><span class="o">.</span><span class="n">strings</span><span class="p">(</span><span class="s2">"positive_tweets.json"</span><span class="p">)</span>
<span class="n">negative_tweets</span> <span class="o">=</span> <span class="n">twitter_samples</span><span class="o">.</span><span class="n">strings</span><span class="p">(</span><span class="s2">"negative_tweets.json"</span><span class="p">)</span>
<span class="n">tweets</span> <span class="o">=</span> <span class="n">positive_tweets</span> <span class="o">+</span> <span class="n">negative_tweets</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org6dcbff7">
<h4 id="org6dcbff7">The Twitter Processor</h4>
<div class="outline-text-4" id="text-org6dcbff7">
<div class="highlight">
<pre><span></span><span class="n">process_tweet</span> <span class="o">=</span> <span class="n">TwitterProcessor</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge5b48c4">
<h4 id="orge5b48c4">The Embeddings Loader</h4>
<div class="outline-text-4" id="text-orge5b48c4">
<div class="highlight">
<pre><span></span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">EmbeddingsLoader</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgea1bb6e">
<h2 id="orgea1bb6e">Middle</h2>
<div class="outline-text-2" id="text-orgea1bb6e"></div>
<div class="outline-3" id="outline-container-orge53e588">
<h3 id="orge53e588">Locality-Sensitive Hashing (LSH)</h3>
<div class="outline-text-3" id="text-orge53e588">
<p>In this part of the assignment, you will implement a more efficient version of k-nearest neighbors using locality sensitive hashing. You will then apply this to document search.</p>
<ul class="org-ul">
<li>Process the tweets and represent each tweet as a vector (represent a document with a vector embedding).</li>
<li>Use locality sensitive hashing and k nearest neighbors to find tweets that are similar to a given tweet.</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org207412b">
<h4 id="org207412b">3.1 Getting the document embeddings</h4>
<div class="outline-text-4" id="text-org207412b"></div>
<ul class="org-ul">
<li><a id="orged6e054"></a>Bag-of-words (BOW) document models<br>
<div class="outline-text-5" id="text-orged6e054">
<p>Text documents are sequences of words.</p>
<ul class="org-ul">
<li>The ordering of words makes a difference. For example, sentences "Apple pie is better than pepperoni pizza." and "Pepperoni pizza is better than apple pie" have opposite meanings due to the word ordering.</li>
<li>However, for some applications, ignoring the order of words can allow us to train an efficient and still effective model.</li>
<li>This approach is called Bag-of-words document model.</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org8e87426">
<h4 id="org8e87426">Document embeddings</h4>
<div class="outline-text-4" id="text-org8e87426">
<ul class="org-ul">
<li><i>Document embedding</i> is created by summing up the embeddings of all words in the document.</li>
<li>If we don't know the embedding of some word, we can ignore that word.</li>
</ul>
<p><b>Exercise 07</b>: Complete the <code>get_document_embedding()</code> function.</p>
<ul class="org-ul">
<li>The function <code>get_document_embedding()</code> encodes entire document as a "document" embedding.</li>
<li>It takes in a document (as a string) and a dictionary, <code>en_embeddings</code></li>
<li>It processes the document, and looks up the corresponding embedding of each word.
<ul class="org-ul">
<li>It then sums them up and returns the sum of all word vectors of that processed tweet.</li>
</ul>
</li>
</ul>
</div>
<ul class="org-ul">
<li><a id="orgb5a3d6c"></a>Hints<br>
<div class="outline-text-5" id="text-orgb5a3d6c">
<ul class="org-ul">
<li>You can handle missing words easier by using the <code>get()</code> method of the python dictionary instead of the bracket notation (i.e. "[ ]"). See more about it <a href="https://stackoverflow.com/a/11041421/12816433%22">here</a></li>
<li>The default value for missing word should be the zero vector. Numpy will <a href="https://docs.scipy.org/doc/numpy/user/basics.broadcasting.html">broadcast</a> simple 0 scalar into a vector of zeros during the summation.</li>
<li>Alternatively, skip the addition if a word is not in the dictonary.</li>
<li>You can use your <code>process_tweet()</code> function which allows you to process the tweet. The function just takes in a tweet and returns a list of words.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C12 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="k">def</span> <span class="nf">get_document_embedding</span><span class="p">(</span><span class="n">tweet</span><span class="p">,</span> <span class="n">en_embeddings</span><span class="p">):</span> 
    <span class="sd">'''</span>
<span class="sd">    Input:</span>
<span class="sd">       - tweet: a string</span>
<span class="sd">       - en_embeddings: a dictionary of word embeddings</span>
<span class="sd">    Output:</span>
<span class="sd">       - doc_embedding: sum of all word embeddings in the tweet</span>
<span class="sd">    '''</span>
    <span class="n">doc_embedding</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
    <span class="c1"># process the document into a list of words (process the tweet)</span>
    <span class="n">processed_doc</span> <span class="o">=</span> <span class="n">process_tweet</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">processed_doc</span><span class="p">:</span>
        <span class="c1"># add the word embedding to the running total for the document embedding</span>
        <span class="n">doc_embedding</span> <span class="o">=</span> <span class="n">doc_embedding</span> <span class="o">+</span> <span class="n">en_embeddings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">doc_embedding</span>
</pre></div>
<p>You do not have to input any code in this cell, but it is relevant to grading, so please do not change anything</p>
<div class="highlight">
<pre><span></span><span class="c1"># testing your function</span>
<span class="n">custom_tweet</span> <span class="o">=</span> <span class="s2">"RT @Twitter @chapagain Hello There! Have a great day. :) #good #morning http://chapagain.com.np"</span>
<span class="c1">#tweet_embedding = get_document_embedding(custom_tweet, en_embeddings_subset)</span>
<span class="n">tweet_embedding</span> <span class="o">=</span> <span class="n">get_document_embedding</span><span class="p">(</span><span class="n">custom_tweet</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">english_subset</span><span class="p">)</span>

<span class="n">actual</span> <span class="o">=</span> <span class="n">tweet_embedding</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.00268555</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15378189</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.55761719</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07216644</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.32263184</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
</pre></div>
<pre class="example">
[-0.00268555 -0.15378189 -0.55761719 -0.07216644 -0.32263184]
</pre></div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orga348d01">
<h4 id="orga348d01">Exercise 08</h4>
<div class="outline-text-4" id="text-orga348d01"></div>
<ul class="org-ul">
<li><a id="orgb720d09"></a>Store all document vectors into a dictionary<br>
<div class="outline-text-5" id="text-orgb720d09">
<p>Now, let's store all the tweet embeddings into a dictionary. Implement <code>get_document_vecs()</code>.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">get_document_vecs</span><span class="p">(</span><span class="n">all_docs</span><span class="p">,</span> <span class="n">en_embeddings</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Input:</span>
<span class="sd">       - all_docs: list of strings - all tweets in our dataset.</span>
<span class="sd">       - en_embeddings: dictionary with words as the keys and their embeddings as the values.</span>
<span class="sd">    Output:</span>
<span class="sd">       - document_vec_matrix: matrix of tweet embeddings.</span>
<span class="sd">       - ind2Doc_dict: dictionary with indices of tweets in vecs as keys and their embeddings as the values.</span>
<span class="sd">    '''</span>

    <span class="c1"># the dictionary's key is an index (integer) that identifies a specific tweet</span>
    <span class="c1"># the value is the document embedding for that document</span>
    <span class="n">ind2Doc_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># this is list that will store the document vectors</span>
    <span class="n">document_vec_l</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_docs</span><span class="p">):</span>

        <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
        <span class="c1"># get the document embedding of the tweet</span>
        <span class="n">doc_embedding</span> <span class="o">=</span> <span class="n">get_document_embedding</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">en_embeddings</span><span class="p">)</span>

        <span class="c1"># save the document embedding into the ind2Tweet dictionary at index i</span>
        <span class="n">ind2Doc_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">doc_embedding</span>

        <span class="c1"># append the document embedding to the list of document vectors</span>
        <span class="n">document_vec_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_embedding</span><span class="p">)</span>

        <span class="c1">### END CODE HERE ###</span>

    <span class="c1"># convert the list of document vectors into a 2D array (each row is a document vector)</span>
    <span class="n">document_vec_matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">document_vec_l</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">document_vec_matrix</span><span class="p">,</span> <span class="n">ind2Doc_dict</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">document_vecs</span><span class="p">,</span> <span class="n">ind2Tweet</span> <span class="o">=</span> <span class="n">get_document_vecs</span><span class="p">(</span><span class="n">tweets</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">english_subset</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">dict_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind2Tweet</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">dict_length</span> <span class="o">==</span> <span class="n">expected</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"length of dictionary </span><span class="si">{</span><span class="n">dict_length</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">document_vecs</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"shape of document_vecs (</span><span class="si">{</span><span class="n">rows</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">rows</span> <span class="o">==</span> <span class="n">expected</span>
<span class="k">assert</span> <span class="n">columns</span> <span class="o">==</span> <span class="mi">300</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgf556eab">
<h4 id="orgf556eab">3.2 Looking up the tweets</h4>
<div class="outline-text-4" id="text-orgf556eab">
<p>Now you have a vector of dimension (m,d) where <code>m</code> is the number of tweets (10,000) and <code>d</code> is the dimension of the embeddings (300). Now you will input a tweet, and use cosine similarity to see which tweet in our corpus is similar to your tweet.</p>
<div class="highlight">
<pre><span></span><span class="n">my_tweet</span> <span class="o">=</span> <span class="s1">'i am sad'</span>
<span class="n">process_tweet</span><span class="p">(</span><span class="n">my_tweet</span><span class="p">)</span>
<span class="n">tweet_embedding</span> <span class="o">=</span> <span class="n">get_document_embedding</span><span class="p">(</span><span class="n">my_tweet</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">english_subset</span><span class="p">)</span>
</pre></div>
<p>This gives you a tweet similar to your input.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">cosine_similarity</span><span class="p">(</span><span class="n">vector_1</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vector_2</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""Calculates the similarity between two vectors</span>

<span class="sd">    Args:</span>
<span class="sd">     vector_1: array to compare</span>
<span class="sd">     vector_2: array to compare to vector_1</span>

<span class="sd">    Returns:</span>
<span class="sd">     cosine similarity between the two vectors</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector_1</span><span class="p">,</span> <span class="n">vector_2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector_1</span><span class="p">)</span> <span class="o">*</span>
                                          <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector_2</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">document_vecs</span><span class="p">,</span> <span class="n">tweet_embedding</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgdfadcaf">
<h4 id="orgdfadcaf">3.3 Finding the most similar tweets with LSH</h4>
<div class="outline-text-4" id="text-orgdfadcaf">
<p>You will now implement locality sensitive hashing (LSH) to identify the most similar tweet. Instead of looking at all 10,000 vectors, you can just search a subset to find its nearest neighbors.</p>
<p>Let's say you have a set of data points, You can divide the vector space into regions and search within one region for nearest neighbors of a given vector.</p>
<div class="highlight">
<pre><span></span><span class="n">N_VECS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">)</span>       <span class="c1"># This many vectors.</span>
<span class="n">N_DIMS</span> <span class="o">=</span> <span class="n">document_vecs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>     <span class="c1"># Vector dimensionality.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"There are </span><span class="si">{</span><span class="n">N_VECS</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> vectors and each has </span><span class="si">{</span><span class="n">N_DIMS</span><span class="si">}</span><span class="s2"> dimensions."</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgbba8c90">
<h4 id="orgbba8c90">Choosing the number of planes</h4>
<div class="outline-text-4" id="text-orgbba8c90">
<ul class="org-ul">
<li>Each plane divides the space to <i>2</i> parts.</li>
<li>So <i>n</i> planes divide the space into \(2^{n}\) hash buckets.</li>
<li>We want to organize 10,000 document vectors into buckets so that every bucket has about <i>~16</i> vectors.</li>
<li>For that we need \(\frac{10000}{16}=625\) buckets.</li>
<li>We're interested in <i>n</i>, number of planes, so that \(2^{n}= 625\). Now, we can calculate \(n=\log_{2}625 = 9.29 \approx 10\).</li>
</ul>
<p>We use \(\log_2(625)\) as the number of planes to have ~16 vectors/bucket.</p>
<div class="highlight">
<pre><span></span><span class="n">buckets</span> <span class="o">=</span> <span class="mi">10000</span><span class="o">/</span><span class="mi">16</span>
<span class="nb">print</span><span class="p">(</span><span class="n">buckets</span><span class="p">)</span>
<span class="n">planes</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">buckets</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">planes</span><span class="p">)</span>
</pre></div>
<pre class="example">
625.0
10
</pre>
<div class="highlight">
<pre><span></span><span class="n">N_PLANES</span> <span class="o">=</span> <span class="n">planes</span>
</pre></div>
<p>Number of times to repeat the hashing to improve the search.</p>
<div class="highlight">
<pre><span></span><span class="n">N_UNIVERSES</span> <span class="o">=</span> <span class="mi">25</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org95fa45f">
<h4 id="org95fa45f">3.4 Getting the hash number for a vector</h4>
<div class="outline-text-4" id="text-org95fa45f">
<p>For each vector, we need to get a unique number associated to that vector in order to assign it to a "hash bucket".</p>
</div>
</div>
<div class="outline-4" id="outline-container-orge514dae">
<h4 id="orge514dae">Hyperlanes in vector spaces</h4>
<div class="outline-text-4" id="text-orge514dae">
<ul class="org-ul">
<li>In <i>3</i>-dimensional vector space, the hyperplane is a regular plane. In <i>2</i> dimensional vector space, the hyperplane is a line.</li>
<li>Generally, the hyperplane is a subspace which has dimension <i>1</i> lower than the original vector space has.</li>
<li>A hyperplane is uniquely defined by its normal vector.</li>
<li>Normal vector <i>n</i> of the plane \(\pi\) is the vector to which all vectors in the plane \(\pi\) are orthogonal (perpendicular in <i>3</i> dimensional case).</li>
</ul>
</div>
</div>
<div class="outline-4" id="outline-container-orgff71824">
<h4 id="orgff71824">Using Hyperplanes to split the vector space</h4>
<div class="outline-text-4" id="text-orgff71824">
<p>We can use a hyperplane to split the vector space into <i>2</i> parts.</p>
<ul class="org-ul">
<li>All vectors whose dot product with a plane's normal vector is positive are on one side of the plane.</li>
<li>All vectors whose dot product with the plane's normal vector is negative are on the other side of the plane.</li>
</ul>
</div>
</div>
<div class="outline-4" id="outline-container-orgc74c417">
<h4 id="orgc74c417">Encoding hash buckets</h4>
<div class="outline-text-4" id="text-orgc74c417">
<ul class="org-ul">
<li>For a vector, we can take its dot product with all the planes, then encode this information to assign the vector to a single hash bucket.</li>
<li>When the vector is pointing to the opposite side of the hyperplane than normal, encode it by 0.</li>
<li>Otherwise, if the vector is on the same side as the normal vector, encode it by 1.</li>
<li>If you calculate the dot product with each plane in the same order for every vector, you've encoded each vector's unique hash ID as a binary number, like [0, 1, 1, … 0].</li>
</ul>
</div>
</div>
<div class="outline-4" id="outline-container-orgeeb44cc">
<h4 id="orgeeb44cc">Exercise 09: Implementing hash buckets</h4>
<div class="outline-text-4" id="text-orgeeb44cc">
<p>We've initialized hash table <code>hashes</code> for you. It is list of <code>N_UNIVERSES</code> matrices, each describes its own hash table. Each matrix has <code>N_DIMS</code> rows and <code>N_PLANES</code> columns. Every column of that matrix is a <code>N_DIMS</code>-dimensional normal vector for each of <code>N_PLANES</code> hyperplanes which are used for creating buckets of the particular hash table.</p>
<p><b>Exercise</b>: Your task is to complete the function <code>hash_value_of_vector</code> which places vector <code>v</code> in the correct hash bucket.</p>
<ul class="org-ul">
<li>First multiply your vector <i>v</i>, with a corresponding plane. This will give you a vector of dimension \((1,\text{N_planes})\).</li>
<li>You will then convert every element in that vector to 0 or 1.</li>
<li>You create a hash vector by doing the following: if the element is negative, it becomes a 0, otherwise you change it to a 1.</li>
<li>You then compute the unique number for the vector by iterating over <code>N_PLANES</code></li>
<li>Then you multiply \(2^i\) times the corresponding bit (0 or 1).</li>
<li>You will then store that sum in the variable <code>hash_value</code>.</li>
</ul>
<p><b>Intructions:</b> Create a hash for the vector in the function below. Use this formula:</p>
<p>\[ hash = \sum_{i=0}^{N-1} \left( 2^{i} \times h_{i} \right) \]</p>
</div>
<ul class="org-ul">
<li><a id="org0877eb0"></a>Create the sets of planes<br>
<div class="outline-text-5" id="text-org0877eb0">
<ul class="org-ul">
<li>Create multiple (25) sets of planes (the planes that divide up the region).</li>
<li>You can think of these as 25 separate ways of dividing up the vector space with a different set of planes.</li>
<li>Each element of this list contains a matrix with 300 rows (the word vectors have 300 dimensions), and 10 columns (there are 10 planes in each "universe").</li>
</ul>
<div class="highlight">
<pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">planes_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">N_DIMS</span><span class="p">,</span> <span class="n">N_PLANES</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_UNIVERSES</span><span class="p">)]</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="org8107305"></a>Hints<br>
<div class="outline-text-6" id="text-org8107305">
<ul class="org-ul">
<li><code>numpy.squeeze()</code> removes unused dimensions from an array; for instance, it converts a (10,1) 2D array into a (10,) 1D array</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">hash_value_of_vector</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">planes</span><span class="p">):</span>
    <span class="sd">"""Create a hash for a vector; hash_id says which random hash to use.</span>

<span class="sd">    Input:</span>
<span class="sd">       - v:  vector of tweet. It's dimension is (1, N_DIMS)</span>
<span class="sd">       - planes: matrix of dimension (N_DIMS, N_PLANES) - the set of planes that divide up the region</span>
<span class="sd">    Output:</span>
<span class="sd">       - res: a number which is used as a hash for your vector</span>

<span class="sd">    """</span>
    <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
    <span class="c1"># for the set of planes,</span>
    <span class="c1"># calculate the dot product between the vector and the matrix containing the planes</span>
    <span class="c1"># remember that planes has shape (300, 10)</span>
    <span class="c1"># The dot product will have the shape (1,10)</span>
    <span class="k">assert</span> <span class="n">planes</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
    <span class="n">dot_product</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">planes</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">dot_product</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dot_product</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># get the sign of the dot product (1,10) shaped vector</span>
    <span class="n">sign_of_dot_product</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dot_product</span><span class="p">)</span>

    <span class="c1"># set h to be false (equivalent to 0 when used in operations) if the sign is negative,</span>
    <span class="c1"># and true (equivalent to 1) if the sign is positive (1,10) shaped vector</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">sign_of_dot_product</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">h</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1"># remove extra un-used dimensions (convert this from a 2D to a 1D array)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># initialize the hash value to 0</span>
    <span class="n">hash_value</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">n_planes</span> <span class="o">=</span> <span class="n">planes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_planes</span><span class="p">):</span>
        <span class="c1"># increment the hash value by 2^i * h_i</span>
        <span class="n">hash_value</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="c1"># cast hash_value as an integer</span>
    <span class="n">hash_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hash_value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hash_value</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">planes</span> <span class="o">=</span> <span class="n">planes_l</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># get one 'universe' of planes to test the function</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mi">768</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">hash_value_of_vector</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">planes</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" The hash value for this vector,"</span><span class="p">,</span>
      <span class="sa">f</span><span class="s2">"and the set of planes at index </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">,"</span><span class="p">,</span>
      <span class="sa">f</span><span class="s2">"is </span><span class="si">{</span><span class="n">actual</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org5babc9d">
<h4 id="org5babc9d">3.5 Creating a hash table</h4>
</div>
<div class="outline-4" id="outline-container-org32adfa4">
<h4 id="org32adfa4">Exercise 10</h4>
<div class="outline-text-4" id="text-org32adfa4">
<p>Given that you have a unique number for each vector (or tweet), You now want to create a hash table. You need a hash table, so that given a hash_id, you can quickly look up the corresponding vectors. This allows you to reduce your search by a significant amount of time.</p>
<p>We have given you the <code>make_hash_table</code> function, which maps the tweet vectors to a bucket and stores the vector there. It returns the <code>hash_table</code> and the <code>id_table</code>. The <code>id_table</code> tells you which vector in a certain bucket corresponds to what tweet.</p>
</div>
<ul class="org-ul">
<li><a id="orgfde0a98"></a>Hints<br>
<div class="outline-text-5" id="text-orgfde0a98">
<ul class="org-ul">
<li>a dictionary comprehension, similar to a list comprehension, looks like this: `{i:0 for i in range(10)}`, where the key is 'i' and the value is zero for all key-value pairs.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">make_hash_table</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">planes</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Input:</span>
<span class="sd">       - vecs: list of vectors to be hashed.</span>
<span class="sd">       - planes: the matrix of planes in a single "universe", with shape (embedding dimensions, number of planes).</span>
<span class="sd">    Output:</span>
<span class="sd">       - hash_table: dictionary - keys are hashes, values are lists of vectors (hash buckets)</span>
<span class="sd">       - id_table: dictionary - keys are hashes, values are list of vectors id's</span>
<span class="sd">                           (it's used to know which tweet corresponds to the hashed vector)</span>
<span class="sd">    """</span>
    <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>

    <span class="c1"># number of planes is the number of columns in the planes matrix</span>
    <span class="n">num_of_planes</span> <span class="o">=</span> <span class="n">planes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># number of buckets is 2^(number of planes)</span>
    <span class="n">num_buckets</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">num_of_planes</span>

    <span class="c1"># create the hash table as a dictionary.</span>
    <span class="c1"># Keys are integers (0,1,2.. number of buckets)</span>
    <span class="c1"># Values are empty lists</span>
    <span class="n">hash_table</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_buckets</span><span class="p">)}</span>

    <span class="c1"># create the id table as a dictionary.</span>
    <span class="c1"># Keys are integers (0,1,2... number of buckets)</span>
    <span class="c1"># Values are empty lists</span>
    <span class="n">id_table</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_buckets</span><span class="p">)}</span>

    <span class="c1"># for each vector in 'vecs'</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vecs</span><span class="p">):</span>
        <span class="c1"># calculate the hash value for the vector</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">hash_value_of_vector</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="n">planes</span><span class="p">)</span>

        <span class="c1"># store the vector into hash_table at key h,</span>
        <span class="c1"># by appending the vector v to the list at key h</span>
        <span class="n">hash_table</span><span class="p">[</span><span class="n">h</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="c1"># store the vector's index 'i' (each document is given a unique integer 0,1,2...)</span>
        <span class="c1"># the key is the h, and the 'i' is appended to the list at key h</span>
        <span class="n">id_table</span><span class="p">[</span><span class="n">h</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">hash_table</span><span class="p">,</span> <span class="n">id_table</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">planes</span> <span class="o">=</span> <span class="n">planes_l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># get one 'universe' of planes to test the function</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">tmp_hash_table</span><span class="p">,</span> <span class="n">tmp_id_table</span> <span class="o">=</span> <span class="n">make_hash_table</span><span class="p">(</span><span class="n">document_vecs</span><span class="p">,</span> <span class="n">planes</span><span class="p">)</span>
<span class="c1"># tmp_hash_table, tmp_id_table = make_hash_table(vec.reshape(1, 300), planes)</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The hash table at key </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_hash_table</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2"> document vectors"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The id table at key </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_id_table</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The first 5 document indices stored at key </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> of are </span><span class="si">{</span><span class="n">tmp_id_table</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<p>Expected output</p>
<p>#+RESULTS The hash table at key 0 has 3 document vectors The id table at key 0 has 3 The first 5 document indices stored at key 0 of are [3276, 3281, 3282]</p>
<p>I get a hash of 2 for document 3276, not 1…</p>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org24e41f9">
<h4 id="org24e41f9">3.6 Creating all hash tables</h4>
<div class="outline-text-4" id="text-org24e41f9">
<p>You can now hash your vectors and store them in a hash table that would allow you to quickly look up and search for similar vectors. Run the cell below to create the hashes. By doing so, you end up having several tables which have all the vectors. Given a vector, you then identify the buckets in all the tables. You can then iterate over the buckets and consider much fewer vectors. The more buckets you use, the more accurate your lookup will be, but also the longer it will take.</p>
</div>
<ul class="org-ul">
<li><a id="org53ae585"></a>Creating the hashtables<br>
<div class="outline-text-5" id="text-org53ae585">
<div class="highlight">
<pre><span></span><span class="n">hash_tables</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">id_tables</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">universe_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_UNIVERSES</span><span class="p">):</span>  <span class="c1"># there are 25 hashes</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'working on hash universe #:'</span><span class="p">,</span> <span class="n">universe_id</span><span class="p">)</span>
        <span class="n">planes</span> <span class="o">=</span> <span class="n">planes_l</span><span class="p">[</span><span class="n">universe_id</span><span class="p">]</span>
        <span class="n">hash_table</span><span class="p">,</span> <span class="n">id_table</span> <span class="o">=</span> <span class="n">make_hash_table</span><span class="p">(</span><span class="n">document_vecs</span><span class="p">,</span> <span class="n">planes</span><span class="p">)</span>
        <span class="n">hash_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hash_table</span><span class="p">)</span>
        <span class="n">id_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_table</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-orge514985">
<h3 id="orge514985">Bundling It Up</h3>
<div class="outline-text-3" id="text-orge514985">
<div class="highlight">
<pre><span></span><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">planes</span><span class="o">-</span><span class="n">universe</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">planes</span><span class="o">-</span><span class="n">plane</span><span class="o">-</span><span class="n">count</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">planes</span><span class="o">-</span><span class="n">planes</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">documents</span><span class="o">-</span><span class="n">embeddings</span><span class="o">-</span><span class="n">builder</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">document</span><span class="o">-</span><span class="n">embedding</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">documents</span><span class="o">-</span><span class="n">embeddings</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">document</span><span class="o">-</span><span class="n">index</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">embedding</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="nb">hash</span><span class="o">-</span><span class="n">table</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="nb">hash</span><span class="o">-</span><span class="n">value</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">vector</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="nb">hash</span><span class="o">-</span><span class="n">hashes</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="nb">hash</span><span class="o">-</span><span class="n">table</span><span class="o">-</span><span class="n">table</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="nb">hash</span><span class="o">-</span><span class="n">index</span><span class="o">-</span><span class="n">table</span><span class="o">&gt;&gt;</span>



<span class="o">&lt;&lt;</span><span class="nb">hash</span><span class="o">-</span><span class="n">tables</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="nb">hash</span><span class="o">-</span><span class="n">tables</span><span class="o">-</span><span class="nb">hash</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="nb">hash</span><span class="o">-</span><span class="n">tables</span><span class="o">-</span><span class="n">index</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org15d4311">
<h4 id="org15d4311">Imports</h4>
<div class="outline-text-4" id="text-org15d4311">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5b5828a">
<h4 id="org5b5828a">Planes Universe</h4>
<div class="outline-text-4" id="text-org5b5828a">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PlanesUniverse</span><span class="p">:</span>
    <span class="sd">"""Creates set of planes with a random mormal distribution of points</span>


<span class="sd">    Args:</span>
<span class="sd">     vector_count: number of vectors that will be hashed</span>
<span class="sd">     dimensions: number of columns per vector</span>
<span class="sd">     universes: number of universes to create</span>
<span class="sd">     vectors_per_bucket: how many vectors we want in each</span>
<span class="sd">     random_seed: value to seed the random number generator</span>
<span class="sd">    """</span>
    <span class="n">vector_count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">dimensions</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">universes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">vectors_per_bucket</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">_plane_count</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_planes</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="orgc317fde"></a>Plane Count<br>
<div class="outline-text-5" id="text-orgc317fde">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">plane_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""The number of planes to create</span>

<span class="sd">    Uses the number of vectors and desired vectors per bucket</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plane_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">buckets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_count</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors_per_bucket</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plane_count</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">buckets</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plane_count</span>
</pre></div>
</div>
</li>
<li><a id="orgc4d6298"></a>Planes<br>
<div class="outline-text-5" id="text-orgc4d6298">
<p>The list of planes.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">planes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""The list of planes"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_planes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_planes</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">plane_count</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">universes</span><span class="p">)]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_planes</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgde2357d">
<h4 id="orgde2357d">Documents Embeddings Builder</h4>
<div class="outline-text-4" id="text-orgde2357d">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DocumentsEmbeddings</span><span class="p">:</span>
    <span class="sd">"""Builds embeddings for documents from their words</span>

<span class="sd">    Args:</span>
<span class="sd">     embeddings: word-embeddings for the documents</span>
<span class="sd">     process: callable to pre-process documents</span>
<span class="sd">     documents: documents (strings) to hash</span>
<span class="sd">    """</span>
    <span class="n">embeddings</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">process</span><span class="p">:</span> <span class="nb">object</span>
    <span class="n">documents</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">_documents_embeddings</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_document_index_to_embedding</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="orgc900605"></a>Getting the Document Embeddings<br>
<div class="outline-text-5" id="text-orgc900605">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">document_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span> 
    <span class="sd">"""sums the embeddings for words in the document</span>

<span class="sd">    Args:</span>
<span class="sd">      - document: string to tokenize and build embedding for</span>

<span class="sd">    Returns:</span>
<span class="sd">      - embedding: sum of all word embeddings in the document</span>
<span class="sd">    """</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
    <span class="n">embedding</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
    <span class="c1"># adding the zeros means you always return an array, not just the number 0</span>
    <span class="c1"># if none of the words in the document are in the embeddings</span>
    <span class="k">return</span> <span class="n">embedding</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><a id="orgcce2d68"></a>Documents Embeddings<br>
<div class="outline-text-5" id="text-orgcce2d68">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">documents_embeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""array of embeddings for each document in documents"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_documents_embeddings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_documents_embeddings</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">document_embedding</span><span class="p">(</span><span class="n">document</span><span class="p">)</span> <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_documents_embeddings</span>
</pre></div>
</div>
</li>
<li><a id="org33b7275"></a>Document Index to Embeddings<br>
<div class="outline-text-5" id="text-org33b7275">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">document_index_to_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""maps document index (from self.documents) to embedding"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_document_index_to_embedding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_document_index_to_embedding</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">index</span><span class="p">:</span> <span class="n">embedding</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">embedding</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">documents_embeddings</span><span class="p">)}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_document_index_to_embedding</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgee3013f">
<h4 id="orgee3013f">Hash Table Builder</h4>
<div class="outline-text-4" id="text-orgee3013f">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HashTable</span><span class="p">:</span>
    <span class="sd">"""Builds the hash-table for embeddings</span>

<span class="sd">    Args:</span>
<span class="sd">     planes: matrix of planes to divide into hash table</span>
<span class="sd">     vectors: vectors to be hashed</span>
<span class="sd">    """</span>
    <span class="n">planes</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">vectors</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">_hashes</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_hash_table</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_index_table</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="orge9aee87"></a>Vector Hash Value<br>
<div class="outline-text-5" id="text-orge9aee87">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">hash_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Create a hash for a vector</span>

<span class="sd">    Args:</span>
<span class="sd">     - vector:  vector of tweet. It's dimension is (1, N_DIMS)</span>

<span class="sd">    Returns:</span>
<span class="sd">      - res: a number which is used as a hash for your vector</span>
<span class="sd">    """</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planes</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># assert vector.shape == (1, rows), vector.shape</span>
    <span class="n">dot_product</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">planes</span><span class="p">)</span>
    <span class="c1">#assert dot_product.shape == (1, columns), dot_product.shape</span>

    <span class="n">sign_of_dot_product</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dot_product</span><span class="p">)</span>
    <span class="n">hashes</span> <span class="o">=</span> <span class="n">sign_of_dot_product</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">hashes</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">dot_product</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># remove extra un-used dimensions (convert this from a 2D to a 1D array)</span>
    <span class="n">hashes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">hashes</span><span class="p">)</span>
    <span class="n">hash_value</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">hash_value</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">**</span><span class="n">column</span> <span class="o">*</span> <span class="n">hashes</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">hash_value</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><a id="org99a7f03"></a>Hashes<br>
<div class="outline-text-5" id="text-org99a7f03">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Vector hashes"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_value</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span>
</pre></div>
</div>
</li>
<li><a id="org404ac19"></a>Hash Table Build<br>
<div class="outline-text-5" id="text-org404ac19">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">hash_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""Hash table of vectors</span>

<span class="sd">    Returns:</span>
<span class="sd">      hash_table: dictionary - keys are hashes, values are lists of vectors (hash buckets)</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">number_of_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">number_of_buckets</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">number_of_planes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_table</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_buckets</span><span class="p">)}</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">hash_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hashes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hash_table</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_table</span>
</pre></div>
</div>
</li>
<li><a id="org4b11395"></a>Index Table<br>
<div class="outline-text-5" id="text-org4b11395">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">index_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""Tabel of document hash to index"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">number_of_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">number_of_buckets</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">number_of_planes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_index_table</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_buckets</span><span class="p">)}</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">hash_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hashes</span><span class="p">):</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">_index_table</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_table</span>
</pre></div>
</div>
</li>
<li><a id="orge870113"></a>Build The Tables<br>
<div class="outline-text-5" id="text-orge870113">
<p>The code that uses the tables doesn't actually pull them at the same time, so I'm going to keep them separate.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">build_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Builds the hash and index table properties"""</span>
    <span class="n">number_of_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">number_of_buckets</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">number_of_planes</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_hash_table</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_buckets</span><span class="p">)}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_index_table</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_buckets</span><span class="p">)}</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">hash_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hashes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_table</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_table</span><span class="p">[</span><span class="n">hash_</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org63a8471">
<h4 id="org63a8471">Hash Tables</h4>
<div class="outline-text-4" id="text-org63a8471">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HashTables</span><span class="p">:</span>
    <span class="sd">"""Builds the universes of hash tables</span>

<span class="sd">    Args:</span>
<span class="sd">     universes: how many universes</span>
<span class="sd">     planes: planes to hash vectors into</span>
<span class="sd">     vectors: vectors to hash</span>
<span class="sd">    """</span>
    <span class="n">universes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">planes</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">vectors</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">_hash_tables</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_id_tables</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="org7481b60"></a>Hash Tables<br>
<div class="outline-text-5" id="text-org7481b60">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">hash_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Builds the list of hash tables"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_tables</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">HashTable</span><span class="p">(</span><span class="n">vectors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">,</span>
                      <span class="n">planes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planes</span><span class="p">[</span><span class="n">universe</span><span class="p">])</span><span class="o">.</span><span class="n">hash_table</span>
            <span class="k">for</span> <span class="n">universe</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">universes</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_tables</span>
</pre></div>
</div>
</li>
<li><a id="org1a2988d"></a>ID Tables<br>
<div class="outline-text-5" id="text-org1a2988d">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">id_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Builds the list of id tables"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_id_tables</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">HashTable</span><span class="p">(</span><span class="n">vectors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">,</span>
                      <span class="n">planes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planes</span><span class="p">[</span><span class="n">universe</span><span class="p">])</span><span class="o">.</span><span class="n">index_table</span>
            <span class="k">for</span> <span class="n">universe</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">universes</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_tables</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org27f639c">
<h3 id="org27f639c">Testing the Classes</h3>
<div class="outline-text-3" id="text-org27f639c"></div>
<div class="outline-4" id="outline-container-orgbf9d2c9">
<h4 id="orgbf9d2c9">PlanesUniverse</h4>
<div class="outline-text-4" id="text-orgbf9d2c9">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.hashing</span> <span class="kn">import</span> <span class="n">PlanesUniverse</span>
<span class="n">universes</span> <span class="o">=</span> <span class="n">PlanesUniverse</span><span class="p">(</span><span class="n">vector_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">),</span>
                        <span class="n">dimensions</span><span class="o">=</span><span class="n">N_DIMS</span><span class="p">,</span>
                        <span class="n">universes</span><span class="o">=</span><span class="n">N_UNIVERSES</span><span class="p">,</span>
                        <span class="n">vectors_per_bucket</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">universes</span><span class="o">.</span><span class="n">plane_count</span><span class="o">==</span><span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org679babc">
<h4 id="org679babc">Documents Embeddings Builder</h4>
<div class="outline-text-4" id="text-org679babc">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.hashing</span> <span class="kn">import</span> <span class="n">DocumentsEmbeddings</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">DocumentsEmbeddings</span><span class="p">(</span><span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="o">.</span><span class="n">english_subset</span><span class="p">,</span>
                            <span class="n">process</span><span class="o">=</span><span class="n">process_tweet</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="n">tweets</span><span class="p">)</span>

<span class="n">custom_tweet</span> <span class="o">=</span> <span class="s2">"RT @Twitter @chapagain Hello There! Have a great day. :) #good #morning http://chapagain.com.np"</span>

<span class="n">tweet_embedding</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">document_embedding</span><span class="p">(</span><span class="n">custom_tweet</span><span class="p">)</span>

<span class="n">actual</span> <span class="o">=</span> <span class="n">tweet_embedding</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.00268555</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15378189</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.55761719</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07216644</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.32263184</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>

<span class="n">dict_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">document_index_to_embedding</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">dict_length</span> <span class="o">==</span> <span class="n">expected</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"length of dictionary </span><span class="si">{</span><span class="n">dict_length</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">documents_embeddings</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"shape of document_vecs (</span><span class="si">{</span><span class="n">rows</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">rows</span> <span class="o">==</span> <span class="n">expected</span>
<span class="k">assert</span> <span class="n">columns</span> <span class="o">==</span> <span class="mi">300</span>

<span class="n">my_tweet</span> <span class="o">=</span> <span class="s1">'i am sad'</span>
<span class="n">tweet_embedding</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">document_embedding</span><span class="p">(</span><span class="n">my_tweet</span><span class="p">)</span>

<span class="n">idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">documents_embeddings</span><span class="p">,</span> <span class="n">tweet_embedding</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tweets</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</pre></div>
<pre class="example">
[-0.00268555 -0.15378189 -0.55761719 -0.07216644 -0.32263184]
length of dictionary 10,000
shape of document_vecs (10,000, 300)
@zoeeylim sad sad sad kid :( it's ok I help you watch the match HAHAHAHAHA
</pre></div>
</div>
<div class="outline-4" id="outline-container-org6501871">
<h4 id="org6501871">Hash Table Builder</h4>
<div class="outline-text-4" id="text-org6501871">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.hashing</span> <span class="kn">import</span> <span class="n">HashTable</span>

<span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">planes</span> <span class="o">=</span> <span class="n">universes</span><span class="o">.</span><span class="n">planes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># get one 'universe' of planes to test the function</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mi">768</span>

<span class="n">hasher</span> <span class="o">=</span> <span class="n">HashTable</span><span class="p">(</span><span class="n">planes</span><span class="o">=</span><span class="n">planes</span><span class="p">,</span> <span class="n">vectors</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hash_value</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"expected: </span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s2">, Actual: </span><span class="si">{</span><span class="n">actual</span><span class="si">}</span><span class="s2">"</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" The hash value for this vector,"</span><span class="p">,</span>
      <span class="sa">f</span><span class="s2">"and the set of planes at index </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">,"</span><span class="p">,</span>
      <span class="sa">f</span><span class="s2">"is </span><span class="si">{</span><span class="n">actual</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
The hash value for this vector, and the set of planes at index 0, is 768
</pre>
<div class="highlight">
<pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">planes</span> <span class="o">=</span> <span class="n">universes</span><span class="o">.</span><span class="n">planes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># get one 'universe' of planes to test the function</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">hasher</span> <span class="o">=</span> <span class="n">HashTable</span><span class="p">(</span><span class="n">planes</span><span class="o">=</span><span class="n">planes</span><span class="p">,</span> <span class="n">vectors</span><span class="o">=</span><span class="n">document_vecs</span><span class="p">)</span>

<span class="n">tmp_hash_table</span> <span class="o">=</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hash_table</span>
<span class="n">tmp_id_table</span> <span class="o">=</span> <span class="n">hasher</span><span class="o">.</span><span class="n">index_table</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The hash table at key </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_hash_table</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2"> document vectors"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The id table at key </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_id_table</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The first 5 document indices stored at key </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> of are </span><span class="si">{</span><span class="n">tmp_id_table</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
The hash table at key 2 has 21 document vectors
The id table at key 2 has 21
The first 5 document indices stored at key 2 of are [356, 529, 976, 1754, 1779]
</pre></div>
</div>
<div class="outline-4" id="outline-container-org8e45f7f">
<h4 id="org8e45f7f">Hash Tables</h4>
<div class="outline-text-4" id="text-org8e45f7f">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.hashing</span> <span class="kn">import</span> <span class="n">HashTables</span>
<span class="n">tables</span> <span class="o">=</span> <span class="n">HashTables</span><span class="p">(</span><span class="n">universes</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">planes</span><span class="o">=</span><span class="n">universes</span><span class="o">.</span><span class="n">planes</span><span class="p">,</span> <span class="n">vectors</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">documents_embeddings</span><span class="p">)</span>
<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>    
    <span class="n">hash_tables_2</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">hash_tables</span>
    <span class="n">id_tables_2</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">id_tables</span>
</pre></div>
<pre class="example">
2020-10-29 19:06:32,191 graeae.timers.timer start: Started: 2020-10-29 19:06:32.191271
2020-10-29 19:06:56,635 graeae.timers.timer end: Ended: 2020-10-29 19:06:56.635738
2020-10-29 19:06:56,637 graeae.timers.timer end: Elapsed: 0:00:24.444467
</pre>
<div class="highlight">
<pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">hash_tables_2</span><span class="p">)</span> <span class="o">==</span> <span class="n">universes</span><span class="o">.</span><span class="n">universes</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_tables_2</span><span class="p">)</span> <span class="o">==</span> <span class="n">universes</span><span class="o">.</span><span class="n">universes</span>

<span class="n">id_tables_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">id_tables</span><span class="p">,</span> <span class="n">id_tables_2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">table</span><span class="p">,</span> <span class="n">table_2</span> <span class="ow">in</span> <span class="n">id_tables_</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="o">**</span><span class="n">universes</span><span class="o">.</span><span class="n">plane_count</span>
    <span class="k">for</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">ids</span> <span class="o">==</span> <span class="n">table_2</span><span class="p">[</span><span class="n">bucket</span><span class="p">],</span> <span class="s2">"[</span><span class="si">{bucket}</span><span class="s2">]: </span><span class="si">{ids}</span><span class="s2">, </span><span class="si">{table_2[bucket]}</span><span class="s2">"</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3bec87a">
<h4 id="org3bec87a">Testing Objects</h4>
<div class="outline-text-4" id="text-org3bec87a">
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Variable</th>
<th class="org-left" scope="col">Class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">embeddings</td>
<td class="org-left">EmbeddingsLoader</td>
</tr>
<tr>
<td class="org-left">process_tweet</td>
<td class="org-left">TwitterProcessor</td>
</tr>
<tr>
<td class="org-left">table</td>
<td class="org-left">DocumentsEmbeddings</td>
</tr>
<tr>
<td class="org-left">hasher</td>
<td class="org-left">HashTable</td>
</tr>
<tr>
<td class="org-left">tables</td>
<td class="org-left">HashTables</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgbdc7ab2">
<h3 id="orgbdc7ab2">The Data</h3>
<div class="outline-text-3" id="text-orgbdc7ab2">
<p>This is a summary of the data that was loaded since this was such a long post and I can't remember what's what without looking around.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Variable</th>
<th class="org-left" scope="col">Type</th>
<th class="org-left" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">tweets</td>
<td class="org-left">list of strings</td>
<td class="org-left">All the tweets (10,000)</td>
</tr>
<tr>
<td class="org-left">document_vecs</td>
<td class="org-left">numpy.ndarray</td>
<td class="org-left">Document embeddings for the tweets (10,000, 300)</td>
</tr>
<tr>
<td class="org-left">ind2Tweet</td>
<td class="org-left">dict</td>
<td class="org-left">Map index of tweet (in tweets or document_vecs) to document embedding</td>
</tr>
<tr>
<td class="org-left">planes_l</td>
<td class="org-left">List of arrays</td>
<td class="org-left">List of random planes for hashing (each is 300 x 10, 25 total)</td>
</tr>
<tr>
<td class="org-left">hash_tables</td>
<td class="org-left">List</td>
<td class="org-left">List of bucket-index to document embeddings maps (One for each plane, each with 1,024 buckets (2^number of planes))</td>
</tr>
<tr>
<td class="org-left">id_tables</td>
<td class="org-left">List</td>
<td class="org-left">List of bucket index: document index maps (one for each plane, each with 1,024)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf3372ed">
<h2 id="orgf3372ed">End</h2>
<div class="outline-text-2" id="text-orgf3372ed">
<p>The next step is to use this to implement <a href="posts/nlp/machine-translation-with-approximate-knn/">approximate k-Nearest Neighbors</a> to compelete our application.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/machine-translation-k-nearest-neighbors/">Implementing k-Nearest Neighbors for Machine Translation</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/machine-translation-k-nearest-neighbors/" rel="bookmark"><time class="published dt-published" datetime="2020-10-22T17:38:25-07:00" itemprop="datePublished" title="2020-10-22 17:38">2020-10-22 17:38</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/machine-translation-k-nearest-neighbors/#org58e777c">Beginning</a>
<ul>
<li><a href="posts/nlp/machine-translation-k-nearest-neighbors/#org561b031">Imports</a></li>
</ul>
</li>
<li><a href="posts/nlp/machine-translation-k-nearest-neighbors/#orgc70ec3f">Middle</a>
<ul>
<li><a href="posts/nlp/machine-translation-k-nearest-neighbors/#orgfa4c476">Testing the translation</a></li>
<li><a href="posts/nlp/machine-translation-k-nearest-neighbors/#org30bfb0e">Test your implementation:</a></li>
<li><a href="posts/nlp/machine-translation-k-nearest-neighbors/#org6f3d326">Test your translation and compute its accuracy</a></li>
<li><a href="posts/nlp/machine-translation-k-nearest-neighbors/#org7eb178a">Bundling It Up</a></li>
</ul>
</li>
<li><a href="posts/nlp/machine-translation-k-nearest-neighbors/#org224dd6f">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org58e777c">
<h2 id="org58e777c">Beginning</h2>
<div class="outline-text-2" id="text-org58e777c">
<p>This continues from the post where we found the <a href="posts/nlp/machine-translation-transformation-matrix/">transformation matrix</a>. It's part of a series of posts whose links are gathered in the <a href="posts/nlp/machine-translation/">Machine Translation</a> post.</p>
</div>
<div class="outline-3" id="outline-container-org561b031">
<h3 id="org561b031">Imports</h3>
<div class="outline-text-3" id="text-org561b031">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.english_french</span> <span class="kn">import</span> <span class="n">TrainingData</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.training</span> <span class="kn">import</span> <span class="n">TheTrainer</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgc70ec3f">
<h2 id="orgc70ec3f">Middle</h2>
<div class="outline-text-2" id="text-orgc70ec3f"></div>
<div class="outline-3" id="outline-container-orgfa4c476">
<h3 id="orgfa4c476">Testing the translation</h3>
<div class="outline-text-3" id="text-orgfa4c476"></div>
<div class="outline-4" id="outline-container-orge5d3f31">
<h4 id="orge5d3f31">k-Nearest neighbors algorithm</h4>
<div class="outline-text-4" id="text-orge5d3f31">
<ul class="org-ul">
<li>The <a href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm">k-Nearest neighbors algorithm</a> is a method which takes a vector as input and finds the other vectors in the dataset that are closest to it.</li>
<li>The 'k' is the number of "nearest neighbors" to find (e.g. k=2 finds the closest two neighbors).</li>
</ul>
</div>
</div>
<div class="outline-4" id="outline-container-orgce8aa57">
<h4 id="orgce8aa57">Searching for the translation embedding</h4>
<div class="outline-text-4" id="text-orgce8aa57">
<p>Since we're approximating the translation function from English to French embeddings with a linear transformation matrix \(\mathbf{R}\), most of the time we won't get the exact embedding of a French word when we transform embedding \(\mathbf{e}\) of some particular English word into the French embedding space.</p>
<p>This is where <i>k</i>-NN becomes really useful! By using <i>1</i>-NN with \(\mathbf{eR}\) as input, we can search for an embedding \(\mathbf{f}\) (as a row) in the matrix \(\mathbf{Y}\) which is the closest to the transformed vector \(\mathbf{eR}\).</p>
</div>
</div>
<div class="outline-4" id="outline-container-org87aa728">
<h4 id="org87aa728">Cosine similarity</h4>
<div class="outline-text-4" id="text-org87aa728">
<p>Cosine similarity between vectors <i>u</i> and <i>v</i> calculated as the cosine of the angle between them.</p>
<p>The formula is:</p>
<p>\[ \cos(u,v)=\frac{u\cdot v}{\left\|u\right\|\left\|v\right\|} \]</p>
<ul class="org-ul">
<li>\(\cos(u,v) = 1\) when <i>u</i> and <i>v</i> lie on the same line and have the same direction.</li>
<li>\(\cos(u,v) = -1\) when they have exactly opposite directions.</li>
<li>\(\cos(u,v) = 0\) when the vectors are orthogonal (perpendicular) to each other.</li>
</ul>
<p><b>Note:</b> Distance and similarity are pretty much opposite things.</p>
<ul class="org-ul">
<li>We can obtain distance metric from cosine similarity, but the cosine similarity can't be used directly as the distance metric.</li>
<li>When the cosine similarity increases (towards <i>1</i>), the "distance" between the two vectors decreases (towards <i>0</i>).</li>
<li>We can define the cosine distance between <i>u</i> and <i>v</i> as</li>
</ul>
<p>\[ d_{\text{cos}}(u,v)=1-\cos(u,v) \]</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgf5ccca2">
<h4 id="orgf5ccca2">The Cosine Similarity</h4>
<div class="outline-text-4" id="text-orgf5ccca2">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">cosine_similarity</span><span class="p">(</span><span class="n">vector_1</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vector_2</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""Calculates the similarity between two vectors</span>

<span class="sd">    Args:</span>
<span class="sd">     vector_1: array to compare</span>
<span class="sd">     vector_2: array to compare to vector_1</span>

<span class="sd">    Returns:</span>
<span class="sd">     cosine similarity between the two vectors</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector_1</span><span class="p">,</span> <span class="n">vector_2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector_1</span><span class="p">)</span> <span class="o">*</span>
                                          <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector_2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgb60bee9">
<h4 id="orgb60bee9">the <code>nearest_neighbor()</code> function</h4>
<div class="outline-text-4" id="text-orgb60bee9">
<p>Inputs:</p>
<ul class="org-ul">
<li>Vector <i>v</i></li>
<li>A set of possible nearest neighbors <i>candidates</i></li>
<li><i>k</i> nearest neighbors to find.</li>
<li>The distance metric should be based on cosine similarity.</li>
<li><i>cosine_similarity</i> function is already implemented and imported for you. It's arguments are two vectors and it returns the cosine of the angle between them.</li>
<li>Iterate over rows in <i>candidates</i>, and save the result of similarities between current row and vector <i>v</i> in a python list. Take care that similarities are in the same order as row vectors of <i>candidates</i>.</li>
<li>Now you can use <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.argsort.html#numpy.argsort">numpy argsort</a> to sort the indices for the rows of <i>candidates</i>.</li>
</ul>
</div>
<ul class="org-ul">
<li><a id="org0be6c02"></a>Hints<br>
<div class="outline-text-6" id="text-org0be6c02">
<ul class="org-ul">
<li><code>numpy.argsort</code> sorts values from most negative to most positive (smallest to largest)</li>
<li>The candidates that are nearest to <i>v</i> should have the highest cosine similarity</li>
<li>To get the last element of a list <i>tmp</i>, the notation is <code>tmp[-1:]</code></li>
</ul>
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C8 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="k">def</span> <span class="nf">nearest_neighbor</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Input:</span>
<span class="sd">      - v, the vector you are going find the nearest neighbor for</span>
<span class="sd">      - candidates: a set of vectors where we will find the neighbors</span>
<span class="sd">      - k: top k nearest neighbors to find</span>
<span class="sd">    Output:</span>
<span class="sd">      - k_idx: the indices of the top k closest vectors in sorted form</span>
<span class="sd">    """</span>
    <span class="c1"># cosine_similarities = [cosine_similarity(v, row) for row in candidates]</span>

    <span class="c1"># for each candidate vector...</span>
    <span class="c1">#for row in candidates:</span>
    <span class="c1">#    # get the cosine similarity</span>
    <span class="c1">#    cos_similarity = cosine_similarity(v, row)</span>
    <span class="c1">#</span>
    <span class="c1">#    # append the similarity to the list</span>
    <span class="c1">#    similarity_l.append(cos_similarity)</span>

    <span class="c1"># sort the similarity list and get the indices of the sorted list</span>
    <span class="c1"># sorted_ids = numpy.argsort(similarity_l)</span>

    <span class="c1"># get the indices of the k most similar candidate vectors</span>
    <span class="c1"># k_idx = sorted_ids[-k:]</span>
    <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">([</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">])[</span><span class="o">-</span><span class="n">k</span><span class="p">:]</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org30bfb0e">
<h3 id="org30bfb0e">Test your implementation:</h3>
<div class="outline-text-3" id="text-org30bfb0e">
<div class="highlight">
<pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float64"</span><span class="p">)</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
<pre class="example">
[[9 9 9]
 [1 0 5]
 [2 0 1]]
</pre></div>
</div>
<div class="outline-3" id="outline-container-org6f3d326">
<h3 id="org6f3d326">Test your translation and compute its accuracy</h3>
<div class="outline-text-3" id="text-org6f3d326">
<p>Complete the function <code>test_vocabulary</code> which takes in English embedding matrix <i>X</i>, French embedding matrix <i>Y</i> and the <i>R</i> matrix and returns the accuracy of translations from <i>X</i> to <i>Y</i> by <i>R</i>.</p>
<ul class="org-ul">
<li>Iterate over transformed English word embeddings and check if the closest French word vector belongs to French word that is the actual translation.</li>
<li>Obtain an index of the closest French embedding by using <code>nearest_neighbor</code> (with argument <i>k=1</i>), and compare it to the index of the English embedding you have just transformed.</li>
<li>Keep track of the number of times you get the correct translation.</li>
<li>
<p>Calculate accuracy as</p>
<p>\[ \text{accuracy}=\frac{\#(\text{correct predictions})}{\#(\text{total predictions})} \]</p>
</li>
</ul>
<div class="highlight">
<pre><span></span><span class="c1"># UNQ_C10 (UNIQUE CELL IDENTIFIER, DO NOT EDIT)</span>
<span class="k">def</span> <span class="nf">test_vocabulary</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Input:</span>
<span class="sd">       X: a matrix where the columns are the English embeddings.</span>
<span class="sd">       Y: a matrix where the columns correspond to the French embeddings.</span>
<span class="sd">       R: the transform matrix which translates word embeddings from</span>
<span class="sd">       English to French word vector space.</span>
<span class="sd">    Output:</span>
<span class="sd">       accuracy: for the English to French capitals</span>
<span class="sd">    '''</span>

    <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
    <span class="c1"># The prediction is X times R</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

    <span class="c1"># initialize the number correct to zero</span>
    <span class="c1">#num_correct = 0</span>
    <span class="c1">#predictions = (nearest_neighbor(row, Y) == index for index, row in enumerate(pred))</span>
    <span class="c1"># accuracy = sum(predictions)/len(red)</span>
    <span class="c1"># loop through each row in pred (each transformed embedding)</span>
    <span class="c1">#for index, row_vector in enumerate(pred):</span>
    <span class="c1">#    # get the index of the nearest neighbor of pred at row 'i'; also pass in the candidates in Y</span>
    <span class="c1">#    pred_idx = nearest_neighbor(row_vector, Y)</span>
    <span class="c1">#</span>
    <span class="c1">#    # if the index of the nearest neighbor equals the row of i... \</span>
    <span class="c1">#    if pred_idx == index:</span>
    <span class="c1">#        # increment the number correct by 1.</span>
    <span class="c1">#        num_correct += 1</span>
    <span class="c1">#</span>
    <span class="c1">## accuracy is the number correct divided by the number of rows in 'pred' (also number of rows in X)</span>
    <span class="c1">#accuracy = num_correct/len(pred)</span>
    <span class="c1">#</span>
    <span class="c1">#### END CODE HERE ###</span>

    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span> <span class="o">==</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred</span><span class="p">)])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
</pre></div>
<p>Let's see how is your translation mechanism working on the unseen data:</p>
<div class="highlight">
<pre><span></span><span class="c1"># X_val, Y_val = get_matrices(en_fr_test, fr_embeddings_subset, en_embeddings_subset)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">TrainingData</span><span class="p">()</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">TheTrainer</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
<p>You do not have to input any code in this cell, but it is relevant to grading, so please do not change anything.</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">test_vocabulary</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">trainer</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>  <span class="c1"># this might take a minute or two</span>
</pre></div>
<pre class="example">
2020-10-24 19:57:36,633 graeae.timers.timer start: Started: 2020-10-24 19:57:36.632998
2020-10-24 20:05:48,225 graeae.timers.timer end: Ended: 2020-10-24 20:05:48.225526
2020-10-24 20:05:48,226 graeae.timers.timer end: Elapsed: 0:08:11.592528
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"accuracy on test set is </span><span class="si">{</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
accuracy on test set is 0.552
</pre>
<p><b>Expected Output</b>:</p>
<p>#+RESULTS 0.557</p>
<p>You managed to translate words from one language to another language without ever seing them with almost 56% accuracy by using some basic linear algebra and learning a mapping of words from one language to another!</p>
</div>
</div>
<div class="outline-3" id="outline-container-org7eb178a">
<h3 id="org7eb178a">Bundling It Up</h3>
<div class="outline-text-3" id="text-org7eb178a">
<div class="highlight">
<pre><span></span><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">nearest</span><span class="o">-</span><span class="n">neighbor</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">nearest</span><span class="o">-</span><span class="n">cosine</span><span class="o">-</span><span class="n">similarity</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">nearest</span><span class="o">-</span><span class="n">nearest</span><span class="o">-</span><span class="n">neighbor</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">nearest</span><span class="o">-</span><span class="n">call</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgf8849f8">
<h4 id="orgf8849f8">Imports</h4>
<div class="outline-text-4" id="text-orgf8849f8">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org19b28e7">
<h4 id="org19b28e7">Nearest Neighbor</h4>
<div class="outline-text-4" id="text-org19b28e7">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NearestNeighbors</span><span class="p">:</span>
    <span class="sd">"""Finds the nearest neighbor(s) to a vector</span>

<span class="sd">    Args:</span>
<span class="sd">     candidates: set of vectors that are potential neighbors</span>
<span class="sd">     k: number of neighbors to find</span>
<span class="sd">    """</span>
    <span class="n">candidates</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>    
    <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc8583be">
<h4 id="orgc8583be">Cosine Similarity Method</h4>
<div class="outline-text-4" id="text-orgc8583be">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">cosine_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_1</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vector_2</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""Calculates the similarity between two vectors</span>

<span class="sd">    Args:</span>
<span class="sd">     vector_1: array to compare</span>
<span class="sd">     vector_2: array to compare to vector_1</span>

<span class="sd">    Returns:</span>
<span class="sd">     cosine similarity between the two vectors</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector_1</span><span class="p">,</span> <span class="n">vector_2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector_1</span><span class="p">)</span> <span class="o">*</span>
                                          <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector_2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org31526c0">
<h4 id="org31526c0">Nearest Neighbor Method</h4>
<div class="outline-text-4" id="text-org31526c0">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">nearest_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Find the nearest neghbor(s) to a vector</span>

<span class="sd">    Args:</span>
<span class="sd">      - vector, the vector you are going find the nearest neighbor for</span>

<span class="sd">    Returns:</span>
<span class="sd">      - k_idx: the indices of the top k closest vectors in sorted form</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">])[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5882771">
<h4 id="org5882771">Nearest Neighbor Call</h4>
<div class="outline-text-4" id="text-org5882771">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Alias for the `nearest_neighbors` method</span>

<span class="sd">    Args:</span>
<span class="sd">      - vector, the vector you are going find the nearest neighbor for</span>

<span class="sd">    Returns:</span>
<span class="sd">      - k_idx: the indices of the top k closest vectors in sorted form</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearest_neighbors</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3d1bd8e">
<h4 id="org3d1bd8e">Testing It</h4>
<div class="outline-text-4" id="text-org3d1bd8e">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.nearest_neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>


<span class="n">v</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float64"</span><span class="p">)</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])</span>

<span class="n">testing</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">candidates</span><span class="o">=</span><span class="n">candidates</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="n">testing</span><span class="o">.</span><span class="n">nearest_neighbors</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
<pre class="example">
[[9 9 9]
 [1 0 5]
 [2 0 1]]
</pre>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">TrainingData</span><span class="p">()</span>
    <span class="n">trainer</span> <span class="o">=</span> <span class="n">TheTrainer</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">trainer</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">tester</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">candidates</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">tester</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">==</span> <span class="n">index</span>
                    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</pre></div>
<pre class="example">
2020-10-31 19:35:14,133 graeae.timers.timer start: Started: 2020-10-31 19:35:14.133884
2020-10-31 19:43:29,695 graeae.timers.timer end: Ended: 2020-10-31 19:43:29.695745
2020-10-31 19:43:29,697 graeae.timers.timer end: Elapsed: 0:08:15.561861
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Accuracy: </span><span class="si">{</span><span class="mi">100</span> <span class="o">*</span> <span class="n">accuracy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2"> 0.2f</span><span class="si">}</span><span class="s2"> %"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Accuracy:  55.23 %
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org224dd6f">
<h2 id="org224dd6f">End</h2>
<div class="outline-text-2" id="text-org224dd6f">
<ul class="org-ul">
<li>The next post in this series is <a href="posts/nlp/machine-translation-with-locality-sensitive-hashing/">Locality-Sensitive Hashing (LSH) for Machine Translation</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nlp/machine-translation-transformation-matrix/">Training the Machine Translation Transformation Matrix</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nlp/machine-translation-transformation-matrix/" rel="bookmark"><time class="published dt-published" datetime="2020-10-22T17:34:49-07:00" itemprop="datePublished" title="2020-10-22 17:34">2020-10-22 17:34</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/nlp/machine-translation-transformation-matrix/#org399bd1c">Beginning</a>
<ul>
<li><a href="posts/nlp/machine-translation-transformation-matrix/#org8548977">Imports</a></li>
<li><a href="posts/nlp/machine-translation-transformation-matrix/#org69de2f4">Set Up</a></li>
</ul>
</li>
<li><a href="posts/nlp/machine-translation-transformation-matrix/#org966f6ca">Middle</a>
<ul>
<li><a href="posts/nlp/machine-translation-transformation-matrix/#orgd8b79d9">Translation As Linear Transformation of Embeddings</a></li>
<li><a href="posts/nlp/machine-translation-transformation-matrix/#orgbb47539">Saving It For Later</a></li>
<li><a href="posts/nlp/machine-translation-transformation-matrix/#org7a7f09c">Check the Tester</a></li>
</ul>
</li>
<li><a href="posts/nlp/machine-translation-transformation-matrix/#org76c77f1">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org399bd1c">
<h2 id="org399bd1c">Beginning</h2>
<div class="outline-text-2" id="text-org399bd1c">
<p>In a prior post we <a href="posts/nlp/building-the-machine-translation-data-set/">built the translation training set</a>. In this post we'll find the <a href="https://en.wikipedia.org/wiki/Transformation_matrix">Transformation Matrix</a> that maps our English Embeddings to the French ones.</p>
</div>
<div class="outline-3" id="outline-container-org8548977">
<h3 id="org8548977">Imports</h3>
<div class="outline-text-3" id="text-org8548977">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># My Stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.english_french</span> <span class="kn">import</span> <span class="n">TrainingData</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org69de2f4">
<h3 id="org69de2f4">Set Up</h3>
<div class="outline-text-3" id="text-org69de2f4">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">)</span>
<span class="n">slug</span> <span class="o">=</span> <span class="s2">"machine-translation-transformation-matrix"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span>
                <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/nlp/</span><span class="si">{</span><span class="n">slug</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org966f6ca">
<h2 id="org966f6ca">Middle</h2>
<div class="outline-text-2" id="text-org966f6ca"></div>
<div class="outline-3" id="outline-container-orgd8b79d9">
<h3 id="orgd8b79d9">Translation As Linear Transformation of Embeddings</h3>
<div class="outline-text-3" id="text-orgd8b79d9">
<p>The problem we're working on is creating a translator that converts an English word to a French one. To do this we're using Word Embeddings which allows us to re-state the problem form being about translation to one of finding the transformation matrix that will give us a new embedding that close enough to the French translation that we can use some kind of algorithm to find the French embedding that is closest to it.</p>
<ul class="org-ul">
<li>Given dictionaries of English and French word embeddings we'll create a transformation matrix <i>R</i>.</li>
<li>Given an English word embedding, \(\mathbf{e}\), we can multiply \(\mathbf{eR}\) to get a new word embedding \(\mathbf{f}\).</li>
<li>Both \(\mathbf{e}\) and \(\mathbf{f}\) are <a href="https://en.wikipedia.org/wiki/Row_and_column_vectors">row vectors</a>.</li>
<li>We can then compute the nearest neighbors to \(\mathbf{f}\) in the French embeddings and recommend the word that is most similar to the transformed word embedding.</li>
</ul>
<p><b>Note:</b> <i>e</i> was called <code>X_train</code> in the original assigment and corresponds to the <code>TrainData.x_train</code> property that we built in <a href="posts/nlp/building-the-machine-translation-data-set/">the previous post</a>.</p>
</div>
<div class="outline-4" id="outline-container-org1d8b027">
<h4 id="org1d8b027">Rethinking Translation as the Minimization Problem</h4>
<div class="outline-text-4" id="text-org1d8b027">
<p>Find a matrix <i>R</i> that minimizes the following equation.</p>
<p>\[ \arg \min _{\mathbf{R}}\| \mathbf{X R} - \mathbf{Y}\|_{F} \]</p>
<p>So we're trying to find the transformation matrix that minimizes the distance between an English embedding and its corresponding French embedding. The subscript for the norm (<i>F</i>) means that we're using the <a href="https://en.wikipedia.org/wiki/Matrix_norm#Frobenius_norm">Frobenius norm</a>.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgb90bf57">
<h4 id="orgb90bf57">Frobenius norm</h4>
<div class="outline-text-4" id="text-orgb90bf57">
<p>The Frobenius Norm of a matrix <i>A</i> (assuming it is of dimension <i>m, n</i>) is defined as the square root of the sum of the absolute squares of its elements:</p>
<p>\[ \|\mathbf{A}\|_{F} \equiv \sqrt{\sum_{i=1}^{m} \sum_{j=1}^{n}\left|a_{i j}\right|^{2}} \]</p>
</div>
</div>
<div class="outline-4" id="outline-container-org87d31de">
<h4 id="org87d31de">Actual loss function</h4>
<div class="outline-text-4" id="text-org87d31de">
<p>In the real world applications, the Frobenius norm loss:</p>
<p>\[ \| \mathbf{XR} - \mathbf{Y}\|_{F} \]</p>
<p>is often replaced by it's squared value divided by <i>m</i>:</p>
<p>\[ \frac{1}{m} \| \mathbf{X R} - \mathbf{Y} \|_{F}^{2} \]</p>
<p>where <i>m</i> is the number of examples (rows in \(\mathbf{X}\)).</p>
<ul class="org-ul">
<li>The same <i>R</i> is found when using this loss function versus the original Frobenius norm.</li>
<li>The reason for taking the square is that it's easier to compute the gradient of the squared Frobenius.</li>
<li>The reason for dividing by <i>m</i> is that we're more interested in the average loss per embedding than the loss for the entire training set.</li>
<li>The loss for all training sets increases with more words (training examples), so taking the average helps us to track the average loss regardless of the size of the training set.</li>
</ul>
</div>
</div>
<div class="outline-4" id="outline-container-org195048b">
<h4 id="org195048b">Implementing the Translation Mechanism Described</h4>
<div class="outline-text-4" id="text-org195048b"></div>
<ul class="org-ul">
<li><a id="orgce6cd99"></a>Step 1: Computing the loss<br>
<div class="outline-text-5" id="text-orgce6cd99">
<ul class="org-ul">
<li>The loss function will be the squared Frobenoius norm of the difference between the matrix and its approximation, divided by the number of training examples <i>m</i>.</li>
<li>Its formula is:</li>
</ul>
<p>\[ L(X, Y, R)=\frac{1}{m}\sum_{i=1}^{m} \sum_{j=1}^{n}\left( a_{i j} \right)^{2} \]</p>
<p>where \(a_{i j}\) is value in the \(i^{th}\) row and /j/th column of the matrix \(\mathbf{XR}-\mathbf{Y}\).</p>
<p><b>Instructions</b>: complete the <code>compute_loss()</code> function.</p>
<ul class="org-ul">
<li>Compute the approximation of <i>Y</i> by matrix multiplying <i>X</i> and <i>R</i></li>
<li>Compute the difference <i>XR - Y</i></li>
<li>Compute the squared Frobenius norm of the difference and divide it by <i>m</i>.</li>
</ul>
<p>Use matrix operations instead of the <code>numpy.norm</code> function.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">compute_loss</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Inputs: </span>
<span class="sd">       X: a matrix of dimension (m,n) where the columns are the English embeddings.</span>
<span class="sd">       Y: a matrix of dimension (m,n) where the columns correspong to the French embeddings.</span>
<span class="sd">       R: a matrix of dimension (n,n) - transformation matrix from English to French vector space embeddings.</span>
<span class="sd">    Outputs:</span>
<span class="sd">       L: a matrix of dimension (m,n) - the value of the loss function for given X, Y and R.</span>
<span class="sd">    '''</span>
    <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
    <span class="c1"># m is the number of rows in X</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># diff is XR - Y</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="n">Y</span>

    <span class="c1"># diff_squared is the element-wise square of the difference</span>
    <span class="n">diff_squared</span> <span class="o">=</span> <span class="n">diff</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># sum_diff_squared is the sum of the squared elements</span>
    <span class="n">sum_diff_squared</span> <span class="o">=</span> <span class="n">diff_squared</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># loss is the sum_diff_squared divided by the number of examples (m)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">sum_diff_squared</span><span class="o">/</span><span class="n">m</span>
    <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">loss</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgf8b3649">
<h4 id="orgf8b3649">Step 2: Computing the gradient of loss in respect to transform matrix R</h4>
<div class="outline-text-4" id="text-orgf8b3649">
<ul class="org-ul">
<li>Calculate the gradient of the loss with respect to transform matrix <i>R</i>.</li>
<li>The gradient is a matrix that encodes how much a small change in <i>R</i> affects the change in the loss function.</li>
<li>The gradient gives us the direction in which we should decrease <i>R</i> to minimize the loss.</li>
<li>\(m\) is the number of training examples (number of rows in <i>X</i>).</li>
<li>The formula for the gradient of the loss function <i>𝐿(𝑋,𝑌,𝑅)</i> is:</li>
</ul>
<p>\[ \frac{d}{dR}𝐿(𝑋,𝑌,𝑅)=\frac{d}{dR}\Big(\frac{1}{m}\| X R -Y\|_{F}^{2}\Big) = \frac{2}{m}X^{T} (X R - Y) \]</p>
</div>
<ul class="org-ul">
<li><a id="org0616514"></a><b>Instructions</b>: Complete the `compute_gradient` function below.<br>
<ul class="org-ul">
<li><a id="org3dbcce3"></a>Hints<br>
<div class="outline-text-6" id="text-org3dbcce3">
<ul class="org-ul">
<li><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.matrix.T.html">Transposing in numpy</a></li>
<li><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.shape.html">Finding out the dimensions of matrices in numpy</a></li>
<li>Remember to use numpy.dot for matrix multiplication</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">compute_gradient</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Inputs: </span>
<span class="sd">       X: a matrix of dimension (m,n) where the columns are the English embeddings.</span>
<span class="sd">       Y: a matrix of dimension (m,n) where the columns correspond to the French embeddings.</span>
<span class="sd">       R: a matrix of dimension (n,n) - transformation matrix from English to French vector space embeddings.</span>
<span class="sd">    Outputs:</span>
<span class="sd">       g: a matrix of dimension (n,n) - gradient of the loss function L for given X, Y and R.</span>
<span class="sd">    '''</span>
    <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
    <span class="c1"># m is the number of rows in X</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># gradient is X^T(XR - Y) * 2/m</span>
    <span class="n">gradient</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="n">Y</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">rows</span>
    <span class="k">assert</span> <span class="n">gradient</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
    <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">gradient</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org61c7c75">
<h4 id="org61c7c75">Step 3: Finding the optimal R with gradient descent algorithm</h4>
<div class="outline-text-4" id="text-org61c7c75"></div>
<ul class="org-ul">
<li><a id="orgb209c12"></a>Gradient descent<br>
<div class="outline-text-5" id="text-orgb209c12">
<p><a href="https://ml-cheatsheet.readthedocs.io/en/latest/gradient_descent.html">Gradient descent</a> is an iterative algorithm which is used in searching for the optimum of the function.</p>
<ul class="org-ul">
<li>Earlier, we mentioned that the gradient of the loss with respect to the matrix encodes how much a tiny change in some coordinate of that matrix affect the change of loss function.</li>
<li>Gradient descent uses that information to iteratively change matrix <i>R</i> until we reach a point where the loss is minimized.</li>
</ul>
</div>
<ul class="org-ul">
<li><a id="orgcb5d18b"></a>Training with a fixed number of iterations<br>
<div class="outline-text-6" id="text-orgcb5d18b">
<p>Most of the time we iterate for a fixed number of training steps rather than iterating until the loss falls below a threshold.</p>
<p>Pseudocode:</p>
<ol class="org-ol">
<li>Calculate gradient <i>g</i> of the loss with respect to the matrix <i>R</i>.</li>
<li>Update <i>R</i> with the formula:</li>
</ol>
<p>\[ R_{\text{new}}= R_{\text{old}}-\alpha g \]</p>
<p>Where \(\alpha\) is the learning rate, which is a scalar.</p>
</div>
</li>
<li><a id="org30755c1"></a>Learning rate<br>
<div class="outline-text-6" id="text-org30755c1">
<ul class="org-ul">
<li>The learning rate or "step size" \(\alpha\) is a coefficient which decides how much we want to change <i>R</i> in each step.</li>
<li>If we change <i>R</i> too much, we could skip the optimum by taking too large of a step.</li>
<li>If we make only small changes to <i>R</i>, we will need many steps to reach the optimum.</li>
<li>Learning rate \(\alpha\) is used to control those changes.</li>
<li>Values of \(\alpha\) are chosen depending on the problem, and we'll use <code>learning_rate</code> <i>=0.0003</i> as the default value for our algorithm.</li>
</ul>
</div>
</li>
<li><a id="org6b4620e"></a>Exercise 04<br>
<div class="outline-text-6" id="text-org6b4620e">
<p>Instructions: Implement <code>align_embeddings()</code></p>
<div class="highlight">
<pre><span></span> <span class="k">def</span> <span class="nf">align_embeddings</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                      <span class="n">train_steps</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                      <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.0003</span><span class="p">,</span>
                      <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">129</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
     <span class="sd">'''</span>
<span class="sd">     Inputs:</span>
<span class="sd">        X: a matrix of dimension (m,n) where the columns are the English embeddings.</span>
<span class="sd">        Y: a matrix of dimension (m,n) where the columns correspong to the French embeddings.</span>
<span class="sd">        train_steps: positive int - describes how many steps will gradient descent algorithm do.</span>
<span class="sd">        learning_rate: positive float - describes how big steps will  gradient descent algorithm do.</span>
<span class="sd">     Outputs:</span>
<span class="sd">        R: a matrix of dimension (n,n) - the projection matrix that minimizes the F norm ||X R -Y||^2</span>
<span class="sd">     '''</span>
     <span class="c1"># the number of columns in X is the number of dimensions for a word vector (e.g. 300)</span>
     <span class="c1"># R is a square matrix with length equal to the number of dimensions in th  word embedding</span>
     <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">train_steps</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">25</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"loss at iteration </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">compute_loss</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
         <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
         <span class="c1"># use the function that you defined to compute the gradient</span>
         <span class="n">gradient</span> <span class="o">=</span> <span class="n">compute_gradient</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

         <span class="c1"># update R by subtracting the learning rate times gradient</span>
         <span class="n">R</span> <span class="o">-=</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="n">gradient</span>
         <span class="c1">### END CODE HERE ###</span>
     <span class="k">return</span> <span class="n">R</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><a id="org7246af5"></a>Testing Your Implementation.<br>
<div class="outline-text-5" id="text-org7246af5">
<div class="highlight">
<pre><span></span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">129</span><span class="p">)</span>
 <span class="n">m</span> <span class="o">=</span> <span class="mi">10</span>
 <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>
 <span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
 <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">1</span>
 <span class="n">R</span> <span class="o">=</span> <span class="n">align_embeddings</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
<pre class="example">
loss at iteration 0 is: 3.4697
loss at iteration 25 is: 3.3795
loss at iteration 50 is: 3.2918
loss at iteration 75 is: 3.2064
</pre>
<p><b>Expected Output:</b></p>
<p>loss at iteration 0 is: 3.7242 loss at iteration 25 is: 3.6283 loss at iteration 50 is: 3.5350 loss at iteration 75 is: 3.4442</p>
</div>
</li>
<li><a id="org658e1fa"></a>Calculate transformation matrix<br>
<div class="outline-text-5" id="text-org658e1fa">
<p>Using those the training set, find the transformation matrix \(\mathbf{R}\) by calling the function <code>align_embeddings()</code>.</p>
<p><b>NOTE:</b> The code cell below will take a few minutes to fully execute (~3 mins)</p>
<div class="highlight">
<pre><span></span> <span class="n">data</span> <span class="o">=</span> <span class="n">TrainingData</span><span class="p">()</span>
 <span class="n">R_train</span> <span class="o">=</span> <span class="n">align_embeddings</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_steps</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
<pre class="example">
loss at iteration 0 is: 968.1416
loss at iteration 25 is: 97.6094
loss at iteration 50 is: 26.7949
loss at iteration 75 is: 9.7902
loss at iteration 100 is: 4.3831
loss at iteration 125 is: 2.3324
loss at iteration 150 is: 1.4509
loss at iteration 175 is: 1.0356
loss at iteration 200 is: 0.8263
loss at iteration 225 is: 0.7152
loss at iteration 250 is: 0.6539
loss at iteration 275 is: 0.6188
loss at iteration 300 is: 0.5983
loss at iteration 325 is: 0.5859
loss at iteration 350 is: 0.5783
loss at iteration 375 is: 0.5736
</pre>
<p>Expected Output</p>
<p>#+RESULTS loss at iteration 0 is: 963.0146 loss at iteration 25 is: 97.8292 loss at iteration 50 is: 26.8329 loss at iteration 75 is: 9.7893 loss at iteration 100 is: 4.3776 loss at iteration 125 is: 2.3281 loss at iteration 150 is: 1.4480 loss at iteration 175 is: 1.0338 loss at iteration 200 is: 0.8251 loss at iteration 225 is: 0.7145 loss at iteration 250 is: 0.6534 loss at iteration 275 is: 0.6185 loss at iteration 300 is: 0.5981 loss at iteration 325 is: 0.5858 loss at iteration 350 is: 0.5782 loss at iteration 375 is: 0.5735</p>
</div>
</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-orgbb47539">
<h3 id="orgbb47539">Saving It For Later</h3>
<div class="outline-text-3" id="text-orgbb47539">
<div class="highlight">
<pre><span></span><span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">the</span><span class="o">-</span><span class="n">trainer</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">timer</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">loss</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">gradient</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">align</span><span class="o">-</span><span class="n">embeddings</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orga52e416">
<h4 id="orga52e416">Imports</h4>
<div class="outline-text-4" id="text-orga52e416">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgba08ee9">
<h4 id="orgba08ee9">The Trainer Class</h4>
<div class="outline-text-4" id="text-orgba08ee9">
<p>We could keep it as just functions like it is here, but, nah.</p>
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TheTrainer</span><span class="p">:</span>
    <span class="sd">"""Trains the word-embeddings data</span>

<span class="sd">    Args:</span>
<span class="sd">     x_train: the training input</span>
<span class="sd">     y_train: the training labels</span>
<span class="sd">     training_steps: number of times to run the training loop</span>
<span class="sd">     learning_rate: multiplier for the gradient (alpha)</span>
<span class="sd">     seed: random-seed for numpy</span>
<span class="sd">     loss_every: if verbose, how often to show loss during fitting</span>
<span class="sd">     verbose: whether to emit messages</span>
<span class="sd">    """</span>
    <span class="n">x_train</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">y_train</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">_timer</span><span class="p">:</span> <span class="n">Timer</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">training_steps</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">400</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">129</span>
    <span class="n">loss_every</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">25</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org9089abb">
<h4 id="org9089abb">A Timer</h4>
<div class="outline-text-4" id="text-org9089abb">
<p>Just something to keep track of how long things take.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timer</span><span class="p">:</span>
    <span class="sd">"""A timer"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="n">emit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orged6a60c">
<h4 id="orged6a60c">The Loss Method</h4>
<div class="outline-text-4" id="text-orged6a60c">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Calculates the loss between XR and Y as the average sum of difference squared</span>

<span class="sd">    Args: </span>
<span class="sd">       transformation: a matrix of dimension (n,n) - transformation matrix.</span>

<span class="sd">    Returns:</span>
<span class="sd">       loss: value of loss function for X, Y and R</span>
<span class="sd">    """</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">difference</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span>
    <span class="n">difference_squared</span> <span class="o">=</span> <span class="n">difference</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">sum_of_difference_squared</span> <span class="o">=</span> <span class="n">difference_squared</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sum_of_difference_squared</span><span class="o">/</span><span class="n">rows</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1865904">
<h4 id="org1865904">The Gradient</h4>
<div class="outline-text-4" id="text-org1865904">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""computes the gradient (slope) of the loss</span>

<span class="sd">    Args: </span>
<span class="sd">       transformation: transformation matrix of dimension (n,n)</span>

<span class="sd">    Returns:</span>
<span class="sd">       gradient: a matrix of dimension (n,n)</span>
<span class="sd">    """</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">gradient</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                  <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="p">)</span><span class="o">/</span><span class="n">rows</span>
    <span class="k">assert</span> <span class="n">gradient</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gradient</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5206c22">
<h4 id="org5206c22">The Embeddings Aligner</h4>
<div class="outline-text-4" id="text-org5206c22">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Fits the transformation matrix to the data</span>

<span class="sd">    Side Effect:</span>
<span class="sd">     sets self.transformation  and self.losses</span>

<span class="sd">    Returns:</span>
<span class="sd">     the projection matrix that minimizes the F norm ||X R -Y||^2</span>
<span class="sd">    """</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Step</span><span class="se">\t</span><span class="s2">Loss"</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_steps</span><span class="p">):</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">25</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org7a7f09c">
<h3 id="org7a7f09c">Check the Tester</h3>
<div class="outline-text-3" id="text-org7a7f09c"></div>
<div class="outline-4" id="outline-container-org4dd6066">
<h4 id="org4dd6066">Sanity Check</h4>
<div class="outline-text-4" id="text-org4dd6066">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.training</span> <span class="kn">import</span> <span class="n">TheTrainer</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">129</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">1</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">TheTrainer</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">training_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
<pre class="example">
2020-10-23 18:27:50,195 graeae.timers.timer start: Started: 2020-10-23 18:27:50.195052
2020-10-23 18:27:50,201 graeae.timers.timer end: Ended: 2020-10-23 18:27:50.201767
2020-10-23 18:27:50,203 graeae.timers.timer end: Elapsed: 0:00:00.006715
The loss at step 0 is: 3.7242
The loss at step 25 is: 2.8709
The loss at step 50 is: 2.2201
The loss at step 75 is: 1.7235
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgec425e2">
<h4 id="orgec425e2">The Real Data</h4>
<div class="outline-text-4" id="text-orgec425e2">
<div class="highlight">
<pre><span></span><span class="n">trainer</span> <span class="o">=</span> <span class="n">TheTrainer</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
<pre class="example">
2020-10-23 18:30:45,558 graeae.timers.timer start: Started: 2020-10-23 18:30:45.558693
Step    Loss
0       963.0146
25      97.8292
50      26.8329
75      9.7893
100     4.3776
125     2.3281
150     1.4480
175     1.0338
200     0.8251
225     0.7145
250     0.6534
275     0.6185
300     0.5981
325     0.5858
350     0.5782
375     0.5735
2020-10-23 18:31:16,471 graeae.timers.timer end: Ended: 2020-10-23 18:31:16.471708
2020-10-23 18:31:16,473 graeae.timers.timer end: Elapsed: 0:00:30.913015
</pre></div>
</div>
<div class="outline-4" id="outline-container-org26f1ddd">
<h4 id="org26f1ddd">Plotting the Losses</h4>
<div class="outline-text-4" id="text-org26f1ddd">
<div class="highlight">
<pre><span></span><span class="n">losses</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">Step</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">losses</span><span class="p">))),</span>
                               <span class="n">Loss</span><span class="o">=</span><span class="n">trainer</span><span class="o">.</span><span class="n">losses</span><span class="p">))</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Step"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Loss"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Training Losses"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"train_loss"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="posts/nlp/machine-translation-transformation-matrix/train_loss.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Although the losses continue to go down, it looks like most of the gains come in the first 100 rounds of training.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org76c77f1">
<h2 id="org76c77f1">End</h2>
<div class="outline-text-2" id="text-org76c77f1">
<ul class="org-ul">
<li>The master post with links to all the posts in this series is <a href="posts/nlp/machine-translation/">Machine Translation</a>.</li>
<li>The next post in this series is <a href="posts/nlp/machine-translation-k-nearest-neighbors/">Implementing k-Nearest Neighbors for Machine Translation</a>.</li>
<li>This is part of an Assignment for Coursera's Natural Language Processing Specialization, Course 1, Week 4.</li>
</ul>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-14.html" rel="prev">Newer posts</a></li>
<li class="next"><a href="index-12.html" rel="next">Older posts</a></li>
</ul>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
<script type="text/x-mathjax-config">

        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']],},

        });
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script>
<script>

    MathJax = {
        tex: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    }
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script><!--End of body content-->
<footer id="footer"><a href="http://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
